grigory.kislin [2:09 AM] 
joined #hw5.


grigory.kislin [2:10 AM] 
Готов https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson05.md
Успехов!
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


tema.emelyan [2:11 AM] 
joined #hw5 along with 18 others.


Ivanushka [12:00 PM] 
added and commented on this Java snippet
В соответствии с требованиями законодательства доступ к запрашиваемому Интернет-ресурсу 
закрыт.
​
Интернет-ресурс запрещен к распространению судом и/или внесен в один из списков:
​
Федеральный список экстремистских материалов http://www.minjust.ru/nko/fedspisok/
​
Единый реестр доменных имен, указателей страниц сайтов в сети «Интернет» и сетевых адресов,
позволяющих идентифицировать сайты в сети «Интернет», содержащие информацию,
распространение которой в Российской Федерации запрещено http://eais.rkn.gov.ru/
​
Реестр доменных имен, указателей страниц сайтов в сети «Интернет» и сетевых адресов,
позволяющих идентифицировать сайты в сети «Интернет», содержащие информацию,
распространяемую с нарушением исключительных прав http://nap.rkn.gov.ru/
3 Comments Collapse
Проверьте, только у меня так? http://jeeconf.com/archive/jeeconf-2013/materials/spring-data/ -это после шестого видео.



Few 
[12:01 PM] 
Открывается


Ivanushka [12:03 PM] 
@Few Cпасибо.


philip.goldm [1:25 PM] 
@grigory.kislin
>Почему при запросе user.id нам не нужно нужно вытаскивать его из базы?
есть два раза *нужно



philip.goldm [2:44 PM] 
>Раскрасил лог (в Spring Boot по умолчанию он тоже colored)
>Apply 5_3_HW4_optional.patch
кажется необходимо поменять на 5_4_log_colored.patch



Katherine Buzatu [4:10 PM] 
При прогоне тестов в консоли проплывают красивые синенькие логи. Потом они исчезают (*куда?*) и остаются только те, которые, видимо, "result" (но и они не magenta). *Куда уходят остальные логи?*


anpotashev [4:23 PM] 
uploaded this image: А ты где смотришь?
Add Comment



Katherine Buzatu [4:25 PM] 
uploaded this image: Вроде там же...
Add Comment



anpotashev [4:30 PM] 
хм. сменил тему на темную - тоже без проблем.


anpotashev [4:32 PM] 
а попробуй из консоли mvn test

Katherine Buzatu [2 hours ago] 
так все логи. И magenta. А в Run куда они деваются?


anpotashev [4:41 PM] 
uploaded this image: и да, магента:
Add Comment



anpotashev [4:52 PM] 
commented on Ivanushka’s snippet Untitled
видео доступно, а презентация блокирована



grigory.kislin [5:01 PM] 
у меня тоже - презентахи нет.. видео-ок



Few
[5:11 PM] 
через анонимайзер и презентация есть

Katherine Buzatu [2 hours ago] 
И чем думают инициаторы ограничений в сети, которые обходятся в два клика?


Few 
[2 hours ago] 
Это уже пахнет политикой, но тем кому положено думать иной раз не имеют подходящего инструмента :slightly_smiling_face:

Ivanushka [2 hours ago] 
Решил проблему аналогично, спасибо.


Viktor [10:02 PM] 
мне интересно про 5 пункт задания, в частности "HSQLDB (она не умеет работать с Java8 Time API)", не совсем понял. Прогнал тесты на hsqldb. все прошли успешно, т.е. данные в LocalDateTime попали без конвертера, что именно не умеет hsqldb?


anpotashev [10:07 PM] 
конвертацию делает не бд а hibernate, он знает какая база к нему подцеплена и преобразует localdatetime в тот формат, что нужен именно этой субд


RNG [10:10 PM] 
Вот любопытно, hibernate много кто ругает, но при этом он все равно в тренде. Получается никаких серьёзных альтернатив пока нету? (edited)


Viktor [10:11 PM] 
все понял, опять невнимательно прочитал. Говорится именно про jdbc



vch [10:11 PM] 
@Viktor В последней версии hsqldb уже есть поддержка новых типов данных.
Но вроде у вас должна использоваться более старая версия


anpotashev [10:13 PM] 
@RNG альтернатива - реализация jpa на серверах приложений, например.


Viktor [10:15 PM] 
@vch да сейчас перенастроил на jdbc и получил ошибку, иногда туго доходит :smiley:


RNG [10:19 PM] 
@anpotashev Это как? Типа брать чистый jpa и реализовывать самому под свои нужды?


vch [10:20 PM] 
@RNG вот вместо hibernate можно: https://habrahabr.ru/post/247885/
На маленьких проектах - почему бы и нет. (edited)


anpotashev [10:22 PM] 
@RNG если будешь развертывать на сервере приложений поддерживающем javaee 6 или 7 и в приложении у тебя не будет ничего кроме jpa2.0 / 2.1 соответственно, то hibernate там не нужен. JPA - это всего лишь интерфейс.


RNG [10:24 PM] 
@vch Спасибо! Но тут же вопрос, где грань между маленьким проектом и средним к примеру?


vch [10:27 PM] 
@RNG ну вот как станет лень вручную писать sql-запросы и работать без автоматических связей между объектами - значит пора переходить на JPA


RNG [10:36 PM] 
@anpotashev @vch Спасибо за информацию!


RNG [10:42 PM] 
Собсно, к чему я это все спрашивал. Хочу на тестовом задании (которое Григорий дал) заюзать какую-то альтернативу для Hibernate. И судя по всему MyBatis неплох для этой цели.


vch [10:43 PM] 
@RNG на masterjava можно будет с jdbi поиграться (это ещё одна замена hibernate)


grigory.kislin [11:56 PM] 
на тему работы с базой:
MyBatic используют и на больших проектах... все от нужд и тимлида-архитектора зависит
если простой crud- то data-jpa самое удобное
реализаций JPA основных 3 (вторая ссылка сверху у меня в гугл): https://stackoverflow.com/questions/576659/jpa-implementations-which-one-is-the-best-to-use
Toplink / EclipseLink  имеют своих фанатов.. но попурярнее да, hibernate.
вот еще: https://s3-eu-west-1.amazonaws.com/presentations2012/50_presentation.pdf
я не думаю что на данный момент вам надо этим голову нагружать
stackoverflow.com
JPA Implementations - Which one is the best to use?
I have made use of the following JPA implementations: Hibernate, Toplink, OpenJPA Each of them has their own strengths and weaknesses. I found Hibernate the most advanced of the three except that...

itAvgur [9 hours ago] 
Не проникся я пока Hibernate'ом.
ИМХО костыль для тех, кто в SQL лезть не хочет (а надо).
MyBatis, как обертка к JDBC - интересный продукт. :ok_hand:


Few [6:23 AM] 
В разделе про транзакции ссылка "How does Spring @Transactional Really Work" у кого-нибудь открывается?


Tanya [7:04 AM] 
не работает, надо поправить
скорее всего эта статья
https://dzone.com/articles/how-does-spring-transactional (edited)


Few [7:05 AM] 
@Tanya спасибо


Tanya [7:06 AM] 
пожалуйста :slightly_smiling_face:


grigory.kislin [11:26 AM] 
всем привет!
ссылку поправил. и- забыл вчера отослать письмо по 5му занятию, счас вышлю


Ivanushka [6:47 PM] 
Подскажите (были проблемы с патчами, с Заданием ещё не разбирался) с выбранными (одинаковыми) профилями UserServiceTest валится после всех патчей?


Dmitry Makarov [6:52 PM] 
еще ничего не делал но уже тест валится?


Ivanushka [6:53 PM] 
5_5 Patch не накатывается, это только у меня? (говорит не может вставить TomCat version "Can`t apply 1 of 3 hunks")


Dmitry Makarov [6:53 PM] 
у меня все накатилось


Ivanushka [6:53 PM] 
@Dmitry Makarov Совершенно верно.


Few
[6:54 PM] 
UserServiceTest работает



[6:54] 
если с выбранными профилями не напутал


Dmitry Makarov [6:54 PM] 
у него патчи не накатились


Ivanushka [6:54 PM] 
Спасибо.


Ivanushka
[7:01 PM] 
IDEA до 2017.3 кто-то обновлял? До патчей...


Few [7:06 PM] 
После патчей уже


Dmitry Makarov [8:16 PM] 
у кого валидация работает?


Argentum_kuh [12:00 AM] 
Народ, после патча 5.5 падает тест на Postrges. Так и задумано?


Argentum_kuh [12:12 AM] 
Говорит dataSource не могет создать


Argentum_kuh [12:23 AM] 
О, ложная тревога


Kirilo [1:46 AM] 
Произношение английских слов, конечно... Ухо режет. Особенно в видео 5_1 с 17:57 по 18:01 :slightly_smiling_face:  Thread все-таки немного не так читается... :slightly_smiling_face:


Vladimir_X [9:09 AM] 
после установки последнего патча проект перестал запускаться. Выдавал длиннющую простыню в консоль, мол не может найти файл ehcache.xml, хотя файл был на месте. После (не)продолжительных танцев-с-бубном выяснилось, что у одной из папок, в которой лежит проект, был пробел в названии. Переименовал папку и всё заработало


philip.goldm [9:50 AM] 
ребят привет! Кому нибудь удалось реализовать save(Meal meal, int userId) в DataJpaMealRepositoryImpl?
если да, реализовали через подсказку? или по другому?
>6: В Data-Jpa метод для ссылки на entity (аналог em.getReference) : T getOne(ID id)
Чтото у меня не получается подтянуть user в meal.setUser

anpotashev [3 hours ago] 
И тебе привет!
Чтобы воспользоваться User getOne(id) вроде нужен CrudUserRepository


philip.goldm [2 hours ago] 
вот тоже подумываю. Но меня останавливает, только то, что здесь идет создание и обращение в UserRepository из другого repository. По логике MealRepository не должен знать об UserRepository. Только на уровне Service.


philip.goldm [2 hours ago] 
в любом случае, спасибо тебе за совет. Этот вариант работает, но мне кажется это не правильно.


anpotashev [2 hours ago] 
Если хочешь можешь создать еще один JpaRepository<User, Integer> в котором ничего не будет кроме getOne. Но, имхо, это лишнее


philip.goldm [2 hours ago] 
интересно мнение: Как считаешь, это правильно что в MealRepositoryImpl есть есть обращение в CrudUserRepository?


anpotashev [2 hours ago] 
Если одну реализацию репозитория делает один разработчик. а другую другой, то, наверно неправильно. А если один, то почему бы нет.


fbochkarev [12:29 PM] 
После патча 5_5 spring-db.xml и в нем ${jdbc.initLocation}  подчеркивает красным и при запуске tomcat-а, и выборе user-а, падает с 500 ошибкой, хотя на hsqldb.properties пробрасывает. (edited)


Few 
[12:33 PM] 
я Григорию уже писал, что это исправляется заменой значения проперти на (edited)


[12:33] 
jdbc.initLocation=db/initDB.sql


[12:33] 
ну и соответственно в xml:


[12:33] 
<jdbc:script location="classpath:${jdbc.initLocation}"/>


[12:34] 
но он не оценил видимо, может это идеологически не правильно


[12:34] 
но проблему решает и работает
хотя оно и без этого работает, но идея подчеркивает

fbochkarev [3 hours ago] 
А 500 ошибка должна послевыбора юзера на сайте падать?


Few 
[3 hours ago] 
ну если ты только применил патчи и еще не реализовал мил репозиторий, то работать у тебя не будет


fbochkarev [3 hours ago] 
в общем с подчеркиванием жить можно?


Few 
[3 hours ago] 
можно



Few [3 hours ago] 
Ошибка твоя связана с профилями, видимо ее всем предстоит исправить


vasiliyeskin [1:22 PM] 
Спасибо! Был та же самая ошибка. Только после удаления пробела из названия папки "нашёлся" ehcache.xml.
Vladimir Khmelnitsky
после установки последнего патча проект перестал запускаться. Выдавал длиннющую простыню в консоль, мол не может найти файл ehcache.xml, хотя файл был на месте. После (не)продолжительных танцев-с-бубном выяснилось, что у одной из папок, в которой лежит проект, был пробел в названии. Переименовал папку и всё заработало
Posted in #hw5Today at 9:09 AM


MetalBro [1:39 PM] 
где-нибудь есть описание встроенного парсера методов DATA JPA, не только исходники?


[1:39] 
я смотрю он почти все понимает)


vch [1:43 PM] 
@MetalBro Да, такой искусственный интеллект достоин уважения.
Поэтому лучше соблюдать вежливость: `findПожалуйстаById(id)`



MetalBro [1:43 PM] 
или get)


philip.goldm [3:48 PM] 
https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation
Andrey Klimenko
где-нибудь есть описание встроенного парсера методов DATA JPA, не только исходники?
Posted in #hw5Today at 1:39 PM



Антон Кляшторный [4:37 PM] 
сколько тестов в итоге получится должно? у меня Tests run: 58, Failures: 0, Errors: 0, Skipped: 0


anpotashev [5:38 PM] 
@Dmitry Makarov ого, откуда столько?


MetalBro [5:41 PM] 
у кого-нибудь работает MealServiceTest если менять профили в spring-db.xml, а не вкидывать вручную @ActiveProfiles () ?


[5:42] 
environment тоже видеть не хочет


anpotashev [5:52 PM] 
@MetalBro тесты в мавен можно запускать с указанием профиля (который из pom), mvn -Phsqldb clean test - запустить тесты на hsql, mvn clean test - на профиле по умолчанию, т.е. postgres.
Если правильно понял вопрос


anpotashev [5:56 PM] 
А как ты делаешь профиль активным в spring-db?

MetalBro [5 hours ago] 
через идею change profiles. Кстати, посмотрел твой гит, неужели у тебя работает? (edited)


Dmitry Makarov [5:56 PM] 
@anpotashev на самом деле "Tests run: 103, Failures: 0, Errors: 0, Skipped: 0" сделал clean


MetalBro [5:58 PM] 
после например такого переноса     <beans profile="jdbc">
       <context:component-scan base-package="ru.javawebinar.**.repository.jdbc"/>
       <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
           <constructor-arg ref="dataSource"/>
       </bean>

       <bean id="namedJdbcTemplate" class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate">
           <constructor-arg ref="dataSource"/>
       </bean>
   </beans>


[5:58] 
он не может загрузить контекст

[5:59] 
ни отдельно MealService ни Maven. Кстати, у нас ведь на MealServiceTest стоит автоматический resolver, и он распознает только базу


[5:59] 
если ему вручную добавить в параметрах какой-нибудь профиль реализации репозитория, то он работает, а так нет


[5:59] 
хз почему

[6:01] 
может где-то баг, не должно же быть так

[6:02] 
контекстные файлы указаны перед тестами, а вот с профилями возникают проблемы

anpotashev [6:05 PM] 
3: Сделать тесты всех реализаций (jdbc, jpa, datajpa) через наследование (без дублирования)
3.1 сделать один базовый класс для MealServiceTest и UserServiceTest.
ты сейчас над этим работаешь?


MetalBro [6:06 PM] 
Нет, я вынес репозитории в профили и попробовал запустить тесты, меняя профили в идее


[6:07] 
Разве не должно работать?

MetalBro [6:12 PM] 
Если определить репозиторий вне профиля и выше базы, то работает, иначе нет


anpotashev [6:14 PM] 
в идее ты меняешь профили мавена

MetalBro [6:17 PM] 
ты пробовал писать ActiveProfileResolver?

anpotashev [6:17 PM] 
Нет


MetalBro [6:20 PM] 
[ERROR]   MealServiceTest.testDelete ? IllegalState Failed to load ApplicationContext
на всех

[6:20] 
хз

anpotashev [6:25 PM] 
Можно спросить, а на основании каких данных ты резолвишь профили?


MetalBro [6:27 PM] 
ха, вот еще WARNING] The requested profile "jdbc" could not be activated because it does not exist


[6:27] 
какие данные

[6:28] 
реализован datajpa


[6:28] 
ну и все, остальное стандартное. Что имеешь в виду, на какие данные смотреть?


anpotashev [6:28 PM] 
Ну вот с бд понятно - там данные наличие или отсутствие jdbc-драйвера postgres, а вот как с выбором профиля имплементации поступить можно не представляю.


MetalBro [6:30 PM] 
ощущение, что просто не видятся профили


[6:30] 
репозиториев

[6:30] 
неясно почему

MetalBro [6:36 PM] 
Наверно так не должно работать без реализации всех по профилям. Будем проверять. Вот если отправлять профиль сразу в метод MealServiceTest, тогда этого не надо, и абстрактных классов тоже. Но как это сделать? Базу он ищет очень интересно


Dmitry Makarov [6:45 PM] 
какие профили ты указал в MealServiceTest?


MetalBro [6:46 PM] 
там походу без абстраций не будет работать

[6:47] 
в самом MealServiceTest специально не указана реализация репозитория, как и было раньше, она только в конфиге spring-db.xml


[6:47] 
а там разделено по профилям

Dmitry Makarov [6:47 PM] 
Все правильно. Попробуй 2 профиля укажи в аннотации (edited)


MetalBro [6:48 PM] 
ну да, если профиль конкретно указать, resolver + например, "jdbc", то заработает


[6:48] 
я вообще пытался автоматическое распознавание репозиториев сделать, но там что-то вообще хитрое делать надо


Dmitry Makarov [6:49 PM] 
давно спал?


MetalBro [6:49 PM] 
верней в резолвере сделать так


[6:49] 
return new String[]{Profiles.getActiveDbProfile(), "jdbc"};


[6:50] 
базу определяем автоматически, а репозиторий даже интересно стало как можно

[6:51] 
спал вроде нормально, но надо было все пункты пройти, а то голова вспухла)


[6:51] 
когда с этим начал разбираться

[6:51] 
Григорий еще константы зашил     public static final String
           JDBC = "jdbc",
           JPA = "jpa",
           DATAJPA = "datajpa";

   public static final String REPOSITORY_IMPLEMENTATION = DATAJPA;

[6:52] 
чтобы запутать еще



Dmitry Makarov [6:52 PM] 
Я вообще с этим резолвером ничего не делал. Ты сейчас на каком-то пункте или сам по себе код ковыряешь?


MetalBro [6:52 PM] 
я после 2 пункта попробовал запустить тесты и они не пошли. Думал без абстрактных должны


[6:53] 
ладно, но пытался ковырять


philip.goldm [11:01 PM] 
>8: Для достать по id пользователя вместе с его едой я в User добавил List<Meal> meals
В User нет List<Meal> meals. Может быть имеется ввиду добавить List<Meal> meals в User?


Tanya [11:45 PM] 
@philip.goldm да, добавить в класс User



----- Today December 3rd, 2017 -----
Ivanushka [8:50 AM] 
Товарищи, выручайте. Не получается накатить патчи начиная с 5_5 ругается на строчку с версией "TomCat" (121 строка в файле). Сегодня увидел в Project_change изменения в патчах, выкачал их по новой из Google_drive, а там никаких изменений. Подскажите как быть?

philip.goldm [8 hours ago] 
>5_5 ругается на строчку с версией "TomCat" (121 строка в файле).


Пришли детали ошибки.


Ivanushka
[7 hours ago] 
IDEA говорила, что не может вставить 19 строку "TomCat-version", и далее во всех следующих патчах ошибок от 3 до 6. 

Перекачал ветку мастер из оригинального https://github.com/JavaWebinar/topjava.git - тесты на User проходят, продолжаю изучать материал.
Спасибо.
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


Ivanushka [8:54 AM] 
...
Туплю, это же просто Григорий накатил патчи... И они накатились...


grigory.kislin [11:12 AM] 
> 5_5 ругается на строчку с версией "TomCat"
https://github.com/JavaOPs/topjava/wiki/git#patch-%D0%BD%D0%B5-%D0%BD%D0%B0%D0%BA%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BF%D1%80%D0%B5%D0%B4%D0%BB%D0%B0%D0%B3%D0%B0%D0%B5%D1%82-merge
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 


Serge [11:15 AM] 
uploaded this image: Ребят, помогите… готлова-стол…
  Add Comment

Serge [11:15 AM] 
uploaded this image: 2017-12-03 в 12.02.00.jpg
Add Comment



Serge [11:15 AM] 
почему?


Few 
[11:20 AM] 
тут говорили что может не найти из-за пробелов в пути

[11:20] 
у тебя не?


[11:20] 
подозрительно выглядит участок пути google........


Serge [11:23 AM] 
не думаю, остальное все находит же по этому пути, только cache ему не угодил чем то

Few 
[11:24 AM] 
Вот посмотри
Vladimir Khmelnitsky
после установки последнего патча проект перестал запускаться. Выдавал длиннющую простыню в консоль, мол не может найти файл ehcache.xml, хотя файл был на месте. После (не)продолжительных танцев-с-бубном выяснилось, что у одной из папок, в которой лежит проект, был пробел в названии. Переименовал папку и всё заработало
Posted in #hw5Yesterday at 9:09 AM


grigory.kislin [11:24 AM] 
@Serge не должно в пути быть пробелов, русских букв и пр. ктото обязательно споткнется
у меня про tomcat написано


Few 
[11:24 AM] 
минимум двое с этим столкнулись


Serge [11:30 AM] 
действительно в этом дело… удивительно что конфиги спринга и логгера до этого находил нормально…  плавающий баг видимо


Ivanushka 
[12:00 PM] 
У кого-то получился метод "Meal...getAll" через "private static final Sort SORT_DATA_DESC = new Sort(Sort.Direction.DESC, "date_time");"?
Сам смог только через Query сделать. Если не жалко скиньте в личку. (Докопался до того, что Hibernate не знает Java8 нужно добавить зависимостей... https://stackoverflow.com/questions/40616629/spring-data-repository-find-method-with-orderby-gets-the-wrong-order)
stackoverflow.com
Spring Data Repository: "find" method with orderBy gets the wrong order
I have a Spring Boot application with some JPA repositories. I defined the following method inside one of the repository interfaces: public List<Post> findAllByOrderByPublishedOnDesc(); ...
 


Valery [12:52 PM] 
как подружить resolver и profiles в @ActiveProfiles? когда задаю 2 профиля - работает. 1 профиль + резолвер = Failed to load ApplicationContext.

philip.goldm [4 hours ago] 
Убедись, что у всех  классов repository добавил анатацию @Profile(..). А также, в spring-db.xml настроены профили. 

>Failed to load ApplicationContext.
Пришли детали ошибки


Valery [3 hours ago] 
проблема устранена. профиль репо надо было  в наследнике задавать. 
а по аннотиции @Profile(..) не совсем ясно. она нужна когда весь контекст задается в классе. в нашем проекте все бины описаны в xml файлах.


philip.goldm [3 hours ago] 
>в нашем проекте все бины описаны в xml файлах.
Не совсем так. Если посмотришь, то в pring-db.xml увидишь, что идет сканирование всех классов
>p:packagesToScan="ru.javawebinar.**.model"
Посмотри, здесь есть пример использование @Profile
https://www.mkyong.com/spring/spring-profiles-example/


philip.goldm [3 hours ago] 
На пример, @Profile(Profiles.JDBC) 
JdbcUserRepositoryImpl позволяет явно указать, что будет сканировать только в случает если используется профиль JDBC


Valery [3 hours ago] 
сканирование, как я понимаю, нужно для автосвязывания. в примере бины описаны в AppConfig.java, посему и нужна аннотация @Profile


Andrew [4:03 PM] 
После последнего патча с кешем, падают тесты для юзера с java.lang.IllegalStateException: Failed to load ApplicationContext. Это только у меня?)


Дима Жуков 
[4:06 PM] 
У меня вроде норм


Few [4:17 PM] 
Почитай подробнее лог, там объяснение должно быть


[4:17] 
Ищи самую длинную строку


Andrew [4:20 PM] 
Error parsing XML configuration at /topjava-1/target/classes/cache/ehcache.xml (edited)


Few
[4:23 PM] 
Возможно не находит конфиг,  у тебя в пути к проекту нет пробелов или русских букв?

Andrew [4:24 PM] 
Есть... но только на кеше упало?( Попробую странить

Few
[4:28 PM] 
не сомневайся, в этом проблема

Andrew [4:30 PM] 
Убрал пробел, ексепшн поменялся. org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be null when 'hibernate.dialect' not set


Few
[4:33 PM] 
снова надо искать объяснение в логе


Andrew [4:39 PM] 
Блин, беда была в том, что упал сервис постгреса, но в логах было непонятно


Andrew [5:12 PM] 
В Мил Круд интерфейсе, получается, всё надо через аннотацию @Query делать?


Few
[5:15 PM] 
а как же МАГИЯ? :slightly_smiling_face:


Andrew [5:16 PM] 
Но ведь Юзер айди..


Few
[5:16 PM] 
ага, но Магия и это может )


Дима Жуков [5:21 PM] 
Я тоже думал только через @Query ..


Few
[5:24 PM] 
ну я тоже сначала, но решил попробовать угадать, Евгений Борисов убедительно рассказывал


Anton K. [5:25 PM] 
Подскажите, почему мавен не видит тесты в папке сервис, т.е когда выбираю в мавене test отрабатывают только тесты контроллера


Viktor [5:33 PM] 
@Anton K. тесты должны лежать в папке test


Few [5:37 PM] 
ну наверное и имеется в виду папка service в test

Anton K. [5:43 PM] 
да лежат в папке тест


Viktor [5:44 PM] 
отвалилась у меня привычка гадать :smiley: вот ты думаешь что человек говорит про папку test/service и пытаешься помочь, советуешь ищешь. А окажется что имелось ввиду src/java/test/service :smiley:


[5:44] 
@Anton K. кинь скрин структуры


Anton K. [5:45 PM] 
uploaded this image: image.png
Add Comment



Anton K. [5:47 PM] 
вон в тестах все вроде


Viktor [5:50 PM] 
какие конкретно тесты он не видит. слева указаны как раз тесты из сервиса и они прошли

Anton K. [4 hours ago] 
Если через maven запускаю то они не запускаются


Viktor [4 hours ago] 
и мавен при этом ничего не говорит?


Andrew [6:05 PM] 
Раньше мы Юзера в JPA получали для мил через Ентити менеджер референс, а теперь как правильно надо? (Или new User().setId() это норм? )


grigory.kislin [6:12 PM] 
@Andrew тоже чз референс правильно


Valery [6:33 PM] 
>а как же МАГИЯ?
почему-то 'int deleteById(int id);' магии не поддается.


Few
[6:34 PM] 
а магия только на get работает


[6:34] 
насколько я понял

Few
[6:34 PM] 
delete через @Query

anpotashev [3 hours ago] 
delete тоже работает


RNG [6:35 PM] 
Я вот тоже плюнул на всю эту магию и сделал через `@Query`. С магией только метод `save` работает.


Valery [6:36 PM] 
получилось с int deleteUserById(int id). это противоречит наставлениям Григория не дублировать имена класса в именах методов. но работает (edited)


Andrew [6:38 PM] 
@RNG я пока не могу подобрать заклинание для Бетвин дейтс, а остальное Магия порешала


[6:38] 
findAllByUserIdWhereDateBetween(int user_id, java.sql.Date from, java.sql.Date to) - почему это заклинание не работает, не понимаю


Few [6:39 PM] 
DateTime


Katherine Buzatu [6:39 PM] 
У всех с "магией" запросы с JOIN получаются?


Andrew [6:39 PM] 
Я его перевёл


Few
[6:39 PM] 
он же от имени поля отталкивается

[6:40] 
да и не надо больше в дату преводить же вроде, уже поддерживается Java 8 Time

Andrew [6:40 PM] 
У меня ругается


[6:43] 
Начало работать когда убрал Where ..


anpotashev [6:43 PM] 
delete тоже работает


Few [6:49 PM] 
@anpotashev а где найти нормальное описание? Я читал Spring Data JPA - Reference Documentation и там вот что написано:
   The mechanism strips the prefixes find…By, read…By, query…By, count…By, and get…By from the method and starts parsing the rest of it.


anpotashev [6:49 PM] 
я пользовался ctrl+space - идея показывает варианты



Few [6:50 PM] 
Это уже высшая магия как я понимаю :grinning:


anpotashev [6:50 PM] 
Попробуй - понравится


Few [6:51 PM] 
Да я верю, просто хочется найти первоисточник

Valery [7:00 PM] 
как определить тип возвращаемого заклинания?


[7:02] 
в CrudRepository операция удаления возвращает void. 
в CrudUserRepository наша операция удаления возвращает int.


anpotashev [7:02 PM] 
Глагол не тот. Не определить а задать.


Valery [7:03 PM] 
то есть не надо угадывать?


[7:03] 
вернется тот, что попросим?


anpotashev [7:04 PM] 
Насколько понял, да. Естественно в рамках того что он вообще может вернуть


Dmitry Makarov [7:14 PM] 
CrudMealRepository юзера не может вернуть


Valery [7:20 PM] 
почему? у еды есть поле user. значит можно написать такой запрос.


Dmitry Makarov [7:28 PM] 
запрос или магию?

Vladimir_X [7:31 PM] 
Вдруг ещё актуально, в названии класса слово "Тест" должно быть последним. Тогда Мавен его увидит
Anton Kuznetsov
Подскажите, почему мавен не видит тесты в папке сервис, т.е когда выбираю в мавене test отрабатывают только тесты контроллера
Posted in #hw5Today at 5:25 PM
 


Few
[7:34 PM] 
http://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html



grigory.kislin [8:28 PM] 
Всем привет! добавил в ДЗ поправку:
3.2 сводку по времени выполнения тестов также сделать для user


Katherine Buzatu [8:35 PM] 
Вот оно наследование! А через неделю - убрать. И приехали!


Dmitry Makarov [8:49 PM] 
@Katherine Buzatu придумала как сделать реализацию секундомера?


Katherine Buzatu [9:00 PM] 
@Dmitry Makarov Еще в прошлый раз. Жду, когда его красивше сделают/


dyakoven [12:05 AM] 
после реализации DataJpaMealRepositoryImpl приложение валится. хотя все тесты проходят нормально


[12:05] 
вот такой эксепшн бросает


dyakoven [12:06 AM] 
added this Plain Text snippet
java.lang.IllegalArgumentException: Invalid boolean value [${jpa.showSql}]
  org.springframework.beans.propertyeditors.CustomBooleanEditor.setAsText(CustomBooleanEditor.java:126)
  org.springframework.beans.TypeConverterDelegate.doConvertTextValue(TypeConverterDelegate.java:465)
  org.springframework.beans.TypeConverterDelegate.doConvertValue(TypeConverterDelegate.java:438)
  org.springframework.beans.TypeConverterDelegate.convertIfNecessary(TypeConverterDelegate.java:192)
  org.springframework.beans.AbstractNestablePropertyAccessor.convertIfNecessary(AbstractNestablePropertyAccessor.java:585)
  org.springframework.beans.AbstractNestablePropertyAccessor.convertForProperty(AbstractNestablePropertyAccessor.java:604)
  org.springframework.beans.BeanWrapperImpl.convertForProperty(BeanWrapperImpl.java:219)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.convertForProperty(AbstractAutowireCapableBeanFactory.java:1656)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1612)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1352)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:502)
  org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:312)
  org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:124)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1607)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1352)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:502)
  org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:312)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:228)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:310)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
  org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1083)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:858)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:549)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:144)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:95)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:478)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:624)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:799)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1455)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Add Comment Collapse



dyakoven [12:07 AM] 
когда нажимаешь на переменную, то перебрасывает в проперти файл


Viktor [12:12 AM] 
"Ненавижу магию", вопрос с горяча, кто смог создать метод получения всей еды пользователя в интерфейсе?

Katherine Buzatu [11 hours ago] 
Ты про метод типа ДайМнеВсеВКрасивомВиде?


Viktor [11 hours ago] 
типо того, сейчас прокатило и я немного в шоке :smiley:


Viktor [11 hours ago] 
блин даже delete так сделал.... ненавижу магию.


Viktor [11 hours ago] 
единственный метод который мне пришлось писать - save


Viktor [11 hours ago] 
все остальное магия в именах методов


Katherine Buzatu [11 hours ago] 
...и в генерируемых запросах...


Viktor [11 hours ago] 
ну если не смотреть в лог, то все что нужно написать правильно имя метода в интерфейсе, при это имя состоит из 13 слов


Viktor [11 hours ago] 
если бы идея не начала подсказывать, я бы их все писал бы через аннотацию, а так ни одного запроса, и всего 1 метод реализован.


Viktor [11 hours ago] 
а не это метод для получения еды между датами в 13 слов, получение всей еды 9 слов.


Viktor [12:12 AM] 
@dyakoven при запуске надо указать нужный профиль спринга


[12:13] 
@dyakoven Если запускаешь через IDEA добавь в параметры запуска -Dspring.profiles.active=test(тут имя профиля)


dyakoven [12:16 AM] 
@Viktor спасибо


dyakoven [12:49 AM] 
что должно входить в настройки спринг профиля jdbc/jpa/datajpa?


Viktor [1:11 AM] 
ответы тут пока не выкладываем :smiley: а так все что к каждому их них относится


Viktor [1:57 AM] 
не совсем понял, что делать "3.1 сделать один базовый класс для MealServiceTest и UserServiceTest.". Попробовал вынести в общий класс таймер, но как-то не очень, все тесты в кучу сваливаются в итоговом отображении.


Tanya [2:05 AM] 
ну так не сваливай


Viktor [2:36 AM] 
так вопрос, что выносить в общий класс? у меня просто подозрение, что я опять что-то не понял


Tanya [2:40 AM] 
@Viktor
> вынести в общий класс таймер
выноси таймер, но надо поправить, чтобы итоги не копились, а обнулялись для каждого класса


Viktor [2:51 AM] 
@Tanya да посидел - придумал кажется :smiley:


[2:52] 
я сначала подумал, что это как-то конкретно связанно с тестами, т.к. подпункт к созданию тестов.


Few [6:17 AM] 
И все-таки как правильно задействовать профили спринга для сервлета и SpringMain: через -Dspring.profiles.active или программно?


Anton K. [7:37 AM] 
Подскажите куда смотреть, чтобы починить сервлет, в web.xml вставил строчки для active prоfile согласно документации, но когда поднимается контекст спринга он сразу же падет т.к. не видит имплементацию для репозитория (edited)

Dmitry Makarov [4 hours ago] 
AbstractApplicationContext, ConfigurableEnvironment, AbstractRefreshableConfigApplicationContext


Dmitry Makarov [7:49 AM] 
@Few я думаю spring.profiles.active более гибкое решение


Few [7:51 AM] 
Григорий в 6 пункте пишет: Попробуйте поднять Spring контекст без использования spring.profiles.active.


Dmitry Makarov [7:53 AM] 
Григорий хочет, чтобы мы документацию по классам почитали :slightly_smiling_face: (edited)


Few [7:55 AM] 
ну я пока разбирался три варианта освоил :slightly_smiling_face:, но оставил все-таки один из программных


Dmitry Makarov [7:56 AM] 
я тоже посмотрел варианты, попробовал


Dmitry Neustupov [8:07 AM] 
Товарищи, подскажите, после патча 5.6 не схватывает Постгрес, с HSQLDB работает нормально, тесты проходят, переключаю везде на Постгрес и не видит в Profiles драйвер на Постгрес. Вроде делаю всё как написано в уроке ( Куда копать? В мавене профиль поменял, реимпорт сделал, в впринге профиль поменял - колин в мавене сделал...


CRCx86 [8:29 AM] 
у меня странное поведение в гите, делаю ветку HW4, делаю доработки в ней, а доработки попадают и на мастер


[8:29] 
подскажите, что не так?

Viktor [8:40 AM] 
@Dmitry Neustupov "Вопросы с просьбами помочь с отладкой («почему этот код не работает?») должны включать желаемое поведение, конкретную проблему или ошибку и минимальный код для её воспроизведения прямо в вопросе. " из правил SO


Антон Кляшторный [9:17 AM] 
Привет всем! В 7.1 достаю юзера с едой, а обратно он не засовывается, валятся все тесты с update, save :( нужно usera настраивать или тест подгонять?


anpotashev [10:20 AM] 
@Антон Кляшторный д.б. два разных метода: достать юзера и достать сытого юрера.


ujwegh [12:03 PM] 
Всем привет, такой вопрос: при запуске тестов, какой бы профиль не выбрал, не проходят тесты в JDBC Meal (testSave, testUpdate, testGetBetween). Ругается на неправильную грамматику SQLorg.springframework.jdbc.BadSqlGrammarException: PreparedStatementCallback; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: incompatible data type in conversion. Саму jdbc репу не менял


Dmitry Makarov [12:08 PM] 
jdbc postgres тоже не проходит?


ujwegh [12:08 PM] 
да


[12:09] 
хотя нет


[12:09] 
с postgre прошло(сделал clean)


Dmitry Makarov [12:09 PM] 
5 пункт делал?


ujwegh [12:10 PM] 
нет еще

Dmitry Makarov [12:10 PM] 
он эту проблему решает


ujwegh [12:10 PM] 
ну хорошо


Katherine Buzatu [1:12 PM] 
У Spring Data отличаются префиксы get и find, или это синонимы?


Few [1:14 PM] 
find, read, query, get, вроде все синонимы


Katherine Buzatu [1:27 PM] 
Озадачило это:
>  В Data-Jpa метод для ссылки на entity (аналог em.getReference) : T getOne(ID id)


Vladimir_X [1:48 PM] 
а кто-то смог сделать метод save для CrudMealRepository в стиле сохраниПожалуйстаЭтуЕдуСВотЭтимЮзером()??? хочется все методы в таком стиле сделать, но не вижу среди вариантов слова "save "
З.Ы. все уже видели новый гугловский дудл про алгоритмы?:grinning:


Katherine Buzatu [1:59 PM] 
Кажется, с save они нас прокатили.


Few [2:09 PM] 
Даже пожалуйста не поможет? :slightly_smiling_face:
 

vsimonov [2:35 PM] 
Посоны, почему в профилях dataSource не виден?


Дима Жуков [2:37 PM] 
А профили можно объединять? Типо JPA и DataJpa ну как Css стили типо?))


Katherine Buzatu [2:38 PM] 
Так, что ли?
> Разделить реализации Repository по профилям Spring: jdbc, jpa, datajpa (общее в профилях можно объединять, например <beans profile="datajpa,jpa">)



Дима Жуков 
[2:38 PM] 
Ооо


[2:38] 
Да


[2:38] 
Спасибо


vsimonov [2:50 PM] 
added this Plain Text snippet: ребята в jpa datasource такой же должен быть?
<bean id="dataSource"
       class="org.springframework.jdbc.datasource.DriverManagerDataSource">
      <property name="driverClassName" value="org.postgresql.Driver"/>
      <property name="url" value="${database.url}"/>
      <property name="username" value="${database.username}"/>
      <property name="password" value="${database.password}"/>
    </bean>
Add Comment Collapse



Katherine Buzatu [2:56 PM] 
dataSource относится к самой БД, не к реализации нашего обращения к ней.


vsimonov [3:22 PM] 
без этого ркгается


Viktor [4:53 PM] 
при указании профиля в тестах надо указывать 2: профиль бд и профиль репозитория


Антон Кляшторный [6:51 PM] 
findMealByUserIdAndDateTimeBetweenOrderByDateTimeDesc(userId, startDate, endDate); вот так заклинание :slightly_smiling_face:


Zamyslov Oleg [6:56 PM] 
зато сразу все понятно )


Дима Жуков [6:58 PM] 
Я как getBetween оставил


[6:59] 
Но твое прям вписывается в Спринг.


Valery [7:03 PM] 
>findMealByUserId
в классе еды нету поля userId, магия не срабатывает в этом случае.
или вы в еде храните и user, и userId?


Few [3 hours ago] 
Однако спринг волшебным образом соображает, что Id надо взять из объекта User


Few 
[3 hours ago] 
вложенного


Дима Жуков [7:07 PM] 
Я названия методов копернул с jpa, зря видно я так сделал


Антон Кляшторный [7:08 PM] 
только user в классе Meal


[7:09] 
сначала тоже с JPA, теперь попереписывал все на магические


Andrew [10:01 PM] 
"при указании профиля в тестах надо указывать 2: профиль бд и профиль репозитория"
Когда ставлю галку на два профиля, то идея не включает никакой из них.. Так и должно быть? Вручную надо их переключать в spring-db.xml? Так ведь не кошерно


Few [10:10 PM] 
ты сейчас про какие галки говоришь?


Andrew [10:11 PM] 
Когда попадешь в Чендж профайл диалог спринга


[10:11] 
Там есть галки около профилей


Few 
[10:11 PM] 
это только интеграция с идеей, чтоб она не подчеркивала лишнего


[10:12] 
активировать профили надо отдельно, способ зависит от того, что ты хочешь запустить

[10:13] 
в тестах через @ActiveProfiles, для сервлета и SpringMain есть разные варианты


Andrew [10:13 PM] 
А для главного сервера?


Few 
[10:14 PM] 
для запуска сервлета на томкате?


Andrew [10:14 PM] 
Да, или там тоже надо указать профили?


Few 
[10:14 PM] 
скину в личку если надо, сюда пока не будем решение выкладывать


dyakoven [10:53 PM] 
реализация профилей заключается в том, чтоб разбить содержимое файла spring-db.xml по профилям или еще что-то дописывать в них нужно?


Andrew [11:10 PM] 
Не нужно


Andrew [11:11 PM] 
Друзья, базовый класс тоже прогоняется по тестам, надо его ексклудить как-то?


dyakoven [11:11 PM] 
и как в @ActiveProfiles можно указать несколько профилей? (напр. "hsqldb" и "datajpa")?


Andrew [11:11 PM] 
{}


[11:11] 
Туда идёт стринг массив


[11:12] 
{String1, String2}



dyakoven [11:12 PM] 
`1: Для того, чтобы не запускались родительские классы тестов нужно сделать их abstract`


Andrew [11:13 PM] 
Не читал подсказки, пока сам не помучался.. :slightly_smiling_face: Спасибо



----- Today December 5th, 2017 -----
vsimonov [9:42 AM] 
ай спасибо
Sergeev Viktor
при указании профиля в тестах надо указывать 2: профиль бд и профиль репозитория
Posted in #hw5Yesterday at 4:53 PM


vsimonov [10:16 AM] 
c таким кто сталкивался? "Failed to load ApplicationContext" , аннотация при этом есть 
@ContextConfiguration({
       "classpath:spring/spring-app.xml",
       "classpath:spring/spring-db.xml"
})


Дима Жуков [10:16 AM] 
Да

[10:16] 
По-моему добавил профиль Postgres ещё и норм


[10:17] 
Это в абстрактном классе было

vsimonov [10:19 AM] 
профиль в класс?
Жуков Дмитрий
По-моему добавил профиль Postgres ещё и норм
Posted in #hw5Today at 10:16 AM


Дима Жуков [10:21 AM] 
Я точно не помню как было)) но ошибка была когда тесты прогонял вроде я вынес это в абстрактный класс что профиль Postgres. А в остальных добавлял к постгрес JPA DataJpa и прошло)) вроде бы. Но ошибка точно бфла


[10:24] 
Правда я только 3 пункта сделал:grinning: пока без optional. Ты наверное optional делаешь

CRCx86 [10:27 AM] 
здравствуйте! для пункта 2 домашнего задания нужно заполнить теги
<beans profile="jdbc">
   </beans>
   <beans profile="jpa">
   </beans>
   <beans profile="datajpa">
   </beans>
но откуда узнать заполнение полей таких как, например, "class", "driverClassName" и др.?


Дима Жуков
[10:28 AM] 
Ну там же есть. Просто попереносить в каждый профиль нужное

CRCx86 [10:29 AM] 
где там?

Дима Жуков
[10:29 AM] 
Ну в spring-db (edited)

CRCx86 [10:31 AM] 
Оо

Few 
[10:32 AM] 
просмотри по истории в git содержимое spring-db.xml для всех реализаций (jdbc, jpa, datajpa)


[10:33] 
сделай вывод какие настройки нужны для каждой и заполни профили

dart_rabbit [10:35 AM] 
в @ActiveProfiles у кого-то получилось одновременно сунуть и профиль из Profiles.getActiveDbProfile() и константу для конкретной реализации репозитория?


Few [10:36 AM] 
@ActiveProfiles принимает либо резолвер, либо массив строк


[10:36] 
и то и другое не получится


dart_rabbit [10:36 AM] 
А в массиве строк он хочет видеть константы %(


[10:37] 
Да, я уже уперся)


Few [10:37 AM] 
когда 3 пункт делаешь - проблема решается сама собой (edited)


dart_rabbit [10:41 AM] 
Решилось. Несмотря на то, что дубликатов этой аннотации не допускается, выставленные и в суперклассе и в потомке - работают) Я чо-т думал оно упрется)))


Few [10:41 AM] 
вот, вот :slightly_smiling_face:


dart_rabbit [10:42 AM] 
А вот кстати, resolver и value можно в аннотацию пихать, и аннотация не ругается. Но распознает оно что-то одно))


Few [10:43 AM] 
возможно, знаю только по опыту что не работает )


fbochkarev [10:55 AM] 
4: Запустить все тесты: mvn test (в IDEA Maven Lifecycle - test, кнопку skipTest отжать)
skipTest - где она?


Dmitry Makarov [10:59 AM] 
в Maven projects
	
fbochkarev 13 hours ago
Спасибо, я понял, что в maven-е.

Антон Кляшторный [11:00 AM] 
:zap:


	
anpotashev 11:45 AM
Нашлось слово "пожалуйста" для получения lazy полей без использования @Query. В комментарии подсказка. (edited)

	
anpotashev 12 hours ago
зовется @EntityGraph


	
Few 11:46 AM
договаривай )
anpotashev 11:47 AM
Сейчас добавлю комментарий, кому надо - развернет
vsimonov 12:29 PM
Народ почему магия не работает ?
   @Transactional
   int deleteByIdAndUserId(int id,int userId);
dyakoven 12:31 PM
@Modifying
vsimonov 12:33 PM
не, не в этом дело
dyakoven
@Modifying
Posted in #hw5Yesterday at 12:31 PM
dyakoven 12:36 PM
а, да, без @Modifying у меня работает
Marina 1:43 PM
У меня именно в таком виде работает, хотя совсем недавно не работало, зато List<Meal>findAllByUserId(int id, int userId) наоборот работал, а теперь перестал, причем ничего не меняла. Так что мне эта магия пока не поддается. Если разберешься - напиши, пожалуйста.
vadim simonov
Народ почему магия не работает ?
   @Transactional
   int deleteByIdAndUserId(int id,int userId);
Posted in #hw5Yesterday at 12:29 PM
1:46
Ошиблась в предыдущем сообщении, не работает - List<Meal>findAllByUserId(int userId, Sort sort)
russell 1:46 PM
а что пишет?
Антон Кляшторный 1:51 PM
deleteByIdAndUserId нужно поконкретнее deleteMealByIdAndUserId еду удалить
dart_rabbit 1:54 PM
@Marina попробуй возвращать Optional<List<Meal>> - вдруг у юзера еды нет? (edited)
Marina 2:01 PM
org.springframework.data.mapping.PropertyReferenceException: No property time found for type LocalDate! Traversed path: Meal.date.
Ruslan Shakirov
а что пишет?
Posted in #hw5Yesterday at 1:46 PM
2:01
И если Optional возвращать тоже самое
russell 2:02 PM
а почему дейт у нас же вроде дейтТайм
Marina 2:07 PM
И именно в таком виде работает в прошлом коммите
2:07
Вот и мне не понятно, почему он date ищет
itAvgur 2:07 PM
Наводящие вопросы к п7:
1) mealOfUser @Transient?
2) одним запросом дергаем и User и Meal к нему в репозитории?
Все верно?
Ганичев Максим 2:14 PM
Подскажите пожалуйста "6: Починить MealServlet ". Тут достаточно просто выставить любые два контекста программным путем или тоже должно быть как в тестах с резолвером в зависимости от профеля мавена?

itAvgur 9 hours ago
Резолвер на основе maven - автоматом,
соединение к БД - вручную, из Profiles.


	
Сергей Матвеев 3:52 PM
Подскажите, uptadeTest валиться вот с таким логом Caused by: javax.validation.ConstraintViolationException: Validation failed for classes [ru.javawebinar.topjava.model.Meal] during update time for groups [javax.validation.groups.Default, ]
List of constraint violations:[
    ConstraintViolationImpl{interpolatedMessage='должно быть задано', propertyPath=user, rootBeanClass=class ru.javawebinar.topjava
russell 3:54 PM
ты юзера вставляешь?

	
Сергей Матвеев 8 hours ago
реализация выглядит вот так @Override
   public Meal save(Meal meal,int id) {
       if(meal.isNew()){
       User ref = new User();
       ref.setId(id);
       meal.setUser(ref);
       return crudRepository.save(meal);}
       else return crudRepository.save(meal);
   }
russell 8 hours ago
так если не новый там тоже юзера вставлять надо, глян как в jpa Григорий реализовал
Сергей Матвеев 8 hours ago
Спасибо!


	
Nick 7:31 PM
Почему то TestUpdateNotFound не проходит. Как можно проверить принадлежит ли еда пользователю  в save?
Viktor 7:38 PM
@Nik проверить владельца
Nick 7:46 PM
Решил проблему. Все оказалось гораздо проще.
Антон Кляшторный 8:26 PM
при пользовании метода <T> getOne(userId) возвращается user но с пораженным полем javassistlazyinitializer handler
anpotashev 8:27 PM
Все правильно. getOne - это аналог getReference


Anton K. [6:50 AM] 
Ребят, вопросик такой по п. 7 надо просто поменять текущие методы get или нужно создать отдельные методы соотвественно в сервисе-репозитории??


RNG [7:15 AM] 
@Anton K. Отдельные, хотя они мало чем отличаются от самих `get`.


Rostish [7:32 AM] 
Ни у кого в пятой задаче не было Error creating bean with name ‘mealServiceImpl’ defined in file [/Users/alex/Documents/GitHub/topjava/target/classes/ru/javawebinar/topjava/service/MealServiceImpl.class]:?


[7:32] 
при запуске тестов?


Few
[7:37 AM] 
Там больше должно быть в логе


Rostish [7:47 AM] 
там больше)


Rostish [7:52 AM] 
java.lang.IllegalStateException: Failed to load ApplicationContext
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name ‘mealServiceImpl’ defined in file [/Users/alex/Documents/GitHub/topjava/target/classes/ru/javawebinar/topjava/service/MealServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type ‘ru.javawebinar.topjava.repository.MealRepository’ available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type ‘ru.javawebinar.topjava.repository.MealRepository’ available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}


[7:52] 
я вроде реализовал meal datajpa


[7:52] 
профили сделал


[7:52] 
а тесты чет не запускаются


Few
[7:57 AM] 
Либо профили недобавлены либо в профиле нет ни одного бина репозитория


Rostish [7:59 AM] 
у меня включен постгресс и datajpa


[7:59] 
там вроде все есть


[7:59] 
ща поищу


CRCx86 [8:53 AM] 
здравствуйте! после выбора пользователя при попытки инициализации на строке 
springContext = new ClassPathXmlApplicationContext("spring/spring-app.xml", "spring/spring-db.xml");
приложение падает с ошибкой
java.lang.IllegalArgumentException: Invalid boolean value [${jpa.showSql}]
что не так?