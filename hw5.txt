grigory.kislin [2:09 AM] 
joined #hw5.


grigory.kislin [2:10 AM] 
Готов https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson05.md
Успехов!
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


tema.emelyan [2:11 AM] 
joined #hw5 along with 18 others.


Ivanushka [12:00 PM] 
added and commented on this Java snippet
В соответствии с требованиями законодательства доступ к запрашиваемому Интернет-ресурсу 
закрыт.
​
Интернет-ресурс запрещен к распространению судом и/или внесен в один из списков:
​
Федеральный список экстремистских материалов http://www.minjust.ru/nko/fedspisok/
​
Единый реестр доменных имен, указателей страниц сайтов в сети «Интернет» и сетевых адресов,
позволяющих идентифицировать сайты в сети «Интернет», содержащие информацию,
распространение которой в Российской Федерации запрещено http://eais.rkn.gov.ru/
​
Реестр доменных имен, указателей страниц сайтов в сети «Интернет» и сетевых адресов,
позволяющих идентифицировать сайты в сети «Интернет», содержащие информацию,
распространяемую с нарушением исключительных прав http://nap.rkn.gov.ru/
3 Comments Collapse
Проверьте, только у меня так? http://jeeconf.com/archive/jeeconf-2013/materials/spring-data/ -это после шестого видео.



Few 
[12:01 PM] 
Открывается


Ivanushka [12:03 PM] 
@Few Cпасибо.


philip.goldm [1:25 PM] 
@grigory.kislin
>Почему при запросе user.id нам не нужно нужно вытаскивать его из базы?
есть два раза *нужно



philip.goldm [2:44 PM] 
>Раскрасил лог (в Spring Boot по умолчанию он тоже colored)
>Apply 5_3_HW4_optional.patch
кажется необходимо поменять на 5_4_log_colored.patch



Katherine Buzatu [4:10 PM] 
При прогоне тестов в консоли проплывают красивые синенькие логи. Потом они исчезают (*куда?*) и остаются только те, которые, видимо, "result" (но и они не magenta). *Куда уходят остальные логи?*


anpotashev [4:23 PM] 
uploaded this image: А ты где смотришь?
Add Comment



Katherine Buzatu [4:25 PM] 
uploaded this image: Вроде там же...
Add Comment



anpotashev [4:30 PM] 
хм. сменил тему на темную - тоже без проблем.


anpotashev [4:32 PM] 
а попробуй из консоли mvn test

Katherine Buzatu [2 hours ago] 
так все логи. И magenta. А в Run куда они деваются?


anpotashev [4:41 PM] 
uploaded this image: и да, магента:
Add Comment



anpotashev [4:52 PM] 
commented on Ivanushka’s snippet Untitled
видео доступно, а презентация блокирована



grigory.kislin [5:01 PM] 
у меня тоже - презентахи нет.. видео-ок



Few
[5:11 PM] 
через анонимайзер и презентация есть

Katherine Buzatu [2 hours ago] 
И чем думают инициаторы ограничений в сети, которые обходятся в два клика?


Few 
[2 hours ago] 
Это уже пахнет политикой, но тем кому положено думать иной раз не имеют подходящего инструмента :slightly_smiling_face:

Ivanushka [2 hours ago] 
Решил проблему аналогично, спасибо.


Viktor [10:02 PM] 
мне интересно про 5 пункт задания, в частности "HSQLDB (она не умеет работать с Java8 Time API)", не совсем понял. Прогнал тесты на hsqldb. все прошли успешно, т.е. данные в LocalDateTime попали без конвертера, что именно не умеет hsqldb?


anpotashev [10:07 PM] 
конвертацию делает не бд а hibernate, он знает какая база к нему подцеплена и преобразует localdatetime в тот формат, что нужен именно этой субд


RNG [10:10 PM] 
Вот любопытно, hibernate много кто ругает, но при этом он все равно в тренде. Получается никаких серьёзных альтернатив пока нету? (edited)


Viktor [10:11 PM] 
все понял, опять невнимательно прочитал. Говорится именно про jdbc



vch [10:11 PM] 
@Viktor В последней версии hsqldb уже есть поддержка новых типов данных.
Но вроде у вас должна использоваться более старая версия


anpotashev [10:13 PM] 
@RNG альтернатива - реализация jpa на серверах приложений, например.


Viktor [10:15 PM] 
@vch да сейчас перенастроил на jdbc и получил ошибку, иногда туго доходит :smiley:


RNG [10:19 PM] 
@anpotashev Это как? Типа брать чистый jpa и реализовывать самому под свои нужды?


vch [10:20 PM] 
@RNG вот вместо hibernate можно: https://habrahabr.ru/post/247885/
На маленьких проектах - почему бы и нет. (edited)


anpotashev [10:22 PM] 
@RNG если будешь развертывать на сервере приложений поддерживающем javaee 6 или 7 и в приложении у тебя не будет ничего кроме jpa2.0 / 2.1 соответственно, то hibernate там не нужен. JPA - это всего лишь интерфейс.


RNG [10:24 PM] 
@vch Спасибо! Но тут же вопрос, где грань между маленьким проектом и средним к примеру?


vch [10:27 PM] 
@RNG ну вот как станет лень вручную писать sql-запросы и работать без автоматических связей между объектами - значит пора переходить на JPA


RNG [10:36 PM] 
@anpotashev @vch Спасибо за информацию!


RNG [10:42 PM] 
Собсно, к чему я это все спрашивал. Хочу на тестовом задании (которое Григорий дал) заюзать какую-то альтернативу для Hibernate. И судя по всему MyBatis неплох для этой цели.


vch [10:43 PM] 
@RNG на masterjava можно будет с jdbi поиграться (это ещё одна замена hibernate)


grigory.kislin [11:56 PM] 
на тему работы с базой:
MyBatic используют и на больших проектах... все от нужд и тимлида-архитектора зависит
если простой crud- то data-jpa самое удобное
реализаций JPA основных 3 (вторая ссылка сверху у меня в гугл): https://stackoverflow.com/questions/576659/jpa-implementations-which-one-is-the-best-to-use
Toplink / EclipseLink  имеют своих фанатов.. но попурярнее да, hibernate.
вот еще: https://s3-eu-west-1.amazonaws.com/presentations2012/50_presentation.pdf
я не думаю что на данный момент вам надо этим голову нагружать
stackoverflow.com
JPA Implementations - Which one is the best to use?
I have made use of the following JPA implementations: Hibernate, Toplink, OpenJPA Each of them has their own strengths and weaknesses. I found Hibernate the most advanced of the three except that...

itAvgur [9 hours ago] 
Не проникся я пока Hibernate'ом.
ИМХО костыль для тех, кто в SQL лезть не хочет (а надо).
MyBatis, как обертка к JDBC - интересный продукт. :ok_hand:


Few [6:23 AM] 
В разделе про транзакции ссылка "How does Spring @Transactional Really Work" у кого-нибудь открывается?


Tanya [7:04 AM] 
не работает, надо поправить
скорее всего эта статья
https://dzone.com/articles/how-does-spring-transactional (edited)


Few [7:05 AM] 
@Tanya спасибо


Tanya [7:06 AM] 
пожалуйста :slightly_smiling_face:


grigory.kislin [11:26 AM] 
всем привет!
ссылку поправил. и- забыл вчера отослать письмо по 5му занятию, счас вышлю


Ivanushka [6:47 PM] 
Подскажите (были проблемы с патчами, с Заданием ещё не разбирался) с выбранными (одинаковыми) профилями UserServiceTest валится после всех патчей?


Dmitry Makarov [6:52 PM] 
еще ничего не делал но уже тест валится?


Ivanushka [6:53 PM] 
5_5 Patch не накатывается, это только у меня? (говорит не может вставить TomCat version "Can`t apply 1 of 3 hunks")


Dmitry Makarov [6:53 PM] 
у меня все накатилось


Ivanushka [6:53 PM] 
@Dmitry Makarov Совершенно верно.


Few
[6:54 PM] 
UserServiceTest работает



[6:54] 
если с выбранными профилями не напутал


Dmitry Makarov [6:54 PM] 
у него патчи не накатились


Ivanushka [6:54 PM] 
Спасибо.


Ivanushka
[7:01 PM] 
IDEA до 2017.3 кто-то обновлял? До патчей...


Few [7:06 PM] 
После патчей уже


Dmitry Makarov [8:16 PM] 
у кого валидация работает?


Argentum_kuh [12:00 AM] 
Народ, после патча 5.5 падает тест на Postrges. Так и задумано?


Argentum_kuh [12:12 AM] 
Говорит dataSource не могет создать


Argentum_kuh [12:23 AM] 
О, ложная тревога


Kirilo [1:46 AM] 
Произношение английских слов, конечно... Ухо режет. Особенно в видео 5_1 с 17:57 по 18:01 :slightly_smiling_face:  Thread все-таки немного не так читается... :slightly_smiling_face:


Vladimir_X [9:09 AM] 
после установки последнего патча проект перестал запускаться. Выдавал длиннющую простыню в консоль, мол не может найти файл ehcache.xml, хотя файл был на месте. После (не)продолжительных танцев-с-бубном выяснилось, что у одной из папок, в которой лежит проект, был пробел в названии. Переименовал папку и всё заработало


philip.goldm [9:50 AM] 
ребят привет! Кому нибудь удалось реализовать save(Meal meal, int userId) в DataJpaMealRepositoryImpl?
если да, реализовали через подсказку? или по другому?
>6: В Data-Jpa метод для ссылки на entity (аналог em.getReference) : T getOne(ID id)
Чтото у меня не получается подтянуть user в meal.setUser

anpotashev [3 hours ago] 
И тебе привет!
Чтобы воспользоваться User getOne(id) вроде нужен CrudUserRepository


philip.goldm [2 hours ago] 
вот тоже подумываю. Но меня останавливает, только то, что здесь идет создание и обращение в UserRepository из другого repository. По логике MealRepository не должен знать об UserRepository. Только на уровне Service.


philip.goldm [2 hours ago] 
в любом случае, спасибо тебе за совет. Этот вариант работает, но мне кажется это не правильно.


anpotashev [2 hours ago] 
Если хочешь можешь создать еще один JpaRepository<User, Integer> в котором ничего не будет кроме getOne. Но, имхо, это лишнее


philip.goldm [2 hours ago] 
интересно мнение: Как считаешь, это правильно что в MealRepositoryImpl есть есть обращение в CrudUserRepository?


anpotashev [2 hours ago] 
Если одну реализацию репозитория делает один разработчик. а другую другой, то, наверно неправильно. А если один, то почему бы нет.


fbochkarev [12:29 PM] 
После патча 5_5 spring-db.xml и в нем ${jdbc.initLocation}  подчеркивает красным и при запуске tomcat-а, и выборе user-а, падает с 500 ошибкой, хотя на hsqldb.properties пробрасывает. (edited)


Few 
[12:33 PM] 
я Григорию уже писал, что это исправляется заменой значения проперти на (edited)


[12:33] 
jdbc.initLocation=db/initDB.sql


[12:33] 
ну и соответственно в xml:


[12:33] 
<jdbc:script location="classpath:${jdbc.initLocation}"/>


[12:34] 
но он не оценил видимо, может это идеологически не правильно


[12:34] 
но проблему решает и работает
хотя оно и без этого работает, но идея подчеркивает

fbochkarev [3 hours ago] 
А 500 ошибка должна послевыбора юзера на сайте падать?


Few 
[3 hours ago] 
ну если ты только применил патчи и еще не реализовал мил репозиторий, то работать у тебя не будет


fbochkarev [3 hours ago] 
в общем с подчеркиванием жить можно?


Few 
[3 hours ago] 
можно



Few [3 hours ago] 
Ошибка твоя связана с профилями, видимо ее всем предстоит исправить


vasiliyeskin [1:22 PM] 
Спасибо! Был та же самая ошибка. Только после удаления пробела из названия папки "нашёлся" ehcache.xml.
Vladimir Khmelnitsky
после установки последнего патча проект перестал запускаться. Выдавал длиннющую простыню в консоль, мол не может найти файл ehcache.xml, хотя файл был на месте. После (не)продолжительных танцев-с-бубном выяснилось, что у одной из папок, в которой лежит проект, был пробел в названии. Переименовал папку и всё заработало
Posted in #hw5Today at 9:09 AM


MetalBro [1:39 PM] 
где-нибудь есть описание встроенного парсера методов DATA JPA, не только исходники?


[1:39] 
я смотрю он почти все понимает)


vch [1:43 PM] 
@MetalBro Да, такой искусственный интеллект достоин уважения.
Поэтому лучше соблюдать вежливость: `findПожалуйстаById(id)`



MetalBro [1:43 PM] 
или get)


philip.goldm [3:48 PM] 
https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation
Andrey Klimenko
где-нибудь есть описание встроенного парсера методов DATA JPA, не только исходники?
Posted in #hw5Today at 1:39 PM



Антон Кляшторный [4:37 PM] 
сколько тестов в итоге получится должно? у меня Tests run: 58, Failures: 0, Errors: 0, Skipped: 0


anpotashev [5:38 PM] 
@Dmitry Makarov ого, откуда столько?


MetalBro [5:41 PM] 
у кого-нибудь работает MealServiceTest если менять профили в spring-db.xml, а не вкидывать вручную @ActiveProfiles () ?


[5:42] 
environment тоже видеть не хочет


anpotashev [5:52 PM] 
@MetalBro тесты в мавен можно запускать с указанием профиля (который из pom), mvn -Phsqldb clean test - запустить тесты на hsql, mvn clean test - на профиле по умолчанию, т.е. postgres.
Если правильно понял вопрос


anpotashev [5:56 PM] 
А как ты делаешь профиль активным в spring-db?

MetalBro [5 hours ago] 
через идею change profiles. Кстати, посмотрел твой гит, неужели у тебя работает? (edited)


Dmitry Makarov [5:56 PM] 
@anpotashev на самом деле "Tests run: 103, Failures: 0, Errors: 0, Skipped: 0" сделал clean


MetalBro [5:58 PM] 
после например такого переноса     <beans profile="jdbc">
       <context:component-scan base-package="ru.javawebinar.**.repository.jdbc"/>
       <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
           <constructor-arg ref="dataSource"/>
       </bean>

       <bean id="namedJdbcTemplate" class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate">
           <constructor-arg ref="dataSource"/>
       </bean>
   </beans>


[5:58] 
он не может загрузить контекст

[5:59] 
ни отдельно MealService ни Maven. Кстати, у нас ведь на MealServiceTest стоит автоматический resolver, и он распознает только базу


[5:59] 
если ему вручную добавить в параметрах какой-нибудь профиль реализации репозитория, то он работает, а так нет


[5:59] 
хз почему

[6:01] 
может где-то баг, не должно же быть так

[6:02] 
контекстные файлы указаны перед тестами, а вот с профилями возникают проблемы

anpotashev [6:05 PM] 
3: Сделать тесты всех реализаций (jdbc, jpa, datajpa) через наследование (без дублирования)
3.1 сделать один базовый класс для MealServiceTest и UserServiceTest.
ты сейчас над этим работаешь?


MetalBro [6:06 PM] 
Нет, я вынес репозитории в профили и попробовал запустить тесты, меняя профили в идее


[6:07] 
Разве не должно работать?

MetalBro [6:12 PM] 
Если определить репозиторий вне профиля и выше базы, то работает, иначе нет


anpotashev [6:14 PM] 
в идее ты меняешь профили мавена

MetalBro [6:17 PM] 
ты пробовал писать ActiveProfileResolver?

anpotashev [6:17 PM] 
Нет


MetalBro [6:20 PM] 
[ERROR]   MealServiceTest.testDelete ? IllegalState Failed to load ApplicationContext
на всех

[6:20] 
хз

anpotashev [6:25 PM] 
Можно спросить, а на основании каких данных ты резолвишь профили?


MetalBro [6:27 PM] 
ха, вот еще WARNING] The requested profile "jdbc" could not be activated because it does not exist


[6:27] 
какие данные

[6:28] 
реализован datajpa


[6:28] 
ну и все, остальное стандартное. Что имеешь в виду, на какие данные смотреть?


anpotashev [6:28 PM] 
Ну вот с бд понятно - там данные наличие или отсутствие jdbc-драйвера postgres, а вот как с выбором профиля имплементации поступить можно не представляю.


MetalBro [6:30 PM] 
ощущение, что просто не видятся профили


[6:30] 
репозиториев

[6:30] 
неясно почему

MetalBro [6:36 PM] 
Наверно так не должно работать без реализации всех по профилям. Будем проверять. Вот если отправлять профиль сразу в метод MealServiceTest, тогда этого не надо, и абстрактных классов тоже. Но как это сделать? Базу он ищет очень интересно


Dmitry Makarov [6:45 PM] 
какие профили ты указал в MealServiceTest?


MetalBro [6:46 PM] 
там походу без абстраций не будет работать

[6:47] 
в самом MealServiceTest специально не указана реализация репозитория, как и было раньше, она только в конфиге spring-db.xml


[6:47] 
а там разделено по профилям

Dmitry Makarov [6:47 PM] 
Все правильно. Попробуй 2 профиля укажи в аннотации (edited)


MetalBro [6:48 PM] 
ну да, если профиль конкретно указать, resolver + например, "jdbc", то заработает


[6:48] 
я вообще пытался автоматическое распознавание репозиториев сделать, но там что-то вообще хитрое делать надо


Dmitry Makarov [6:49 PM] 
давно спал?


MetalBro [6:49 PM] 
верней в резолвере сделать так


[6:49] 
return new String[]{Profiles.getActiveDbProfile(), "jdbc"};


[6:50] 
базу определяем автоматически, а репозиторий даже интересно стало как можно

[6:51] 
спал вроде нормально, но надо было все пункты пройти, а то голова вспухла)


[6:51] 
когда с этим начал разбираться

[6:51] 
Григорий еще константы зашил     public static final String
           JDBC = "jdbc",
           JPA = "jpa",
           DATAJPA = "datajpa";

   public static final String REPOSITORY_IMPLEMENTATION = DATAJPA;

[6:52] 
чтобы запутать еще



Dmitry Makarov [6:52 PM] 
Я вообще с этим резолвером ничего не делал. Ты сейчас на каком-то пункте или сам по себе код ковыряешь?


MetalBro [6:52 PM] 
я после 2 пункта попробовал запустить тесты и они не пошли. Думал без абстрактных должны


[6:53] 
ладно, но пытался ковырять


philip.goldm [11:01 PM] 
>8: Для достать по id пользователя вместе с его едой я в User добавил List<Meal> meals
В User нет List<Meal> meals. Может быть имеется ввиду добавить List<Meal> meals в User?