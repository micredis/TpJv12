grigory.kislin [12:49 AM] 
joined #hw2.


grigory.kislin [12:52 AM] 
Выложил занятие 2
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson02.md
Закладываем архитектуру приложения, поэтому, если не сталкивались с архитектурой по слоям, непростое.
Не стремитесь прочитать все ссылки урока, пока не сделаете HW2
Ссылки всегда останутся у вас как справочник
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


Vangelis [12:53 AM] 
joined #hw2 along with 18 others.

grigory.kislin [10:31 AM] 
всем привет!
в видео про спиринг неверно сказано про common-logging. maven его подтянет, тк jcl-over-slf4j и common-logging- 2 разные зависимости, что у них одинаковые классы maven не может быть в курсе:) видео с правкой счас перезалью


Fabus [11:11 AM] 
Привет всем! Вопрос мы ведь патчи накатываем на ветку master? А ветки HW1, HW..., и т.д. остаются для нас? Их мержить не надо?

vsergeev [11:11 AM] 
Не надо



Fabus [11:11 AM] 
ок. спасибо


chimax [11:24 AM] 
Еще один шаг вперед)

grigory.kislin [11:43 AM] 
видео перезалил

Shalukhau Dzmitry [11:44 AM] 
@grigory.kislin А ссылочку :slightly_smiling_face:

chimax [11:47 AM] 
ссылка выше - в ветке hw2


Abnod [12:13 PM] 
хм... мне кажется с патчами что т оне то... взял ветку мастер после накатки всех патчей из первого урока.
пытаюсь накатить 2,0 add fix патч
в MealsUtils патч пытается заменить 108ю строку... но у меня в этом файле их всего 59 (edited)

[12:13] 
что я делаю не так? =(

[12:15] 
@here

fbochkarev [12:19 PM] 
@Abnod посмотри сам патч, что там внутри


Abnod [12:22 PM] 
так я ж написал, замена 108й строки :smiley: судя по гиту надо было накатывать опциональный патч 1.3_hw0 из прошлого урока "решение в один стрим". а я его не стал накатывать, т.к. он необязательный, судя по названию =))

[12:22] 
в общем решил вопрос

fbochkarev [12:23 PM] 
@Abnod https://github.com/JavaOPs/topjava/wiki/Git#%D0%9A%D0%B0%D0%BA-%D0%B2%D0%B5%D1%81%D1%82%D0%B8-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82-%D1%83-%D1%81%D0%B5%D0%B1%D1%8F-%D0%B2-%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%BC-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B5
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 


[12:23] 
Правила работы с патчами на проекте


Abnod [12:24 PM] 
да это то я читал... просто когда патчи по дз накатывал, почему то решил третий не накатывать, отсюда и проблема


grigory.kislin [12:25 PM] 
в этом же документе есть раздел- что делать если патч не накатывается
те - как программисты- пытаемся все сделать самостоятельно


Abnod [12:27 PM] 
я решил по простому - зашел на гит и посмотрел историю изменений данного файла :smile:


vsimonov [2:41 PM] 
added this Plain Text snippet: первый домашний патч 2_1_HW1 если запустить ошибка позникает
Type Exception Report
Message An exception occurred processing [/meals.jsp] at line [34]
Description The server encountered an unexpected condition that prevented it from fulfilling the request.
Exception
org.apache.jasper.JasperException: An exception occurred processing [/meals.jsp] at line [34]
31:     </thead>
32:     <c:forEach items="${meals}" var="meal">
33:       <jsp:useBean id="meal" scope="page" type="ru.javawebinar.topjava.model.MealWithExceed"/>
34:       <tr class="${meal.exceed ? 'exceeded' : 'normal'}">
35:         <td>
36:             <%--${meal.dateTime.toLocalDate()} ${meal.dateTime.toLocalTime()}--%>
37:             <%--<%=TimeUtil.toString(meal.getDateTime())%>--%>
Stacktrace:
  org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:593)
  org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:482)
  org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:385)
  org.apache.jasper.servlet.JspServlet.service(JspServlet.java:329)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
  org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
  ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:20)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:634)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
  org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
Root Cause
javax.el.PropertyNotFoundException: Property [exceed] not found on type [ru.javawebinar.topjava.model.MealWithExceed]
  javax.el.BeanELResolver$BeanProperties.get(BeanELResolver.java:260)
  javax.el.BeanELResolver$BeanProperties.access$300(BeanELResolver.java:212)
  javax.el.BeanELResolver.property(BeanELResolver.java:347)
  javax.el.BeanELResolver.getValue(BeanELResolver.java:92)
  org.apache.jasper.el.JasperELResolver.getValue(JasperELResolver.java:110)
  org.apache.el.parser.AstValue.getValue(AstValue.java:169)
  org.apache.el.parser.AstChoice.getValue(AstChoice.java:44)
  org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:184)
  org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(PageContextImpl.java:702)
  org.apache.jsp.meals_jsp._jspx_meth_c_005fforEach_005f0(meals_jsp.java:216)
  org.apache.jsp.meals_jsp._jspService(meals_jsp.java:159)
  org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
  org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:444)
  org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:385)
  org.apache.jasper.servlet.JspServlet.service(JspServlet.java:329)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
  org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
  ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:20)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:634)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
  org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
Note The full stack trace of the root cause is available in the server logs.


Few [2:59 PM] 
Я первые два применил без проблем,  дальше пока не пробовал


aanyukhin [3:00 PM] 
хм. всё поднялось, полёт нормальный.


vsimonov [3:01 PM] 
ок значит у меня чтото


Zipper [3:14 PM] 
Подскажите пожалуйста, мне на почту не пришло письмо с этим занятием. У всех так или только у меня?


Abnod [3:16 PM] 
применил до 2,3. если с файлами проекта все норм, то никаких проблем с патчами не наблюдается


[3:16] 
у всех

aanyukhin [3:17 PM] 
@vsimonov а ты все патчи применил или только с HW_2?


vsimonov [3:17 PM] 
все, щас попробую всё по новой сделать
aanyukhin
@vsimonov а ты все патчи применил или только с HW_2?
Posted in #hw2Nov 9th at 3:17 PM


Abnod [3:18 PM] 
@vsimonov проверь что ты на мастер ветку применяешь

vsimonov [3:18 PM] 
на мастер, всё верно
Oleg Maximov
@vsimonov проверь что ты на мастер ветку применяешь
Posted in #hw2Nov 9th at 3:18 PM


[3:20] 
этот патч надо накатываать? Apply 2_0_add_fix.patch

aanyukhin [3:20 PM] 
все надо по порядку


vsimonov [3:22 PM] 
всё удалил, всё по новой накатил, работает


Abnod [4:23 PM] 
@grigory.kislin по поводу видео 5. вы так и не ответили на вопрос в чатике как работает / что означает в пути, указанном в контексте две звездочки **


tema.emelyan [4:26 PM] 
это wildcart поиска во всех вложенных директориях



Abnod [4:29 PM] 
т.е. есть у нас прописано 1.**.финиш
и в папке 1 лежит 100 папок, в каждой из которых по 100 папок, он будет проходить каждую до конца и искать файл "финиш"?
если да, то получается это лучше использовать только в небольших проектах, а в крупных указывать точный путь, верно?


tema.emelyan [4:31 PM] 
не думаю, что даже большой проект может разрастись так, что это начнёт ощутимо бить по времени (edited)



[4:33] 
можно первые пару пакетов прописать чтобы сузить, а дальше вайлдкарты использовать (edited)


Abnod [4:56 PM] 
кто подскажет потокобезопасный вариант сета? :smiley:

tema.emelyan [5:04 PM] 
https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html#newKeySet--


chimax [7:58 PM] 
Коллеги, кто разобрался в отличиях dao слоя от repository?
Вот, нашел запись

Разница между слоем dao и repository:
    DAO - это низкоуровневый слой, который работает с объектами базы
    repository - работает с объектами DTO
    Если Entity не переводятся в DTO, то два этих слоя сливаются и становятся одним и тем же


[8:00] 
насколько она правдоподобна?! (edited)


chimax [8:15 PM] 
Коллеги - все эти термины: POJO (для чего его придумали), JavaBean, Entity, ValueObject, DTO, DAO vs Repository, REST и тд не всегда бывают понятными (даже, когда есть четкое определение из интернета), предлагаю простыми словами описать все их определения - это можно делать совместно, даже редактировать, кто хочет присоединяйтесь (потом закину все это в гит для вопросов-ответов для собеса)
https://docs.google.com/document/d/1qD5fJE5kAq0gmHDKmi-ubZW3odNxqyWjx0HYE2A0R48/edit?usp=sharing (edited)


Valery [8:25 PM] 
в патче 2,1 добавился файл functions.tld. это что за технология и почему требует отдельного файла?

chimax [8:28 PM] 
это кастомный тег

[8:28] 
у jstl


grigory.kislin [9:15 PM] 
@chimax я предлагаю не фиксироваться на определениях. практически от них немного пользы
@Valery в уроке есть ссылка.

evgeny [9:17 PM] 
Я правильно понял, что бизнес логика расположена в слое сервисов?

chimax [9:18 PM] 
@grigory.kislin меня спросили пару определений некоторых терминов - я не смог внятно на них ответить - это и послужило причиной создания подобного документа (edited)


[9:18] 
вроде, да (edited)

grigory.kislin [9:20 PM] 
>  бизнес логика расположена в слое сервисов
правильно. хотя бывает и в контроллерах

chimax [9:21 PM] 
@grigory.kislin а еще бывает и в сущностях в доменном уровне) - классическое трехлеерное приложение (edited)

Shalukhau Dzmitry [10:01 PM] 
Ага, я недавно бизнес логику в модели обнаружил вместе с контейером.... так что она бывает в самых необычных местах...


Grub [10:10 PM] 
@chimax еще называют трехтировое, да там бизнес логика в домене и якобы это правильно

chimax [10:10 PM] 
есть такие приверженцы этого подхода)

[10:12] 
https://www.youtube.com/watch?v=j88XgKAPy-s
YouTube Sergey Nemchinsky
Вопрос архитектуры - трехслойное приложение или сервисы?
 


[10:12] 
))))

Valery [10:15 PM] 
@grigory.kislin В списке типичных ошибок к дз1 первым пунктом идет избегание дублирований в названиях. Почему у нас сейчас переменные Энума не соблюдают это правило?
В классе User поле каллорий инициализировано при объявлении константой. зачем его снова инициализировать в конструкторе?


chimax [10:17 PM] 
а мне не понятно почему id у нас в сущностях не final и у него есть сеттер

Valery [10:29 PM] 
и зачем мы храним 60 строчек коментированого кода в MealsUtil?

chimax [10:30 PM] 
это якоря)


[10:32] 
вот и пойми, что такое POJO: в статье, по версии спринг для POJO допускаются аннотации
https://spring.io/understanding/POJO

а в википедии написано, что нет
spring.io
Understanding : POJO (16 kB)
(edited)


Grub [10:42 PM] 
@chimax не final, так как нам поле id для новых экземляров надо менять ( если isNew() возвращает true)


chimax [10:43 PM] 
c null на number?


Grub [10:44 PM] 
ну какой база сгенерит

grigory.kislin [10:44 PM] 
@Valery про роли- так принято их называть
про User конструктор - предложи как лучше

Viktor [10:45 PM] 
посмотри это видео :smiley:
chimax
а мне не понятно почему id у нас в сущностях не final и у него есть сеттер
Posted in #hw2Nov 9th at 10:17 PM


[10:45] 
https://www.youtube.com/watch?v=lfdAwl3-X_c
YouTube JUG .ru
Егор Бугаенко — Объектно-ориентированное вранье
 


grigory.kislin [10:45 PM] 
закоментрованный код- чтоб смотреть на него удобнее было
можно конечно удалит и из истории git смотреть, когда захочется


[10:46] 
@chimax потомучто мы используем в коде сеттер

chimax [10:46 PM] 
Выступления Егора смотрел много раз, лучше не надо - на работе не поймут))

Viktor [10:47 PM] 
хаха ну тогда ты знаешь что ни одно поле не будет final :smiley: а id не задается при создании объекта, его потом придется выставлять. Хотя может я ещё не дошел до нужного патча


chimax [10:47 PM] 
просто использовать для id сеттер как-то не безопасно


Grub [10:47 PM] 
@grigory.kislin в HW1 добавить бы в форму mealForm.jsp для поля calories required то если пустое оставить получаем ексепшн  ну и ничего не мешает его сделать отрицательным (edited)



chimax [10:48 PM] 
для рефлексии пофиг - хоть файнал файнал в квадрате


grigory.kislin [10:49 PM] 
@Grub да, можно. в фикс добавлю. далее у нас будет валидация


Valery [10:49 PM] 
>про User конструктор - предложи как лучше
либо в конструкторе, либо при объявлении. я не понимаю зачем сейчас оно инициализировано дважды


chimax [10:50 PM] 
а если не отрицательным, а просто ноль (edited)

grigory.kislin [10:50 PM] 
@Valery а, понял.
да счас инициализация не работает... будет по умолчанию конструктор позже


[10:51] 
можно счас убрать

Grub [10:52 PM] 
Еще может логичнее сделать сразу в MealExceed конструктор c параметрами Meal и isExceed


grigory.kislin [10:53 PM] 
не.. MealExceed  - это to. он про entity ничего знать не должен. и наследоваться тоже поэтому нельзя




----- Yesterday November 10th, 2017 -----
Abnod [7:10 AM] 
@tema.emelyan ну это мапа, а не сет :smiley: у того же листа есть Вектор, а у сета что то не могу найти аналог

tema.emelyan [7:11 AM] 
@Abnod не понял (edited)

Abnod [7:12 AM] 
ну смотри. для мапы есть потокобезопасный аналог - конкуррентхэшмэп. для листа - Vector, а для сета похоту никакого конкаррент сета нету, или я очень хреново ищу =-(


tema.emelyan [7:13 AM] 
uploaded this image: image.png
Add Comment




tema.emelyan [7:13 AM] 
@Abnod ты спросил дайте мне потокобезопасный сет (edited)

[7:14] 
вот тебе потокобезопасный сет


Denis1989 [10:32 AM] 
@grigory.kislin В классе User появилось поле Date registered. А почему не LocalDateTime ?

chimax [10:37 AM] 
@Denis1989 LocalDateTime - не зависит от часового пояса - т.е. это абсолютное время, которое будет одним и тем же не зависимо от того в какой части планеты ты на него взглянешь (edited)


[10:37] 
Date - зависит от часового пояса - т.е. это относительные время/дата (edited)



Дима Жуков [10:40 AM] 
Ничоси

[10:40] 
Я не знал

chimax [10:41 AM] 
видимо, когда пользователь занес свои данные - нам не важно, а вот, когда зарегался и где он находится - важно). (edited)


Denis1989 [10:44 AM] 
@chimax а как из Date можно посмотреть где находится пользователь ?

chimax [10:44 AM] 
это я  чисто условно сказал про нахождение пользователя) (edited)


Denis1989 [10:45 AM] 
а вот наверное из LocalDateTime можно попробовать )

aanyukhin [10:48 AM] 
@chimax, а что ты понимаешь под абсолютным временем? Просто если вывести now() на экран, отобразится дата и время в которые сейчас на компьютере.


LORREON [12:10 PM] 
Как через stream API преобразовать list в map - чтоб ключ был автоматически пронумерован - 1,2,3 .. ?


Few [2:53 PM] 
Ну первая идея это локальная переменная в лямбде и инкрементить


Grub [3:15 PM] 
зачем в сигнатуре пишем `throws NotFoundException` если у нас unchecked exception


Grub [3:45 PM] 
@grigory.kislin почему 5й спринг не используем?


Grub [3:58 PM] 
` <context:component-scan .../>` уже включает `<context:annotation-config/>` , поэтому последнюю можно не писать

Дима Жуков [4:00 PM] 
Интересно сколько здесь людей которые только начинают работать со спрингом?)



vsimonov [4:25 PM] 
думаю много но не все



grigory.kislin [4:35 PM] 
заменил в уроке бытую ссылку на слои на картинку


[4:36] 
@Denis1989
> User появилось поле Date registered. А почему не LocalDateTime ?
в первом уроке есть вопрос: Почему у User.registered тип Date, а Meal.dateTime LocalDateTime? (edited)


Belstrel 
[4:37 PM] 
думаю реально работающего ни одного, иначе зачем этот прект если Spring знаешь


grigory.kislin [4:42 PM] 
@Grub добавил впрос в урок
> зачем в сигнатуре пишем `throws NotFoundException` если у нас unchecked exception
Обычно не пишут. Я написал для информации разработчикам - здесь делаем проверку и может быть брошено.



[4:43] 
на topjava юзаем то, с чем с большой вероятностью придется работать
spring 5 планирую юзать в новом проекте spring boot+microservices (edited)


[4:46] 
>` <context:component-scan .../>` уже включает `<context:annotation-config/>` , поэтому последнюю можно не писать
спасибо, напишу сверху комментарий



[4:47] 
@Belstrel были (и возможно есть) и реально на нем работающие (edited)

vch [4:47 PM] 
@Belstrel в реальной работе не всегда нужен весь спектр изучаемых тут возможностей. Поэтому новое тоже можно узнать.
Да, имея опыт работы с Spring тут будет гораздо легче (особенно помня о том, что многие участники не успевают изучать материал, что существенно снижает для них эффективность обучения). 
Но углубиться в области, которые ранее не требовались в своём проекте - тоже полезно.
Причём, имея свой рабочий проект на спринге можно тут же вводить в него новые изученные фишки.




----- Today November 11th, 2017 -----
Anton K. [12:08 AM] 
(список пользователей возвращать отсортированным по имени)

[12:08] 
у них же не тимен


[12:09] 
а блин

[12:09] 
есть


chimax [12:10 AM] 
а еще и по емэйлу

[12:10] 
если имена совпадают


Anton K. [1:06 AM] 
блин


Anton K. [1:07 AM] 
А вопрос такой, можно же сигнатуру методов B mealrepository менять
1 reply Today at 1:15 AM View thread

Anton K. [1:07 AM] 
:?

Alexander _Gubanow [1:12 AM] 
Почему Maven не подтягивает Spring-context?
 7 replies Last reply today at 4:32 PM View thread

Li0n13 [1:15 AM] 
Григорий не раз писал и говорил в видео, что не надо бояться менять исходный код, если это требуется для решения поставленной задачи.


Anton K. [1:46 AM] 
А я вот немножко не понял, мы должны проводить проверку "принадлежит ли данному юзеру еда" в слое репозитория?


[1:46] 
если да, то почему?


Anton K. [1:51 AM] 
Почему это не сделать в сервис слое?


Дима Жуков 
[3:44 AM] 
Я не знаю, но я бы ответил что да. Ну тебе надо получить список еды юзера. Ты получается в репозитории всю еду вытащишь и потом на сл уровне будешь смотреть условие его еда или нет? Сразу вытаскивать только его может лучше в репозитории, где обращение к бд идёт или к мапе.


Maksim [8:19 AM] 
Объясните пожалуйста, что здесь происходит?  {
       MealsUtil.MEALS.forEach(this::save);
   }


[8:19] 
сохраняем куда?

[8:21] 
Или это просто создаем объекты, для каждой записи?


Few
[8:22 AM] 
Читаем из листа в утилс,  и для каждой вызываем локальный сейв


[8:22] 
Наполняем репозиторий

Maksim [8:23 AM] 
т.е. таким образом вызываем метод save при инициализации InMemoryMealRepositoryImpl?

Дима Жуков [8:23 AM] 
MealsUtil.MEALS это лист, для каждого элемента вызываем (m -> this.save(m)


Maksim [8:24 AM] 
а метод ниже переписан? Правильно?


Дима Жуков [8:24 AM] 
где ниже


Maksim [8:25 AM] 
@Override
   public Meal save(Meal meal) {
       if (meal.isNew()) {
           meal.setId(counter.incrementAndGet());
       }
       repository.put(meal.getId(), meal);
       return meal;
   }


Few [8:25 AM] 
Метод save ниже в репозитории


Maksim [8:25 AM] 
Все, понял


[8:25] 
спасибо

[8:25] 
иногда нужно самому себе рассказывать что происходит и как

[8:25] 
)))

[8:26] 
Т.е. просто заполняем мапу repository данными из MEALS?

[8:26] 
верно?


Дима Жуков 
[8:26 AM] 
да там айдишник инициализируем


Maksim [8:27 AM] 
а так как будем использовать многопоточность, то используем ConcurrentHashMap?


Дима Жуков 
[8:28 AM] 
ты все знаешь)


Maksim [8:28 AM] 
)))


[8:28] 
Просто жизнь очень круто меняется


[8:28] 
просто атас

Maksim [8:53 AM] 
У меня такое ощущение, что не хватает <!DOCTYPE html> в jsp файлах



Few [9:03 AM] 
Надо посмотреть код страницы после вывода


[9:03] 
По идее каждый браузер должен открывать в режиме совместимости без четкого указания


Nick [3:43 PM] 
Правильно ли я понимаю, что в методы MealRepository/InMemoryMealRepositoryImpl нужно передавать не только id пищи, а еще и id пользователя?



Дима Жуков 
[3:46 PM] 
думаю да


vsimonov [3:57 PM] 
У кого уже получилось? Вывод на консоль какой должен быть?


Дима Жуков 
[4:08 PM] 
added this Plain Text snippet
//================ USERS ORDER BY NAME =================//
INFO AdminRestController [AbstractUserController.java:21] getAll
INFO InMemoryUserRepositoryImpl [InMemoryUserRepositoryImpl.java:54] getAll
[User (id=3, email=igor@mail.ru, name=Igor Nekto, enabled=true, roles=[ROLE_USER], caloriesPerDay=2000), User (id=2, email=ivanov@mail.ru, name=Ivan Ivanov, enabled=true, roles=[ROLE_ADMIN], caloriesPerDay=2000), User (id=4, email=pasha@mail.ru, name=Pasha Kruglov, enabled=true, roles=[ROLE_USER], caloriesPerDay=2000), User (id=1, email=email, name=userName, enabled=true, roles=[ROLE_ADMIN], caloriesPerDay=2000)]
//=================CREATE MEAL ================//
INFO MealRestController [AbstractMealController.java:37] create Meal{id=null, dateTime=2017-11-11T20:06:31.467, description='Some new meal', calories=300, userId=0}
INFO MealRestController [AbstractMealController.java:27] getAll
[Meal{id=7, dateTime=2017-11-11T20:06:31.467, description='Some new meal', calories=300, userId=1}, Meal{id=6, dateTime=2015-05-31T20:00, description='Ужин', calories=510, userId=1}, Meal{id=5, dateTime=2015-05-31T13:00, description='Обед', calories=500, userId=1}, Meal{id=4, dateTime=2015-05-31T10:00, description='Завтрак', calories=1000, userId=1}, Meal{id=3, dateTime=2015-05-30T20:00, description='Ужин', calories=500, userId=1}, Meal{id=2, dateTime=2015-05-30T13:00, description='Обед', calories=1000, userId=1}, Meal{id=1, dateTime=2015-05-30T10:00, description='Завтрак', calories=500, userId=1}]
//==================UPDATE MEAL ===============//
INFO MealRestController [AbstractMealController.java:48] update Meal{id=7, dateTime=2017-11-11T20:06:31.472, description='Some new meal - updated', calories=900, userId=0}
INFO MealRestController [AbstractMealController.java:27] getAll
[Meal{id=7, dateTime=2017-11-11T20:06:31.472, description='Some new meal - updated', calories=900, userId=1}, Meal{id=6, dateTime=2015-05-31T20:00, description='Ужин', calories=510, userId=1}, Meal{id=5, dateTime=2015-05-31T13:00, description='Обед', calories=500, userId=1}, Meal{id=4, dateTime=2015-05-31T10:00, description='Завтрак', calories=1000, userId=1}, Meal{id=3, dateTime=2015-05-30T20:00, description='Ужин', calories=500, userId=1}, Meal{id=2, dateTime=2015-05-30T13:00, description='Обед', calories=1000, userId=1}, Meal{id=1, dateTime=2015-05-30T10:00, description='Завтрак', calories=500, userId=1}]
//================DELETE MEAL=================//
INFO MealRestController [AbstractMealController.java:43] delete 7
true
INFO MealRestController [AbstractMealController.java:27] getAll
[Meal{id=6, dateTime=2015-05-31T20:00, description='Ужин', calories=510, userId=1}, Meal{id=5, dateTime=2015-05-31T13:00, description='Обед', calories=500, userId=1}, Meal{id=4, dateTime=2015-05-31T10:00, description='Завтрак', calories=1000, userId=1}, Meal{id=3, dateTime=2015-05-30T20:00, description='Ужин', calories=500, userId=1}, Meal{id=2, dateTime=2015-05-30T13:00, description='Обед', calories=1000, userId=1}, Meal{id=1, dateTime=2015-05-30T10:00, description='Завтрак', calories=500, userId=1}]
INFO ClassPathXmlApplicationContext [AbstractApplicationContext.java:984] Closing org.springframework.context.support.ClassPathXmlApplicationContext@843fce: startup date [Sat Nov 11 20:06:29 ALMT 2017]; root of context hierarchy


Дима Жуков [4:09 PM] 
мой вывод, так практически на каждом слое копипаст все что делается в юзере, с правками небольшими


[4:11] 
я так понял на консоли просто попробовать как  все заинжектилось.


new messages
Anton K. [6:26 PM] 
Ребят, а когда нужно вызывать servlet.destroy


[6:26] 
в какой момент


vsimonov [6:30 PM] 
метод checkNew обязательно использовать в контроллере?


Дима Жуков 
[6:33 PM] 
servlet.destroy разве его сам вызываешь?


Anton K. [6:33 PM] 
Ну проверка что кто то птается создать новый мил с определнным id


[6:33] 
Ну я думал он контекст спринга чистит


[6:34] 
или нужно переопределить метод дестрой и в нем закрыть контекст


Дима Жуков 
[6:34 PM] 
нужно переопределить метод дестрой и в нем закрыть контекст - вот это наверное


Anton K. [6:34 PM] 
Просто я спринг поднимаю в методе init


Дима Жуков 
[6:35 PM] 
но это предположение)

Anton K. [6:35 PM] 
с автозакрытием ресурсов


[6:35] 
и не могу вызвать его из другого метода


Li0n13 [7:51 PM] 
>4.2: AuthorizedUser известен только на слое web (см. реализацию ProfileRestController). MealService можно тестировать без подмены логики авторизации, принимаем в методах сервиса и репозитория параметр userId: id владельца еды.
<Зачеркнуто>~Мне кажется, самое место для проверки, принадлежит ли еда залогиненному юзеру, в слое serivce. А по этому пункту вроде как service вообще не в курсе, что есть AuthorizedUser. Или можно передать в сервис id этого юзера как параметр? Что-то вообще этот пункт не очень понятен.~</Зачеркнуто> Заработалась. Ответ в п. 4.3 (edited)


shaakem [7:55 PM] 
Я правильно понимаю, в InMemoryMealRepositoryImpl (слой Repository) логики не должно быть? К примеру получение id залогиненого пользователя и формирование еды только для этого пользователя? Кто прошел 3й пункт?


Li0n13 [7:56 PM] 
Думаю, да. Дело репозитория - сделать запрос и вернуть ответ. А ответ уже по бизнес-логике обрабатывает сервис. (edited)

vch [8:04 PM] 
@Li0n13 возвратить еду юзера - это не бизнес логика.
В SQL-запросе мы ведь будем писать `where userId=:userId`

Li0n13 [8:06 PM] 
Но репозиторию же должно быть  все равно, залогинен этот юзер или нет. Так ведь?

vch [8:07 PM] 
@Li0n13 да. Это его не касается. Его дело - выдать ответ на запрос. Ему неважно - сам юзер смотрит еду, или админ из праздного любопытства решил узнать, чем позавтракал коллега.


Anton K. [8:18 PM] 
Тогда получается будут лишние обращения к БД


vch [8:21 PM] 
@Anton K. почему?


Anton K. [8:22 PM] 
А нет

[8:22] 
получается будем гонять объекты между слоями

[8:22] 
не знаю хуже это или без разницы


[8:23] 
Так то можно и в контроллере прописать логику

vch [8:24 PM] 
@Anton K. предлагаю объекты не гонять... Не знаю, зачем тебе это.

russell [8:25 PM] 
На маленьких приложениях разницы нет, на больших обязательно. Поддерживать легче и менять когда надо.


Anton K. [8:25 PM] 
Ну просто если в сервисе прописать логику то получается в сервис будет приходить объект и только потом решается можно ли с ним что-то делать


[8:26] 
а если в репозитории прописать то в сервис будет приходить или null или объект


vch [8:26 PM] 
@Anton K. выше же цитата из задания была: `принимаем в методах сервиса и репозитория параметр userId: id владельца еды`
Если в репозитории есть userId, то что, куда и, главное, зачем ты собираешься гонять?


russell [8:26 PM] 
это круд приложение здесь методы сервиса дублируют репозитрий. В больших приложениях в сервисе гораздо больше логики.

Anton K. [8:28 PM] 
В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId)


russell [8:28 PM] 
кажется будет сессия в ней будет лежать юзер с айдишником


Anton K. [8:29 PM] 
я просто в репозитории беру ай-ди из класса autorisedUser


russell [8:29 PM] 
это ты должен делать в сервлете имхо

Anton K. [8:30 PM] 
принимаем в методах сервиса и репозитория параметр userId: id владельца еды


[8:30] 
а вот это како пункт


russell [8:31 PM] 
4.2: AuthorizedUser известен только на слое web


[8:31] 
его по цепочке в сервис, а сервис в репо


Anton K. [8:33 PM] 
а


[8:33] 
ок


[8:33] 
: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей. Любой пользователь авторизуется и видит/модифицирует только свою еду.
3.1: если по запрошенному id еда отсутствует или чужая, возвращать null/false (см. комментарии в UserRepository


[8:34] 
Вот еще раз про расположение логики


[8:34] 
в задании написано что в репозитории


[8:34] 
или я неправльно понимаю


russell [8:35 PM] 
на сколько я понимаю методы репо должны принимать два айдишника, мила и юзера.


Anton K. [8:35 PM] 
просто если логику не прописать как он будет возвращить null false


[8:35] 
он может только объекты возвращать


[8:36] 
из БД


[8:36] 
и вообще тогда null и false не надо возвращать


[8:36] 
сразу эксепшн в сервисе кидать


russell [8:40 PM] 
@chimax Максим, мыслим правильно?


chimax [9:20 PM] 
@russell рекомендую взять листок бумаги и полностью все слои нарисовать, указав кто с кем взаимодействует и как (edited)


Антон Кляшторный [9:38 PM] 
Все user в UserRepository это авторизованные пользователи?


russell [9:40 PM] 
нет зарегистрированные кажется

Argentum_kuh [9:41 PM] 
@Антон Кляшторный
Репозиторий - х ранилище всех юзеров, Авторизованный юзер - уровень доступа, статус так сказать. Имхо.


vsimonov [9:42 PM] 
added this Plain Text snippet: кто то так реализовал?
3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей. Любой пользователь авторизуется и видит/модифицирует только свою еду. 


Argentum_kuh [9:43 PM] 
@vsimonov


russell [9:44 PM] 
@vsimonov true


Argentum_kuh [9:44 PM] 
@vsimonov
Я так думаю: что-то вроде фильтрации. Подобно фильтрации по времени


russell [9:45 PM] 
в мил добавил поле юзер айди, и в репо передаю айди юзера. В репо фильтрую по айди


vsimonov [9:45 PM] 
тоесть мы делаем getid(user) и нам высерает id user и его хавчик?


Argentum_kuh [9:45 PM] 
Это уже детали реализации пожалуй


vsimonov [9:46 PM] 
блин нет
как она должна работать
высер из консоли сделайте плиз тогда
хочу понять чего нужно добиться


russell [9:48 PM] 
так как у нас авторизированный юзер пока один и он захардкожен, в таблице ничего не поменяется


vsimonov [9:48 PM] 
так значит нужно всё вывести и ничего не связывать? не думаю


[9:49] 
Любой пользователь авторизуется и видит/модифицирует только свою еду


Alexander _Gubanow [10:09 PM] 
я так понял пункт 3 задания: id залогиневшегося юзера берем из AuthorizedUser(хардкордим) или считываем с jsp c comboboxа, в контролере дергаем методы сервиса, из сервисов-методы repository. При этом предаем в методах id залогиневшегося юзера. Если по запрошенному id еда отсутствует или чужая, возвращаем null/false в сервис. В сервисе проверяем на null/false и выкидываем если что не так NotFoundexeption. Колеги, поправьте если что не так.


Valery [10:29 PM] 
>При этом предаем в методах id залогиневшегося юзера.
то есть, весь код сервлета с едой теперь надо править? надо из реквеста вытягивать userID. а чтобы его вытянуть, туда его надо сперва положить.


Alexander _Gubanow [11:00 PM] 
если не хардкордить, то считывать с параметра name, например comboboxа


Valery [11:07 PM] 
я так понял, AuthorizedUser - пока заглушка, реализация будет потом. не понимаю зачем надо это - "При этом предаем в методах id залогиневшегося юзера". ведь его можно получить непосредственно в репозитории.


russell [11:09 PM] 
ну так это иммитация реального процесса, чтобы потом меньшь дорабатывать


Li0n13 [11:11 PM] 
Коллеги, получилось в `MealRepository` не менять метод `save` на `create` и `update`? И какое должно быть поведение в таких, например, ситуациях:
1. если в сервис пришел запрос на update() еды с id=null.
2. create() еды с непустым id, существующим в базе.
3. create() еды с непустым id, не существующим в базе.


Valery [11:17 PM] 
запросы на создание приходят вовсе без ID в сервлет. ID генерируется при добавлении в базу.


Li0n13 [11:24 PM] 
В запросе на создание у нас `id=null`.
>Запрос попадает в контроллер, методы которого будут доступны снаружи по http, т.е. запрос можно будет сделать с ЛЮБЫМ id для еды (не принадлежащем авторизированному пользователю). Нельзя позволять модифицировать/смотреть чужую еду
То есть в запросе могут быть разные невалидности.


Valery [11:27 PM] 
там скорее всего имелось в виду, что ID можно вписать в Url, таким образом отправив запрос не к своей еде.


Li0n13 [11:30 PM] 
А кто мешает нам, к примеру, подменить id еды в post запросе на обновление?


russell [11:30 PM] 
там же будет фильтр стоять, который будет в сессии проверять - зарегистрирован ли пользователь (edited)


Valery [11:36 PM] 
>А кто мешает нам, к примеру, подменить id еды в post запросе на обновление?
поле ID закрыто для редактирования. пареметры метода пост не видны в запросе (в url)


russell [11:40 PM] 
а почему оно закрыто?


[11:41] 
можно же через postman послать запрос пост?


Li0n13 [11:41 PM] 
Вопрос не про пользователя. Если приходит запрос на update еды, которая по факту isNew(). Вроде никакого криминала, создать новую еду и все. Но все-таки невалид - неспроста ведь у нас есть отдельно создание, отдельно - обновление.
Или попросят создать еду с ID. Игнорировать ID и создавать новую, или проверять данные, как при обновлении? (edited)


Valery [11:51 PM] 
если выходит за пределы браузера и рассматривать сторонние утилиты, которые могут подменить параметры ПОСТ запроса, то надо валидировать все данные. вместо ID может строка прийти и т.п.


Li0n13 [11:54 PM] 
Кажется, разобралась. Надо искать ответы в `ValidationUtil`.



----- Today November 12th, 2017 -----
Anton K. [12:11 AM] 
а что там


[12:12] 
просто методы помощники


Li0n13 [12:22 AM] 
Они помогают разрешать подобные ситуации и Юзерами. Только возникает еще вопрос - по слоям приложения. Если посмотреть методы `AbstractUserController`
```public User create(User user) {
        log.info("create {}", user);
        checkNew(user);
        return service.create(user);
    }
public void update(User user, int id) {
        log.info("update {} with id={}", user, id);
        assureIdConsistent(user, id);
        service.update(user);
    }
```
Мне кажется, что эти проверки - бизнес-логика приложения, а они делаются в контроллере. (edited)


Valery [12:29 AM] 
я прежде троицу MVC понимал так: модель - данные, вид - отображение, логика в контроллере. 
А теперь с уровнями DAO и сервиса не понятно что делать...


Li0n13 [12:46 AM] 
Я понимаю так. Есть ситуация - пришел запрос `create` с заполненным id. Сегодня заказчик решил, что надо кидать исключение. Завтра передумал и решил заполненный id игнорировать. А послезавтра вообще регистрацию закроет. Чем не бизнес-логика?  Контроллеру пофиг - он посылает к сервису, как и раньше - пусть сервис принимает решение.


Anton K. [1:22 AM] 
Дак получается валидацию тогда проще провести в репозитории


[1:23] 
а уже что делать кидать исключение или игнориовать можно прописать в сервисе


Антон Кляшторный [10:34 AM] 
uploaded this image: mealRepository.jpg
Add Comment



Антон Кляшторный [10:34 AM] 
В таком виде еда в репозитории хранится?


russell [10:57 AM] 
Вроде да, но есть еще вариант 3.2: реализовать хранение еды для каждого пользователя можно с добавлением поля userId в Meal ИЛИ *без него* (как нравится).


Valery [11:07 AM] 
Какие варианты могут быть *без добавления* такого поля? Я могу представить только: у каждого пользователя своя мапа еды, а в репо - мапа с мапами.


ализовать слои приложения для функциональности "еда".
реализовал сервис и репо. в сервлете вызываю методы сервиса. приложение работает. не пойму какая роль в этом MealRestController ? он должен быть промежуточным слоем между сервлетом и сервисом?


russell [12:46 PM] 
да, сервлет же мы будем удалять. На следующем уроке надо будет просто маппинг на методы рест контроллера сделать.

[12:49] 
6.1: учесть, что когда будем работать через Spring MVC, MealServlet удалим, те вся логика должна быть в контроллере

CRCx86 [1:01 PM] 
друзья, закончилась лицензия, а ссылку на учебную, ту, что в начале стажировки давали не вижу


[1:01] 
подскажите пожалуйста где взять


[1:02] 
а, всё


[1:02] 
в личном кабинет нашёл


Vangelis [1:39 PM] 
uploaded and commented on this image: Конфликт.png
2 Comments
Всем привет, у меня возникает  такой же конфликт, как у @Abnod при накатке патча 2_0_add_fix. Почему это так?



aanyukhin [2:25 PM] 
@vsimonov, ты случаем не разобрался, почему checkNew находится в контроллере а не в сервисе? Увидел, ты вопрос задавал.


russell [2:25 PM] 
где вы получаете mealwithexceed в сервисе или контроллере? (edited)


Дима Жуков [2:28 PM] 
контроллере,


Антон Кляшторный [2:31 PM] 
пользователь убирается со своей едой, или еда удаленного пользователя остается в репозитории?


Dmitry Makarov [2:43 PM] 
Сортировка юзеров это ведь бизнес логика?


fbochkarev [2:51 PM] 
commented on Vangelis’s file Конфликт.png
по github @Vangelis - https://github.com/JavaOPs/topjava/wiki/Git#patch-%D0%BD%D0%B5-%D0%BD%D0%B0%D0%BA%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BF%D1%80%D0%B5%D0%B4%D0%BB%D0%B0%D0%B3%D0%B0%D0%B5%D1%82-merge
по github попробуй тут подсказки посмотреть, может поможет



Vangelis [3:17 PM] 
@fbochkarev Не знаю, ничего не помогало, поэтому просто откатился и снова накатил все патчи. Фикс встал, теперь посмотрим остальные. Спасибо.

vsimonov [4:18 PM] 
checkNew находится в утильном методе, не в контроллере
aanyukhin
@vsimonov, ты случаем не разобрался, почему checkNew находится в контроллере а не в сервисе? Увидел, ты вопрос задавал.
Posted in #hw2Today at 2:25 PM


Li0n13 [4:20 PM] 
@vsimonov Почему проверка методом `checkNew` в контроллере?


vsimonov [4:23 PM] 
Я таким вопросом не задавался, но будет интересно узнать
Katherine Buzatu
@vsimonov Почему проверка методом `checkNew` в контроллере?
Posted in #hw2Today at 4:20 PM


vsimonov [5:40 PM] 
Какие методы нужно реализовать в миле?


[5:42] 
пока понял crud + filterByDate + filterByTime + find+ getAll + get


shaakem [6:06 PM] 
Meal - это модель. Там только геттеры и конструктор должны быть по идее.


vsimonov [6:08 PM] 
имею ввиду MealService
Alexey Shulayakov
Meal - это модель. Там только геттеры и конструктор должны быть по идее.
Thread in #hw2Today at 6:06 PM
1 reply Today at 6:13 PM View thread

shaakem [6:13 PM] 
я сделал crud, getAll и getByUserId.


vsimonov [6:20 PM] 
@grigory.kislin Гриша, может стоит внести ясность в ТЗ по домашке? (edited)



russell [6:26 PM] 
скажите, а налл же из хмтл инпута не может быть, только пустая строка?

Дима Жуков [6:26 PM] 
может вроде

Dmitry Makarov [6:27 PM] 
я вот думаю сортировку реализовывать в утил классе или в сервисе, явно не в репозитории. И не логичнее ли было бы сортировать List<MealWithExceed>

Дима Жуков [6:27 PM] 
@vsimonov А зачем такие методы в сервисе? у нас же в DateTimeUtil фильтры всякие


[6:28] 
filterByDate + filterByTime

Dmitry Makarov [6:30 PM] 
@Дима Жуков о спс напомнил что есть DateTimeUtil


vsimonov [6:32 PM] 
ок согласен
Жуков Дмитрий
@vsimonov А зачем такие методы в сервисе? у нас же в DateTimeUtil фильтры всякие
Posted in #hw2Today at 6:27 PM


russell [6:33 PM] 
а byTime Же уже есть метод getFilteredWithExceeded

Дима Жуков 
[6:48 PM] 
я вообще запутался, нам получается нужно добавить на страницу отображения meals 4 инпута, в 2-х даты от до, 2-х время от до. и отправлять эти 4 параметра на сервлет, принимать на какой то отдельный экшен типо фильтр, прогонять через гет битвин с 4-мя этими параметрами он возвращает лист и мы опять форвардим на meals.jsp Я так понял?) я этого еще не сделал)


Valery [6:49 PM] 
>сортировку реализовывать в утил классе или в сервисе, явно не в репозитории
при использовании БД sql запросы позволяют применять сортировку/фильтрацию. и при переключении на другой сторэдж не надо будет менять код на других уровнях.


Дима Жуков [6:50 PM] 
ну данные мы все вытащили, впринципе на кой в бд лесть их фильтровать опять вытаскивать если их же можно уже фильтрануть


russell [6:51 PM] 
@Дима Жуков Да я точно так сделал.



Valery [6:52 PM] 
@Дима Жуков, откуда вытащили? InMemoryMealRepositoryImpl это и есть БД. мы к ней обращаемся в каждом методе.


Дима Жуков [6:53 PM] 
н да вообще то


[6:53] 
фигню сказанул как обычно)

Valery [6:57 PM] 
>И не логичнее ли было бы сортировать List<MealWithExceed>
с сортировкой вроде как все равно. при передаче в другой список порядок таким же остаётся.
а вот с фильтрацией - да. если мы применим MealWithExceed к отфильтрованым результатам, мы не получим актуальную сумму калорий за день


russell [7:00 PM] 
а фильтр постом или гетом передают?


Дима Жуков [7:00 PM] 
постом я думаю


[7:00] 
хотя


Valery [7:18 PM] 
>pom.xml НЕ менять, работаем со spring-context
spring-app.xml можно менять? Или надо реализовать дефолтные интерфейсы инициализации/удаления бина? (edited)


Valery [7:26 PM] 
или эти методы не нужны? (edited)


Дима Жуков [7:28 PM] 
я думал блок {} убрать в метод init ну у нас там context:component-scan он вызовет этот инит, вроде его прописывать надо в bean тэг init-method или че там


Valery [7:30 PM] 
блок {} в InMemoryMealRepositoryImpl?

Дима Жуков [7:30 PM] 
lf

[7:30] 
да

russell [7:30 PM] 
а зачем его убирать, это не инит

[7:31] 
он вызывается когда бин создается

Valery [7:31 PM] 
не стоит. этот блок нужен только для этой реализации базы.


Дима Жуков [7:31 PM] 
я просто подумал)

[7:31] 
init тоже ж

[7:32] 
ну и не стал)

Дима Жуков 
[7:48 PM] 
а если мы в xml пропишем руками все бины то можно будет аннотации убрать @Repository, @Component? я просто не пробовал, получается @Component = bean.

Valery [7:49 PM] 
перечитал ТЗ. Требуется закрыть контекст, про бины ничего не говорится. то есть, inin/destroy для бинов не надо писать.


Дима Жуков [7:49 PM] 
ну да это наверное сл урок

[7:49] 
цикл жизни бинов

Valery [7:50 PM] 
бин - это экземпляр класса.
аннотации @Repository, @Component определяют поведение бинов

Дима Жуков 
[7:50 PM] 
а какое может быть поведение у бинов?


[7:51] 
типо некоторые для бд, некоторые контролеры?

Valery [7:51 PM] 
спринг на них реагирует соответственно

Дима Жуков 
[7:51 PM] 
убрать @Repository, @Component и не будет работать? если в xml прописать руками?

Valery [7:52 PM] 
@Component - общая. делится на @Repository, @Controller, @Service

Дима Жуков 
[7:53 PM] 
я думал это просто типо для семантики, как в html например div и p оба блочных решения, оба можно заменить просто семантика другая, но работать будет)


Valery [7:53 PM] 
в видео 2 5 на 33 минуте говорится об этом


Дима Жуков 
[7:54 PM] 
значит без этих аннотаций нельзя


russell [7:58 PM] 
@Дима Жуков repositary еще свои собственные исключения кидает, отличные от компонента

Valery [8:04 PM] 
вообще-то, без аннотаций бины создавать можно.


russell [8:05 PM] 
можно еще через джава класс бины создавать, не только хмл и аннотации


Дима Жуков 
[8:06 PM] 
понятно что ничего не понятно


[8:06] 
надо читать,ну или смотреть видосики

Valery [8:08 PM] 
надо делать)


Дима Жуков 
[8:09 PM] 
создал бин в xml и что это @Repository, @Controller, @Service @Component

[8:09] 
@Component


[8:09] 
скорее всего

[8:10] 
а как ему в xml сказать что он @Repository вообще то

Few
[8:53 PM] 
Помогите мне понять, мы в контроллере пользователей в методе update принимаем бин и id, если бин новый,  то присваиваем ему этот самый  id и сохраняем без проверки был ли в базе пользователь с таким id. Т.е. Если передать в контроллер 100-й id,  counter об этом не узнает и при создании 100-го пользователя мы его перепишем? В UserServiceImpl на create и update проверок нестоит


Valery [9:06 PM] 
>если бин новый,  то присваиваем ему этот самый  id и сохраняем без проверки был ли в базе пользователь с таким id
если бин новый, зачем проверять его наличие в базе?


Few [9:06 PM] 
Ну мы же хотим сделать update а не новый создать

Valery [9:08 PM] 
для существующего там есть другая проверка. if (entity.getId() != id)


[9:09] 
то есть, бин может только себя перезаписать

Few [9:09 PM] 
Я думал мы не доверяем внешним запросам по умолчанию



[9:10] 
И должны быть готовы получить оттуда все что угодно,  или я что-то недопонимаю


[9:14] 
Я просто REST не знаю пока,  но думал что мы получаем в запросе action и JSON-представление,  а как им можно доверять?


Li0n13 [9:34 PM] 
Мы и не должны доверять. Если приходит запрос на update еды с установленным id, мы должны проверить, принадлежит ли еда с таким id залогиненному пользователю. Нет такой еды - нет и соответствия, и еда с таким id создаваться не должна. Проверяла дополнением к Firefox - HttpRequester. Можно послать любой запрос и посмотреть результат.
А по вопросу поведения в случае update еды с заданным несуществующим id возможны два варианта: отказать (бросить исключение) или создать у текущего юзера новую еду с указанными параметрами.


grigory.kislin [9:38 PM] 
@vsimonov @Dmitry Makarov по ДЗ разжевал-разжевал как мог
на большинство вопросов есть ответ в ДЗ и замечаниях
основное- делайте ТОЧНО ТАК ЖЕ как в User сделано. не придумывйте своего

checkNew  проверяем в контроллере, тк это валидация входных данных
userId пеердаем в репозиторий, тк AuthorizedUser есть только на слое web (в уроке и видео все это есть)
есть хранилице всех юзеров и когда вы авторизуетесь в приложение, ваше id попадает в AuthorizedUser. берем оттуда, реальную авторизацию будем делать позже


Few [9:42 PM] 
@Li0n13 я про пользователей сейчас, по ним то все уже реализовано как образец


Li0n13 [9:51 PM] 
Точно, перезапишется потом, как ты писал! Баг или мы что-то в коде недосмотрели?..


Few
[9:52 PM] 
хотелось бы проверять в репозитории, а в сервисе кидать исключение в в зависимости от ответа репозитория


[9:53] 
или в сервисе первый запрос на существование такой записи, но это уже два запроса


[9:56] 
хотя первый вариант не подойдет, у нас в репозитории один метод save и он не знает создаем мы или редактируем


Li0n13 [9:57 PM] 
Проверять существование - в репозитории. Потом с реальной БД это будет один запрос - типа `update ... where ...`


Few 
[10:01 PM] 
метод-то один в репозитории, ему не известно обновление мы запросили или создание, он конечно узнает что именно он сделал, но уже к этому моменту сделает


Valery [10:04 PM] 
>есть хранилице всех юзеров и когда вы авторизуетесь в приложение, ваше id попадает в AuthorizedUser
но одновременно несколько пользователей может быть авторизовано. Какой id возвращать? (edited)


Li0n13 [10:05 PM] 
@Few Вот в этом методе и проверять. А новый или нет - он проверяет isNew() (edited)


Few 
[10:07 PM] 
сейчас id просто захардкожено, но потом будет из сессии браться видимо


Dmitry Makarov [10:14 PM] 
Разве у админа не должно быть возможности обновить данные пользователя. Или я не правильно тебя понял?
Fedor Vershinin
Помогите мне понять, мы в контроллере пользователей в методе update принимаем бин и id, если бин новый,  то присваиваем ему этот самый  id и сохраняем без проверки был ли в базе пользователь с таким id. Т.е. Если передать в контроллер 100-й id,  counter об этом не узнает и при создании 100-го пользователя мы его перепишем? В UserServiceImpl на create и update проверок нестоит
Posted in #hw2Yesterday at 8:53 PM


Few 
[10:16 PM] 
бесспорно должна быть возможность, но только естественным путем


[10:17] 
через gui

Li0n13 [10:19 PM] 
Мы предоставляем API для того, чтобы можно было пользоваться нашим приложением, используя запросы. То есть кто-то пишет свой клиент, а к нашему приложению обращается за данными и логикой.


Few [10:19 PM] 
наверное не правильно выразился


[10:20] 
Теоретическая ситуация: я, являясь админом системы, генерирую post запрос на изменение несуществующего пользователя, назначаю ему 100 id, у нас к тому моменту нет такого пользователя. Пользователь будет создан, но при создании 100-го пользователя стандартным путем он перезапишется?


Li0n13 [10:20 PM] 
В текущем положении - похоже, что да.

Few 
[10:21 PM] 
это тем более важно, если мы предоставляем REST API


Dmitry Makarov [10:26 PM] 
ага а если по мапе проверять операция перестанет быть атомарной


[10:26] 
т.е. пока ты проверял есть ли такой ключ его еще кто-то получил


Few [10:27 PM] 
т.е. нас спасут два метода create и update  в репозитории )


[10:28] 
update  сможет проверять реально ли он собирается изменить

[10:29] 
и возвращать сервису boolean, а тот кидать исключение

Dmitry Makarov [10:32 PM] 
поэтому у каждого метода должна быть 1 обязанность :grinning:


Li0n13 [10:46 PM] 
> 7: добавить в meals.jsp и MealServlet две отдельные фильтрации еды: по дате и по времени (см. демо)
Что значит "отдельные"? Смотрю демо - там вроде одна общая фильтрация - с учетом и даты, времени...


Few 
[10:48 PM] 
Я общую делаю


grigory.kislin [10:54 PM] 
@Few
> мы в контроллере пользователей в методе update принимаем бин и id, если бин новый,  то присваиваем ему этот самый  id и сохраняем без проверки был ли в базе пользователь с таким id
похоже, что в InMemoryUserRepositoryImpl.save мы действительно при update не проверяем id на наличие в хранилище. сделаю fix, спасибо!
create и update не спасут, тк в JPA используется один. а мы будет делать его реализацию
с базой работает так: jdbc не вставляет юзера, jpa вставляет его с автогенеренным id (edited)


Valery [10:56 PM] 
@Li0n13 возможно имеется в виду, что можно отдельно фильтровать по времени, отдельно по датам.



----- Today November 13th, 2017 -----
Ivan [7:03 AM] 
Подскажите для чего "5: включить классы еды (Meal, MealWithExeed ?)в контекст Spring (добавить аннотации)" ? MealRestController и без этого отрабатывает (в консоле...). На будущее? (edited)

Tanya [7:06 AM] 
для проверки


Anton K. [7:15 AM] 
Мне кажется классы еды это репозиторий, сервис и контроллер для еды


Ivan [7:21 AM] 
Просто никогда так не делал, не знаю как правильно. Перед объявлением класса Meal ставим "@Component" и в spring-app.xml добавляем ещё один путь поиска бинов?

[7:22] 
@Tanya Спасибо. :grinning:

CRCx86 [8:09 AM] 
доброго времени суток! в патче 2_1_HW1.patch добавился файл в расширением .tld - что это такое?


[8:09] 
function.tld

Дима Жуков 
[8:10 AM] 
Кастомный тэг.


CRCx86 [8:21 AM] 
одним из патчей должно было добавиться в MealsUtil DEFAULT_CALORIES_PER_DAY, должны были быть переименованы несколько классов. К сожалению этого у меня не произошло, что я сделал не так?


[8:22] 
сейчас всё, что не переименовано и не добавлено подсвечаивается красным


[8:22] 
я могу добавить сам, но интересно, что я сделал не правильно

astronarh 
[8:38 AM] 
@CRCx86 Было так же, руками дописал.

CRCx86 [8:41 AM] 
какая задача файла logback.xml?

Few
[8:44 AM] 
Настройка логгера

CRCx86 [8:44 AM] 
в папаке model есть два файла AbstractBaseEntity и AbstractNamedEntitiy - какова их задача?


Few
[8:46 AM] 
Вынести в одно место id и имя,  ведь у всех энтити есть id,  и у многих имя

[8:46] 
Чем писать везде эти поля,  геттеры и сеттеры,  просто наследуем

CRCx86 [8:47 AM] 
entity в данном случае объекты управления: пользователи?

Few [8:48 AM] 
Ну да,  в нашем случае объекты пользователей и объекты еды

CRCx86 [8:53 AM] 
в папке web появились новые контроллеры. в чем суть? и почему они не называются servlet?


CRCx86 [9:00 AM] 
в чем суть файла ProfileRestController? почему он не называется UserRestController?

[9:03] 
где лучше всего создавать папку to?

CRCx86 [9:11 AM] 
в видео несколько раз упоминалось слово отражение в контексте Spring Framework, что это такое?

[9:12] 
@Few спасибо за ответы


CRCx86 [9:20 AM] 
если авторизация доделается потом, то как реализовывать 4 часть домашнего задания?

Valery [9:40 AM] 
@CRCx86
контроллеры пришли на замену сервлетам
путь к папке to указан в ТЗ
отражение - view
используй AuthorizedUser.id() для получения id пользователя

CRCx86 [9:41 AM] 
@Valery :+1:


tema.emelyan [9:52 AM] 
@CRCx86 @Valery думаю под отражением понимается Reflection API

[9:56] 
многие (все???) фреймворки его используют. Фреймворк предоставляет настраиваемый каркас на все случаи жизни, а мы пишем бизнес логику. Потом расставляем аннотации (или конфигурим xml или где как) и фреймворк, используя отражение, встраивает кусочки нашей бизнес логики в свой каркас. (edited)


CRCx86 [11:22 AM] 
@tema.emelyan применимо к тому, что мы сейчас делаем как понимать отражение? (edited)

[11:23] 
вот скажем есть MVC - в каком из модулей это начинает работать?

russell [11:25 AM] 
Отражение нужно фреймворку Спрингу чтобы прочитать аннотации в рантайм и к примеру заинжектить, что надо. В самом мвс отражение не нужно. Используя рефлекшн можно также получить доступ к приватным полям объекта. (edited)


Few [11:48 AM] 
Про reflection лучше почитать просто и попробовать на примерах

vsimonov [11:56 AM] 
Если мы ненаходим id для удаления/обновления NotFoundException выкидывать?

Denis1989 [12:07 PM] 
Человеки )) Как думаете, правильно ли будет при обновлении, если такой записи нет, то создавать новую.


vch [12:08 PM] 
@Denis1989 мне кажется, что неправильно


Denis1989 [12:14 PM] 
Кто как делал? NotFount кидать ?

[12:16] 
или лучше IllegalArgumentException

vsergeev [12:55 PM] 
Или IllegalState? :smile:

vsergeev [1:10 PM] 
Если мы фильтруем сразу в repository, а преобразуем в TO в сервисе или контроллере, то ведь exceed посчитается на основе только отфильтрованных записей, так и должно быть?


vsergeev [1:19 PM] 
@Denis1989 посмотри в слой сервисов и Validation util, там есть нужные методы на проверку. только нужно подходящее значение из repository возвращать :wink:

Denis1989 [1:20 PM] 
@vsergeev Ok. Что-то недосмотрел значит :+1:


grigory.kislin [2:17 PM] 
@Denis1989 @vsergeev
> или лучше IllegalArgumentException
> Или IllegalState?
еще раз здесь и в уроке: основное- делайте ТОЧНО ТАК ЖЕ как в User сделано. не придумывйте своего
смотрим на UserServiceImpl
на реальном проекте 5 раз прошерстите код и найдите похожее на вашу функциональность, прежде чем придумывать чтото свое! (edited)


vsimonov [2:33 PM] 
если делать точно так же то как реализовать такой пункт
5.2: Отдать свою еду, отфильтрованную по startDate, startTime, endDate, endTime
Grigory Kislin
@Denis1989 @vsergeev
> или лучше IllegalArgumentException
> Или IllegalState?
еще раз здесь и в уроке: основное- делайте ТОЧНО ТАК ЖЕ как в User сделано. не придумывйте своего
смотрим на UserServiceImpl Show more…
Posted in #hw2Today at 2:17 PM
(edited)


vsergeev [2:54 PM] 
Перефразирую предыдущий вопрос: что должен принимать getAllFiltered() в контроллере? два LocalTime и два LocalDate? (edited)


russell [3:01 PM] 
я принимал строки, чтобы сервлет конвертацией не перегружать. Плюс если мы сервлет удалим, как контроллер превратит налл в локал дейт или тайм в параметрах.

vch [3:04 PM] 
@russell Беспокойство за контроллер понятно, но излишне. Его вполне можно научить конвертировать String в LocalDate. И null его не испугает.

ujwegh [3:04 PM] 
как я понял, в демо приложении есть поля  от даты до даты и от времени до времени, значит нужно брать два LocalDate и 2 LocalTime и смотреть какие из них не null пришли

russell [3:06 PM] 
остальные помечать LocalDate.MIN и тд


[3:07] 
@vch можно научить налл конвертить в LocalDate.MIN или LocalDate.Max?


vch [3:09 PM] 
@russell Ну, с этим я и сам могу справиться. Мне главное - чтобы контроллер не упал, а уж из null то что мне надо я получу 1 тернарным оператором.

russell [3:10 PM] 
понял оказывается есть аннотация @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)


grigory.kislin [3:17 PM] 
@vsergeev если вы поняли, что нужно вернуть,то это вопрос, на который надо найти ответ самому. попробуйте по разному сделать
про место, где конвертировать в dto (MealWithExceeded) в уроке и видео есть материал


Антон Кляшторный [3:20 PM] 
getByEmail из MealService удалить нужно?



vsergeev [3:20 PM] 
у еды нет почты
 


Shalukhau Dzmitry [3:22 PM] 
>у еды нет почты
Хорошая идея для стартапа на Java :slightly_smiling_face:


PugV [6:07 PM] 
извините за глупый вопрос по п1: список пользователей возвращать отсортированным по имени.  Пользователей создаем сами, по аналогии с MealsUtil.MEALS ?
 2 replies Last reply today at 6:24 PM View thread

shaakem [6:17 PM] 
У тебя пользователи находятся в мапе repository. В методе getAll() сформируй список из этой мапы и отсортируй.


Антон Кляшторный [6:30 PM] 
5.7: Сделайте отдельный getAll без применения фильтра. без exceed всю еду или без фильтра по времени?


vsergeev [6:34 PM] 
С exceed без фильтра по времени

Антон Кляшторный [6:39 PM] 
ок

Антон Кляшторный [7:46 PM] 
uploaded this image: HW02 Spring-context.JPEG
Add Comment



kadmser [9:32 PM] 
uploaded this image: подскажите, это нормальный вывод?
Add Comment



Valery [9:34 PM] 
для какого пункта? (edited)


kadmser [9:37 PM] 
задание HW02 без опшионал

Valery [9:39 PM] 
там требуется что-то в консоль выводить?

Dmitry Makarov [9:40 PM] 
Попробуй удалить одну и ту же еду 2 раза. Должно NotFoundException выбросить

Argentum_kuh [10:51 PM] 
Кстати, кто знает, для чего в User поле enabled? И зачем нам списо ролей? Предполагается, что в дальнейшем будут еще какие-то?


russell [10:53 PM] 
Для того, чтобы отключать юзера, возможно банить. Админ тоже хочет иметь свой список еды и может быть пользователем.


Viktor [11:27 PM] 
Такая идея, поскольку для jsp нам нужен MealWithExceeded а для сервиса-репозитория Meal. может стоит сделать конверторы в классах, так удобнее + паттерн информационный эксперт (немного)


russell [11:30 PM] 
они же вроде знать друг о друге не должны, они же даже не наследуются и также лежат в отдельных пакетах


Viktor [11:32 PM] 
опять же,конвертировать их приходиться часто, и код дублируется. Тогда можно использовать утильтарный конвертер, но это уже странно :smiley:

russell [11:33 PM] 
private static MealWithExceed createWithExceed(Meal meal, boolean exceeded) {
       return new MealWithExceed(meal.getId(), meal.getDateTime(), meal.getDescription(), meal.getCalories(), exceeded);
   } в MealsUtil


Viktor [11:39 PM] 
че-то у меня голова ломаться начинает :smiley:


Kirilo [1:08 AM] 
если я правильно понял, то задание нужно начинать делать с контроллера(вставить необходимые методы) по аналогии с юзером. То есть, там перенаправляем на сервисы, в сервисах запускаем соответствующие утилиты, а в репозитории вызываем необходимые сервисы...


russell [1:16 AM] 
Да и не забудь из контроллера в сервис передать userId


[1:16] 
А в сервлете уже вызывать методы контроллера

Kirilo [1:28 AM] 
а разве мы не получаем текущего пользователя из AuthorizedUser?

[1:29] 
если в еду добавить приватное поле с id юзера и сравнивать его? (edited)

[1:29] 
например, это поле инициализировать в конструкторе еды, при создании (edited)


[1:32] 
ну, и геттер добавить, конечно (edited)

[1:35] 
кстати, да, спасибо, о сервлете я почти забыл... (edited)


Иван [1:39 AM] 
я чёто не пойму как в репозиторий еды засовывать еду всех пользователей и доставать

[1:40] 
вроде бы гдето должен лежать авторизованный пользователь но не ясно где

Kirilo [1:41 AM] 
я так понимаю, что список еды общий для всех и канкарэд (edited)


Dmitry Makarov [1:41 AM] 
@Kirilo  а не наоборот? Контроллер берет из id AuthorizedUser, вызывает метод сервиса, метод сервиса обращается к репозиторию


Kirilo [1:42 AM] 
:slightly_smiling_face:


[1:43] 
ну, да, так и есть, особенно, если с контролера начинаем...


Иван [1:43 AM] 
я вот как написано по пунктам так и начинаю


Kirilo [1:44 AM] 
но тогда тяжелее понять смысл (edited)


[1:44] 
Гигорий все запутал специально, думаю :slightly_smiling_face:

Dmitry Makarov [1:44 AM] 
@Иван можно добавить в качестве id хозяина поле UserId в класс Meal и по нему фильтровать


Kirilo [1:45 AM] 
я так и сделал


Иван [1:46 AM] 
у меня первая мысль была сделать Map<User, Map<Integer, Meal>>


Kirilo [1:46 AM] 
когда еда создается, айди привязывается к текущему пользователю...

[1:46] 
и нужно затем только вызвать его и сравнить с текущим (edited)

Dmitry Makarov [1:47 AM] 
Вам кажется, что сложно. Я сначала тоже за голову схватился. Перечитайте задание от начала и до конца, подумайте. Если не получается, то скорее всего отдохнуть надо.


Kirilo [1:47 AM] 
меня на мысль натолкнули последние коменты Григория :slightly_smiling_face: Да, и только приступил к заданию...


Иван [1:49 AM] 
дело не в том что сложно а в том что не понятно чё куда сувать и откуда брать



Kirilo [1:49 AM] 
просто посмотри, как юзер реализован


Dmitry Makarov [1:49 AM] 
Покопайся в проекте

Kirilo [1:49 AM] 
и точно так сделай еду (edited)

[1:50] 
начни с контроллера и все станет понятным


Иван [1:52 AM] 
AbstractUserController?


Kirilo [1:58 AM] 
конечно, он общий для всех юзеров.

Иван [2:02 AM] 
тогда помойму надо с сервлета начинать


Иван [2:20 AM] 
както мозголомно получается


[2:23] 
при удалении или добавлении вьюшка должна дёргать контроллер а контроллер уже както сервис дёргать а тот делать чёто должен с данными


Kirilo [2:23 AM] 
кстати, да

[2:23] 
подсвечивает, какие методы нужны в итоге и что хотят получить (edited)

Иван [2:24 AM] 
а у нас в meals.jsp сходу MealWithExceed и работа без посредников с ним

Kirilo [2:24 AM] 
об этом все в видео и статьях

[2:25] 
нужно разделить логику настолько. чтобы с легкостью менять сервисы и т.д. и у нас не завалился весь проект (edited)


[2:26] 
то есть сделать слабую связку между всеми компонентами

Иван [2:27 AM] 
не тут походу дело в том что MealWithExceed был уже получен вместе со страничкой от сервлета неявно


Kirilo [2:30 AM] 
MealsUtil.getWithExceeded(repository.getAll(), MealsUtil.DEFAULT_CALORIES_PER_DAY));

Vlad [2:32 AM] 
Ребят,а кому нибудь ключик учебный давали от идеи?А то у меня скоро истечет срок пробной версии


Kirilo [2:33 AM] 
линк был. По ходу один для всех ключ (edited)


[2:33] 
в нулевом задании


Vlad [2:37 AM] 
Разобрался,извиняюсь за off topic


Vangelis [6:14 AM] 
Ребят, я не слишком понимаю, если пользователь авторизованный, то как проверять, чужая или своя еда? Пункт:
2.1: В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.


Few [6:28 AM] 
Ну в задании же написано: решить можно добавляя ид пользователя в еду и не добавляя,  предавать id пользователя по цепочке до хранилища (edited)


Vangelis [6:33 AM] 
Понятно, спасибо.


itAvgur [8:33 AM] 
Коллеги! Правильно ли я понял, что настройки фильтра храним в AuthorizedUser? Ибо в моей реализации я запихнул их в контроллер, за что получил "-" в карму.


vch [8:35 AM] 
@itAvgur если будешь хранить настройки фильтра (как я понимаю, период дат и период времени?) в AuthorizedUser, то одним минусом не отделаешься.


itAvgur [8:37 AM] 
Ну тогда в User их, однако!
Vitaliy Churbakov
@itAvgur если будешь хранить настройки фильтра (как я понимаю, период дат и период времени?) в AuthorizedUser, то одним минусом не отделаешься.
Posted in #hw2Today at 8:35 AM


CRCx86 [9:14 AM] 
доброго дня! в реализации InMemoryUserRepositoryImpl могу я по аналогии с InMemoryMealRepositoryImpl завести List<User> в ValidationUtil?


[9:14] 
или нужен другой способ?

kadmser 
[9:37 AM] 
@CRCx86 зачем? Юзера берем из AuthorizedUser

CRCx86 [9:39 AM] 
а как он приходит? где инициализируется?

kadmser 
[9:41 AM] 
пока он захардкоден там. id() возвращает 1


[9:42] 
Я так понял

CRCx86 [9:44 AM] 
@kadmser спасибо, не заметил

Kaa [9:51 AM] 
а почему настройки фильтра нельзя хранить в AuthorizedUser? по моему самое место, единственный класс который будет храниться с момента логина юзера до его дисконекта. В самом User ему делать нечего, т.к. это дао класс и он только для хранения. А AuthorizedUser это я так понимаю дто и там возможно сохранять расширенную информацию о пользователе на момент его подключения.

anpotashev [9:57 AM] 
@Kaa, я тоже так сперва запихал в AuthorizedUser, но при проверке пояснили, что это неправильно.

Katherine Buzatu [9:58 AM] 
А потом же они будут приходить из сессии? (А в задании надо их хранить?) (edited)

anpotashev [9:58 AM] 
Подозреваю, что AuthorizedUser для хранения "постоянных" данных пользователя, вроде caloriesPerDay.

Kaa [10:06 AM] 
ну тогда еще куки или сессия, локал сторедж, но мы ж пока без них, а больше идей никаких. (
 3 replies Last reply today at 5:50 PM View thread
CRCx86 [10:06 AM] 
не хватает кунг-фу в стримах
return repository.entrySet().stream()
               .filter(map -> email.equals(map.getValue()))
               .map(Map.Entry::getValue)
               .collect(Collectors.toList());
подскажите, что не дописываю? Понимаю, что нужно как-то выделить e-mail, пока что сделано для User

Kaa [10:08 AM] 
а ты сразу по values делай.

CRCx86 [10:09 AM] 
@Kaa не понимаю

anpotashev [10:10 AM] 
лучше equals заменить equalsIgnoreCase (edited)

[10:11] 
Тебе на выходе надо лист или одиночное значение?

Kaa [10:13 AM] 
CRCx86 repository.values().stream() и тогда только фильтр и коллект.

russell [10:13 AM] 
@CRCx86 а зачем ты мапишь пробегайся по repository.values() у тебя будет коллекция милов

CRCx86 [10:14 AM] 
@russell мне по email юзера надо найти


russell [10:14 AM] 
извини юзеров


[10:14] 
имейл уникальное значение, там юзай .findFirst()
.orElse(null);

CRCx86 [10:19 AM] 
@russell return repository.values().stream()
               .filter(map -> email.equalsIgnoreCase(map.getEmail()))
               .map(map -> map.getEmail())
               .findFirst().orElse(null);

вот такое норовит вернуть String

[10:19] 
не хочет User

russell [10:19 AM] 
а зачем ты мэпишь на имейлы

[10:19] 
мэп удали

CRCx86 [10:20 AM] 
@russell спасибо, видимо нужно перечитать по stream

CRCx86 [10:32 AM] 
ряд вопросов по содержанию InMemoryUserRepositoryImpl:
1. если делать репозиторий внутри класса, то какими должны быть значения? AutorizedUser или User?
2. как инициализировать id если у нас нет списка пользователей в случае User?
3. как инициализировать значения и реализовывать методы, если это AuthorizedUser?

russell [10:40 AM] 
В юзер репо не нужны айди авторизированного пользователя. Юзер репо только для админа. Authorizeduser нужен в мил репо

Rostish [10:43 AM] 
я чет завис на 3 пункте

[10:43] 
прям капитально

[10:43] 
что нам нужно поменять? чтобы получить единственный репозиторий мне нужно мапу в мапе сделать?


Иван [10:44 AM] 
ты не одинок

russell [10:44 AM] 
Два варианта. можно и так


Rostish [10:45 AM] 
private Map<Integer, Map<User, Meal>> mealRepository = new ConcurrentHashMap<>();

[10:45] 
как-то так?

russell [10:45 AM] 
Можно еще в мил вставить юзер аиди


Rostish [10:45 AM] 
у нас получает юзер будет ключом, а еда значением и вся еда за одним юзером

Иван [10:46 AM] 
это значит юзерИд нужно будет в вызов засунуть же


russell [10:47 AM] 
Да с контроллера и по всей цепочке вниз

Rostish [10:48 AM] 
так, а правильней как делать


Иван [10:48 AM] 
я в этих контроллерах запутался


russell [10:48 AM] 
Там же написано как вам нравится.


Rostish [10:48 AM] 
Просто, когда мы наследовали meal от абстрактной сущности у него уже появился id


Иван [10:48 AM] 
там для еды контроллеры и для юзеров

Rostish [10:49 AM] 
мы должны добавить еще userId

[10:49] 
будет 2 id?

russell [10:49 AM] 
Да

Иван [10:49 AM] 
я добавил userId и отрефакторил

CRCx86 [10:50 AM] 
не понимаю про репо для Юзер

[10:50] 
в статическом блоке по аналогии с Мил

[10:50] 
что делать нужно?

russell [10:52 AM] 
У юзера сервлет же не реализован, таблицу ты все равно не увидишь. Можешь прям в спрингмейне добавить для теста

Иван [10:53 AM] 
сервлет юзеровский нужено в дз реализовывать этом?

Rostish [10:53 AM] 
А зачем мы мил наследовали от абстрактной сущности?

russell [10:53 AM] 
Я не видел в дз. Мог пропустить. Если кто видел покажите.

CRCx86 [10:54 AM] 
блин, ничего не понимаю

russell [10:55 AM] 
В личку напиши подробно, что знаю помогу

Rostish [10:57 AM] 
Просто разрыв довольно большой с предыдущей задачей, там все расжовано и показаны примеры, тут много на собственное усмотрение, я, например, реально потерялся. Я не понимаю зачем в еде два id для юзера и от унаследованного класса. Этот момент может мне кто-нибудь объяснить? Какой конструктор в итоге должен быть? На все пять параметров?
1 reply Today at 6:40 PM View thread
anpotashev [10:58 AM] 
Можно не создавать два id



russell [10:58 AM] 
Согласен, это задание в разы сложнее

Rostish [10:59 AM] 
Это я тоже понял, но мапа  в мапе выглядит неочень интуитивно, сложнее в разы реализовывать методы create, delete и тд

anpotashev [10:59 AM] 
Мапа в мапе - быстрее.

Иван [10:59 AM] 
почему быстрее?

vch [10:59 AM] 
@anpotashev чем?

anpotashev [11:00 AM] 
Поиск в мапе по ключу имеет сложность O(log)



Иван [11:00 AM] 
я думал быстрей реализовать

vch [11:00 AM] 
@anpotashev смотря что за Map. Если HashMap - то O(1)



CRCx86 [11:01 AM] 
да у меня в основном общие вопросы: 
1. как связаны AuthorizedUser с User?
2. где инициализируется список пользователей?
3. нужно ли контролировать список еды по id каждого пользователя?
4.  сигнатура получения для MealRepository должен быть Meal get(int id, int userID)?

Иван [11:01 AM] 
я тупо как для еды создал UsersUtil и в нём так же захардкодил список пользователей

anpotashev [11:02 AM] 
Давно-ли O(1) ?

vch [11:02 AM] 
@anpotashev с незапамятных времён

Иван [11:02 AM] 
наверно он имел в виду O(n)?

[11:03] 
O(1) это например arr..lenght вызвать

[11:03] 
тоесть не зависит от длины

anpotashev [11:04 AM] 
Чтобы добраться до искомого элемента в хэш-таблице из n элементов надо в среднем перебрать ln(n) элементов.

vch [11:06 AM] 
@anpotashev ты не путай с TreeMap.
HashMap - это массив, в каждом элементе которого может быть несколько value.
Номер элемента в массиве определяется быстро (на основе хэша). 
А дальше если не повезёт - то перебор нескольких значений в bucket тоже быстр.
1 reply Today at 11:20 AM View thread
russell [11:07 AM] 
Вот если коллизии будут то там уже o(n) внутри

Иван [11:08 AM] 
@CRCx86 а что ты имеешь в виду под контролировать список еды по id пользователя?

vch [11:08 AM] 
@russell И тоже не совсем так. Если элементов в bucket больше 8, то там красно-чёрное дерево образуется.
И вот только тогда уже получаем log. Но не от N, а от количество элементов, попавших в 1 bucket



russell [11:09 AM] 
Да вспомнил в какой то недавней версии ввели


vch [11:09 AM] 
@russell в 8


CRCx86 [11:09 AM] 
@Иван к примеру вот что я написал для InMemory
@Override
   public Collection<Meal> getAll() {

       List<Meal> mealList = new CopyOnWriteArrayList<>(repository.values());
       Comparator<Meal> mealComparator = new Comparator<Meal>() {
           @Override
           public int compare(Meal m1, Meal m2) {
               return m2.getDate().compareTo(m1.getDate());
           }
       };
       Collections.sort(mealList, mealComparator);

       return mealList;
   }

но он всегда возвращает весь список. как решение нужно добавить getAll(int userID), я думаю


[11:10] 
я говорю, я запутался, не понимаю ничего


russell [11:10 AM] 
Про лямбдовый  компаратор глянь, код значительно уменьшится

Иван [11:10 AM] 
в задании написано пользователь должен видеть только свою еду


[11:11] 
тоесть ты както в тело метода должен получать userId

Rostish [11:11 AM] 
я так понимаю через гет параметр

[11:11] 
но пока не понял как на веб морде появляться должен userId

Иван [11:11 AM] 
грубо говоря для пользователя будет хакерством получать данные о чужой еде


[11:12] 
он наверное не должен

vsergeev [11:12 AM] 
AuthorizedUser виден только в web, поэтому полученный оттуда id надо передавать вниз в репозиторий и вытаскивать только ту еду, которая принадлежит этому пользователю


Ivan [11:13 AM] 
На мой взгляд, на много проще ввести userId в Meal, еда сразу приобретает своего владельца и куча условий (дальнейших) будет проще реализовывать.


CRCx86 [11:13 AM] 
@vsergeev где связка AuthorizedUser и User?

Иван [11:13 AM] 
пользователь видит свой userId в jsp например

[11:14] 
мне тоже вот не понятно про AuthorizedUser


Rostish [11:15 AM] 
у нас должна быть новая jsp страница для авторизированного пользователя с его списком или делать все в той же meals.jsp?


Иван [11:15 AM] 
в задании не упоминается user.jsp и UserServlet следовательно

[11:16] 
по этому не понятно как проходит авторизация пользжователя


[11:17] 
в роликах показано что можно сделать выпадающий список с всеми пользователями и выбирать из них (edited)

itAvgur [11:17 AM] 
Так-с... задам вопрос про фильтры.
Настройки фильтров - в User.
Фильтрация по дате - из репозитория еды.
Фильтрация по времени - из сервиса еды.
Обновление веб-формы: из сервлета еды через контроллер.
А юзера по AuthorizedUser.id мы получает через UserService.
Т.е. выходит так, что и репозиторию и  сервису и контроллеру надо узнать про UserService.
Чего-то сложно я напридумывал. Мнение? (edited)


grigory.kislin [11:18 AM] 
привет
@CRCx86
> 1. как связаны AuthorizedUser с User?
сходи на demo: http://topjava.herokuapp.com/login
когда пользователь авторизуется в приложении создается AuthorizedUser (хранится в сессии, сейчас там захардкоден 1, авторизация и что такое сессия/куки будет позже). Для нас: когда авторизированный пользователь обращается на сервер, его id находится в AuthorizedUser .
> 2. где инициализируется список пользователей?
на твое усмотрение
> 3. нужно ли контролировать список еды по id каждого пользователя?
не понял вопроса. еще раз- посмотри демо и пойми, что делает приложение. есть пользователи, есть их еда. они ее могут смотреть- редактировать. все просто.
> 4.  сигнатура получения для MealRepository должен быть Meal get(int id, int userID)?
да. только название - userId (edited)


Ivan [11:20 AM] 
AuthorizedUser.id() - вернёт id пользователя, верни всю еду у которой (AuthorizedUser.id() == meal.getUserId()).

anpotashev [11:20 AM] 


Точно, ты прав.


grigory.kislin [11:21 AM] 
@Rostish
> должна быть новая jsp страница для авторизированного пользователя с его списком или делать все в той же meals.jsp
а в чем будет разница между ними??

Rostish [11:22 AM] 
Я, думаю, не в чем. Я просто реально пока не пойму момент входа пользователя. Я нажимаю кнопку login, срабатывает doget? с параметром от моего id от моего юзера и вниз по цепочке вытаскиваются данные
1 reply Today at 1:15 PM View thread

Rostish [11:22 AM] 
но откуда мы берем id юзера не понимаю

grigory.kislin [11:22 AM] 
по поводу хранения значений фильтра - в демо она не хранится (по F5 скидывается)

[11:23] 
@Rostish момент входа пользователя будет на 9м уроке (авторизация)
берем из AuthorizedUser ( думаю не менее 10 раз везде встретилось:) (edited)

CRCx86 [11:24 AM] 
@grigory.kislin т.е. id AuthorizedUser общее значения для всего приложения на данный момент?

Rostish [11:24 AM] 
public class AuthorizedUser {

   *public static int id() {
       return 1;
   }*

   public static int getCaloriesPerDay() {
       return DEFAULT_CALORIES_PER_DAY;
   }
}
Мы о выделенной части говорим?


vch [11:24 AM] 
по поводу фильтров - если внимательно почитать, то в HW1 был запрет на использование сессий.
А в HW2 уже такого не написано... :slightly_smiling_face:
2 replies Last reply today at 11:31 AM View thread
Rostish [11:25 AM] 
только она не выделилась, звездочки там


Иван [11:32 AM] 
@grigory.kislin получается в этом дз не нужно трогать user.jsp и UserServlet или я чего не понимаю?


itAvgur [11:32 AM] 
Если настройки фильтров не храним, то откуда их брать в  п. "2.4: Фильтрацию по датам сделать в репозитории" ???


Иван [11:34 AM] 
наверно через get в строке броузера хранится

itAvgur [11:39 AM] 
Я в контроллер объявил две переменные для фильтра - но это оказалось несекьюрно для многопоточности.
Из возможных вариантов остается только перетащить их в сервлет, а в контроллер и ниже передавать атрибутами в методах.


vch [11:40 AM] 
@itAvgur вот только в сервлете в точности те же проблемы с многопоточностью... И сервлет, и контроллер существуют в 1 экземпляре на приложение.

itAvgur [11:41 AM] 
Именно! Значит в сервис его пну. Метод перебора, епта.
Vitaliy Churbakov
@itAvgur вот только в сервлете в точности те же проблемы с многопоточностью... И сервлет, и контроллер существуют в 1 экземпляре на приложение.
Posted in #hw2Today at 11:40 AM
(edited)


vch [11:44 AM] 
@itAvgur Эээ... Ну если что, сервис тоже только в 1 экземпляре создаётся...
И, предупреждая твой следующий шаг - репозиторий Meal тоже 1.


itAvgur [11:45 AM] 
Вот я вторым шагом и решил его убрать в User.
Только там хранить такие данные - не комильфо однако.
Vitaliy Churbakov
@itAvgur Эээ... Ну если что, сервис тоже только в 1 экземпляре создаётся...
И, предупреждая твой следующий шаг - репозиторий Meal тоже 1.
Posted in #hw2Today at 11:44 AM
(edited)


vch [11:46 AM] 
@itAvgur Нет в жизни счастья...


Ivan [11:52 AM] 
Ещё один непонятный момент, может кто знает почему в User "Date registered", а в Meal "LocalDateTime dateTime"? Может было бы удобнее везде LDT использовать? (edited)


russell [3:06 PM] 
остальные помечать LocalDate.MIN и тд

[3:07] 
@vch можно научить налл конвертить в LocalDate.MIN или LocalDate.Max?

vch [3:09 PM] 
@russell Ну, с этим я и сам могу справиться. Мне главное - чтобы контроллер не упал, а уж из null то что мне надо я получу 1 тернарным оператором.

russell [3:10 PM] 
понял оказывается есть аннотация @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)

grigory.kislin [3:17 PM] 
@vsergeev если вы поняли, что нужно вернуть,то это вопрос, на который надо найти ответ самому. попробуйте по разному сделать
про место, где конвертировать в dto (MealWithExceeded) в уроке и видео есть материал

Антон Кляшторный [3:20 PM] 
getByEmail из MealService удалить нужно?


vsergeev [3:20 PM] 
у еды нет почты
 

Shalukhau Dzmitry [3:22 PM] 
>у еды нет почты
Хорошая идея для стартапа на Java :slightly_smiling_face:

PugV [6:07 PM] 
извините за глупый вопрос по п1: список пользователей возвращать отсортированным по имени.  Пользователей создаем сами, по аналогии с MealsUtil.MEALS ?
 2 replies Last reply 1 day ago View thread
shaakem [6:17 PM] 
У тебя пользователи находятся в мапе repository. В методе getAll() сформируй список из этой мапы и отсортируй.

Антон Кляшторный [6:30 PM] 
5.7: Сделайте отдельный getAll без применения фильтра. без exceed всю еду или без фильтра по времени?

vsergeev [6:34 PM] 
С exceed без фильтра по времени

Антон Кляшторный [6:39 PM] 
ок

Антон Кляшторный [7:46 PM] 
uploaded this image: HW02 Spring-context.JPEG
Add Comment

kadmser [9:32 PM] 
uploaded this image: подскажите, это нормальный вывод?
Add Comment

Valery [9:34 PM] 
для какого пункта? (edited)

kadmser [9:37 PM] 
задание HW02 без опшионал

Valery [9:39 PM] 
там требуется что-то в консоль выводить?

Dmitry Makarov [9:40 PM] 
Попробуй удалить одну и ту же еду 2 раза. Должно NotFoundException выбросить

Argentum_kuh [10:51 PM] 
Кстати, кто знает, для чего в User поле enabled? И зачем нам списо ролей? Предполагается, что в дальнейшем будут еще какие-то?

russell [10:53 PM] 
Для того, чтобы отключать юзера, возможно банить. Админ тоже хочет иметь свой список еды и может быть пользователем.

Viktor [11:27 PM] 
Такая идея, поскольку для jsp нам нужен MealWithExceeded а для сервиса-репозитория Meal. может стоит сделать конверторы в классах, так удобнее + паттерн информационный эксперт (немного)

russell [11:30 PM] 
они же вроде знать друг о друге не должны, они же даже не наследуются и также лежат в отдельных пакетах

Viktor [11:32 PM] 
опять же,конвертировать их приходиться часто, и код дублируется. Тогда можно использовать утильтарный конвертер, но это уже странно :smiley:

russell [11:33 PM] 
private static MealWithExceed createWithExceed(Meal meal, boolean exceeded) {
       return new MealWithExceed(meal.getId(), meal.getDateTime(), meal.getDescription(), meal.getCalories(), exceeded);
   } в MealsUtil

Viktor [11:39 PM] 
че-то у меня голова ломаться начинает :smiley:


----- Today November 14th, 2017 -----
Kirilo [1:08 AM] 
если я правильно понял, то задание нужно начинать делать с контроллера(вставить необходимые методы) по аналогии с юзером. То есть, там перенаправляем на сервисы, в сервисах запускаем соответствующие утилиты, а в репозитории вызываем необходимые сервисы...

russell [1:16 AM] 
Да и не забудь из контроллера в сервис передать userId

[1:16] 
А в сервлете уже вызывать методы контроллера

Kirilo [1:28 AM] 
а разве мы не получаем текущего пользователя из AuthorizedUser?

[1:29] 
если в еду добавить приватное поле с id юзера и сравнивать его? (edited)

[1:29] 
например, это поле инициализировать в конструкторе еды, при создании (edited)

[1:32] 
ну, и геттер добавить, конечно (edited)

[1:35] 
кстати, да, спасибо, о сервлете я почти забыл... (edited)

Иван [1:39 AM] 
я чёто не пойму как в репозиторий еды засовывать еду всех пользователей и доставать

[1:40] 
вроде бы гдето должен лежать авторизованный пользователь но не ясно где

Kirilo [1:41 AM] 
я так понимаю, что список еды общий для всех и канкарэд (edited)

Dmitry Makarov [1:41 AM] 
@Kirilo  а не наоборот? Контроллер берет из id AuthorizedUser, вызывает метод сервиса, метод сервиса обращается к репозиторию

Kirilo [1:42 AM] 
:slightly_smiling_face:

[1:43] 
ну, да, так и есть, особенно, если с контролера начинаем...

Иван [1:43 AM] 
я вот как написано по пунктам так и начинаю

Kirilo [1:44 AM] 
но тогда тяжелее понять смысл (edited)

[1:44] 
Гигорий все запутал специально, думаю :slightly_smiling_face:

Dmitry Makarov [1:44 AM] 
@Иван можно добавить в качестве id хозяина поле UserId в класс Meal и по нему фильтровать

Kirilo [1:45 AM] 
я так и сделал

Иван [1:46 AM] 
у меня первая мысль была сделать Map<User, Map<Integer, Meal>>

Kirilo [1:46 AM] 
когда еда создается, айди привязывается к текущему пользователю...

[1:46] 
и нужно затем только вызвать его и сравнить с текущим (edited)

Dmitry Makarov [1:47 AM] 
Вам кажется, что сложно. Я сначала тоже за голову схватился. Перечитайте задание от начала и до конца, подумайте. Если не получается, то скорее всего отдохнуть надо.

Kirilo [1:47 AM] 
меня на мысль натолкнули последние коменты Григория :slightly_smiling_face: Да, и только приступил к заданию...

Иван [1:49 AM] 
дело не в том что сложно а в том что не понятно чё куда сувать и откуда брать


Kirilo [1:49 AM] 
просто посмотри, как юзер реализован

Dmitry Makarov [1:49 AM] 
Покопайся в проекте

Kirilo [1:49 AM] 
и точно так сделай еду (edited)

[1:50] 
начни с контроллера и все станет понятным

Иван [1:52 AM] 
AbstractUserController?

Kirilo [1:58 AM] 
конечно, он общий для всех юзеров.

Иван [2:02 AM] 
тогда помойму надо с сервлета начинать

Иван [2:20 AM] 
както мозголомно получается

[2:23] 
при удалении или добавлении вьюшка должна дёргать контроллер а контроллер уже както сервис дёргать а тот делать чёто должен с данными

Kirilo [2:23 AM] 
кстати, да

[2:23] 
подсвечивает, какие методы нужны в итоге и что хотят получить (edited)

Иван [2:24 AM] 
а у нас в meals.jsp сходу MealWithExceed и работа без посредников с ним

Kirilo [2:24 AM] 
об этом все в видео и статьях

[2:25] 
нужно разделить логику настолько. чтобы с легкостью менять сервисы и т.д. и у нас не завалился весь проект (edited)

[2:26] 
то есть сделать слабую связку между всеми компонентами

Иван [2:27 AM] 
не тут походу дело в том что MealWithExceed был уже получен вместе со страничкой от сервлета неявно

Kirilo [2:30 AM] 
MealsUtil.getWithExceeded(repository.getAll(), MealsUtil.DEFAULT_CALORIES_PER_DAY));

Vlad [2:32 AM] 
Ребят,а кому нибудь ключик учебный давали от идеи?А то у меня скоро истечет срок пробной версии

Kirilo [2:33 AM] 
линк был. По ходу один для всех ключ (edited)

[2:33] 
в нулевом задании

Vlad [2:37 AM] 
Разобрался,извиняюсь за off topic

Vangelis [6:14 AM] 
Ребят, я не слишком понимаю, если пользователь авторизованный, то как проверять, чужая или своя еда? Пункт:
2.1: В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.

Few
[6:28 AM] 
Ну в задании же написано: решить можно добавляя ид пользователя в еду и не добавляя,  предавать id пользователя по цепочке до хранилища (edited)

Vangelis [6:33 AM] 
Понятно, спасибо.

itAvgur [8:33 AM] 
Коллеги! Правильно ли я понял, что настройки фильтра храним в AuthorizedUser? Ибо в моей реализации я запихнул их в контроллер, за что получил "-" в карму.

vch [8:35 AM] 
@itAvgur если будешь хранить настройки фильтра (как я понимаю, период дат и период времени?) в AuthorizedUser, то одним минусом не отделаешься.

itAvgur [8:37 AM] 
Ну тогда в User их, однако!
Vitaliy Churbakov
@itAvgur если будешь хранить настройки фильтра (как я понимаю, период дат и период времени?) в AuthorizedUser, то одним минусом не отделаешься.
Posted in #hw2Today at 8:35 AM

CRCx86 [9:14 AM] 
доброго дня! в реализации InMemoryUserRepositoryImpl могу я по аналогии с InMemoryMealRepositoryImpl завести List<User> в ValidationUtil?

[9:14] 
или нужен другой способ?

kadmser [9:37 AM] 
@CRCx86 зачем? Юзера берем из AuthorizedUser

CRCx86 [9:39 AM] 
а как он приходит? где инициализируется?

kadmser [9:41 AM] 
пока он захардкоден там. id() возвращает 1


[9:42] 
Я так понял

CRCx86 [9:44 AM] 
@kadmser спасибо, не заметил

Kaa [9:51 AM] 
а почему настройки фильтра нельзя хранить в AuthorizedUser? по моему самое место, единственный класс который будет храниться с момента логина юзера до его дисконекта. В самом User ему делать нечего, т.к. это дао класс и он только для хранения. А AuthorizedUser это я так понимаю дто и там возможно сохранять расширенную информацию о пользователе на момент его подключения.

anpotashev [9:57 AM] 
@Kaa, я тоже так сперва запихал в AuthorizedUser, но при проверке пояснили, что это неправильно.

Katherine Buzatu [9:58 AM] 
А потом же они будут приходить из сессии? (А в задании надо их хранить?) (edited)

anpotashev [9:58 AM] 
Подозреваю, что AuthorizedUser для хранения "постоянных" данных пользователя, вроде caloriesPerDay.

Kaa [10:06 AM] 
ну тогда еще куки или сессия, локал сторедж, но мы ж пока без них, а больше идей никаких. (
 3 replies Last reply today at 5:50 PM View thread
CRCx86 [10:06 AM] 
не хватает кунг-фу в стримах
return repository.entrySet().stream()
               .filter(map -> email.equals(map.getValue()))
               .map(Map.Entry::getValue)
               .collect(Collectors.toList());
подскажите, что не дописываю? Понимаю, что нужно как-то выделить e-mail, пока что сделано для User

Kaa [10:08 AM] 
а ты сразу по values делай.

CRCx86 [10:09 AM] 
@Kaa не понимаю

anpotashev [10:10 AM] 
лучше equals заменить equalsIgnoreCase (edited)

[10:11] 
Тебе на выходе надо лист или одиночное значение?

Kaa [10:13 AM] 
CRCx86 repository.values().stream() и тогда только фильтр и коллект.

russell [10:13 AM] 
@CRCx86 а зачем ты мапишь пробегайся по repository.values() у тебя будет коллекция милов

CRCx86 [10:14 AM] 
@russell мне по email юзера надо найти

russell [10:14 AM] 
извини юзеров

[10:14] 
имейл уникальное значение, там юзай .findFirst()
.orElse(null);

CRCx86 [10:19 AM] 
@russell return repository.values().stream()
               .filter(map -> email.equalsIgnoreCase(map.getEmail()))
               .map(map -> map.getEmail())
               .findFirst().orElse(null);

вот такое норовит вернуть String

[10:19] 
не хочет User

russell [10:19 AM] 
а зачем ты мэпишь на имейлы

[10:19] 
мэп удали

CRCx86 [10:20 AM] 
@russell спасибо, видимо нужно перечитать по stream

CRCx86 [10:32 AM] 
ряд вопросов по содержанию InMemoryUserRepositoryImpl:
1. если делать репозиторий внутри класса, то какими должны быть значения? AutorizedUser или User?
2. как инициализировать id если у нас нет списка пользователей в случае User?
3. как инициализировать значения и реализовывать методы, если это AuthorizedUser?

russell [10:40 AM] 
В юзер репо не нужны айди авторизированного пользователя. Юзер репо только для админа. Authorizeduser нужен в мил репо

Rostish [10:43 AM] 
я чет завис на 3 пункте

[10:43] 
прям капитально

[10:43] 
что нам нужно поменять? чтобы получить единственный репозиторий мне нужно мапу в мапе сделать?

Иван [10:44 AM] 
ты не одинок

russell [10:44 AM] 
Два варианта. можно и так


Rostish [10:45 AM] 
private Map<Integer, Map<User, Meal>> mealRepository = new ConcurrentHashMap<>();

[10:45] 
как-то так?

russell [10:45 AM] 
Можно еще в мил вставить юзер аиди

Rostish [10:45 AM] 
у нас получает юзер будет ключом, а еда значением и вся еда за одним юзером

Иван [10:46 AM] 
это значит юзерИд нужно будет в вызов засунуть же

russell [10:47 AM] 
Да с контроллера и по всей цепочке вниз

Rostish [10:48 AM] 
так, а правильней как делать

Иван [10:48 AM] 
я в этих контроллерах запутался

russell [10:48 AM] 
Там же написано как вам нравится.

Rostish [10:48 AM] 
Просто, когда мы наследовали meal от абстрактной сущности у него уже появился id

Иван [10:48 AM] 
там для еды контроллеры и для юзеров

Rostish [10:49 AM] 
мы должны добавить еще userId

[10:49] 
будет 2 id?

russell [10:49 AM] 
Да

Иван [10:49 AM] 
я добавил userId и отрефакторил

CRCx86 [10:50 AM] 
не понимаю про репо для Юзер

[10:50] 
в статическом блоке по аналогии с Мил

[10:50] 
что делать нужно?

russell [10:52 AM] 
У юзера сервлет же не реализован, таблицу ты все равно не увидишь. Можешь прям в спрингмейне добавить для теста

Иван [10:53 AM] 
сервлет юзеровский нужено в дз реализовывать этом?

Rostish [10:53 AM] 
А зачем мы мил наследовали от абстрактной сущности?

russell [10:53 AM] 
Я не видел в дз. Мог пропустить. Если кто видел покажите.

CRCx86 [10:54 AM] 
блин, ничего не понимаю

russell [10:55 AM] 
В личку напиши подробно, что знаю помогу

Rostish [10:57 AM] 
Просто разрыв довольно большой с предыдущей задачей, там все расжовано и показаны примеры, тут много на собственное усмотрение, я, например, реально потерялся. Я не понимаю зачем в еде два id для юзера и от унаследованного класса. Этот момент может мне кто-нибудь объяснить? Какой конструктор в итоге должен быть? На все пять параметров?
1 reply Today at 6:40 PM View thread
anpotashev [10:58 AM] 
Можно не создавать два id


russell [10:58 AM] 
Согласен, это задание в разы сложнее

Rostish [10:59 AM] 
Это я тоже понял, но мапа  в мапе выглядит неочень интуитивно, сложнее в разы реализовывать методы create, delete и тд

anpotashev [10:59 AM] 
Мапа в мапе - быстрее.

Иван [10:59 AM] 
почему быстрее?

vch [10:59 AM] 
@anpotashev чем?

anpotashev [11:00 AM] 
Поиск в мапе по ключу имеет сложность O(log)


Иван [11:00 AM] 
я думал быстрей реализовать

vch [11:00 AM] 
@anpotashev смотря что за Map. Если HashMap - то O(1)


CRCx86 [11:01 AM] 
да у меня в основном общие вопросы: 
1. как связаны AuthorizedUser с User?
2. где инициализируется список пользователей?
3. нужно ли контролировать список еды по id каждого пользователя?
4.  сигнатура получения для MealRepository должен быть Meal get(int id, int userID)?

Иван [11:01 AM] 
я тупо как для еды создал UsersUtil и в нём так же захардкодил список пользователей

anpotashev [11:02 AM] 
Давно-ли O(1) ?

vch [11:02 AM] 
@anpotashev с незапамятных времён

Иван [11:02 AM] 
наверно он имел в виду O(n)?

[11:03] 
O(1) это например arr..lenght вызвать

[11:03] 
тоесть не зависит от длины

anpotashev [11:04 AM] 
Чтобы добраться до искомого элемента в хэш-таблице из n элементов надо в среднем перебрать ln(n) элементов.

vch [11:06 AM] 
@anpotashev ты не путай с TreeMap.
HashMap - это массив, в каждом элементе которого может быть несколько value.
Номер элемента в массиве определяется быстро (на основе хэша). 
А дальше если не повезёт - то перебор нескольких значений в bucket тоже быстр.
1 reply Today at 11:20 AM View thread
russell [11:07 AM] 
Вот если коллизии будут то там уже o(n) внутри

Иван [11:08 AM] 
@CRCx86 а что ты имеешь в виду под контролировать список еды по id пользователя?

vch [11:08 AM] 
@russell И тоже не совсем так. Если элементов в bucket больше 8, то там красно-чёрное дерево образуется.
И вот только тогда уже получаем log. Но не от N, а от количество элементов, попавших в 1 bucket


russell [11:09 AM] 
Да вспомнил в какой то недавней версии ввели

vch [11:09 AM] 
@russell в 8

CRCx86 [11:09 AM] 
@Иван к примеру вот что я написал для InMemory
@Override
   public Collection<Meal> getAll() {

       List<Meal> mealList = new CopyOnWriteArrayList<>(repository.values());
       Comparator<Meal> mealComparator = new Comparator<Meal>() {
           @Override
           public int compare(Meal m1, Meal m2) {
               return m2.getDate().compareTo(m1.getDate());
           }
       };
       Collections.sort(mealList, mealComparator);

       return mealList;
   }

но он всегда возвращает весь список. как решение нужно добавить getAll(int userID), я думаю

[11:10] 
я говорю, я запутался, не понимаю ничего

russell [11:10 AM] 
Про лямбдовый  компаратор глянь, код значительно уменьшится

Иван [11:10 AM] 
в задании написано пользователь должен видеть только свою еду

[11:11] 
тоесть ты както в тело метода должен получать userId

Rostish [11:11 AM] 
я так понимаю через гет параметр

[11:11] 
но пока не понял как на веб морде появляться должен userId

Иван [11:11 AM] 
грубо говоря для пользователя будет хакерством получать данные о чужой еде

[11:12] 
он наверное не должен

vsergeev [11:12 AM] 
AuthorizedUser виден только в web, поэтому полученный оттуда id надо передавать вниз в репозиторий и вытаскивать только ту еду, которая принадлежит этому пользователю

Ivan [11:13 AM] 
На мой взгляд, на много проще ввести userId в Meal, еда сразу приобретает своего владельца и куча условий (дальнейших) будет проще реализовывать.

CRCx86 [11:13 AM] 
@vsergeev где связка AuthorizedUser и User?

Иван [11:13 AM] 
пользователь видит свой userId в jsp например

[11:14] 
мне тоже вот не понятно про AuthorizedUser

Rostish [11:15 AM] 
у нас должна быть новая jsp страница для авторизированного пользователя с его списком или делать все в той же meals.jsp?

Иван [11:15 AM] 
в задании не упоминается user.jsp и UserServlet следовательно

[11:16] 
по этому не понятно как проходит авторизация пользжователя

[11:17] 
в роликах показано что можно сделать выпадающий список с всеми пользователями и выбирать из них (edited)

itAvgur [11:17 AM] 
Так-с... задам вопрос про фильтры.
Настройки фильтров - в User.
Фильтрация по дате - из репозитория еды.
Фильтрация по времени - из сервиса еды.
Обновление веб-формы: из сервлета еды через контроллер.
А юзера по AuthorizedUser.id мы получает через UserService.
Т.е. выходит так, что и репозиторию и  сервису и контроллеру надо узнать про UserService.
Чего-то сложно я напридумывал. Мнение? (edited)

grigory.kislin [11:18 AM] 
привет
@CRCx86
> 1. как связаны AuthorizedUser с User?
сходи на demo: http://topjava.herokuapp.com/login
когда пользователь авторизуется в приложении создается AuthorizedUser (хранится в сессии, сейчас там захардкоден 1, авторизация и что такое сессия/куки будет позже). Для нас: когда авторизированный пользователь обращается на сервер, его id находится в AuthorizedUser .
> 2. где инициализируется список пользователей?
на твое усмотрение
> 3. нужно ли контролировать список еды по id каждого пользователя?
не понял вопроса. еще раз- посмотри демо и пойми, что делает приложение. есть пользователи, есть их еда. они ее могут смотреть- редактировать. все просто.
> 4.  сигнатура получения для MealRepository должен быть Meal get(int id, int userID)?
да. только название - userId (edited)

Ivan [11:20 AM] 
AuthorizedUser.id() - вернёт id пользователя, верни всю еду у которой (AuthorizedUser.id() == meal.getUserId()).

anpotashev [11:20 AM] 


Точно, ты прав.

grigory.kislin [11:21 AM] 
@Rostish
> должна быть новая jsp страница для авторизированного пользователя с его списком или делать все в той же meals.jsp
а в чем будет разница между ними??

Rostish [11:22 AM] 
Я, думаю, не в чем. Я просто реально пока не пойму момент входа пользователя. Я нажимаю кнопку login, срабатывает doget? с параметром от моего id от моего юзера и вниз по цепочке вытаскиваются данные
1 reply Today at 1:15 PM View thread
Rostish [11:22 AM] 
но откуда мы берем id юзера не понимаю

grigory.kislin [11:22 AM] 
по поводу хранения значений фильтра - в демо она не хранится (по F5 скидывается)

[11:23] 
@Rostish момент входа пользователя будет на 9м уроке (авторизация)
берем из AuthorizedUser ( думаю не менее 10 раз везде встретилось:) (edited)

CRCx86 [11:24 AM] 
@grigory.kislin т.е. id AuthorizedUser общее значения для всего приложения на данный момент?

Rostish [11:24 AM] 
public class AuthorizedUser {

   *public static int id() {
       return 1;
   }*

   public static int getCaloriesPerDay() {
       return DEFAULT_CALORIES_PER_DAY;
   }
}
Мы о выделенной части говорим?

vch [11:24 AM] 
по поводу фильтров - если внимательно почитать, то в HW1 был запрет на использование сессий.
А в HW2 уже такого не написано... :slightly_smiling_face:
2 replies Last reply today at 11:31 AM View thread
Rostish [11:25 AM] 
только она не выделилась, звездочки там

Иван [11:32 AM] 
@grigory.kislin получается в этом дз не нужно трогать user.jsp и UserServlet или я чего не понимаю?

itAvgur [11:32 AM] 
Если настройки фильтров не храним, то откуда их брать в  п. "2.4: Фильтрацию по датам сделать в репозитории" ???

Иван [11:34 AM] 
наверно через get в строке броузера хранится

itAvgur [11:39 AM] 
Я в контроллер объявил две переменные для фильтра - но это оказалось несекьюрно для многопоточности.
Из возможных вариантов остается только перетащить их в сервлет, а в контроллер и ниже передавать атрибутами в методах.

vch [11:40 AM] 
@itAvgur вот только в сервлете в точности те же проблемы с многопоточностью... И сервлет, и контроллер существуют в 1 экземпляре на приложение.

itAvgur [11:41 AM] 
Именно! Значит в сервис его пну. Метод перебора, епта.
Vitaliy Churbakov
@itAvgur вот только в сервлете в точности те же проблемы с многопоточностью... И сервлет, и контроллер существуют в 1 экземпляре на приложение.
Posted in #hw2Today at 11:40 AM
(edited)

vch [11:44 AM] 
@itAvgur Эээ... Ну если что, сервис тоже только в 1 экземпляре создаётся...
И, предупреждая твой следующий шаг - репозиторий Meal тоже 1.

itAvgur [11:45 AM] 
Вот я вторым шагом и решил его убрать в User.
Только там хранить такие данные - не комильфо однако.
Vitaliy Churbakov
@itAvgur Эээ... Ну если что, сервис тоже только в 1 экземпляре создаётся...
И, предупреждая твой следующий шаг - репозиторий Meal тоже 1.
Posted in #hw2Today at 11:44 AM
(edited)

vch [11:46 AM] 
@itAvgur Нет в жизни счастья...

Ivan [11:52 AM] 
Ещё один непонятный момент, может кто знает почему в User "Date registered", а в Meal "LocalDateTime dateTime"? Может было бы удобнее везде LDT использовать? (edited)

grigory.kislin [11:52 AM] 
@Иван
user.jsp не меняется (в ДЗ нет)
UserServlet можно поменять в Optional п.8

[11:53] 
@itAvgur
можно прокидывать в запрос. можно барть из параметров. хочется- храни в сессии

[11:54] 
@CRCx86
>   id AuthorizedUser общее значения для всего приложения на данный момент
да. в Optional п.8 мы его можем поменять (edited)

Иван [11:55 AM] 
такое впечатление что список пользователей не нужен вовсе


[11:57] 
в идее можно какнибудь рефакторинг откатить?

[11:58] 
ато есть сомнения что userId лучше чем мапа в мапе

grigory.kislin [12:03 PM] 
откат- см. https://github.com/JavaOPs/topjava/wiki/git#%D0%9A%D0%B0%D0%BA-%D0%BE%D1%82%D0%BA%D0%B0%D1%82%D0%B8%D1%82%D1%8C-patch
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 

[12:03] 
добавил в урок:
*Еще раз смотрим на демо приложение и вникаем, что такое пользователь и его еда и что он может с ней сделать. Когда пользователь авторизуется в приложении, его id и норма калорий чудесным образом попадают в AuthorizedUser и в приложении мы может обращаемся к ним. Как они реально туда попадут будет в уроке 9 (Spring Security, сессия и куки)*

если у кого есть мысли, как можно еще лучше разжевать - буду очень благодарен (edited)

vch [12:04 PM] 
>чудесным образом
:slightly_smiling_face:

Иван [12:06 PM] 
вот именно эти чудеса и делают непонятным последовательность вызовов

grigory.kislin [12:07 PM] 
??? AuthorizedUser.id()  я не понимаю, что непонятного?

Иван [12:07 PM] 
я гдето читал что в идее хотели добавить дерево вызовов

[12:09] 
@grigory.kislin я не могу проследить кто и где начинает это использовать и как это привести к репозиторию

grigory.kislin [12:10 PM] 
получай в контроллере и передавай в репозиторий. в уроке есть- "на слое web" и про передачу userId. почитай еще раз (edited)

Mish [1:13 PM] 
@Rostish Пользователи выбираются в index.html. Оттуда при выборе попадают в users.jsp - где в методе дуГет делаем их авторизацию через setId(userId).



vsimonov [2:19 PM] 
@grigory.kislin количество и тип входных параметров в методы MealService менять можно?

timur.dzh [2:20 PM] 
можно всё


Viktor [4:22 PM] 
Есть вопрос, со своей колокольни не могу понять, что лучше для фильтрации:
1. передавать по всем методам 2 LocalDate 2 LocalTime userId
2. передавать по всем методам 2 LocalDateTime собрав его в сервелете и userId
3. Создать отдельный объект DateTimeFilter с полями фильтрами и передавать его.

russell [4:25 PM] 
LocalTime LocalDateTime не нужен же в репо, там же только по дате

[4:27] 
@Viktor ты с дто решил в контроллере или сервисе работать?

Viktor [4:28 PM] 
ещё не решил, пока просто методы прописываю. Но ведь из БД можно взять и по дате и по времени

russell [4:29 PM] 
а зачем тебе по времени, тебе же потом в мил с эксидом превращать, а там эксид же только по дате определяется


Viktor [4:29 PM] 
точняк, затупил немного


Ганичев Максим [4:32 PM] 
Реализовать слои приложения для функциональности "еда". API контроллера должна удовлетворять все потребности демо приложения и ничего лишнего


[4:32] 
Такой вопрос а поиск входит в необходимую функциональность на данном этапе?

russell [4:32 PM] 
поиск в смысле фильтр?


Ганичев Максим [4:33 PM] 
да

russell [4:33 PM] 
это optional по желанию, задача со *


Ганичев Максим [4:33 PM] 
а ну туда я еще не дошел то есть не в Optional реализуется исключительно CRUD


russell [4:33 PM] 
да


Ганичев Максим [4:34 PM] 
спасибо


vsimonov [4:58 PM] 
uploaded and commented on this image: kak_pobedit.jpg
  1 Comment
как победить не делая метод статиком?



Viktor [4:58 PM] 
создайте объект MealRestController :smiley:

[4:59] 
хоть по задаче, его надо получать из спринга

russell [5:01 PM] 
а ты откуда этот метод вызываешь, из сервлета?


vsimonov [5:01 PM] 
da
Ruslan Shakirov
а ты откуда этот метод вызываешь, из сервлета?
Posted in #hw2Today at 5:01 PM


[5:02] 
боюсь так не пойдёт
Sergeev Viktor
создайте объект MealRestController :smiley:
Posted in #hw2Today at 4:58 PM


russell [5:02 PM] 
как не пойдет, только так и надо

[5:03] 
сверху в сервлете создай объект

vsimonov [5:05 PM] 
ах да я то думал через new надо, так годно.спс


russell [5:05 PM] 
так можно и через new если спринг не юзаешь, сервлет его сам создаст

Yuri [5:06 PM] 
Всем привет! Хочу вот помощи попросить, точнее спросить - почему такое у меня.  Мне кажется, я недопонимаю что-то, механизм инициирования сервлета, нужен совет знающих:)

[5:06] 
В классе MealServlet:
   @Override
   public void init(ServletConfig config) throws ServletException {
       super.init(config);

       springContext = new ClassPathXmlApplicationContext("spring/spring-app.xml");
       controller = springContext.getBean(MealRestController.class);

       MealRepository repository = springContext.getBean(InMemoryMealRepositoryImpl.class);
       repository.save(new Meal(null, AuthorizedUser.id(), LocalDateTime.of(2015, Month.MAY, 30, 10, 0), "Завтрак", 500));
       repository.save(new Meal(null, 1, LocalDateTime.of(2015, Month.MAY, 30, 13, 0), "Обед", 1000));
       repository.save(new Meal(null, 1, LocalDateTime.of(2015, Month.MAY, 30, 20, 0), "Ужин", 500));
       repository.save(new Meal(null, 2, LocalDateTime.of(2015, Month.MAY, 31, 10, 0), "Завтрак", 1000));
       repository.save(new Meal(null, 2, LocalDateTime.of(2015, Month.MAY, 31, 13, 0), "Обед", 500));
       repository.save(new Meal(null, 2, LocalDateTime.of(2015, Month.MAY, 31, 20, 0), "Ужин", 510));
   }


[5:07] 
я инициализирую repository с едой тестовыми данными и в результате туда попадает только 
repository.save(new Meal(null, AuthorizedUser.id(), LocalDateTime.of(2015, Month.MAY, 30, 10, 0), "Завтрак", 500));

Katherine Buzatu [5:08 PM] 
Посмотри, что у тебя save делает.

Grub [5:09 PM] 
а зачем ты его там достаешь
`достать MealRestController из контекста`


Yuri [5:09 PM] 
т.е. с AuthorizedUser.id().
А если тупо написать вместо него цифру - то не сохраняет!!
1 reply Today at 5:10 PM View thread

Yuri [5:10 PM] 
Li0n13, ты прав, все очень жестоко и просто)) Я за сегодняшний день совсем видимо загнался уже)


[5:13] 
Стыдно, самый простой вариант и не посмотрел...в save я проверяю как раз userId на соответствие


vsimonov [5:15 PM] 
Теперь NullPointerException возникает в этой строке
Ruslan Shakirov
так можно и через new если спринг не юзаешь, сервлет его сам создаст
Posted in #hw2Today at 5:05 PM


russell [5:15 PM] 
ты со спрингом или без делаешь?


vsimonov [5:15 PM] 
со спрингом

russell [5:16 PM] 
ты контекст с сервлете создал, бин родил?


vsimonov [5:18 PM] 
эм бин в анотация прописан и контроллер помечен  @Controller (edited)


[5:19] 
в сервлете в doGet приходит

russell [5:20 PM] 
@vsimonov в личку отписал

vsergeev [6:15 PM] 
Кстати, 1.3: предусмотрите случай одинаковых User.name (порядок должен быть зафиксированным). 
Т.е. могут быть пользователи с одинаковым именем, но разными id или нельзя и надо проверять при save()?


vch [6:16 PM] 
@vsergeev могут быть с одинаковыми именами. У нас вроде email уникальны должны быть


vsergeev [6:19 PM] 
Ок, спасибо

Viktor [8:11 PM] 
Доделал наконец, но блин, я могу объяснить каждую написанную строку, каждый написанный метод, но вот взять и представить все сразу не особо, привык к JR когда есть четкое определение входных и выходных данных. Я один такой?


Valery [8:17 PM] 
четкое определение выходных данных на JR? сарказм?



Nick [8:20 PM] 
Вспомните task27(Ресторан) и сразу же станет легче


Viktor [8:21 PM] 
ну немного, но все же их наличие. Для меня было самое сложное это фраза "вот демо сделай так же", сложно но вроде справился. Возможно потому, что делать начал  с репозитория, а не с контроллера


[8:22] 
я на этом задании первый раз пересек уровень в 100 попыток, потом оставил :smiley:
Nick Batrak
Вспомните task27(Ресторан) и сразу же станет легче
Posted in #hw2Today at 8:20 PM

Valery [8:23 PM] 
>вот демо сделай так же
и это нормально. есть постановка задания. решений может быть несколько. выбирай сам. на JR надо было угадать решение автора.
я почитав коментв про ресторан даже не начинал его


Viktor [8:25 PM] 
когда я вижу "сделай так же", меня вечно начинает преследовать мысль, ты не все увидел, а значит не все сделал, т.е. мне бы было намного проще от конкретного указания - допили фильтр

vch [8:29 PM] 
@Viktor Да тут, по-моему, всё задание состоит из конкретных указаний! А к нему ещё длиннющая пачка подсказок, рассказывающая, что и как сделать

Viktor [8:31 PM] 
@vch каждый со своей колокольни :smiley: говорю же меня выбила фраза "сделай так же", скажем так для меня это прозвучало так "пройдись по всему проекту и убери все лишнее и добавь недостающее, что лишнее и недостающее решай сам".


[8:31] 
в подсказки по привычке я старался не смотреть (edited)

[8:34] 
главное, что свою ошибку понял, надо было начинать с контроллера, а не с репозитория. Чтобы сначала определить функцинал, а потом уже реализовывать его...


[8:37] 
и че-то у меня страшная простыня получилась для фильтрации, получить параметр каждого фильтра, проверить, что не пустой преобразовать к дате\времени и передать на контроллер


vch [8:38 PM] 
@Viktor Да, наверно проверяющие будут немного недовольны этим


Dernogard [8:38 PM] 
В сервлете делаю new контроллер, в контроллере autowired на сервисе и всё равно получаю его в null. Некоторые другие варианты пробовал, итог все равно null. Что не так?

russell [8:38 PM] 
@VictorА почему в контроллере не преобразуешь? (edited)

Viktor [8:39 PM] 
@vch у меня без проверки


Grub [8:39 PM] 
контроллер из контекста надо взять


vch [8:39 PM] 
@Dernogard Нельзя делать контроллер через new. Надо с самого начала из Спринга брать, иначе дальше по цепочке Autowired не заработает


Viktor [8:39 PM] 
@russell думаю, что контроллер будет с использование спринга, а там можно использовать spring:form, который все это сделает сам


russell [8:40 PM] 
о круто, гляну


Dernogard [8:40 PM] 
В сервлетах можно использовать аннотации Спринга? Там пишет, что можно использовать аннотации только в компонентах, а аннотации для сервлета я не нашел. Или нужно получать его не через аннотации?


Viktor [8:40 PM] 
@Dernogard спринг это контейнер, он отвечает только за те объекты, которые вы берете из него, если вы взяли свой объект то придеться самому о нем заботиться


vch [8:41 PM] 
@Dernogard можно без аннотаций. getBean или что-то подобное из спрингового контекста


Dmitry Makarov [8:42 PM] 
проверку при создании юзеров с существующим email кто-нибудь делал? (edited)
 2 replies Last reply today at 8:46 PM View thread

Viktor [8:42 PM] 
@Dernogard в сервелетах это бессмысленно, сервелет будет создавать srvlet контейнер, а не сприг, а контейнер сервелетов не знает таких аннотаций и проигнорирует их

[8:43] 
@russell я с учетом этого вступительное и делал. Спринг дает возможность закинуть на jsp объект и в форме сразу заполнить поля, а значит в контроллер нам придет готовый объект. Поэтому и думал сделать модель(объект) фильтра, чтобы потом его же и закидывать.

Dernogard [8:44 PM] 
@vch Статический геттер в SpringMain что ли?  Как-то дико. Переносить контекст в сервлет?


Viktor [8:45 PM] 
@Dernogard просто в методе servlet.init создайте спринг контектс копипастом из SpringMain и его используйте


russell [8:45 PM] 
@Viktor к примеру у меня есть метод удалить. можно ли как-нибудь замэпить не через http method =delete, а как в сервлете с параметами, я в курсе про аннотации реквестпарам, но не пойму как их мэпить. или только свичем проверять? (edited)


Viktor [8:47 PM] 
@russell я пытался сделать через метод delete но, как-то не прошло, все время в get запрос уходил, только через js получилось. Только при удалении достаточно послать просто id для этого и get запроса хватает

russell [8:47 PM] 
а как он поймет что удалить при гет запросе (edited)


Viktor [8:48 PM] 
по переданному id

vch [8:48 PM] 
@Dernogard см. в 6 ТЗ. Там конкретная инструкция дана по спрингу


Viktor [8:48 PM] 
meal?action=delete&id=2


russell [8:48 PM] 
а вдруг я хочу его посмотреть по айди


Viktor [8:48 PM] 
meal?action=view&id=2


russell [8:49 PM] 
а в спринге это как мэпится?


Viktor [8:49 PM] 
там можно замапить примерно так meals/delete/3

russell [8:50 PM] 
ясно, про это я в курсе, с параметрами интересно было

Dernogard [8:50 PM] 
@vch Странно, что это положили в Optional, поэтому не видел. Логично показалось сразу идти через контроллер, раз он есть, а не потом переносить :smiley:   Спасибо.


Viktor [8:55 PM] 
Из-за 7 требования простынка то и вышла, не видел его, но сделал "по подобию" :smiley:


[8:56] 
получилось, что фильтр работает с любой комбинацией дней и времени и без них :smiley:


[8:58] 
пойду от простыни избавляться


Argentum_kuh [11:07 PM] 
Народ, а подскажите, как логирование делают обычно? На все методы, или нам нужно только на работу со слоем web?


Valery [11:12 PM] 
какое поведение должно быть в случае невалидности данных в фильтре (startDate > endDate)? надо выводить предупреждение пользователю или продолжать выполнение?


[11:16] 
сама html5 форма не позволяет задать литерал вместо даты. но это можно сделать в том же постмане. при ошибке парсинга бросать кастомный эксепшн или фильтровать с параметрами по умолчанию?


Viktor [11:38 PM] 
@Valery думаю сейчас это не важно, такое лучше реализовывать сначала на стороне клиента с помощью js, и на стороне сервера, если кто-то подделает запрос. В первом случае предупреждение пользователю, вот втором случае вернуть ошибку, думаю так


grigory.kislin [11:49 PM] 
я не парился по поводу обработки ошибок
у нас будет Validation после Spring MVC



----- Today November 15th, 2017 -----
Rostish [8:55 AM] 
Слушайте, я вот все эти дни мучался и не понимал откуда брать userId, а его надо было просто захардкодить из класса AutorizedUser? И просто тестить с 1 юзером?


vch [8:56 AM] 
@Rostish не совсем так, в п. 8 ТЗ детально описано, каким `чудесным образом` юзер попадает в `AuthorizedUser`


Rostish [8:57 AM] 
Это уже optional, до него дойти надо было


[8:57] 
начинать обычную часть с последней optional не совсем логично, не так ли?


vch [8:58 AM] 
@Rostish если не будешь делать Optional - то да, хардкодь. 
А если планировать делать всё - то и читать лучше всё сразу, иначе придётся делать двойную работу.


Rostish [9:00 AM] 
ну не двойную))) не будем преувеличивать, формочку это сделать, которая будет передавать все 1 параметр - это 10 минут)))
А вот для других людей я бы это как-то выделил, я вот, честно, сразу не догадался, пришло ролик topjava11 посмотреть спустя 7 часов ада, когда я увидел захардкоденный userId, я аж всплакнул, как все легко.


vch [9:09 AM] 
@Rostish Странно всё же получается... Т.е. ты предпочёл вместо 10-минутной работы получить 7 часов ада.
С другой стороны - такая light версия реальных проектов, где категорически нельзя делать последовательно по пунктам, не прочитав внимательно всё ТЗ, иначе можно получить очень неприятные сюрпризы.



Rostish [9:20 AM] 
Приятно знать, что в мире есть такие умные люди, как ты, которые всегда приведут пример из жизни и дадут дельный совет


vch [9:23 AM] 
@Rostish У нас же Страна Советов... Поэтому советы, особенно непрошеные - это единственное, что можно получить в избытке.


Rostish [9:23 AM] 
А что касается меня, я человек последовательный. Когда я учился в универе, например, на высшей матиматике мне не нужно было читать конец книги, чтобы решить первые задачи


astronarh 
[9:26 AM] 
@Rostish добро пожаловать в реальный мир ) если ты не прочитаешь ТЗ, от реального работодателя, до конца, перед выполнением, можешь потратить много времени в пустую, потому что в конце может быть написано, "так как первые 5 пунктов уже реализованы, от вас требуется дописать только пункт 6" ))) (edited)


Rostish [9:26 AM] 
)))


CRCx86 [9:43 AM] 
@Rostish я до сих пор нифига не понимаю, а остался 1 день до следующего ДЗ

Dmitry Neustupov [9:56 AM] 
Коллеги, два вопроса, вы логику из сервлета переносили в контроллер, оставляя в сервлете в doPost и doGet только логирование и вызов методов на контроллере? И как реализовывали сортировку еды по времени? Я так понимаю, решение должно быть элементарное, но что то у меня никак не выходит со стримами и компаратором.


Ганичев Максим [10:17 AM] 
у меня получилось map.values().sort().collect() примерно такой набор операторов в стриме,


grigory.kislin [10:21 AM] 
@CRCx86 @Rostish userId уже захардкожено за вас, делать ничего не надо. что брать оттуда 3 раза!! написано в ДЗ и уж не знаю сколько раз тут
скажите плз, что такое надо сделать чтобы это прояснить для всех ???? (edited)


[10:22] 
буду очень признателен, за то, что надо дописать в урок (edited)


[10:24] 
@Dmitry Neustupov 1. да 2. в стримах есть sorted()

Dmitry Neustupov [10:27 AM] 
@grigory.kislin 1. Спасибо ) 2. Пытаюсь побороть.


grigory.kislin [10:27 AM] 
а зачем его бороть:)? применил и все


CRCx86 [11:00 AM] 
Объясните пожалуйста пункт 4.4: конвертацию в MealWithExceeded можно делать как в слое web, так и в service
Зачем это конвертить и куда? Зачем это всё? Какова задумка?


[11:01] 
я понимаю, что у нас отображение будет с учётом калорий, но если опираться на наши слои

[11:01] 
как это вообще?


anpotashev [11:02 AM] 
Всем привет!
Подскажите, как можно подгружать спринг-контекст, в случае двух и более сервлетов?


Katherine Buzatu [11:03 AM] 
@CRCx86 Да так же, как и раньше. Просто для себя определись, к какому слою это ближе. Я сделала это в слое веб. (edited)


vch [11:04 AM] 
@anpotashev в одном из них. Но это костыль для нашего промежуточного приложения, который через пару недель исчезнет.
В реальности так не делают.


anpotashev [11:05 AM] 
А во втором как тогда подгрузить?

[11:05] 
Autowired вроде не должен сработать

vch [11:06 AM] 
getBean сработает. Ссылку на spring-контекст как-нибудь передай по 2 сервлет. (edited)


CRCx86 [11:06 AM] 
@Katherine Buzatu получается в репозитории Meal будет private Map<Integer, MealWithExceed> repository = new ConcurrentHashMap<>();?

anpotashev [11:09 AM] 
Думал над таким вариантом, но тут еще вопрос с очередностью инициализации сервлетов.

Katherine Buzatu [11:09 AM] 
В репозитории НЕ хранится MealWithExceed. Он нам нужен исключительно для красивого отображения в вебе. Если мы пересмотрим концепцию питания и решим, например, отображать красным переедание только на ночь, нам нужен будет уже какой-то другой ТО, который будет формироваться из базового Meal, который лежит в репозитории. (edited)


CRCx86 [11:42 AM] 
Т.е. направление транспорта нужно из репозитория, а не во внутрь?


Katherine Buzatu [11:43 AM] 
> направление транспорта
переведи :slightly_smiling_face:



CRCx86 [11:44 AM] 
вот 4.4 о чём говорит?

[11:45] 
нам нужно что-то куда-то конвертировать

[11:45] 
вы сказали, что это должно быть в вебе и скорее всего это сервлет для красивого отображения


[11:46] 
пришла команда на getAll() я достал Meal


[11:46] 
это направление ИЗ

[11:46] 
а вот когда create или update то это В

Katherine Buzatu [11:47 AM] 
1. Нас попросили список еды. Мы пошли в репозиторий. Забрали оттуда Meal. Для удобства отображения обработали список и сконвертили Meal в MealWithExceed и передали в отображение список в специально разработанном для этого формате.
2. Если направление "В", то мы получаем данные из формы (как сделаешь, так и будет) и конвертим их в Meal, который отдаем на сохранение в репозиторий.
MealWithExceed для входящих не нужен, т. к. его особенность только в том, чтобы дать возможность что-то выделить в отдаваемой еде (isExceed). (edited)


CRCx86 [11:51 AM] 
@Katherine Buzatu спасибо


dyakoven [12:13 PM] 
почему при нажатии Cancel в Create meal мы попадаем в метод doPost()?


[12:13] 
при этом происходит сохранение еды


CRCx86 [12:59 PM] 
Что значит "имитация авторизации, сделать Select с двумя элементами со значениями 1 и 2 в index.html и AuthorizedUser.setId(userId) в UserServlet", конкретно, что такое "сделать Select", если Гибернейт мы еще не делали


vch [1:01 PM] 
@CRCx86 http://htmlbook.ru/html/select


CRCx86 [1:01 PM] 
@vch :+1:


vsimonov [2:31 PM] 
Валидацию на пусты значения делать надо?


Viktor [3:28 PM] 
@vsimonov в фильтре?


vsimonov [3:28 PM] 
да,уже понял что надо
Sergeev Viktor
@vsimonov в фильтре?
Posted in #hw2Today at 3:28 PM


Viktor [5:22 PM] 
кто пробовал получить доступ к статической переменной из jsp? Я тут решил 8 пунктов псевдо авторизацию запилить, пытаюсь из AuthorizedUser достать пользователя, да как-то не получается..


[5:23] 
точнее достал скриплетом, но хочу попробовать jstl использовать :smiley:


russell [5:24 PM] 
а доставать разве надо было, вроде же просто сетить надо


Viktor [5:25 PM] 
да это я уже издеваюсь, приветствие там, если пользователь залогинен


[5:25] 
Формочку регистрации сделал и логина

[5:26] 
чтобы все по честному - по паролю :smiley:

russell [5:28 PM] 
кажется статику вызвать нельзя через jstl


Viktor [5:29 PM] 
похоже на то, все ответы, что нашел предлагают использовать бин и класть его в реквест


Shalukhau Dzmitry [5:29 PM] 
Может кастомный тэг?


Viktor [5:30 PM] 
@Shalukhau Dzmitry как вариант думал, но надеялся что найду путь попроще :smiley:


Shalukhau Dzmitry [5:31 PM] 
@Viktor Ну это довольно просто :slightly_smiling_face: Хотя может от статики будет проще избавиться?


Grub [5:32 PM] 
в jsp можно просто скриплетом


russell [5:32 PM] 
@Viktor а как у тебя все работает, айди сессии инкрементируется?

Grub [5:32 PM] 
`<%=AuthorizedUser.getId()%>`


Ганичев Максим [5:35 PM] 
Мне кажется не секьюрно в jsp пользователя получать


[5:36] 
после авторизации контроллер должен быть уже в курсе о пользователе и соответственно все что бы не вызывалось из сервлета должно работать под этим пользователем


[5:37] 
а кто-нибудь фильтрацию сделал? не могу понять почему два метода фильтрации по времени и по дате, судя по демо там один метод т к работает с любым кол-вом заданных параметров

[5:38] 
как будто заполняют некий объект фильтр а уже при запросе в БД веру формируют из заполненных в фильтре полей

Viktor [5:39 PM] 
@russell все намного проще, на страничке форма логина -> ввод данных -> post запрос если подходит, то пользователь меняется


Grub [5:39 PM] 
мы можем фильтровать только по времени , поэтому два фильтра (edited)


Viktor [5:39 PM] 
@Ганичев Максим ты подсказал отличную идею :smiley: rblfnm bvz pfkjubytyjuj gjkmpjdfntkz ghb пуе pfghjct :smiley:

Ганичев Максим [5:40 PM] 
7: добавить в meals.jsp и MealServlet две отдельные фильтрации еды: по дате и по времени 
я так понимаю один фильтр по дате другой по времени, а как они между собой соединяются потом если указать допустим 3 параметра 1 дату например и два времени?


Viktor [5:41 PM] 
хаха раскладка... в get запросе при наличии авторизованного пользователя кидать его в jsp как бин


Ганичев Максим [5:41 PM] 
по демо такой вариант вполне рабочий, вот и не могу понять схему с этими фильтрами как их формировать


Viktor [5:41 PM] 
@Ганичев Максим это я тоже не совсем понял, у меня все линейка методов одна, фильтруется по любой комбинации полей


[5:42] 
@Ганичев Максим я делал фильтр исходя из того, что ни дата ни время не могут быть меньше минимального или больше максимального :smiley:


Ганичев Максим [5:43 PM] 
ну эт логично я тож об этом думал


[5:44] 
но получается один метод где задается два параметра LocalDateTime и изначально они равны мин и макс а в зависимости от праметров обновляются части дат


[5:44] 
но хотя это будет работать отлично от демо ) в общем не совсем понятно

[5:46] 
видимо придется ждать завтра чтобы понять почему 2 метода и как они между собой работать должны


Viktor [5:46 PM] 
а если использовать LocalDate и LocalTime отдельно?

Ганичев Максим [5:47 PM] 
ну если отдельно то получается один запрос в репазиторий вернет данный отобранные по времени другой запрос вернет фильтрацию по дате, и потом надо юнион делать, но эт так криво что ужас


[5:48] 
точнее не юнион а пересечение )

Viktor [5:49 PM] 
тут такой момент: из репо берем все данные за нужные дни, из них делаем mealExceeded и только потом их фильтруем по времени


[5:49] 
если брать из репо с фильтрацией по времени, то exceeded кривые получаться

Grub [5:49 PM] 
если задано только startTime и/или endTime - фильтруем по времени, если startDate и/или endDate - то по всем 4м полям ( где пусто подставляет дефолтные значения MIN MAX) (edited)


Ганичев Максим [5:50 PM] 
в демо работает и только по времени
Grub
если задано только startTime и/или endTime - фильтруем по времени, если startDate или endDate - то по всем 4м полям ( где пусто подставляет дефолтные значения MIN MAX)
Posted in #hw2Today at 5:49 PM


Grub [5:51 PM] 
ну я так и написал


Ганичев Максим [5:51 PM] 
@Viktor 2.4: Фильтрацию по датам сделать в репозитории т.к. из базы будем брать сразу отфильтрованные по дням записи. Следите чтобы первый и последний день не были обрезаны, иначе сумма калорий будет неверная.


[5:52] 
а ну в целом я понял наверное идею твою

[5:53] 
но с точки зрения архитектуры глупо тянуть данные отфильтрованные по дате если заранее известно время. Это у нас данных мало а если таблицы будут терабайтные, то там можно оч хорошо залипнуть


Viktor [5:57 PM] 
да, но для этого в таблице надо хранить MealWithExceeded и редактировать их при каждом действии, что может быть сложнее


[5:58] 
Если вытащить из БД данные только с 11 до 12 часов, то при формировании калорий за день не возможно будет учесть остальную еду, которую из БД не взяли

dyakoven [9:50 PM] 
как в index.html передать значение id из комбобокса? я так понимаю, он должен быть параметром при переходе на users.jsp?


Valery [10:04 PM] 
этот комбобокс уже на странице индекса (edited)
 6 replies Last reply today at 10:32 PM View thread

chimax [10:12 PM] 
Ну что, как настроение, мученики))?

russell [10:13 PM] 
Ждем джей юнита. сам докончил? (edited)


chimax [10:13 PM] 
докончил - баги исправляю

[10:15] 
Чувствую, что от этого задания кто-то поседел)

vch [10:15 PM] 
@chimax Чувствую, что это был Григорий...


chimax [10:15 PM] 
@vch не исключено


russell [10:16 PM] 
он уже умолял дать ему совет, как еще проще разжевать (edited)


chimax [10:17 PM] 
честно сказать, для совсем новичков задание требует напряженного въезжания в тему слоев)

Katherine Buzatu [10:17 PM] 
А что, задание про книжную полку тут не все делали?


chimax [10:18 PM] 
все эти слои кажутся ненужными, лишними, не понятно что в каждм слое делать?!)))


[10:18] 
тут не все из JR

russell [10:18 PM] 
а есть тот монстр кто все уровни прошел?


chimax [10:18 PM] 
Таня)


Katherine Buzatu [10:19 PM] 
Я прошла.


Valery [10:19 PM] 
долистал...


chimax [10:19 PM] 
а я недопролистал))


Иван [10:19 PM] 
слои это фигня а вот срезание путей сквозь слои и втыкание заглушек напрягает


Valery [10:20 PM] 
разочаровали последние 3 уровни


chimax [10:20 PM] 
заглушки - это концепт будущего функцонала, как правило



Иван [10:20 PM] 
я уже почти въехал чё от меня хотят :slightly_smiling_face:


[10:20] 
да концепт когда их делаеш ты сам а не кто-то объясняя перед этим про слои


chimax [10:21 PM] 
Главное понять, что Слой контроллер отменяет Сервлеты)

[10:21] 
а в Сервисе находится бизнес-логика


Иван [10:21 PM] 
сервлет это диспатчер слоя контроллеров


chimax [10:21 PM] 
потом их не должно быть


russell [10:21 PM] 
Диспатче это же спринговый сервлет (edited)


chimax [10:22 PM] 
Я вот до конца не догнал отличие ДАО от Репозитория, Фаулера даже читал)


russell [10:23 PM] 
@Katherine Buzatu может подскажешь про различия? (edited)

chimax [10:23 PM] 
кроме того, что в Репозитории мы работаем с объектами, как с коллекциями


Иван [10:23 PM] 
зачем нам сечас это отличие когда мы работаем с репозиторием?


chimax [10:24 PM] 
ок, а если это был бы Фасад или Эктив рекорд, то что тогда)


[10:24] 
надо понимать что и зачем


[10:25] 
можно, конечно, сказать, что в спринг жпа используется название репозиторий вместо дао

Иван [10:25 PM] 
актив рекорд это бин плюс обслуживающие методы типа файнд


chimax [10:25 PM] 
меня это как-то не устраивает

[10:26] 
у Фаулера в его книге Шаблоны корпоративных приложений есть описание слоя Репозиторий, стр 341 (edited)


Иван [10:27 PM] 
есть книжка "чистый код" там про это дают понять зачем оно бывает нужно


chimax [10:27 PM] 
где?


[10:28] 
скажи страницу

[10:28] 
я открою)


[10:28] 
на тумбочке она лежит)

Иван [10:28 PM] 
щас гляну


chimax [10:28 PM] 
спс


Иван [10:29 PM] 
128 Объекты передачи данных


[10:29] 
ну это про DTO а так там глава целая по данным


chimax [10:29 PM] 
ДТО?

[10:29] 
а, это я читал


Иван [10:30 PM] 
ну а следом Активный записи на стр 129


Viktor [10:31 PM] 
"Таким образом, репозиторий представляет собой более высокий уровень абстракции над слоем отображения данных."


[10:31] 
как я понял репозиторий уже содержит ДАО и накоторые его методы


[10:32] 
Так же дает возможность дописать необходимые. Если не ошибаюсь, то в спринге можно дописать запрос в аннотации, а спринг сам будет работать с ДАО

chimax [10:33 PM] 
ДАО - слой для чисто круд-методов


[10:33] 
простых


Иван [10:33 PM] 
а я пока ни чё это не читал и был занят тем что же происходит то у нас в приложении и откуда долбаный AuthorizedUser вылезет


chimax [10:33 PM] 
Repository (хранилище) ⎼
    паттерн, выполняющий роль коллекции объектов домена в оперативной памяти. Хранилище позволяет добавлять или удалять объекты, как будто мы работаем с обычными коллекциями. Тот факт, что объект домена на самом деле не находятся в хранилище, полностью скрыт от клиентских программ. Для них - это выглядит, как коллекция в памяти. Используется в Spring Data JPA

Разница между слоем dao и repository:
    DAO - это низкоуровневый слой, который работает с объектами базы
    repository - работает с объектами DTO
    Если Entity не переводятся в DTO, то два этих слоя сливаются и становятся одним и тем же


[10:34] 
это все красиво написано, но...))

Иван [10:34 PM] 
а это прокси шаблон или как там его


chimax [10:35 PM] 
возможно, в следующих тасках мы увидим разницу


Viktor [10:35 PM] 
я в ветку рандома уже скидывал, есть проект speedment, там на самом деле смотришь на базу данных как на коллекцию и обращаешься с ней так же (в стиле стримов)


[10:38] 
пробовал на тестовой БД и вот весь код обращения к БД и получению списка значений по фильтру:

Viktor [10:38 PM] 
added this Plain Text snippet
  private List<City> getRussiaCities(){
    return cityManager.stream()
        .filter(City.COUNTRY_CODE.equal("RUS"))
        .collect(Collectors.toList());
  }
Add Comment



Viktor [10:39 PM] 
Т.е. нет никаких дао и репозиториев. Они конечно будут, ведь это надо будет куда-то сложить


[10:40] 
Есть ещё вот такой интересный ORM https://www.jooq.org/
jooq.org
jOOQ
jOOQ, a fluent API for typesafe SQL query construction and execution. (4 kB)


Andrew [10:53 PM] 
Друзья, какую фильтрацию (кроме давать свежие сверху) надо ещё делать в InMemoryMealRepositoryImpl ?

Viktor [10:54 PM] 
вроде никакой


Andrew [10:56 PM] 
Ну тогда там же всё просто , компаратор написать да и всё


vch [10:58 PM] 
@Andrew правильный save написать тоже нетривиальная задача


Andrew [11:02 PM] 
Я сделал по аналогии с Meals, где камни там? :slightly_smiling_face:


vch [11:03 PM] 
@Andrew Не понял, как ты сделал Meals по аналогии с Meals????


Andrew [11:04 PM] 
Эт я про User, Meals уже был реализован изначально


[11:05] 
метод Save


vch [11:06 PM] 
@Andrew Метод InMemoryMealRepositoryImpl.save никак не мог быть реализован изначально...


[11:09] 
@Andrew Ну, т.е. формально он реализован, но для п. 3.1. - 3.2 ТЗ его надо существенно переделать (edited)

Andrew [11:16 PM] 
И правда, если это апдейт, надо проверять владельца. 
Я не понимаю пункт 6. Надо переделать сервлет так, чтобы работало через спринг... Но у меня или томкат, или спринг (без веб). Что тут надо сделать?


Viktor [11:17 PM] 
надо явно в сервелете инициализировать контекст спринга и достать из него контроллер. В этом случае спринг подключиться, соберет для вас контроллер (со всеми зависимостями) и выдаст вам


Andrew [11:23 PM] 
А, в методе инит сделать так , как делали в SpringMain - сделать контекст и стянуть с него бин?


Viktor [12:06 AM] 
да


[12:08] 
видео про репозиторий, не отличия от ДАО, но из видео их примерно можно обозначить https://www.youtube.com/watch?v=G9apMqwRedA
YouTube JUG .ru
Владимир Цукур — Путь от CRUD к Hypermedia API с Spring


dyakoven [11:12 AM] 
@grigory.kislin Григорий, похоже, у нас в проекте баг. когда добавляешь/редактируешь еду, при нажатии Cancel еда все равно сохраняется


grigory.kislin [11:28 AM] 
@dyakoven это наблюдалось на FF. полечили тем, что поставили в Cancel type="button"
я проверли- все ок. 1. обнови страничку F5 2. какой браузер? (edited)
1 reply Today at 11:32 AM View thread

LORREON [12:06 PM] 
added this Java snippet: Почему в сервлете в методе doGet такой код вызывает ava.lang.NullPointerException
String action = req.getParameter("action");
​
    if(action.equals("delete")){
      System.out.println("delete");
    }
Add Comment



Grub [12:07 PM] 
а откуда там этому параметру взяться


LORREON [12:08 PM] 
неважно если нет пусть пропустит (edited)


Grub [12:10 PM] 
тогда на null проверяй


Few 
[12:13 PM] 
public static final LocalDate MIN_DATE = LocalDate.of(1, 1, 1);
   public static final LocalDate MAX_DATE = LocalDate.of(3000, 1, 1);


[12:13] 
а зачем эти константы?

[12:13] 
LocalDate.MIN и LocalDate.MAX не подходят?

vch [12:24 PM] 
@Few не подходят, т.к. диапазон значений даты в PostgreSQL уже, чем LocalDate.MIN и LocalDate.MAX. 
Падать будут такие запросы... (edited)



Few 
[12:24 PM] 
ок, спс


[12:28] 
видео еще не смотрел, а уже с вопросами


[12:28] 
там наверное объясняется )


Katherine Buzatu [12:48 PM] 
```@Override
public List<Meal> getBetween(LocalDateTime startDateTime, LocalDateTime endDateTime, int userId) {
return getAllAsStream(userId)
.filter(meal -> DateTimeUtil.isBetween(meal.getDateTime(), startDateTime, endDateTime))
.collect(Collectors.toList());
}

private Stream<Meal> getAllAsStream(int userId) {
Map<Integer, Meal> meals = repository.get(userId);
return meals == null ?
Stream.empty() :
meals.values().stream()
.sorted(Comparator.comparing(Meal::getDateTime).reversed());
}```
В методе `getBetween` происходит сначала сортировка, потом фильтрация. Почему не наоборот?


danissimo [1:36 PM] 
Коллеги, почему операции репозитория возвращают спец. значения, а не исключения? То есть почему вместо
```public interface MealRepository {
    Meal save(Meal meal);
    /** @return {@code false} if there was no {@link Meal} with the given {@code id} by the moment of invocation */
    boolean delete(int id);
    /** @return {@code null} if there was no {@link Meal} with the given {@code id} by the moment of invocation */
    Meal get(int id) throws NotFoundException;
    Collection<Meal> getAll();
}
```
не объявить такие операции:
```public interface MealRepository {
    Meal save(Meal meal);
    void delete(int id) throws NotFoundException;
    Meal get(int id) throws NotFoundException;
    Collection<Meal> getAll();
}
```
? (edited)


grigory.kislin [1:41 PM] 
@Katherine Buzatu мы `getAllAsStream`  еще для `getAll()` используем 
попробуй красиво зарефакторить- поменяю:) (edited)


Shalukhau Dzmitry [1:42 PM] 
@danissimo Насколько я понимаю, отсутствие в БД Meal является допустимым состоянием приложения


[1:43] 
Т.е. не является ошибкой.



grigory.kislin [1:43 PM] 
@danissimo мне кажется так более универсально. далеко не всегда в приложении нам нужно достать по ентити id  и получить эксепшен. 
поэтому проверку вынес на уровень сервиса. ну и дублирования не будет, тк у нас будет несколько реализаций репозиториев


danissimo [1:44 PM] 
@Shalukhau Dzmitry исключение != ошибка, особенно если это checked exception


Shalukhau Dzmitry [1:45 PM] 
@danissimo исключение = исключительная ситуация (edited)


danissimo [1:45 PM] 
исключение — это изменение workflow без if'ов


Shalukhau Dzmitry [1:45 PM] 
@danissimo Я бы сказал, что исключение - это очень дорогое изменение workflow :slightly_smiling_face:


[1:46] 
Дешевле алгоритм поменять :slightly_smiling_face:

vch [1:46 PM] 
@grigory.kislin По `getBetween` вопрос действительно интересный.
По уму да - все сортировки и фильтрации происходят только в момент терминальной операции.
И, если верить в благоразумие разработчиков JDK - то они должны были сделать выполнение операций в стриме не в том порядке, в котором мы их заносили, а сначала всё отфильтровать, и уже потом сортировать.
Но вроде по спецификации нам таких гарантий не дают.


grigory.kislin [1:46 PM] 
если приложение чуть сложнее нашего скорее всего понадобится get где результата может не быть
вместо catch(NotFound e) гораздо лучше !=null проверить (edited)


Katherine Buzatu [1:48 PM] 
У меня вспомогательный метод выглядит так
```private final List<Meal> getMealsByFiltersSortedByDate(Predicate<AbstractMap.SimpleEntry<Integer, Meal>>... filters) {
        Stream<AbstractMap.SimpleEntry<Integer, Meal>> userAndMealStream = repository.values()
                .stream();
        for (Predicate<AbstractMap.SimpleEntry<Integer, Meal>> filter: filters) {
            userAndMealStream = userAndMealStream.filter(filter);
        }
        return userAndMealStream
                .map(AbstractMap.SimpleEntry::getValue)
                .sorted(comparatorByDate)
                .collect(Collectors.toList());
    }```
. Не знаю, насколько это красиво, но порядок действий, мне кажется, эффективнее. Схему хранилища я выбрала другую, не стала менять типы.
Grigory Kislin
@Katherine Buzatu мы `getAllAsStream`  еще для `getAll()` используем 
попробуй красиво зарефакторить- поменяю:)
Posted in #hw2Today at 1:41 PM


grigory.kislin [1:48 PM] 
@vch сотрировка- терминальная операция. те конечно filter спереди лучше... на наших объемах и нагрузках конечно это не так принципиально


danissimo [1:48 PM] 
правильно ли понимаю, что спец. значение или exception — дело вкуса?


grigory.kislin [1:50 PM] 
@danissimo на мой вкус null лучше. бывает что эксепшен используется для изменения flow, например выход из глубокого вложения вызовов
в некоторых языках от используется для выхода из циклов.. но не в java


danissimo [1:51 PM] 
похоже, нужно попробовать и так, и эдак, чтобы понять


grigory.kislin [1:51 PM] 
@Katherine Buzatu :+1: попробую такой вариант


danissimo [1:52 PM] 
@grigory.kislin я вот что подумал: может, для Spring Data code conventions такие, что возвращаются спец. значения? Я не в курсе просто ещё. Это так, Григорий?


grigory.kislin [1:56 PM] 
в SpringData есть их стандартные JpaRepository extends PagingAndSortingRepository  extends CrudRepository extends Repository
это их code conventions
остальное уже- как разработчик захочет


vch [1:58 PM] 
@grigory.kislin Странно, а в Stream.java написано, что sorted() - `This is a stateful intermediate operation` , так же как и filter
Если б sorted был терминальной операцией, то было бы совсем плохо.


grigory.kislin [2:03 PM] 
@Katherine Buzatu у меня так вышло:
```    public List<Meal> getAll(int userId) {
        return getAllFiltered(userId, null);
    }

    public List<Meal> getBetween(LocalDateTime startDateTime, LocalDateTime endDateTime, int userId) {
        return getAllFiltered(userId, meal -> DateTimeUtil.isBetween(meal.getDateTime(), startDateTime, endDateTime));
    }

    private List<Meal> getAllFiltered(int userId, Predicate<Meal> filter) {
        Map<Integer, Meal> meals = repository.get(userId);
        if (CollectionUtils.isEmpty(meals)) {
            return Collections.emptyList();
        }
        Stream<Meal> stream = meals.values().stream();
        if (filter != null) {
            stream = stream.filter(filter);
        }
        return stream.sorted(Comparator.comparing(Meal::getDateTime).reversed()).collect(Collectors.toList());
    }
```
 

Tanya [10:03 PM] 
а если вместо null отдавать Predicate.TRUE? 
public List<Meal> getAll(int userId) {
      return getAllFiltered(userId, meal -> true);
}



grigory.kislin [12:43 AM] 
https://stackoverflow.com/questions/26549659/built-in-java-8-predicate-that-always-returns-true
```    private List<Meal> getAllFiltered(int userId, Predicate<Meal> filter) {
        Map<Integer, Meal> meals = repository.get(userId);
        return CollectionUtils.isEmpty(meals) ? Collections.emptyList() :
                meals.values().stream()
                        .filter(filter)
                        .sorted(Comparator.comparing(Meal::getDateTime).reversed())
                        .collect(Collectors.toList());
    }
```
stackoverflow.com
Built-in Java 8 predicate that always returns true?
Google Guava has a predicate that always returns true. Does Java 8 have something similar for its Predicate? I know I could use (foo)->{return true;}, but I want something pre-made, analogous to
 
(edited)


Katherine Buzatu [8:33 AM] 
Вчера была дискуссия на тему "null против исключений". Вроде пришли к тому, что null предпочтительнее. А у нас все равно выбрасывается исключение, да еще и `unchecked`. Объясните, пожалуйста, кто понял, зачем бросать `unchecked` там, где такая ситуация ожидаема? Почему бы не бросить `checked`, например, чтобы наверху тоже бы готовились?


russell [9:09 AM] 
@Katherine Buzatu Не уверен, но возможно, из-за того, что в 95 случаях исключения непонятно как обрабатывать. Где-то же была статистика, что в исключениях просто лог выводится или просто другое пробрасывается. а засорять трай кэтчем код не хочется. Имхо. (edited)


Katherine Buzatu [9:38 AM] 
Но мы же и так засорили. Свое исключение ввели. Класс `ValidationUtils` написали. Типа мы знали, что это наверняка случится, но решили сами не заморачиваться. Как-то логичнее, имхо, бросать `checked`, а выше захотят - поймают, неизвестно, что делать - бросят дальше. Ситуация-то на самом деле не исключительная.


russell [9:49 AM] 
создатели джава вроде заявляли, что налл и чект эксепшнз их самые большие ошибки. Возможно поэтому все современные фреймворки переоборачивают чект в анчект. А то что ситуация неисключительная - согласен. А с другой стороны как можно починить, то что в базе нет еды с таким айди и не получается удалить. Что можно сделать в кэтче? Еще чект искл не совместимы с функциональным программированием. http://literatejava.com/exceptions/checked-exceptions-javas-biggest-mistake/ (edited)


Viktor [1:59 PM] 
@Katherine Buzatu не что не мешает вам поймать unchecked исключение и обработать его. Просто это не обязательно.


Katherine Buzatu [2:08 PM] 
@Viktor мешает то, что слой выше даже не догадывается обо всех `unchecked`, которые могут ему прилететь.


Viktor [2:09 PM] 
@Katherine Buzatuесли это важное исключение влияющее на работы вы можете объявить его в блоке throws и описать в доках.


grigory.kislin [2:10 PM] 
@Katherine Buzatu я голосовал за то, что null в репозитории удобнее
а в сервисе уже бизнес логика- ексепшен. в конце проекта будем их централизовано обрабатывать
по поводу checked-unckeked чтото не могу найти ссылок, вроде гдето были, тк вопрос частый
чекад были признаны ошибкой и чуть ли не хотят из java удалить
ссылки поищу (edited)


Katherine Buzatu [2:11 PM] 
> в конце проекта будем их централизовано обрабатывать.
Ну, это уже другой компот. Буду ждать.


grigory.kislin [2:22 PM] 
вопрос в 2м уроке:
https://stackoverflow.com/questions/6115896/java-checked-vs-unchecked-exception-explanation
http://blog.takipi.com/ignore-checked-exceptions-all-the-cool-devs-are-doing-it-based-on-600000-java-projects/
stackoverflow.com
Java: checked vs unchecked exception explanation
I have read multiple posts on StackOverFlow about checked vs unchecked exceptions. I'm honestly still not quite sure how to use them properly. Joshua Bloch in "Effective Java" said that Use c...
 
 Takipi Blog
Ignore Checked Exceptions, All the Cool Devs Are Doing It - Based on 600,000 Java Projects | Takipi Blog
An overview of exception handling in over 600,000 Java projects on Github and Sourceforge (59 kB)
Jun 21st, 2016 at 6:59 PM


Shalukhau Dzmitry [8:48 PM] 
Ребята, правильно я понимаю, что в случае, если я RestController в MealServlet помечу @Authowired - и в init проинициализирую контекст - Spring не сможет заполнить Authowired свойство сервлета (т.к. объект уже создан)? Есть ли возможность обойти это ограничение или ручками getBean взять?


russell [8:50 PM] 
кажется только ручками, так как сервлет создается сервером через нью.



Shalukhau Dzmitry [8:51 PM] 
@russell Я это понял, Тут скорее вопрос, можно ли спринг заставить заюзать сеттер когда объект уже проинициализирован. Мне кажется, что нет - но вдруг :slightly_smiling_face:


vch [8:54 PM] 
@Shalukhau Dzmitry У меня однажды была необходимость создавать классы через `new`. И чтобы в них можно было использовать `@Autowired`, я делал такой конструктор:
```        public MyClass() {
            SpringBeanAutowiringSupport.processInjectionBasedOnCurrentContext(this);
        }```
Может и для твоего случая подойдёт.


Shalukhau Dzmitry [8:55 PM] 
SpringBeanAutowiringSupport - я думал об этом, но ведь это же не spring-context уже вроде как...


vch [8:56 PM] 
@Shalukhau Dzmitry А что тогда? Вроде как раз - где-то раньше контекст создан, и мы таким хаком обращаемся к нему


Shalukhau Dzmitry [8:56 PM] 
Это часть spring-web

[8:57] 
Хотя в данном случае оно помогло бы...


vch [8:57 PM] 
у вас всё равно Spring MVC используется. Так что не вижу проблем.

Shalukhau Dzmitry [9:12 PM] 
@vch В HW2 не используется spring-web и spring-mvc. Только хардкор. Отдельно Григорий написал, что не стоит модифицировать pom.xml


Viktor [9:13 PM] 
@Shalukhau Dzmitry спринг может чтолибо делать только с теми бинами, которые сам создал. Вы доверяете контроль за объектом ему (создание удаление и все зависимости). Если вы создаете объект сами, считайте, что спринг обиделся на вас и не поможет :smiley:


Shalukhau Dzmitry [9:15 PM] 
@Viktor Это понятно. Но есть SpringBeanAutowiringSupport.processInjectionBasedOnCurrentContext(this);, которая говорит, а просканируй класс текущего объекта и внедри Authowired dependency зависимости в текущий объект


vch [9:17 PM] 
@Shalukhau Dzmitry Да, печально. В spring-context.jar ничего похожего не вижу.
Может там оно и есть (кто знает), но во всяком случае названий классов на эту тему не вижу.


russell [9:20 PM] 
у меня тоже пусто, есть еще вариант http://olivergierke.de/2009/05/using-springs-configurable-in-three-easy-steps/


Shalukhau Dzmitry [9:25 PM] 
@russell я не уверен, что там что - то есть (по крайней мере я не нашел).


russell [9:26 PM] 
@Shalukhau Dzmitry первая строчка перед описанием As you might not be aware of, besides injecting dependencies into beans Spring is able to inject dependencies into objects that are not instantiated by Spring.


Shalukhau Dzmitry [9:34 PM] 
@russell Не смог завести это решение.


[9:34] 
3 пункт звучит как костыль.

[9:39] 
@russell для того, чтобы 3 пункт реализовать нужно подключить spring-aspect. А это уже нарушение правила. В общем, наиболее красивое решение: SpringBeanAutowiringSupport.processInjectionBasedOnCurrentContext(this);


[9:42] 
Всем спасибо


Viktor [10:13 PM] 
ну блин, это тоже самое, что использовать контекст, проще конечно, но хз как там будут жить бины
Shalukhau Dzmitry
@Viktor Это понятно. Но есть SpringBeanAutowiringSupport.processInjectionBasedOnCurrentContext(this);, которая говорит, а просканируй класс текущего объекта и внедри Authowired dependency зависимости в текущий объект
Posted in #hw2Today at 9:15 PM


grigory.kislin [9:11 PM] 
SpringBeanAutowiringSupport находится в spring-web. если подключить, то можно заюзать
