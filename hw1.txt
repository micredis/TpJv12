grigory.kislin [2:03 AM] 
joined #hw1.


grigory.kislin [2:04 AM] 
Привет!
Первое занятие с разбором HW0
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson01.md
Днем продублирую ссылку письмом
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


Erick [2:05 AM] 
joined #hw1.


grigory.kislin [2:05 AM] 
Успехов в HW1


Erick [2:06 AM] 
спасибо))


Tanya [2:07 AM] 
joined #hw1.

Tanya [2:07 AM] 
set the channel topic: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson01.md


RNG [2:12 AM] 
joined #hw1 along with 9 others.


Иван [4:03 AM] 
канал hw0 теперь будет удалён?


Tanya [4:05 AM] 
нет, будет до конца проекта

Andrey [4:05 AM] 
joined #hw1.


Иван [4:05 AM] 
ну он по сути мёртвый щас стал :slightly_smiling_face:


Tanya [4:06 AM] 
не все идут в одиннаковом темпе, это для тех у кого с проверкой, дедлайн во вт


JavaJedi [4:07 AM] 
joined #hw1 along with 4 others.

Kirilo [4:45 AM] 
Посмотрел видео, о том где одним стримом. :slightly_smiling_face: И почему я не додумался что сборку map можно копированием просто вложить в другой стрим? (edited)


Алексей Карманов [4:45 AM] 
joined #hw1.


tema.emelyan [5:14 AM] 
@Kirilo предыдущее дз обсуждаем в #hw0

chimax [10:07 AM] 
welcome to HW1!!


LeshaKol [10:46 AM] 
туплю, теперь надо  с гитхаба залить обновленный проект?

itAvgur [10:47 AM] 
Просто вернуться в ветку master. Далее применить все патчи (каждый патч рекомендуется отдельно закоммитить), далее сделать push в githab  и сделать новый branch hw1 для обновленной master. Перейти в hw1 и работать в ней.
Alex Kolushev
туплю, теперь надо  с гитхаба залить обновленный проект?
Posted in #hw1Nov 2nd at 10:46 AM
(edited)



evgeny [2:38 PM] 
где на гитхабе выкладываются прошлые домашние задания?

vch [2:41 PM] 
@evgeny а зачем их выкладывать?


evgeny [2:42 PM] 
чтоб сверить


vch [2:43 PM] 
@evgeny Эталонные решения выкладывает Григорий в своих патчах.
А если тебя интересуют решения других участников - это уже напрямую с ними договаривайся...


evgeny [2:44 PM] 
понял, спасибо

chimax [3:23 PM] 
Как там дела с HW1 - сложно делать?

fbochkarev [3:24 PM] 
uploaded and commented on this image: Pasted image at 2017-11-02, 3:24 PM
1 Comment
Привет всем. После "apply patch" классы подсвечиваются красным и сверху появилось сообщение, чего нажимать?)



chimax [3:25 PM] 
наверно, git add не сделан

[3:26] 
все надо коммитить в default

fbochkarev [3:30 PM] 
@chimax если я нажимаю "move changes" то в "local changes" падает всё в default, так и должно быть? (edited)

fbochkarev [3:31 PM] 
uploaded this image: Pasted image at 2017-11-02, 3:31 PM
Add Comment




chimax [3:32 PM] 
выбери move to another changelist

[3:32] 
и выбери default


[3:32] 
все остальное удали

fbochkarev [3:34 PM] 
@chimax спасибо


Vangelis [6:26 PM] 
Кто-нибудь начал уже делать?) Как успехи? Как сложность? Поделитесь с тем, кто пока в дороге, готовится морально :joy:


grigory.kislin [7:55 PM] 
Письмо выслал! Там ссылка на lesson01 + некоторая доп. информация по патчам и проекту.


Kirilo [10:06 PM] 
@tema.emelyan ну, спасибо. Вот, дельный совет. Есть кому Григория подменить.

1 reply 8 days ago View thread

Andrew [10:26 PM] 
Надо в общем накатить все патчи, да? Кроме тех, которые альтернативы решения HW0 (выбрать один из трёх). Просто интересно, зачем разделены патчи?

chimax [10:28 PM] 
накатывай все


[10:28] 
разделено, т.к., видимо, новые решения появились не сразу, а постепенно


[10:29] 
ну и что бы разделить их - это хороший стиль, что бы проще было откатываться

Andrew [10:29 PM] 
Благодарю


Serge [10:56 PM] 
Всем бобра, можно сразу вопрос по условию задачи?


[10:56] 
“1.2.1 Список еды захардкодить (те проинициализировать в коде, желательно чтобы в проекте инициализация была только в одном месте)” Не совсем понятно где это сделать? Сделать отдельный класс? Сделать статик в Util? или прямо в сервлет его плюхнуть?


kadmser 
[10:57 PM] 
правильно я понял, ветку HW1 делаем перед патчем 1_4_switch_to_war


Serge [10:58 PM] 
“1.2.3 Список выводим БЕЗ фильтрации по startTime/endTime” - У нас реализованы из ДЗ-0 методы с фильтрацией… Нужно там же сделать такой же метод без фильтрации и его использовать?
 


[11:00] 
Или захардкодить уже сразу List<MealWithExceed>?


Valery [11:18 PM] 
@kadmser
>Домашнее задание HW01 (делаем ветку HW01 от последнего патча в master)

chimax [11:20 PM] 
веку делать, когда закончатся патчи, относящиеся к предыдущему таску

kadmser [11:20 PM] 
А, все разобрался, после всех патчей 1.х делаем ветку новую



[11:21] 
я сначала подумал что патчи после HW0 уже относятся к 1 заданию

[11:21] 
т.е. с выполненым 1 заданием

chimax [11:22 PM] 
список без фильтрации - это значит, что у нас есть морда, где будет таблица со списком еды, а т.к. фильтрация у нас еще не будет реализована (графически - по времени), то да, надо создать метод без фильтрации для простого вывода всего, что у нас есть (edited)


[11:27] 
Сервлет отвечает за обработку запросов по протоколу http (edited)



----- Friday, November 3rd -----
Kaa [9:56 AM] 
проэплаил последовательно патчи 1.0, 1.1, 1.2, 1.3 модели поменялись, а метод getFilteredWithExceeded так и остался нереализованным. так и нужно или я где-то стратил?


Rostish [10:01 AM] 
чет странно, у меня после всех патчей остались все методы, которые в видео на разборе

[10:02] 
@grigory.kislin Грийгой, подскажи, пожалуйста, а у нас будут занятия в виде вебинаром? Хотя бы несколько. Судя по выложенным видео, у других студентов такая возможность была), Хочется немного и в живую пообщаться)


[10:02] 
Григорий*

vasiliyeskin [10:44 AM] 
Григорий, в дополнительном задании указано, что нужно сделать "без 2х проходов в цикле по List<UserMeal>". В примере кода сначала идёт группировка, а затем ещё раз проход для извлечения нужных записей. Итого, всегда 2 прохода. Т.е. сложность порядка O(2*N). Я вот несколько "крамольно" сделал. Объявил в классе MealWithExceed поле exceed как mutable (поменял тип boolean на обёртку AtomicBoolean и убрал final) и при проходе по List<UserMeal> заполнял два списка
       Map<LocalDate, Integer> mapDateCalories = new HashMap<>();
       Map<LocalDate, AtomicBoolean> mapDateBoolean = new HashMap<>(); 
Как итог, сложность O(N), т.к. полноценных проходов только 1. Такой вариант приемлем? (edited)


Kaa [11:00 AM] 
uploaded and commented on this image: image.png
1 Comment
Т.к. в мастере можно менять только патчами опасаюсь сделать что-то не то. Что делать в данном случае? если все проигнорировать, то изменения не вносятся. Что должно остаться в MealsUtil после применения патчей?



tema.emelyan [11:27 AM] 
@Kaa у тебя что-то не так. этой штуки не должно быть в принципе. эта фигня значит, что у тебя файл не в том же состоянии, что у Григория


[11:28] 
возможно у тебя стоит галочка Optimize imports при коммитах

Kaa [11:29 AM] 
та не, проверял эта галочка убрана.

tema.emelyan [11:30 AM] 
это при применении какого патча?

Kaa [11:32 AM] 
это 1,1, 1.2 и 1.3 тот=же результат дают. тем более что я ж перед ними 1.0 ставил и после ничего не менял.


Belstrel [11:35 AM] 
Всем привет,надо ещё внимательно смотреть по веткам,там есть ещё master удаленный и тд я вчера по быстрому начал патчи эплаить и в этоге черти что получилось,каких-то файлов не хватало,сегодня с нуля весь проект перезалил и теперь внимательно всё делаю.



Kaa [11:41 AM] 
а все. есть контакт. tema.emelyan, спасибо натолкнул на мысль. Optimize imports то у меня убрана была, а вот reformat и rearrange были установлены, их убрал и все пошло.

vsimonov [11:56 AM] 
а для чего tomcat_remote добавлялся?

Maksim [12:07 PM] 
Народ, всем привет.


[12:08] 
А как сделать так, чтобы когда щелкаешь с ctrl по имени класса, который входит в jdk

[12:08] 
чтобы открывалось окно с javadoc

[12:08] 
а то у меня открывается окно, но там написано //
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by Fernflower decompiler)
//


[12:09] 
и все

Grub [12:09 PM] 
@Maksim `Ctrl+Q` (edited)

tema.emelyan [12:10 PM] 
@Maksim загрузи сорсы

Maksim [12:10 PM] 
и в сеттинги подключить?

[12:10] 
вроде все так и делал

tema.emelyan [12:15 PM] 
@Maksim я с ctrl жму на имя класса или метода и всё работает (edited)

[12:17] 
в мавене можно ещё загрузить документацию, но это только про библиотеки импортируемые мавеном насколько я понимаю. стандартные jdk сорсы должны сразу быть (edited)


[12:17] 
у тебя винда?

Maksim [12:19 PM] 
не


[12:19] 
у меня linux

[12:19] 
сейчас попробую source подключить

[12:19] 
может быть дело в этом

tema.emelyan [12:19 PM] 
ага, так и думал

Maksim [12:19 PM] 
т.е. доки подключил, а сорсы нет


tema.emelyan [12:19 PM] 
у меня там тоже с сорсами трабл был

[12:20] 
в идее нужно указать путь к src.zip


Maksim [12:21 PM] 
))) понял, сейчас поиграюсь


[12:23] 
все заработало

[12:23] 
теперь по ctrl + click открываются сорсы

tema.emelyan [12:24 PM] 
ура

Maksim [12:24 PM] 
всем спасибо за помощь

[12:24] 
просто как-то про source забыл


grigory.kislin [2:46 PM] 
@Rostish если будет потребность- можно будет провести. собирайте вопросы для вебинара
я на их основе и делал видео. например будет в конце стажировки будет видео с доп. вебинара
Собеседование. Разработка ПО (edited)



grigory.kislin [2:53 PM] 
@vasiliyeskin 1. O(2*N) это идеологиески неверно. O- это коэффициент. с AtomicBoolean  есть разбор в видео Optional 2

[2:54] 
как интересное решение задачки на 1н проход- приемлимо. для кода в проекте- нет


[2:56] 
@vsimonov что такое  tomcat_remote?

vsimonov [2:58 PM] 
в видосике "WAR. Веб-контейнер Tomcat. Сервлеты." создаётся tomcat_remote на 8000 порту. Для чего?
Grigory Kislin
@vsimonov что такое  tomcat_remote?
Posted in #hw1Nov 3rd at 2:56 PM
(edited)

grigory.kislin [3:02 PM] 
на 8000 порту - для дебага


vsimonov [3:03 PM] 
дебажить без этого что не получится?
Grigory Kislin
на 8000 порту - для дебага
Posted in #hw1Nov 3rd at 3:02 PM

grigory.kislin [3:03 PM] 
если запускаешься не из idea- нет



vsimonov [3:04 PM] 
данная операция как раз в idea проделывается.
Grigory Kislin
если запускаешься не из idea- нет
Posted in #hw1Nov 3rd at 3:03 PM


grigory.kislin [3:05 PM] 
не, ты еще раз пересмотри видео и пойми, что есть remote debug

vsimonov [3:14 PM] 
отдельно для дебага сделан отдельный порт


[3:16] 
повторить не получилось, Connection refused


vsimonov [3:17 PM] 
uploaded this image: refuzed.jpg
  Add Comment



Sergey [5:52 PM] 
Может кто-нибудь подсказать, почему при запуске remote debug выдается ошибка: Unable to open debugger port (localhost:8000): java.net.ConnectException "Connection refused: connect"? С другими номерами портов тоже самое.


Valery [7:28 PM] 
Посмотрел видео по maven. Не услышал какой архетип используется на текущем проекте. Из стандартного набора или кастомный? (edited)

chimax [7:31 PM] 
может, этот
org.apache.maven.archetypes:maven-archetype-webapp (A simple Java web application)


net_ [7:34 PM] 
@Sergey  а ты при запуске томкат использовал ключик jpda?

Vladimir Z [7:37 PM] 
всем привет. кто подскажет, как указать путь к урлу, чтоб корректно мапило на сервлет?


[7:40] 
моя проблема в том, что когда в идее указываю Application context: "/topjava", то ссылка в Index.html  <a href="/meals" бежит, минуя /topjava...

[7:43] 
http://localhost:8080/meals, а нужно чтоб автоматом рут прописывало... пробовал ${pageContext....}, чего-то не вышло... если у кого есть универсальное решение, чтоб не пришлось хардкодить каждый урл, напишите плз


chimax [7:43 PM] 
а ты в web.xml прописывал маппинг?


Vladimir Z [7:45 PM] 
да, нативно все работает, а если в настройки сервера добавляю контекст патх, то сервлет не подхватывает (((


chimax [7:51 PM] 
в идеи в двух местах добавил Application Context? (edited)

[7:52] 
https://github.com/JavaOPs/topjava/wiki/IDEA#%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B9-war-%D0%B2-tomcat-application-context-%D0%B4%D0%BE%D0%BB%D0%B6%D0%B5%D0%BD-%D0%B1%D1%8B%D1%82%D1%8C-%D1%82%D0%BE%D1%82-%D0%B6%D0%B5-%D1%87%D1%82%D0%BE-%D0%B8-url-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B4%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%D1%82%D1%8C-%D0%BD%D0%B0%D0%B4%D0%BE-war-exploded
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 


Vladimir Z [8:04 PM] 
да, выполнил правильно, просто хотел ссылку с главной страницы прописать...

[8:05] 
конкретно не корректно работает ссылка <a href="/users"

chimax [8:06 PM] 
а ты прописал маппинг в web.xml для UserServlet?


Sergey [8:11 PM] 
@net_ Спасибо! В этом и было дело


Vladimir Z [8:14 PM] 
я тоже разобрался)))

[8:14] 
проблема была, что в HTML путь надо было прописывать с точкой в начале)))) аххахах!!!

chimax [8:15 PM] 
да не обязательно


Vladimir Z [8:15 PM] 
href="/users" - не работает, а href="./users" - работает!!!))))

chimax [8:16 PM] 
точка говорит о том, что файл находится в текущей папке относительно index.html


[8:16] 
а попробуй без / (edited)

Vladimir Z [8:17 PM] 
проверил, убедился, смех))) конечно я прописывал веб хмл, а раньше и более сложные контроллеры, рест-контроллеры писал)))

[8:18] 
да, без слэша тоже корректно все работает))) спасибо

[8:19] 
уже собирался путь скриптом вытягивать динамически)))

chimax [8:19 PM] 
а теперь убери слэш из настроек идеи

[8:20] 
и снова напиши слэш /users

vch [8:20 PM] 
@Vladimir Z Это сработает, только если все твои сервлеты находятся в 1 папке.
Если будешь иерархию строить - `\meals`,`\meal\create` и т.п., то твой способ даст сбой. Либо придётся везде отслеживать текущий уровень иерархии... Очень неудобно.

chimax [8:21 PM] 
есть иной способ)

Vladimir Z [8:21 PM] 
в идее слэш убрал, но ничего не изменилось принципиально..

chimax [8:22 PM] 
а с точкой если

Vladimir Z [8:23 PM] 
c точкой работает. вот и разница хтмл от жсп

chimax [8:24 PM] 
./ - это всего лишь указание, где находится файл

Vladimir Z [8:24 PM] 
ну я так понимаю и по структуре каталога тоже можно гулять ../

chimax [8:25 PM] 
да хоть так))) 
../../../../

Vladimir Z [8:25 PM] 
можно попробовать в более сложном приложении навигацию таким способом...


vch [8:26 PM] 
@Vladimir Z сомнительное удовольствие...


Vladimir Z [8:26 PM] 
ну это только гет, с постом сложнее, я так понимаю, еще не разбирался


chimax [8:27 PM] 
все то же самое


[8:28] 
разница лишь в том, что в форме ты укажешь method="post"

Vladimir Z [8:28 PM] 
ясн... ну разберемся))

[8:28] 
спасибо

[8:28] 
я офф пока


chimax [8:29 PM] 
bb)

Valery [9:51 PM] 
Запусил на виртуалке сервер, поставил томкат. Захожу на remote-server:8080 - ОК. Но при при попытке зайти в админку получаю 403 Forbidden. Даже пароль не запрашивает. Какой папке какого уровня привилегии надо дать, чтобы работала админка? (edited)


grigory.kislin [9:52 PM] 
@Valery для админки надо конфиг в tomcat редактировать. в уроке есть (edited)


Valery [9:54 PM] 
сделал

[9:55] 
даже без редактирования конфига пароль должно запрашивать. на локалхосте так было. на удаленном не получается.


Valery [10:27 PM] 
как запустить томкат в папке проекта с консоли?


[10:28] 
только через полный путь к скрипту?

chimax [10:28 PM] 
занеси его в качестве переменной среды


Valery [10:29 PM] 
какое имя переменной?

chimax [10:29 PM] 
не обязательно новую создавать

[10:29] 
укажи в PATH

[10:31] 
архитайп-то кто какой использовал?


russell [10:31 PM] 
а надо было?


chimax [10:32 PM] 
не обязательно

[10:32] 
просто их там около 2000 )


Valery [10:33 PM] 
я так понимаю архетип мы не выбирали, а выкачали готовый из гитхаба

chimax [10:33 PM] 
архитайп - это структура каталогов


[10:33] 
мы ничего не выкачивали из гитхаба

russell [10:33 PM] 
так Григорий же проект создавал

[10:34] 
а архетип можно менять на готовом проекте?

chimax [10:34 PM] 
а там кроме папок model и util разве что-то еще было?

russell [10:35 PM] 
а менять можно?

chimax [10:35 PM] 
это слои

[10:35] 
я не про них говорю)

russell [10:36 PM] 
да не я понял, ты говоришь про структуру папок, я спрашиваю, вот если создан проект мавена, есть такая кнопка сменить архетип и чтобы мавен сам все по нужным папкам готовый проект раскидал

chimax [10:37 PM] 
в эклипсе была возможность конвертировать проект в мавен проект


[10:37] 
тут как - не знаю

Valery [10:53 PM] 
сгенерил spring-boot-sample-tomcat-archetype, при упаковке создается jar. Это значит, что можно и jar-ники деплоить?

chimax [10:54 PM] 
укажи war в pom.xml


Valery [10:55 PM] 
это я знаю. интересно почему в стандартном архетипе это не сделано.

russell [11:25 PM] 
там вроде как томкат плагином идет и его спринг бут запускает через мейн, на нем обычно веб сервисы пишут



----- Saturday, November 4th -----
Anton K. [1:45 AM] 
Ребят, чет туплю, если я в сервлете реквесту ставлю аттрибут, а потом на jsp-хе пытаюсь его вывести, его не видно((


[1:45] 
куда смотреть

Anton K. [1:52 AM] 
Вопрос точнее как атрибут в jsp Открыть


[1:52] 
${Имя атрибута} так не получается

Anton K. [2:35 AM] 
А все сорри, это я просто криворук


Valery [8:58 AM] 
><user username="tomcat" password="tomcat" roles="tomcat,manager-gui,admin-gui"/>
С ролью 'manager-gui' вроде понятно. А зачем роль 'tomcat'?

kadmser 
[1:03 PM] 
Написано слеши в пути должны быть в стиле unix (/). Я сделал как в винде, логгер работает. Для чего как в Unix?

vsergeev [1:06 PM] 
Для совместимости? :thinking_face:


kadmser 
[1:45 PM] 
И так(\) и так(/) работает

vvviiit [1:55 PM] 
Тоже интересует этот вопрос, все другие переменные с обычными слешами


Shalukhau Dzmitry [3:55 PM] 
Не все ОС одинаково гуманны к /. Некоторые \ могут и не понять...

Dinara [4:11 PM] 
Всем привет! Не могу победить кодировку. При вводе кириллицы сохраняются кракозябры. Поставила как написано в комментах кодировку у реквеста UTF 8, не помогло.


[4:15] 
И еще сомневаюсь сильно в части "Добавить поле id в Meal/ MealWithExceed и реализовать генерацию счетчика, УЧЕСТЬ МНОГОПОТОЧНОСТЬ СЕРВЕЛТОВ". Поле id в этих классах должно быть AtomicInteger или это надо где-то в другом месте сделать?


Дима Жуков [4:16 PM] 
Идея в настройках проекта тоже utf8?

[4:17] 
Сами JSP проверь в notepad++ например

vch [4:17 PM] 
@Dinara В Meal и MealWithExceed точно не должно быть AtomicInteger


Dinara [4:19 PM] 
да вот вроде да. везде где нашла - стоит UTF 8.
Жуков Дмитрий
Идея в настройках проекта тоже utf8?
Posted in #hw1Nov 4th at 4:16 PM

[4:20] 
ясно. буду переделывать)
Vitaliy Churbakov
@Dinara В Meal и MealWithExceed точно не должно быть AtomicInteger
Posted in #hw1Nov 4th at 4:17 PM


Дима Жуков 
[4:20 PM] 
Где объявления JSP там тоже utf8?)

russell [4:20 PM] 
там должен быть синкронайзд блок?


Дима Жуков 
[4:20 PM] 
В meta запули тож))

[4:22] 
Наверное есть несколько реализаций... Как обычно)


Dinara [4:22 PM] 
ой, я думала без синхронайзд, в момент генерации нового айдишника использовать AtomicInteger. Ну и коллекция сама чтоб была потокобезопасной. Но не уверена, что этого достаточно всего.
Ruslan Shakirov
там должен быть синкронайзд блок?
Posted in #hw1Nov 4th at 4:20 PM


russell [4:23 PM] 
а в чем храните, в мапе?


Anton K. [4:23 PM] 
Ребят вопрос такой реализация crud интерфейса - это же написать класс для слоя dao и service, но в нашем случае слой dao будет работать не с БД а с коллекцией. Я правильно понял задание??

vch [4:23 PM] 
@Dinara а вот это уже более правильные мысли идут.



russell [4:23 PM] 
да получается так.


Dinara [4:24 PM] 
почему в мапе, в листе как и раньше.
Ruslan Shakirov
а в чем храните, в мапе?
Posted in #hw1Nov 4th at 4:23 PM


russell [4:26 PM] 
а если в листе по айдишнику в середине удалить, он же сместиться. Или каждый раз айдишники перебивать?

Дима Жуков [4:26 PM] 
Айдишники то в классе самом.

[4:26] 
Какие есть такие и будут

russell [4:27 PM] 
а удалять, чтобы быстро то по индексу надо

[4:27] 
или каждый раз перебирать все объекты

Дима Жуков [4:27 PM] 
Хз, я думал по айди

russell [4:29 PM] 
нет по айди то понятно, но получается что при каждом запросе надо итерироваться вытаскивать объект и смотреть у него айдишник, вроде как не очень рационально.

Дима Жуков [4:29 PM] 
Я так делал... Но согласен

Dinara [4:30 PM] 
а, хорошая идея! я тоже сделала в листе и перебираю по всему листу в поисках айдишника. а если в мапе, то быстрее, да.
Ruslan Shakirov
нет по айди то понятно, но получается что при каждом запросе надо итерироваться вытаскивать объект и смотреть у него айдишник, вроде как не очень рационально.
Posted in #hw1Nov 4th at 4:29 PM


[4:32] 
спасибище! в jsp был не utf!!
Жуков Дмитрий
Где объявления JSP там тоже utf8?)
Posted in #hw1Nov 4th at 4:20 PM


Dmitry Makarov [4:45 PM] 
@vsimonov, ты разобрался с дебагом? у меня та же проблема Error running 'tomcat-remote': Unable to open debugger port (localhost:8000): java.net.ConnectException "В соединении отказано (Connection refused)"
1 reply 7 days ago View thread
evgeny [5:21 PM] 
есть ли смысл указывать настройки томката в мавене?

fbochkarev [5:43 PM] 
uploaded and commented on this image: Pasted image at 2017-11-04, 5:42 PM
1 Comment
Что надо сделать? Или что я делаю не так?)



Дима Жуков [5:43 PM] 
Мавен апдейт

[5:43] 
Нужен.

[5:44] 
Импортировать зависимости чтобы

[5:44] 
Правой кнопкой на pom update?

[5:44] 
Тип того

[5:45] 
Нет наверное по-другому


chimax [5:45 PM] 
у тебя проблема с dependecies - справа во вкладке maven (edited)

[5:47] 
нажми там же на круговые стрелки - reimport all maven projects (edited)

fbochkarev [5:48 PM] 
@chimax "reimport all maven projects" что-то всёравно ему)

chimax [5:48 PM] 
тогда открой нам pom


fbochkarev [5:48 PM] 
минутку idea перезагружу


Дима Жуков 
[5:49 PM] 
Может прокси? Не на работе случаем?)


chimax [5:49 PM] 
он не видит сервлеты

[5:49] 
может, не подгрузились или неправильно указана зависимость

fbochkarev [5:51 PM] 
uploaded this image: Pasted image at 2017-11-04, 5:51 PM
Add Comment



fbochkarev [5:51 PM] 
uploaded this image: Pasted image at 2017-11-04, 5:51 PM
Add Comment



fbochkarev [5:52 PM] 
нажал подгрузить


Дима Жуков 
[5:52 PM] 
Должно сработать

chimax [5:55 PM] 
https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api/3.1.0


fbochkarev [5:56 PM] 
@chimax грузится с репозитория, долго что-то просто


[6:00] 
@chimax после закачки мне его просто двойным кликом запустить? (edited)


Дима Жуков 
[6:00 PM] 
Ребята, а вы где лист забиваете данными? В сервлете?


chimax [6:01 PM] 
а где именно в сервлете?)


Дима Жуков 
[6:02 PM] 
Хз))

chimax [6:02 PM] 
данные должны быть инициализированы один раз при запуске программы

Дима Жуков 
[6:03 PM] 
Ну вот что то у меня с пониманием этого трудности... Туплю жуть. Помощь. Подсказку


chimax [6:04 PM] 
Надо голову поломать


Дима Жуков 
[6:05 PM] 
В сервлете написать блок {} он один раз вызовется:slightly_smiling_face:


vsimonov [6:05 PM] 
неа я и не смотрел. Насколько это нужно сейчас так и не понял.
Dmitry Makarov
@vsimonov, ты разобрался с дебагом? у меня та же проблема Error running 'tomcat-remote': Unable to open debugger port (localhost:8000): java.net.ConnectException "В соединении отказано (Connection refused)"
Posted in #hw1Nov 4th at 4:45 PM
(edited)


Дима Жуков 
[6:05 PM] 
Или нет:grimacing:


Dmitry Makarov [6:06 PM] 
Разобрался. Если у кого такая проблема просто раскомментируйте строку JAVA_OPTS="${JAVA_OPTS} -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n" в /etc/default/tomcat8 (edited)


Дима Жуков 
[6:07 PM] 
Хоть с дебагом проблем нет. И то хлеб

russell [6:08 PM] 
а где именно в сервлете?)

[6:08] 
а почему не в Дао это делать


[6:08] 
поделитесь как цитировать (edited)

Дима Жуков 
[6:12 PM] 
Я просто там такого наворотил, меня практически хотели исключить при проверке за такой код. Теперь каша в голове, запутался. Что то тянет усложнить всё


russell [6:13 PM] 
а чего ты там наворотил, сессии настраивал, фильтры


Дима Жуков 
[6:14 PM] 
Индусы знаешь как кодят?)

[6:14] 
Не в обиду индусам если есть на проекте


vch [6:14 PM] 
@Дима Жуков Ого! Это достижение. Я тоже усложнял (относительно ТЗ), но до такого недотянул.

Дима Жуков [6:15 PM] 
На лукморе забавная статья про такой код)


[6:15] 
Все читали поди

vsimonov [6:16 PM] 
где ты такую строку нашёл?
Dmitry Makarov
Разобрался. Если у кого такая проблема просто раскомментируйте строку JAVA_OPTS="${JAVA_OPTS} -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n" в /etc/default/tomcat8
From a thread in #hw1Nov 4th at 6:06 PM


chimax [6:16 PM] 
у кого линукс, разобрались как дебаг запустить?
1 reply 7 days ago View thread

Dmitry Makarov [6:17 PM] 
в /etc/default/tomcat8


vsimonov [6:17 PM] 
вот разбираемся
chimax
у кого линукс, разобрались как дебаг запустить?
Posted in #hw1Nov 4th at 6:16 PM


Dmitry Makarov [6:17 PM] 
@chimax, ты не разобрался?


vsimonov [6:18 PM] 
у тея томкат как установлен и в каком файле эта строка
Dmitry Makarov
в /etc/default/tomcat8
Posted in #hw1Nov 4th at 6:17 PM
(edited)


chimax [6:18 PM] 
https://stackoverflow.com/questions/16689274/how-to-start-debug-mode-from-command-prompt-for-apache-tomcat-server
stackoverflow.com
How to start debug mode from command prompt for apache tomcat server?
I want to start debug mode for my application. But I need to start the debug mode from command prompt. Is it possible ? And will the procedure vary between tomcat 5.5 to tomcat 6.?
 


Dmitry Makarov [6:19 PM] 
у меня дебиан, томкат устанавливал через apt, строка в файле /etc/default/tomcat8


vsimonov [6:21 PM] 
блин ук меня такого конфиг-файла нет
Dmitry Makarov
у меня дебиан, томкат устанавливал через apt, строка в файле /etc/default/tomcat8
Thread in #hw1Nov 4th at 6:19 PM
 2 replies Last reply 4 days ago View thread

chimax [6:22 PM] 
напиши locate название конфига


Valery [6:23 PM] 
в лекции не рекомендовалось ставить через apt-get. файлы разбросаны по разным директориям.
Dmitry Makarov
у меня дебиан, томкат устанавливал через apt, строка в файле /etc/default/tomcat8
Posted in #hw1Nov 4th at 6:19 PM


chimax [6:24 PM] 
да и запускать томкат придется каждый раз


Dmitry Makarov [6:25 PM] 
@Valery, у меня он уже стоял

vsimonov [6:26 PM] 
хз поиском тоже найти такую строку не получается

chimax [6:27 PM] 
а ты ищи только последнюю часть, а не строку


vsimonov [6:27 PM] 
конечно я ищу часть)

chimax [6:28 PM] 
сколько лет с линуксом?

vsimonov [6:28 PM] 
года 3, к чему вопрос? :slightly_smiling_face:


chimax [6:29 PM] 
что бы понимать, что не две недели)


[6:29] 
что бы не давать глупые советы)

vsimonov [6:30 PM] 
у меня скаченный томкат 9 версии

chimax [6:30 PM] 
у меня тоже, но я пользуюсь идеевским


vsimonov [6:31 PM] 
я главное несовсем понял в неоходимости запуска дебага на 8000 порту, когда можно также запустить но на 8080,кто то может пояснить? (edited)


Dmitry Makarov [6:31 PM] 
как запускаешь томкат?


vsimonov [6:31 PM] 
через идею

Valery [7:17 PM] 
у меня первый комент по ссылке на СО  не работает - 'catalina.sh jpda start'.
но там ниже есть такой - 'catalina.sh jpda run'. тут ок, но только если с 'sudo' запускать. иначе некоторые страницы дают 500 ошибку.
chimax
у кого линукс, разобрались как дебаг запустить?
Posted in #hw1Nov 4th at 6:16 PM


Dinara [7:42 PM] 
Спасибо за идею с мапой, все переделала на нее - даошник получился намного лаконичнее!
Ruslan Shakirov
а в чем храните, в мапе?
Posted in #hw1Nov 4th at 4:23 PM


russell [7:49 PM] 
круто, а подскажи как ты организовала конкарент мапу, атомик интегер на мил? вставляла через computeIfAbsent?


Dinara [7:57 PM] 
хм, computeIfAbsent? не, вставляла через обычный put... Начинаю сомневаться


[8:00] 
да, и мапа у меня integer на мил

russell [8:00 PM] 
нет ну теоретически с таким атомик интеджером уже не будет ключа, должно сработать. Спецы помогите что да как с конкарент мапой.


Дима Жуков 
[8:00 PM] 
Конкарент мапа из concurrency пакета

russell [8:00 PM] 
нет вот это точно нельзя


Дима Жуков 
[8:01 PM] 
7 джавы там коллекций нет?


russell [8:01 PM] 
а ты на 7 до сих пор


Dinara [8:01 PM] 
почему? у меня atomicinteger только в момент вставки новой записи используется как counter


Дима Жуков [8:01 PM] 
Нет я имею в виду их ввели при 7)

Dinara [8:01 PM] 
для того чтобы операция ++ была потокобезопасной.


Дима Жуков [8:01 PM] 
У нас у всех8


Dinara [8:02 PM] 
а остальная конкарренси обеспечивается потокобезопасной мапой


russell [8:02 PM] 
а интегер уже берешь из айдишника,


[8:02] 
?

Dinara [8:02 PM] 
что?


Дима Жуков 
[8:02 PM] 
Ну да она самая потокобезопасная (edited)


Dinara [8:04 PM] 
не поняла при чем тут 8 джава


Дима Жуков 
[8:06 PM] 
Мне показалось кто то спросил, я на 7 версии джавы. Я сказал что на 8. А пакет concurrency ввели при 7 джаве. Пакет. Из 7й джавы.


russell [8:06 PM] 
Динара вроде твоя версия должна работать, айдишник то у тебя уникальный, он обеспечивается атомиком.


Dinara [8:06 PM] 
аа, ясно!
Жуков Дмитрий
Мне показалось кто то спросил, я на 7 версии джавы. Я сказал что на 8. А пакет concurrency ввели при 7 джаве. Пакет. Из 7й джавы.
Posted in #hw1Nov 4th at 8:06 PM


russell [8:06 PM] 
а тесты кто-нибудь знает как пишут на многопоточность? (edited)


Dinara [8:07 PM] 
мне кажется, что да. Правда, как это проверить, что-то не могу сообразить. в двух вкладках что ли открыть или как
Ruslan Shakirov
Динара вроде твоя версия должна работать, айдишник то у тебя уникальный, он обеспечивается атомиком.
Posted in #hw1Nov 4th at 8:06 PM


russell [8:07 PM] 
да нет там же все за милисекунды делается, это не поможет


Дима Жуков 
[8:08 PM] 
Много друзей попросить

[8:09] 
А на следующем уроке не тесты случайно?

vch [8:09 PM] 
@russell Кстати, хороший вопрос... На таких маленьких функциях надёжнее глазами просмотреть и мысленно промоделировать параллельную работу.
А тестами - только если отлавливать конкретные ситуации. Типа запустить get-запрос, сделать паузу (программно), запустить save-запрос в другом потоке. (edited)


Dinara [8:17 PM] 
а еще у меня вопросик есть - вы какие слои создаете сейчас? dao и сервисы и в сервлете используются методы сервиса? или так как сервисы вырожденные получаются, то напрямую дергаете из dao?


Дима Жуков 
[8:18 PM] 
Думаю попроще. Сразу dao


russell [8:18 PM] 
Да напрямую из дао, так как при круде сервис просто дублирует дао методы


russell [8:20 PM] 
скажите, а вот если идея подчеркивает ошибку, есть такое сочетание клавиш или инструмент, чтобы сразу на ту строку перекидывала
 3 replies Last reply 5 days ago View thread

Dinara [8:24 PM] 
ой, я всегда мучаюсь с этим - нашла пока только способ справа увидеть красную черточку и ткнуть туда, тогда скорее всего попадаю на место с ошибкой


[8:25] 
спрашивала у коллег - программистов, они ничего более умного не предложили

russell [8:26 PM] 
спасибо, это как раз то, что мне надо


Дима Жуков 
[8:27 PM] 
Тут уже большая часть практикующих программистов собралась как я понимаю. Много кто уже работает

Dinara [8:28 PM] 
я qa... пока что)

Дима Жуков 
[8:29 PM] 
Java?


Dinara [8:29 PM] 
на java ага. но это совсем не то что девелоперы)

Дима Жуков 
[8:29 PM] 
Тут про домашку чат. Но спрошу уж тут

russell [8:30 PM] 
а что конкретно вы логировали и каким приоритетом

Дима Жуков 
[8:31 PM] 
Try catch один был. Там error в катче. Но я его выпелю.. остальное debug


[8:33] 
Всякую дичь логгировал... Не совсем понял что надо логировать. Типо тут добавили + кого тут удалили + кого. Тут форварднули + куда

Dinara [8:35 PM] 
я логирую изменения состояний. в принципе ничего другого у нас пока и нет)

[8:35] 
ну и еще запросы все типа find или findAll

Valery [8:39 PM] 
зачем нужна многопоточность при работе со списком еды пользователя?

Дима Жуков [8:40 PM] 
Сервлеты многопоточны.

Valery [8:40 PM] 
и?

Дима Жуков [8:40 PM] 
Список один. Его как то контролировать надо


Dinara [8:40 PM] 
а там в комментах у Григория есть объяснение

russell [8:40 PM] 
ты круд делаешь или просто выводишь таблицу?


Valery [8:40 PM] 
пользователь может одновременно сделать 2 запроса?


Дима Жуков [8:40 PM] 
Да

Valery [8:40 PM] 
а как он это может?

russell [8:41 PM] 
нет может одновременно быть хоть миллион запросов от других пользователей, а сервлет всего один


Дима Жуков 
[8:41 PM] 
2 пользователя в один лист

Valery [8:41 PM] 
так у каждого пользователя свой список еды

Dinara [8:41 PM] 
Реализация хранения в памяти у нас одна на всех. Те коллекция шарится между пользователями, а они в разных потоках ее дергают. Если несколько потоков одновременно будут изменять коллекцию без учета многопоточности (нарпимер один будет удалять, второй вставлять), мы получим ConcurrentModificationException


Valery [8:41 PM] 
доступ к нему он получает после авторизации


Dinara [8:41 PM] 
это цитата из Григория есличе


russell [8:42 PM] 
кстати он прав

Дима Жуков 
[8:42 PM] 
Неа. Она одна

[8:42] 
Хотя погоди

Valery [8:42 PM] 
база общая. согласен.


Дима Жуков [8:43 PM] 
Нет одна она

[8:43] 
Да?

[8:43] 
И лист один

[8:43] 
На всех


russell [8:44 PM] 
а разве на каждого пользователся своя таблица со списком не заводится?

Дима Жуков 
[8:44 PM] 
Нет

vch [8:44 PM] 
Есть 2 уровня требований многопоточности в нашем случае:
1. чтобы разные пользователи могли одновременно делать запросы
2. чтобы 1 пользователь посылал одновременно разные запросы.
2 требованию удовлетворить чуть сложнее, но правильнее стремиться именно к нему.


Дима Жуков 
[8:44 PM] 
Ну будет заводит ься

[8:45] 
Когда мы сделаем. А сейчас она одна на всех

Valery [8:45 PM] 
второе требование трудно представить.


[8:45] 
это надо в приложении 2 кнопки одновременно нажать?

Dinara [8:45 PM] 
да ладно, нет, конечно!
Ruslan Shakirov
а разве на каждого пользователся своя таблица со списком не заводится?
Posted in #hw1Nov 4th at 8:44 PM


Valery [8:45 PM] 
или авторизоваться с разных девайсов?

Дима Жуков 
[8:45 PM] 
Она для всех одна


russell [8:46 PM] 
а как ты мэпить будешь пользователя?у всех же в дескрипшене что угодно может быть?

[8:47] 
надо же делать one to many

Dinara [8:47 PM] 
так потом наверное мил будет к юзеру еще привязываться

Valery [8:47 PM] 
но при авторизации с разных устройств либо сессия должна обрываться на одном из, либо не пускать второй раз пока сеесия где-то еще активна


russell [8:47 PM] 
ну получается, что на каждого узера будет своя таблица, куда будет ссылаться юзер. Не так?

Дима Жуков 
[8:48 PM] 
Нет

[8:48] 
Пока нет


[8:48] 
Потом будет бд

Valery [8:48 PM] 
>а как ты мэпить будешь пользователя?
в БД с едой будет колонка юзеров (edited)


Дима Жуков [8:49 PM] 
Многопоточность сейчас нужна. Это факт


vch [8:50 PM] 
Хотя, я думаю, серьёзные раздумья о многопоточности можно отложить до HW2. Там юзеры появятся.

Valery [8:51 PM] 
нам сейчас нужна многопоточность из-за ID-шников только?

Дима Жуков 
[8:51 PM] 
Ну да


vch [8:52 PM] 
@Valery По сути сейчас только 1 сценарий надо проверять - когда будет 2 одновременных запроса на создание новой еды

Dinara [8:53 PM] 
так а вот это то же тоже - Реализация хранения в памяти у нас одна на всех. Те коллекция шарится между пользователями, а они в разных потоках ее дергают. Если несколько потоков одновременно будут изменять коллекцию без учета многопоточности (нарпимер один будет удалять, второй вставлять), мы получим ConcurrentModificationException



[8:53] 
то есть не только при создании, но и при удалении например

Дима Жуков 
[8:54 PM] 
Слово практикующего программиста чувствуется сразу.

Dinara [8:54 PM] 
это Григорий в комментах писал)))

[8:54] 
цитата)

Valery [8:55 PM] 
удалять не проблема. никтоне требует чтобы ID были непрерывными

Dinara [8:56 PM] 
ConcurrentModificationException может случиться

vch [8:56 PM] 
@Valery У любителей List с удалением были бы проблемы...


Valery [8:56 PM] 
в mysql если удалить запись, а потом добавить, то новая получает новый номер

Dinara [8:57 PM] 
так сейчас у нас не бд же


Valery [8:58 PM] 
сейчас не БД. но делать ID непрерывными - лишние проблемы.

Dinara [8:59 PM] 
а кто гооврит про непрерывные id?

[8:59] 
это в связи с чем?

Valery [8:59 PM] 
>нарпимер один будет удалять


[9:00] 
это из твоей цитаты )


LeshaKol [9:03 PM] 
коллеги, случайно внес изменения у себя в master, но не закоммитил и не запушил. Как откатить, подскажите? То есть надо поднять мастер из реппозитория, а hw0 оставить. Ну или, откатить весь проект до реппозитория, не создавая новый.  навскидку, по видео, не нашел.


Valery [9:03 PM] 
>Добавить поле id в Meal/ MealWithExceed
вот тут момент не понятный. MealWithExceed - фильтрованая еда и тут многопоточность уже не надо соблюдать?


Dinara [9:05 PM] 
там же проблема кажется не в том, что удаляется та же запись которая вставляется. ConcurrentModificationException же про другое вроде.


Valery [9:06 PM] 
@LeshaKol reset current branch to here

[9:06] 
пкм по нужному коммиту

Dinara [9:06 PM] 
кмк не надо, потому что это просто выборка из милс.
Valery Trebukh
>Добавить поле id в Meal/ MealWithExceed
вот тут момент не понятный. MealWithExceed - фильтрованая еда и тут многопоточность уже не надо соблюдать?
Posted in #hw1Nov 4th at 9:03 PM


[9:09] 
тебе эти изменения вообще не нужны? тогда стоя на чейнджлисте (Default) делаешь revert - оно откатывает все файлы на состояние ремоутного репозитория.
Alex Kolushev
коллеги, случайно внес изменения у себя в master, но не закоммитил и не запушил. Как откатить, подскажите? То есть надо поднять мастер из реппозитория, а hw0 оставить. Ну или, откатить весь проект до реппозитория, не создавая новый.  навскидку, по видео, не нашел.
Posted in #hw1Nov 4th at 9:03 PM

[9:10] 
hw0  у тебя же закоммитено и запушено уже, да?

LeshaKol [9:11 PM] 
да, закоммитено и запушено, при этом, обнаружил, что мастер точно соответствует hw0. Как так получилось, не понял, видимо, от невнимательности.

Dinara [9:12 PM] 
а ты мастер пушил когда патчи применил?

LeshaKol [9:12 PM] 
пока не понял, где стучать ПКМ ни по ответу Валерия, ни где делать реверт по ответу динары.

Valery [9:13 PM] 
внизу Version Controll вкладка Log

LeshaKol [9:13 PM] 
патч я только один применял нулевой и тогда пушил. а теперь туда еще решение hw0 попало

Dinara [9:14 PM] 
вкладка VersionControl -> там в Default все файлы которые ты изменил. Стоишь на этой Default правая кнопка revert.

[9:14] 
ветка откатится до состояния последнего пуша в мастер

[9:15] 
то есть придется патчи из последнего урока снова применить, потому что ты их не впушил

LeshaKol [9:17 PM] 
большое спасибо, разобрался! Оказалось, я закоммитил все же одни изменения в мастер, но не запушил их. Поэтому оно не предлагало реверт. Спасибо большое, оба ответа были очень полезными и быстро помогли!

LeshaKol [10:08 PM] 
очень извините за дальнейшие чайниковские воспросы, но - запушил hw1 в мастер, после этого решил вернуться в свою ветку hw0 - так она ругается, показывает на конфликт с мастером и спрашивает, чьи изменения принимать. Я, честно говоря, в удивлении - что, нельзя две ветки независимо посмотреть?

Valery [10:12 PM] 
переключаться между ветками можно

[10:14] 
>но - запушил hw1 в мастер, после этого решил вернуться в свою ветку hw0
вернуться - то есть, откатится? hw1 не надо в мастер пушить...

LeshaKol [10:16 PM] 
может я непонятно выразился.. Урок 1:

переключаемся на master: в IDEA внизу справа Local Branches -> master -> checkout
apply все патчи урока Lesson01, git commit/push

[10:16] 
выполнял вот эту инструкцию.

[10:17] 
применил первый патч урока 1. сделал коммит- пуш, как написано

[10:18] 
после этого решил переключиться на hw0.

[10:21] 
теперь даже не могу объяснить, что происходит. на гитхабе видно, что на мастере последние изменения 15 минут назад, раздел Log же показывает 26 10

[10:22] 
каким-то образомHW0 с мастером соединились, что ли.

[10:27] 
при переключении сначала идет сообщение, что следующие файлы будут переписаны в результате чекаута. предлагают умный и форсированный чекаут. Я выбираю умный

LeshaKol [10:54 PM] 
uploaded this image: в результате разбирательств выяснилось следующее:
Add Comment

LeshaKol [10:55 PM] 
то есть я каким-то образом 2 патча параллельно сделал. Теперь вопрос - как это все в гитхабе отменить, или это только переименованием веток лечится?

[10:55] 
хотелось бы в мастере гитхабовском вернуться до prepare to hw0

Valery [11:14 PM] 
сперва надо в локальном репозитории починить потом запушить в гитхаб.

[11:17] 
можно удалить проект и сделать форк https://github.com/JavaWebinar/topjava.
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


chimax [11:17 PM] 
тебе надо сделать форс пуш

[11:18] 
приводишь в порядок код на своем компе

[11:18] 
потом делаешь пуш с ключом -f (edited)

Valery [11:19 PM] 
>приводишь в порядок код на своем компе
в этом трудность.


chimax [11:19 PM] 
сделай откат до нужного коммита


[11:22] 
заходишь в лог с коммитами, нажимаешь правой кнопкой на том коммите, где, как тебе кажется код в порядке и выбираешь Reset current brunch to here


[11:22] 
ко откатится до нужного состояния

[11:23] 
потом, как все сделаешь - пуш код на гитхаб

[11:23] 
попробуй это сделать через консоль

[11:23] 
git push origin master -f


Valery [11:35 PM] 
там вроде как слились две ветки. reset делается только для одной ветки. что со второй будет?

chimax [11:41 PM] 
пусть для наглядности в лог выставит фильтр для одной ветки - исправит ресетом, а потом тоже самое для другой - ветки независимы друг от друга


----- Sunday, November 5th -----
chimax [12:12 AM] 
покажите, что у вас в настроках Project Structure (Ctrl+Alt+Shift+S) -> Facets -> web


LeshaKol [3:59 AM] 
uploaded this image: image.png
Add Comment



chimax [9:30 AM] 
у тебя там еще нет web.xml. Как его добавить?

Valery [10:50 AM] 
я понимаю, он сам добавится как только появится такой файл в проекте. то есть, после патча 1 4.


grigory.kislin [10:51 AM] 
@chimax обычно moven сам определяет. если нет- пропробуй в maven окошке первую кнопку reimport all


chimax [12:53 PM] 
@grigory.kislin Thanks a lot. I broke my brain, but I solved this problem

LeshaKol [2:15 PM] 
решил сделать все заново в новом проекте и тут же при установке нулевого патча получил вот это:

LeshaKol [2:15 PM] 
uploaded this image: image.png
Add Comment



LeshaKol [2:16 PM] 
это нормально? мне при установке следующего патча merge будут предлагать? соглашаться?


tema.emelyan [2:16 PM] 
у тебя две ветки


[2:17] 
вряд ли ты этого хотел добиться

[2:18] 
ты наверное хотел вообще от всего избавиться и оставить только ветку мастер первые несколько коммитов? (edited)


[2:18] 
я бы сделал `Reset current branch to here` -> `hard`


[2:19] 
и потом форс пуш (это затрёт ненужные коммиты)

LeshaKol [2:19 PM] 
я на этот раз вообще скопировал новыцй проект и применил нулевой патч. все

[2:19] 
старое я вообще решил не трогать. мне сразу же после первого же патча

[2:20] 
его коммита и пуша дало вот это


tema.emelyan [2:21 PM] 
куда скопировал? что скопировал? скачал зип и распаковал? в папку со старым проектом?


LeshaKol [2:22 PM] 
нет. я сделал форк проекту на топява, он у меня стал топява-1 в реппозитории. потом я его отклонил в совершенно новую папку и открыл в идее


[2:22] 
потом применил патч хв0

[2:22] 
закоммитил его и запушил

[2:22] 
и сразу получил вот это

tema.emelyan [2:23 PM] 
а ну так ты форкнул наверное из проекта куда уже все патчи применены были


LeshaKol [2:23 PM] 
и что?


tema.emelyan [2:24 PM] 
вон история же есть. там уже есть prepare to hw0 если ты вниз пролистаешь


[2:24] 
зачем ты его опять применяешь

[2:26] 
вот отсюда форкай если всё самому охота

[2:26] 
https://github.com/JavaOPs/topjava
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 


[2:26] 
сюда ничего не накатывали ещё

LeshaKol [2:27 PM] 
так я отсюда форкал

tema.emelyan [2:27 PM] 
нет


[2:28] 
ты отсюда форкал https://github.com/javaWebinar/topjava
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


LeshaKol [2:29 PM] 
слушай, а ведь точно!


[2:30] 
а что это, какой-то аналогичый вебинар, зачем такая путаница?

tema.emelyan [2:32 PM] 
один проект для людей, которые проходят стажировку, Григорий накатывает патчи, чтобы в случае чего можно было свериться с ним


[2:33] 
другой проект содержит только пробное занятие. пробное занятие оно для людей, которые хотят посмотреть что к чему и решить хотят ли они покупать или нет

[2:33] 
туда он ничего не коммитит

LeshaKol [2:33 PM] 
только меня на форк выкинуло в мой старый проект. получается, мне надо сносить патчи в старом проекте, или снести мой hw0 лишний в новом?


tema.emelyan [2:34 PM] 
а зачем тебе два одинаковых проекта?

LeshaKol [2:35 PM] 
я со старым не смог мправиться :disappointed:, сейчас попробую опять.


tema.emelyan [2:36 PM] 
у тебя там конфликт имён. можно создать новый репозиторий в гитхабе пустой. назвать его topjavaTest. без форка вычекать себе на компьютер нужный проект. и залить его себе во вновь созданный репозиторий


[2:37] 
или просто снести две уже имеющиеся топджавы с гитхаба (edited)

[2:37] 
и сделать один нормальный репозиторий


LeshaKol [2:38 PM] 
то есть настолько все плохо, что репозиторий надо сменить? а если такое на проекте на 50-м патче происходит?


tema.emelyan [2:38 PM] 
я пока не понял какое такое


[2:39] 
я тебе говорил, откатись на коммит prepare to hw 0, запушь на гитхаб и будет тебе новый проект (edited)


LeshaKol [2:40 PM] 
сейчас попробую опять. оно мне не очень это дает. сейчас попробую и скажу, где затык.


evgeny [2:43 PM] 
Как отформатировать дату в jsp?

grigory.kislin [2:43 PM] 
просто переименуй папку старого проекта
> то есть настолько все плохо, что репозиторий надо сменить?
проект живой, все меняется к лучшему. я вижу в этом только плюсы


LeshaKol [2:53 PM] 
uploaded this image: image.png
Add Comment



LeshaKol [2:53 PM] 
выбираю хард?

gslava [2:54 PM] 
uploaded this image: Уже кое-что есть
3 Comments



LeshaKol [2:55 PM] 
uploaded this image: image.png
Add Comment



LeshaKol [2:55 PM] 
это выдает, когда я возварщаюсь к hw0  и пытаюсь запушить.


tema.emelyan [2:56 PM] 
а как ты пушишь?

LeshaKol [2:59 PM] 
uploaded this image: еще вот
Add Comment



LeshaKol [2:59 PM] 
то есть коммит не активна

tema.emelyan [2:59 PM] 
есть коммит, есть пуш. это разные вещи

[2:59] 
почитай мануал


[3:00] 
ты щас коммитишь, а надо пушить

[3:00] 
жми контрл шифт к


[3:00] 
и выбирай форс

[3:01] 
или в терминале git push --force

LeshaKol [3:05 PM] 
через терминал сделал. получилось

[3:06] 
какая из ссылок по гиту лучшая?

Belstrel 
[3:13 PM] 
commented on gslava’s file Уже кое-что есть
о круто!А на какой странице это сделал??вводы и вывод на meals.jsp?



gslava [3:18 PM] 
Отдельными страницами с отдельными сервлетами

gslava [3:21 PM] 
Это на скорую руку, много ещё надо сделать чтобы было хотя бы нормально


vsimonov [3:21 PM] 
Ни у кого не было проблем с тем что файл с логами не создаётся в папке лог каталога проекта? у меня высер тока в консоль идёт а в файловую систему нет (edited)

tema.emelyan [3:21 PM] 
переменную окружения добавил?

vsimonov [3:21 PM] 
да


tema.emelyan [3:22 PM] 
а вышел из системы после этого?


vsimonov [3:22 PM] 
нет идею тока перезагрузил

tema.emelyan [3:22 PM] 
по-моему нужно логаут сделать, чтобы переменные окружения инициализировались в ос (edited)

vsimonov [3:23 PM] 
у меня линукс тут можно налету (edited)

tema.emelyan [3:23 PM] 
идея в терминале видит её?


vsimonov [3:23 PM] 
да

tema.emelyan [3:23 PM] 
хз тогда

vsimonov [3:23 PM] 
added this Plain Text snippet
[simonov@spk1-simonovva topjava]$ echo $TOPJAVA_ROOT
/home/simonov/GIT/topjava
Add Comment

anpotashev [4:26 PM] 
У тебя переменная того же пользователя, от которого сервер запускается?

evgeny [4:39 PM] 
У кого нибудь были проблемы с логгером? у меня сервлет привязан к "", при запуске приложения в лог два раза одно и то же пишет


vsimonov [4:45 PM] 
сервер это томкат? томкат стартую из idea она запускается от пользователя simonov у которой есть жэта переменная, но я и для рута добавил
Aleksandr N Potashev
У тебя переменная того же пользователя, от которого сервер запускается?
Posted in #hw1Nov 5th at 4:26 PM


russell [4:54 PM] 
По верстке помогите, когда высоту и ширину регулируешь блока, это делать через padding или width, height;

vsimonov [4:57 PM] 
ребутул комп, файл создался.Видимо нужно было всё же рестартануться. Извиняйте меня.

anpotashev [5:02 PM] 
Я так решил https://stackoverflow.com/questions/17019233/pass-user-defined-environment-variable-to-tomcat
stackoverflow.com
Pass user defined environment variable to tomcat
I am using the eclipse for web application coding. Within this I passed environment variable like : Project--> Run as --> Run Configuration. And selected Environment tab. Add new environment varia...
 


[5:02] 
Но у меня томкат как сервис стартует

[5:03] 
а не из идеи

chimax [5:22 PM] 
Меня интересует один вопрос: почему в request.setAttribute("meals", MEALS)
setAttribute - это метод запроса (от пользователя), а не ответа (от сервера), т.к. логично предположить, что то, что мы отдаем наружу - это ответ, а тут получается, что запрос (edited)


[5:24] 
почему не так
response.setAttribute("meals", MEALS);

grigory.kislin [5:25 PM] 
нет. мы не отдаем наружу. мы пеердаем запрос в другой сервлет (сгенерированный по jsp)


chimax [5:26 PM] 
т.е. - это тоже запрос, но уже от контейнера сервлетов к jsp?


russell [5:28 PM] 
тоже интересовал этот вопрос, получается так что наружу то выдаeт не сервлет контроллер, а сервлет - jsp. (edited)

grigory.kislin [5:30 PM] 
froward- перенаправление внутри контейнера

chimax [5:32 PM] 
это да, т.к. jsp, как и сервлет лежат на сервере

[5:32] 
и равнозначны друг другу

[5:33] 
https://stackoverflow.com/questions/3815332/is-there-an-option-in-eclipse-like-view-servlet-in-netbeans-for-jsp-files
stackoverflow.com
Is there an option in eclipse like "view servlet" in netbeans for jsp files?
If you work in netbeans you pretty much know the context menu entry "view servlet" on an jsp file. What it does is show you the generated servlet java code from the jsp. Is there something similar...
 


[5:33] 
для тех, кто хочет убедиться, что jsp - это сервлет)


chimax [6:14 PM] 
Покажите хоть что у кого получилось, как выглядит таблица с выводом еды, какой дизайн и тд

Дима Жуков [6:17 PM] 
uploaded this image: IMG_20171105_221610.jpg
Add Comment



Дима Жуков 
[6:17 PM] 
В екплорере :muscle:

chimax [6:17 PM] 
Отлично

[6:18] 
покажите, не стесняйтесь)

Nick [6:39 PM] 
uploaded and commented on this image: Screenshot.png
1 Comment
Выглядит ужасно, но работает



chimax [6:40 PM] 
Отлично - главное, что работает

Vladimir_X [6:40 PM] 
Так большинство скорее всего делало по "Пример: Simple CRUD using Servlet/JSP", так что внешний вид будет почти одинаковым)


Дима Жуков 
[6:40 PM] 
Дату сказали выводить без T. Поправить надо б

anpotashev [6:40 PM] 
http://topjava.arh.net.ru/meals

russell [6:44 PM] 
https://topjava12.slack.com/archives/C7UFKFCMC/p1509900031000011
Aleksandr N Potashev
http://topjava.arh.net.ru/meals
Posted in #hw1Nov 5th at 6:40 PM


[6:45] 
поделись как на сервер скинул

anpotashev [6:45 PM] 
Это у меня дома

russell [6:47 PM] 
сложно поднять?

anpotashev [6:48 PM] 
Нужен реальный ip


russell [6:48 PM] 
статический?


anpotashev [6:48 PM] 
да

[6:48] 
внешний статический

russell [6:49 PM] 
а сколько такое чудо стоит


anpotashev [6:49 PM] 
У нас 50 р / месяц

vch [6:51 PM] 
статический не обязательно. Чисто показать- можно и на динамическом.
Главное, чтобы ip был реальный внешний, а не NAT

russell [6:54 PM] 
а в сети нет таких сервисов, чтобы варник можно было кинуть и юзать быстро и не сложно


[6:55] 
пусть на их поддомене

anpotashev [7:08 PM] 
Можно, думаю, найти впн и через ssh пробрасывать порт с твоего локального сервера.

fbochkarev [7:08 PM] 
@russell надо конечно с техподдержкой хостинга разговаривать, а так можно дешевый vsp сервер попробовать арендовать (edited)


vsimonov [7:27 PM] 
по какому принципу раскраску делаете? (edited)

anpotashev [7:28 PM] 
Красный, если exeeded, зеленый в противном случае.


vsimonov [7:31 PM] 
сам делал?
Aleksandr N Potashev
http://topjava.arh.net.ru/meals
Posted in #hw1Nov 5th at 6:40 PM


[7:35] 
стоп стоп. Если прогонять через наши методы то лист будет из 2-х позиций. А тут у всех полный листиз 6-ти. Или тут нужно сверять наличия дней в двух списках на наличие?
Aleksandr N Potashev
Красный, если exeeded, зеленый в противном случае.
Posted in #hw1Nov 5th at 7:28 PM

Valery [7:41 PM] 
>Если прогонять через наши методы то лист будет из 2-х позиций
В ТЗ сказано:
>1.2.3 Список выводим БЕЗ фильтрации по startTime/endTime


vsimonov [7:42 PM] 
ага, тоесть я от балды делаю свой список

russell [7:43 PM] 
введи LocalDateTime.MIN LocalDateTime.MAX (edited)


anpotashev [7:53 PM] 
Можно свой сайт разместить в onion. Нужен только torbrowser


[7:53] 
Сделал по этой инструкции https://tor4rus.wordpress.com/kak-sozdat-svoi-site-v-seti-tor/
о торч.ру komok
Как создать свой сайт в сети Tor
открыв файл hostname, увидим адрес созданного в домене .onion сайта, типа: 4qzehe2rv3y5tkyg.onion
 


grigory.kislin [9:40 PM] 
спутал...
я на http://www.host-food.ru/ покупал домен за 150р. / год
а статический ip aws бесплатно дает к своему хостингу (год бесплатный)
host-food.ru
Дешевый хостинг, от 12 рублей, php хостинг, недорогой хостинг сайтов с поддержкой PHP и MySQL, профессиональное обслуживание и бесплатный тест, регистрация доменов / HOST-FOOD
Дешевый хостинг, недорогой хостинг, качественный хостинг PHP, MySQL, размещение сайтов и бесплатный тестовый период
(edited)


chimax [9:44 PM] 
uploaded this image: мой вариант
Add Comment



Nick [10:07 PM] 
Что для frontend использовали?


chimax [10:07 PM] 
plain html + css) (edited)


Anton K. [10:31 PM] 
uploaded this image: image.png
Add Comment



russell [10:59 PM] 
uploaded this image: 2017-11-06_0259.png
Add Comment



vch [11:02 PM] 
Уже и сортировка появилась... 
Вы такими темпами скоро весь функционал приложения сделаете самостоятельно.


chimax [11:12 PM] 
вижу, что кто-то сделал таблицу через table, а кто-то div'ами

russell [11:21 PM] 
а кто дивами? кроме тебя. )

chimax [11:22 PM] 
я подумал, что ты

russell [11:24 PM] 
я так и думал, что ты подумаешь. это я старую зааплоудил



----- Monday, November 6th -----
Rostish [6:30 AM] 
Друзья, что значит в памяти? Без использования базы данных?

Nick [6:50 AM] 
Сейчас CRUD без базы, да


Rostish [6:56 AM] 
Я нашел решение, чтобы убрать Т, но почему-то не работает


[6:56] 
<fmt:parseDate value="${ cleanedDateTime }" pattern="yyyy-MM-dd'T'HH:mm" var="parsedDateTime" type="both" />
<fmt:formatDate pattern="dd.MM.yyyy HH:mm" value="${ parsedDateTime }" />


[6:56] 
никто не сталкивался?


vladimir.glinskikh [7:48 AM] 
added this XML snippet: Вот, что пишет в своей книге Pankaj Kumar:
Advantages of JSP over Servlets
​
* We can generate HTML response from servlets also but the process is
cumbersome and error prone, when it comes to writing a complex HTML 
response, writing in a servlet will be a nightmare. 
JSP helps in this situation and provide us flexibility to write normal
HTML page and include our java code only where it’s required.
​
* JSP provides additional features such as tag libraries, expression 
language, custom tags that helps in faster development of user views.
​
* JSP pages are easy to deploy, we just need to replace the modified 
page in the server and container takes care of the deployment. 
For servlets, we need to recompile and deploy whole project again.
​
Actually Servlet and JSPs complement each other. We should use Servlet
as server side controller and to communicate with model classes whereas 
JSPs should be used for presentation layer.
 
Add Comment Collapse



Rostish [7:59 AM] 
Как эту Т убрать, могу ли я это сделать через парсинг и форматирование в jstl? Если да, то у меня что-то не выходит


Rostish [8:09 AM] 
Если что, я разобрался


Alexander _Gubanow [8:32 AM] 
Я тоже так делал: все работает                                                                                                                                                                 <fmt:parseDate value="${meal.dateTime}" pattern="yyyy-MM-dd'T'HH:mm" var="time" type="both"/>
           <fmt:formatDate pattern="yyy-MM-dd HH:mm" value="${time}" var="parsedTime"/>
           <th style="${fstyle}">${parsedTime}</th>


vladimir.glinskikh [8:50 AM] 
@Alexander _Gubanow Оформляй текст кодом.



Ivan [10:43 AM] 
added and commented on this Java snippet
<servlet>
    <servlet-name>userServlet</servlet-name>
    <servlet-class>ru.javawebinar.topjava.web.UserServlet</servlet-class>
    <load-on-startup>0</load-on-startup>
  </servlet>
  <servlet-mapping>
    <servlet-name>userServlet</servlet-name>
    <url-pattern>/users</url-pattern>
  </servlet-mapping>
​
  <servlet>
    <servlet-name>mealServlet</servlet-name>
    <servlet-class>ru.javawebinar.topjava.web.MealServlet</servlet-class>
    <load-on-startup>0</load-on-startup>
  </servlet>
  <servlet-mapping>
    <servlet-name>mealServlet</servlet-name>
    <url-pattern>/meals</url-pattern>
  </servlet-mapping>
1 Comment Collapse
Всё работает, но в 3 строке "UserServlet" горит красным, IDEA предлагает создать класс, но класс создан (стираю строку и по подсказкам идеи пишу снова - снова становится красным)...



anpotashev [11:01 AM] 
Можешь попробовать удалить папку .idea в проекте и перезапустить ее.

russell [11:04 AM] 
было такое но с классами, не видел импортов сделал file -> invalidate caches/restart помогло попробуй


Ivan [11:12 AM] 
Удалил .idea - не помогло. "file -> invalidate caches/restart" - не успел попробовать. Сделал Refactor класса - переименовал. Красный цвет пропал, потом переименовал обратно. Всё ок. Спасибо.


chimax [11:13 AM] 
Т можно убрать в одну строчку


[11:15] 
fn:replace


Li0n13 [11:34 AM] 
uploaded and commented on this image: Screenshot_1.png
1 Comment
Пытаюсь побороть remote debug. При начале дебага получаю строчку 
`Connected to the target VM, address: 'localhost:8000', transport: 'socket'` , 
вроде как все нормально. 
В браузере `http://localhost:8080/topjava/` (пробовала варианты с/без слэша) выдает
```*HTTP Status 404 - /topjava/*
*type* Status report
*message* /topjava/
*description* The requested resource is not available.
Apache Tomcat/9.0.0.M17```



Li0n13 [11:35 AM] 
Подскажите, куда копать?


Li0n13 [11:41 AM] 
Возникает еще вопрос: куда писать `Application context` в remote?


anpotashev [11:45 AM] 
Для начала, зайди в админку http://localhost:8080/manager/ и посмотри есть-ли там вообще твое приложение


Li0n13 [11:46 AM] 
При remote не появляется.

[11:48] 
На всякий - последовательность действий такая: запускаю из командной строки `catalina jpda start`, потом дебаг в Идее.


vch [11:50 AM] 
@Li0n13 а если не делать Remote, то web-страницы работают?
Remote - это только подключение отладчика к уже работающему проекту.
А у тебя, по-моему, проблема с запуском проекта, Remote с этим не связан.


Li0n13 [11:50 AM] 
Локально все работает.

anpotashev [11:53 AM] 
а как деплоишь? Через идею?


[11:55] 
Надо скопировать твой war-файл в папку webapps томката

Li0n13 [11:57 AM] 
Да-да, кажется, поняла. Надо задеплоить через админку (главное - не из Идеи), а потом подключиться дебагом. Пробую...


[11:59] 
Вопрос решен. Спасибо за подсказку. Ключевая фраза: *Remote - это только подключение отладчика к уже работающему проекту.*

kadmser [12:04 PM] 
uploaded this image: qw.png
Add Comment



kadmser 
[12:05 PM] 
Почему постоянно у меня не видит переменную установленную в атрибуты?


[12:05] 
подскажите


vch [12:06 PM] 
@kadmser А должно? Как я понимаю, всё работает, только Idea жалуется?

kadmser [12:08 PM] 
не работает. Я на этом моменте застрял. Выводит только названия столбцов в таблице


[12:08] 
переменная не пустая


vch [12:10 PM] 
@kadmser значит всё же пустая... Надо сервлет изучать.
Но то, что Idea не видит переменную - с этим никак не связано. Она и не должна видеть.


chimax [12:10 PM] 
а у переменных из сервлета и в jsp названия совпадают?


kadmser [12:11 PM] 
Да конечно. Менял уже пробовал много раз


chimax [12:12 PM] 
геттеры в классе MealWithExceed есть?


kadmser [12:12 PM] 
lf


[12:12] 
да

chimax [12:13 PM] 
<c:forEach var="meal" items="${meals}">


[12:13] 
у меня все также

[12:13] 
попробуй через bean сделать


[12:14] 
попробуй просто вывести в ручную без цикла пару значений

[12:14] 
дату и описание


[12:14] 
видит он твой класс

Дима Жуков [1:16 PM] 
Ребята вы id Mealу в конструкторе проставляете? Или финал убрали и сеттеры сделали?

chimax [1:19 PM] 
при создании объекта в конструкторе передаем id (edited)

Few [1:19 PM] 
Сеттер

Дима Жуков 
[1:19 PM] 
А где объект создаёте? В сервлете?


chimax [1:19 PM] 
почему


Ivan [1:19 PM] 
@kadmser У меня тоже идея в JSP не видит переменную, а вот на вступительном задании, когда по аналогии делал видела, что-то мы упускаем.
Но! при этом всё работает.

chimax [1:19 PM] 
наверно, в сервлете, а потом передаются в круд (edited)

[1:21] 
https://github.com/spring-projects/spring-data-jpa/blob/master/src/main/java/org/springframework/data/jpa/repository/support/SimpleJpaRepository.java
GitHub
spring-projects/spring-data-jpa
spring-data-jpa - Simplifies the development of creating a JPA-based data access layer.
 


[1:21] 
обратите внимание на реализацию save

[1:21] 
create и update объеденены в один метод save

Дима Жуков [1:23 PM] 
Круд дао класс ты имеешь в виду?

chimax [1:24 PM] 
новый объект создаешь в сервлете, а потом передаешь в круд (edited)


Дима Жуков [1:24 PM] 
Ну это да. А айдишник в сервлете генеришь?


Few
[1:25 PM] 
По аналогии с бд у меня dao рулит id-шниками


[1:25] 
Другого не придумал

chimax [1:25 PM] 
idки можно генерить в dao реализации


Дима Жуков [1:25 PM] 
Он же в конструкторе у тебя

chimax [1:25 PM] 
через атомарный объект


Few [1:26 PM] 
Поэтому сеттер


chimax [1:26 PM] 
а вот тут другой момент - конструтора должно быть два))


fbochkarev [1:26 PM] 
Почему может быть 500 ошибка?

chimax [1:26 PM] 
один с id, а другой без


[1:26] 
тот, который без id внутри себя вызывает тот, который с id и передает в него id


russell [1:27 PM] 
А как же пустой по стандарту джава бина


Дима Жуков [1:27 PM] 
Ну это да

[1:27] 
Ну хз правильно это или нет

chimax [1:27 PM] 
у нас тут полубин) шутка (edited)

Few
[1:31 PM] 
Это уже несколько зависимая от хранилища реализация получается

chimax [1:33 PM] 
а кто какие названия для crud использовал?

Дима Жуков 
[1:33 PM] 
Может какой то шаблон билдер применить?) Эх тянет меня на шаблоны какие нить. Передавать параметры и там билдеть)


chimax [1:33 PM] 
можно и билдер

[1:33] 
а то там конструктор будет гиганстким)

[1:34] 
https://habrahabr.ru/post/86252/
Хабрахабр
Использование паттерна Builder в случае, когда мы сталкиваемся с конструктором с многими параметрами
Статья представляет вольный перевод главы из книги Effective Java, Second Edition by Joshua Bloch В статье рассматриваются 3 альтернативных подхода к упрощению... (50 kB)


Дима Жуков 
[1:35 PM] 
Ну симпатично должно быть


chimax [1:37 PM] 
какое название для метода использовали для получения элемента: get, find, read? (edited)

[1:37] 
https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html#findById-ID-


[1:38] 
тут find используется

Дима Жуков 
[1:38 PM] 
Get


Ivan [2:22 PM] 
uploaded and commented on this image: 1.bmp
1 Comment
Я правильно понимаю, что это тот минимум, который надо реализовать, а дальше красота и Optional?



Few
[2:24 PM] 
перебор не нужно, его по цвету понятно

Ivan [2:24 PM] 
O, точно. Спасибо.

Few
[2:24 PM] 
а так, да, это основное задание

Ivan [4:05 PM] 
А кто сделал CRUD в памяти. Как правильнее? - сделать интерфейс репозитория и его имплементацию через ConcurrentHashMap в отдельном package, или как-то иначе?


vch [4:08 PM] 
@Ivan а зачем в отдельном package?

Ivan [4:10 PM] 
Просто в Util положить?

russell [4:10 PM] 
Можно в утилитах создать DbMock extends ConcurrentHashMap

vch [4:11 PM] 
@Ivan а почему Util? dao или repository как-то более традиционны.

russell [4:11 PM] 
нет DbMock к дао отношения не имеет


Дима Жуков [4:11 PM] 
Он наверняка подумал даже без dao


russell [4:12 PM] 
это тупо аналог базы

Дима Жуков [4:12 PM] 
Просто в util

[4:12] 
Какой то package то создать надо конечно

Viktor [4:30 PM] 
Все зависит от реализации, если все отличие ДАО с базой от ДАО с мапой в  типе переменной, то зачем кидать в какой-то утилитарный пакет? Это же тот же самый ДАО просто хранилище не БД.
Ruslan Shakirov
нет DbMock к дао отношения не имеет
Posted in #hw1Nov 6th at 4:11 PM

[4:31] 
стоп я понял, вы говорите о наследнике мапы, а Иван спрашивал про реализацю ДАО с мапой


Дима Жуков [4:37 PM] 
В первой своей версии я создал класс наследник от ArrayList<Meal> переопледелил там add, set как с листом своим. Синхронизировал и работал через дао с ним) но меня убедили отказаться от затеи :-)


[4:38] 
Я его ещё и синглтоном сделал :-)

vch [4:39 PM] 
@Дима Жуков а что плохого в синглтоне?


Дима Жуков 
[4:39 PM] 
Ничего просто смайлик

chimax [5:19 PM] 
Синглтон признан антипаттерном

Дима Жуков 
[5:20 PM] 
Ну да я слышал про это

vch [5:22 PM] 
@chimax Сервлеты, которые сейчас используем - это синглтоны. Сервисы и др. компоненты, которые мы будем создавать на следующих занятиях в спринге - синглтоны.
Странно это всё...

chimax [5:23 PM] 
Странно-то странно, но из-за того, что синглтон пихали куда только не поподя, а при этом не думали о многопоточности... ну ты понял)

Дима Жуков [5:24 PM] 
Я погуглил и сделал синглтон для многопоточности))

[5:25] 
Там много рецептов всяких

vch [5:25 PM] 
Ну да, согласен, если в нашем случае inmemory базу хранить не в синглтоне, то в многопоточном режиме будет работать очень быстро. Вот только у каждого запроса будет свой вариант базы... Зато быстро.

Elda87R [6:45 PM] 
Товарищи, я помню обещали дать учебный ключик для IDEA на первом занятии. Где его найти, не подскажете? А то пробная лицензия кончилась... :disappointed:


Vangelis [7:16 PM] 
@Elda87R в профиле на javaops.ru посмотри, там должен быть ключик

Denis1989 [8:04 PM] 
Народ, кто-нибудь данные на валидность проверял ? Которые с jsp-шек приходят.

chimax [8:04 PM] 
надо проверять

Tanya [8:06 PM] 
в дз не требовалось, валидация отдельно будет


chimax [8:07 PM] 
тогда ок


Denis1989 [8:08 PM] 
Да и html5 type не дает в форму лишнего забить.


Valery [8:15 PM] 
html5 защищает от sql injection?


Дима Жуков [8:16 PM] 
Он вообще ни от чего не защищает


[8:17] 
Так немножко ограничевает)

Elda87R [8:18 PM] 
@Vangelis Спасибо. Нашел!


timur.dzh [8:35 PM] 
как вытащить meal.dateTime в JSTL без свистоплясок с добавлением функций в  /WEB-INF/ ?


Дима Жуков [8:36 PM] 
Добавляешь библиотеку EL в jsp. И for each


[8:36] 
Ааа

[8:36] 
Сорри

[8:36] 
Дата ж

russell [8:36 PM] 
добавь методы getLocalDate() getLocalTime() в дто там ${meal.localDate} ${meal.localTime} (edited)

chimax [8:38 PM] 
jsp сама подхватит переменные через геттеры


Valery [8:47 PM] 
я пытаюсь убрать букву Т из даты-времени через DateTimeFormatter в jsp. 
объявил переменную
<%! DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm"); %>
но в этой строчке - ${item.dateTime.format(formatter)} - получаю NullPointerException: formatter


Дима Жуков 
[8:47 PM] 
Надо ещё требования к дз распечатывать и прям галочкой отмечать проходит или нет.. не знаю как вы я эти требования прочитал что запомнил то и сделал... Меня уже проверяющие наверное ненавидят)) Прям как javarush валидатор) и в письме надо указать прям вот распечатай и отметь галочкой что совпадает)


chimax [8:49 PM] 
используй fn:replace

russell [8:50 PM] 
а в джсп в ел же нельзя методы вызывать кроме геттеров, кажется (edited)

chimax [8:50 PM] 
можно, через скриплеты (edited)


russell [8:51 PM] 
вызывай тогда из скриплета

chimax [8:51 PM] 
но это плохо


Дима Жуков 
[8:51 PM] 
Скриптлеты за это ж бьют вроде

russell [8:51 PM] 
${item.dateTime.format(formatter)}  это же не скриплет

Valery [8:51 PM] 
как в скриплет передать переменную item?

chimax [8:51 PM] 
да же не думай


Дима Жуков 
[8:51 PM] 
<%%>


chimax [8:52 PM] 
это тоже самое, как писать html в java файле

[8:52] 
акстись)

[8:52] 
Таня тебе этого не простит

Valery [8:52 PM] 
писать метод форматирования в классе еды можно. но для нового формата каждый раз придется новый метод


[8:53] 
Таня меня не проверяет

vch [8:53 PM] 
@chimax После Димы, думаю, ей уже ничего не страшно.

chimax [8:53 PM] 
${fn:replace(meal.dateTime, 'T', ' ')}

[8:53] 
и все

Дима Жуков [8:53 PM] 
:grinning:

chimax [8:54 PM] 
можно еще, конечно свой кастомный тег написать...

Valery [8:54 PM] 
>${fn:replace(meal.dateTime, 'T', ' ')}
а если я захочу название месяца, а не номер? форматтер это позволит, а замена - нет


russell [8:55 PM] 
https://topjava12.slack.com/archives/C7UFKFCMC/p1509994295000751 если ты ее в аттрибут засунул, то в скриплете она доступна из реквеста
Valery Trebukh
как в скриплет передать переменную item?
Posted in #hw1Nov 6th at 8:51 PM


Дима Жуков [8:55 PM] 
Кастомный тэг это интересно

chimax [8:55 PM] 
можно на все случаи жизни подбирать решение


Valery [8:55 PM] 
замена на пробел - это костыль


chimax [8:55 PM] 
потом переделаешь, если надо будет (edited)

russell [8:57 PM] 
а почему ты это в серлете не сделаешь, а туда уже отформатированную не закинешь

Valery [8:58 PM] 
и для каждого нового формата писать новый метод?


russell [8:59 PM] 
а джсп по другому?

chimax [9:01 PM] 
первое правило - лишь бы работало


Valery [9:01 PM] 
jsp - это конечная станция.

Valery [9:18 PM] 
а чем плохи скриплеты?
похоже на php получается )

Дима Жуков [9:21 PM] 
Во вью код. За такое и в пхп наваляют


[9:21] 
Наверное


chimax [9:23 PM] 
плохи тем, что фронтендер не обязан знать все прелести бэкэнда (edited)

Дима Жуков 
[9:24 PM] 
Но я спорить не буду все имеет место быть! Это творчество. Как это сказать я не консерватор? Консерватор за правила же (edited)


chimax [9:24 PM] 
раньше, до jsp - html код писали прямо в java классах


Valery [9:24 PM] 
Declarations предназначены для определения переменных и методов на языке скриптов, которые в дальнейшем используются на странице JSP. 
У меня такая переменная не видна в любом месте на странице jsp. Объявляю <%! String s = "Hello, World!"; %>, но приходит пустая строка когда обращаюсь к ней.


chimax [9:25 PM] 
потом сделали jspи стали писть java в html


[9:25] 
потом и от этого отказались

russell [9:25 PM] 
https://topjava12.slack.com/archives/C7UFKFCMC/p1509996290000372
странно должна быть видна
Valery Trebukh
Declarations предназначены для определения переменных и методов на языке скриптов, которые в дальнейшем используются на странице JSP. 
У меня такая переменная не видна в любом месте на странице jsp. Объявляю <%! String s = "Hello, World!"; %>, но приходит пустая строка когда обращаюсь к ней.
Posted in #hw1Nov 6th at 9:24 PM


chimax [9:26 PM] 
был бардак


Valery [9:26 PM] 
а как теперь подружить backend и frontend?


[9:26] 
если не jsp?


chimax [9:26 PM] 
через шаблонизаторы


net_ [9:27 PM] 
added and commented on this Plain Text snippet
<%@ taglib uri="http://sargue.net/jsptags/time" prefix="javatime" %>
<!-- some stuff there -->
<javatime:format value="${meal.dateTime}" pattern="yyyy-MM-dd" />
<javatime:format value="${meal.dateTime}" pattern="HH:mm" />
1 Comment

кому интересно то LocalDateTime отформатировал так:



chimax [9:27 PM] 
jsp, Thymeleaf и тд

russell [9:27 PM] 
react, angular


[9:28] 
https://topjava12.slack.com/archives/C7UFKFCMC/p1509996290000372
а как ты к ней обращаешься


Valery [9:29 PM] 
added this Java snippet
<%! String formatter = "yyyy-MM-dd HH:mm"; %>
${item.getFormattedDateTime(formatter)}
Add Comment



Valery [9:30 PM] 
${item.getFormattedDateTime("yyyy-MM-dd HH:mm")} - работает

[9:31] 
с доп переменной - нет

Дима Жуков [9:32 PM] 
Они не видят друг друга $ и скриптлеты поди

[9:33] 
Объявить переменную <c:set var и туда в вплью скриптлет этот. Может так?)

[9:34] 
Хотя скриптлет тада зачем


russell [9:35 PM] 
<%= request.getAttribute("item).getFormattedDateTime(formatter) %>

Дима Жуков [9:37 PM] 
Давайте не будем скриптлетчиками) так поиграться можно конечно

Valery [9:39 PM] 
@russell, если item в кавычках, то идея не понимает метод getFormattedDateTime.
item мне не приходит в реквесте. это объект списка еды.


russell [9:40 PM] 
нет ну напиши что тебе приходит, имя аттрибута какое

[9:41] 
все понял о чем ты

Valery [9:42 PM] 
ладно. мне достаточно такого решения:


Valery [9:42 PM] 
added this Java snippet
${item.getFormattedDateTime("yyyy-MM-dd HH:mm")}
Add Comment

Valery [9:42 PM] 
цели я добился - форматирование задается на фронтэнде

Dmitry Neustupov [9:44 PM] 
Коллеги, подскажите, что может быть не так? Не форматится датаТайм, хоть убейся.


Dmitry Neustupov [9:44 PM] 
added this Java snippet
String inputModified = request.getParameter("localDateTime").replace ( " " , "T" );
    DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-ddTHH:mm");
    LocalDateTime localDateTime = LocalDateTime.parse(inputModified, formatter);
Add Comment



Dmitry Neustupov [9:45 PM] 
Дата приходит в таком виде - 1992-12-12T12:12

Valery [9:46 PM] 
в патерне убери букву Т

[9:47] 
я не понимаю зачем тебе replace в первой строчке


[9:47] 
ты все пробелы меняешь на Т?

russell [9:49 PM] 
replace вроде только первый replaceAll все


Дима Жуков [9:50 PM] 
А что плохого в пом добавить зависимость одну и выводить это без проблем вообще?

Dmitry Neustupov [9:50 PM] 
в паттерне убрал "Т", видимо уже глаз замылен - пропустил, дата приходит с "Т" посередине - пытаюсь убрать


[9:50] 
так мне не для вывода - вывод я сделал


Дима Жуков 
[9:50 PM] 
Там вроде в ссылках было на стековерфлоу


Dmitry Neustupov [9:50 PM] 
мне для получения из формы надо

[9:51] 
из формы приходит в непотребном виде, надо в поле meal воткнуть, и не форматится...

Дима Жуков [9:51 PM] 
Ну там же и про это рассказывается вроде


russell [9:53 PM] 
а в инпуте тип у тебя какой


Дима Жуков [9:53 PM] 
HTML 5 шикарен

Dmitry Neustupov [9:54 PM] 
@russell type="datetime-local"


vch [9:55 PM] 
@Дима Жуков особенно шикарно использовать браузеры, не поддерживающие html5 типы.
И ходить на сайты, разработчики которых свято уверены, что данные могут прийти только в 1 формате - который они заложили.



russell [9:58 PM] 
DateTimeFormatter.ISO_LOCAL_DATE_TIME;

timur.dzh [10:03 PM] 
одно смущает: какого рожна JSTL может смотреть приватные поля класса Meals. И тут Reflections?


vch [10:04 PM] 
@timur.dzh Вроде геттеры нужны... У тебя без геттеров работает?

timur.dzh [10:05 PM] 
да

chimax [10:06 PM] 
как оно без геттеров работает?

timur.dzh [10:06 PM] 
<td><c:out value="${meal.description}" /></td>
           <td><c:out value="${meal.calories}" /></td>


Dmitry Makarov [10:07 PM] 
@timur.dzh, просто get не учитывается

[10:07] 
попробуй удали метод увишиь что не сработает

chimax [10:07 PM] 
я выше писал, что геттеры явно не нужны

[10:08] 
если они есть в коде, то jstl их подхватывает

timur.dzh [10:08 PM] 
и вот так


[10:08] 
<tr class="<c:out value="${meal.exceed ? 'redtext' : 'bluetext'}" />"


chimax [10:08 PM] 
все верно


[10:08] 
а теперь закомменти геттеры в сущности и еще раз запусти код

timur.dzh [10:08 PM] 
getExceed у меня нет. класс не менял а он там прайват


russell [10:08 PM] 
странно


chimax [10:09 PM] 
а как ты его тогда используешь в MealUtil?


Dmitry Makarov [10:09 PM] 
для тех кто не понял как отображать LocalDateTime в задании есть ссылка https://stackoverflow.com/questions/35606551/jstl-localdatetime-format
stackoverflow.com
JSTL LocalDateTime format
I want to format my java 8 LocalDateTime object in "dd.MM.yyyy" pattern. Is there any library to format ? I tried code below but got convertion exception. <fmt:parseDate value="${date}" pattern...
 


russell [10:09 PM] 
isExceed было


chimax [10:09 PM] 
для idea - это геттер

[10:09] 
проверьте, нажав alt + insert

russell [10:10 PM] 
из за джава бина, как так


chimax [10:11 PM] 
isExceed - это геттер


[10:11] 
и jstl его понимает

[10:12] 
закомментируй этот метод и все рухнет

russell [10:12 PM] 
а я заранее переименовал


chimax [10:12 PM] 
зря


[10:12] 
это рекомендации при рефакторинге

timur.dzh [10:12 PM] 
public class MealWithExceed {
   private final LocalDateTime dateTime;

   private final String description;

   private final int calories;

   private final boolean exceed;

   public MealWithExceed(LocalDateTime dateTime, String description, int calories, boolean exceed) {
       this.dateTime = dateTime;
       this.description = description;
       this.calories = calories;
       this.exceed = exceed;
   }

   @Override
   public String toString() {
       return "UserMealWithExceed{" +
               "dateTime=" + dateTime +
               ", description='" + description + '\'' +
               ", calories=" + calories +
               ", exceed=" + exceed +
               '}';
   }
}


[10:13] 
кто из них геттер?

Dmitry Makarov [10:14 PM] 
ты после удаления метода задеплоил проект?


chimax [10:14 PM] 
а у тебя программа запускается?


timur.dzh [10:14 PM] 
да


chimax [10:14 PM] 
сделай clear


[10:14] 
а потом задеплой

timur.dzh [10:16 PM] 
ХААА и правда


[10:16] 
пардон

chimax [10:16 PM] 
nice


vch [10:17 PM] 
Эх, а я уж собрался удалять все геттеры из своих приложений, раз они не нужны...

vsergeev [10:55 PM] 
Кто-нибудь поборол параметры в URL после add/update/delete?


russell [11:05 PM] 
в смысле, а что с ними не так

chimax [11:07 PM] 
надо что бы окончание урла было без параметров

[11:07] 
а просто /meals

[11:07] 
или /edit

[11:07] 
или /add

russell [11:19 PM] 
а это разве борется

chimax [11:22 PM] 
да

vsergeev [11:30 PM] 
такс, update и add у меня идет через doPost и url чистый. Вот с delete проблема


chimax [11:31 PM] 
это спицифика post - у него аргументы урла не идут в открытом виде


vsergeev [11:31 PM] 
Скорее всего лечится редиректом после удаления, но при этом надо еще заново отрисовать еду


[11:31] 
или как-то delete можно направить в doPost? :thinking_face:

chimax [11:44 PM] 
или все через post делать

vsergeev [11:52 PM] 
Ну тогда можно из "удалить" сделать не ссылку, а форму из одной кнопки чтобы прямо из JSP летело в doPost (edited)


chimax [11:54 PM] 
или как-то редирект делать


Valery [11:56 PM] 
в задании требуется делать все постом?

chimax [11:57 PM] 
нет, но есть рекомендации...


Valery [11:59 PM] 
пусть будет гет с параметрами. сервлет отработает, удалит строчку и в конце редирект на обновленную таблицу. пользователь атрибуты видеть не будет в строке урла - страница быстро обновляется



----- Tuesday, November 7th -----
chimax [12:01 AM] 
response.sendRedirect("meals");

vsergeev [12:05 AM] 
Да, делал так, но накосячил. Пустая таблица рисовалась после редиректа.

[12:08] 
А косяк был в том, что редиректил не на сервлет (meals) а сразу на meals.jsp. Естественно атрибутов не было и ничего не рисовалось.

chimax [12:09 AM] 
я тоже только что отредиректил

[12:10] 
не вышло пока


[12:11] 
наверно, надо учесть вариант без атрибутов для вывода таблицы

[12:13] 
выводится только таблица, но без содержимого и даже css не подхватилось

vsergeev [12:18 AM] 
ну у меня если ?action нет, то просто идем выводить записи с атрибутами

Argentum_kuh [1:00 AM] 
Народ, подскажите что делать? У меня Git при попытке коммита переходит в состояние detached HEAD. Как уйти от этого?


vladimir.glinskikh
[3:08 AM] 
@Argentum_kuh http://pr0git.blogspot.com/2015/03/git.html (edited)


[3:10] 
@Argentum_kuh Для Git есть отдельный канал. #git. Все вопросы по git задаются там.

Rostish [9:18 AM] 
Получается, чтобы добавлять новые приемы пищи, нам нужно убирать файнал атребуты? Иначе не сделать сеттеры, если я правильно понял.

Дима Жуков [9:20 AM] 
Финальные уберешь по-моему могут быть проблемы с параллельностью. Надо оставлять поидее вроде.

vch [9:21 AM] 
@Дима Жуков а какие проблемы с параллельностью?


Rostish [9:22 AM] 
А как в финальные изменения вносить?)

Дима Жуков 
[9:22 AM] 
Ну в статье которой chimax присылал вчера про билдер. Там три подхода рассматривалось. И там говорилось.

Rostish [9:22 AM] 
можешь статью скинуть?


Дима Жуков 
[9:23 AM] 
Ок

[9:25] 
https://habrahabr.ru/post/86252/
Хабрахабр
Использование паттерна Builder в случае, когда мы сталкиваемся с конструктором с многими параметрами
Статья представляет вольный перевод главы из книги Effective Java, Second Edition by Joshua Bloch В статье рассматриваются 3 альтернативных подхода к упрощению... (50 kB)


[9:25] 
К сожалению, JavaBeans паттерн не лишен серьезных недостатков. Поскольку строительство разделено между несколькими вызовами, JavaBean может находиться в неустойчивом состоянии частично пройдя через конструирование. Попытка использования объекта, если он находится в неустойчивом состоянии может привести к ошибкам, которые далеки от кода, содержащего ошибку, следовательно, трудными для отладки. Также JavaBeans паттерн исключает возможность сделать класс неизменным(immutable), что требует дополнительных усилий со стороны программиста для обеспечения безопасности в многопоточной среде.


[9:26] 
ну правда если принть доп усилия то норм



[9:26] 
:grinning:


vch [9:26 AM] 
Это не наш случай, мне кажется. Entity без сеттеров невозможен.
Другое дело, что может быть проблема, если в 2 параллельных запросах мы читаем и изменяем данные в нашей mockDB - тогда да, согласен.
По уму, надо из репозитория возвращать не объект, который там хранится, а его копию.
Но почему-то мне кажется, что так никто не сделал в HW1.


Rostish [9:27 AM] 
а с чем лучше работать в качестве данных в нашей mockDB. Meal или MealWithExceed

[9:28] 
?

Дима Жуков 
[9:28 AM] 
Ну кстати это по-моему не билдер паттерн. А другой.... Но авторам статьи виднее.


[9:28] 
А что за mockDB?

Rostish [9:28 AM] 
ну типа заглушка


[9:28] 
коллекция map или еще что-нибудь

[9:29] 
в ДЗ ведь написано сделать без реальной дб

vch [9:29 AM] 
@Rostish а есть выбор? Entity - это Meal. 
А MealWithExceed - это Transfer Object, просто временный объект для отображения данных

Rostish [9:29 AM] 
вообще логично, я тоже так думал


Дима Жуков [9:30 AM] 
Наверное буду ждать четверга уже.. а там все и прояснится. Разбор то будет


Rostish [9:31 AM] 
по факту, если честно, мне вот легче было бы сделать с реальной БД)
с моком в виде мапы я немного встрял, так как, например, id в реальной бд идет автоинкрементом


[9:31] 
и париться ненадо

vch [9:32 AM] 
@Rostish Зато позволяет прикоснуться  к проблемам реализации СУБД.
А реальных баз ещё много будет.


Дима Жуков [9:34 AM] 
@vch а ты сеттеры сделал?

vch [9:35 AM] 
Конечно. 
Нам ведь можно делать всё что угодно, запретов нет.


Tanya [9:38 AM] 
"По уму, надо из репозитория возвращать не объект, который там хранится, а его копию.
Но почему-то мне кажется, что так никто не сделал в HW1."
ну так не требовалось вообще что-то возращать при сохранении/апдейте

Дима Жуков 
[9:39 AM] 
наверное при гете имеется в виду копию возвращать? я так понял)))

Rostish [9:39 AM] 
Кстати, в ДЗ странно написано, что нужно добавить ид в непосредственно классы, а если делать с мапой, то получится два ид как будто


Дима Жуков 
[9:41 AM] 
мне не нравится ни один 3х подходов этой статьи почему то... мне кажется есть что то другое.

vch [9:43 AM] 
@Tanya как это?
`Сделать форму редактирования в JSP`
Т.е. надо запросить из БД запись, а потом сохранить измененную.
Соответственно, когда Meal вышел из слоя DAO на уровень сервиса/сервлета, то DAO уже потерял контроль над объектом и не может защитить его от многопоточных изменений.
Вроде на эту тему было что-то в `Вопросах по HW1`


[9:44] 
@Дима Жуков хотя нет, я ошибся - в HW1 я без сеттеров обошёлся. Что автоматом избавило от проблем с многопоточным изменением данных.

Дима Жуков [9:44 AM] 
ну из этих 3 я бы выбрал сеттеры не задумываясь если честно)


[9:45] 
@vch несколько конструкторов?


vch [9:47 AM] 
@Дима Жуков да. А для возврата из DAO очень удобен конструктор копирования: ` public Meal(Meal meal) {`

Rostish [9:48 AM] 
Я  возможно задаю тупой вопрос, но как редактировать уже существующую запись без сеттеров?


[9:48] 
вот есть у меня прием на 500 калорий, а надо на 490

Дима Жуков 
[9:48 AM] 
заменить обьект

Rostish [9:48 AM] 
Я просто заменяю


[9:48] 
?

Дима Жуков [9:48 AM] 
весь


[9:48] 
ну а че

Rostish [9:48 AM] 
Ну ладно, я тоже так подумал

Tanya [9:55 AM] 
@vch
"Т.е. надо запросить из БД запись, а потом сохранить измененную." 
т.е. в session найти, поменять и вернуть? такого варианта я не видела
ну и в дз указано, что не использовать session

Дима Жуков [10:02 AM] 
наверное в личку написал.. ребята нам тоже интересно продолжение!)

vch [10:05 AM] 
@Tanya А причём тут session? 
У нас как минимум в пределах приложения Meal безконтрольно и многопоточно перемещается по слоям.
И давать доступ к изменению объекта, напрямую находящемуся в базе - немножко рискованно.

@Дима Жуков ну мы-то от нечего делать, к HW1 напрямую не относится. А у тебя, как я понимаю, ещё HW1 недоделано...


Дима Жуков [10:08 AM] 
@vch Проверки классная вещь, рекомендую. Я сначала так сделал, потом по-другому переделал) но Meal создается не правильно, не по требованиям дз


Tanya [10:11 AM] 
@vch ты сейчас всех запутаешь :slightly_smiling_face:
и мне придется продираться в дз на каждом слое через десятки проверок и копий
@Дима Жуков мы с @vch еще на топджава10 неплохо пообщались на проверках дз, думаю больше не стоит :wink:


vch [10:14 AM] 
@Tanya а что плохого в том, чтобы запутать всех?
И, насколько я понял, @Дима Жуков уже и без меня с этим успешно самостоятельно справился, судя по его отзывам о проверках...

Tanya [10:23 AM] 
@vch а что в этом хорошего?
тут учебный проект, а не просто потрындеть (edited)

Rostish [10:23 AM] 
Народ, помогите лучше мне

[10:23] 
Как счетчик реализовать

[10:23] 
на базе листа с meal

[10:24] 
у меня сейчас есть метод инициализации DB

[10:24] 
public static void initDB() {
       List<Meal> meals = Arrays.asList(
               new Meal(LocalDateTime.of(2015, Month.MAY, 30, 10, 0), “Завтрак“, 500, 1),
               new Meal(LocalDateTime.of(2015, Month.MAY, 30, 13, 0), “Обед“, 1000, 2),
               new Meal(LocalDateTime.of(2015, Month.MAY, 30, 20, 0), “Ужин“, 500, 3),
               new Meal(LocalDateTime.of(2015, Month.MAY, 31, 10, 0), “Завтрак“, 1000, 4),
               new Meal(LocalDateTime.of(2015, Month.MAY, 31, 13, 0), “Обед“, 500, 5),
               new Meal(LocalDateTime.of(2015, Month.MAY, 31, 20, 0), “Ужин“, 510, 6)
       );

       for (int i = 0; i < meals.size(); i++) {
           DB.put(meals.get(i).getUserid(), meals.get(i));
       }

   }


[10:25] 
и теперь у меня несколько вопросов, например мы добавили новый прием, метод будет простой

[10:25] 
просто кладем еще одну запись в map и все

[10:26] 
но как присвоить новый записи правильный юзер id

[10:26] 
новой*


gslava [10:28 AM] 
Приватное поле id и при методе add() делаешь id++

[10:28] 
Обёртка над ArrayList


[10:29] 
Или над чем-то другим - чтобы объект dao был в итоге


Ivan [10:38 AM] 
added and commented on this Java snippet
public class Meal {
​
  private final Long id;
​
  private static Long counter = 1L;
​
  private final LocalDateTime dateTime;
​
  private final String description;
​
  private final int calories;
​
  public Meal(LocalDateTime dateTime, String description, int calories) {
    this.dateTime = dateTime;
    this.description = description;
    this.calories = calories;
    this.id = counter++;
  }
1 Comment Collapse
Сделал так, пинайте.



Maksim [10:47 AM] 
Всем привет. Подскажите пожалуйста. Операционка Linux. Сделал переменную TOPJAVA_ROOT=/home/maximus/IdeaProjects/topjava/, но когда дебажу проект, пишет что TOPJAVA_ROOT_IS_UNDEFINED/log/topjava.log (No such file or directory)
1 reply 4 days ago View thread

Maksim [10:47 AM] 
В чем может быть причина?


Rostish [10:50 AM] 
А каунтер срабатывает типа каждый раз когда мы вызываем конструктор?


[10:52] 
Если мы редактируем существующуб запись, как такой случай отработает? Мы же вроде тоже вызываем конструктор, получается, что существующая запись получит новый id?


Maksim [10:54 AM] 
Пока решил так, что указал полный путь до лога.


chimax [11:11 AM] 
@Ivan "10 Не размещайте никакую логику (форматирование, счетчики) в бинах, где хранятся только данные (Meal, MealWithExceed)"



[11:11] 
счетчик сделай в другом месте

anpotashev [11:16 AM] 
@Maksim, запускаешь из идеи или отдельно?


Ivan [11:22 AM] 
@Rostish Как раз занимаюсь add/update/create (реализовал только delete), думаю проблем не будет (... != null).
@chimax А вот тут правильно, забыл - забыл. Буду править.


[11:23] 
JSP пишу руками в IDEA - медленно - знаний frontend не хватает.

chimax [11:24 AM] 
счетчик проще всего в dao сделать


[11:25] 
и при создании meal сразу присваивать id


Rostish [11:26 AM] 
Дата : <input
           type=“text” name=“dateTime”
           value=“<javatime:parseLocalDateTime pattern=“YYYY-MM-dd HH:mm” value=“${meal.dateTime}” />“/> <br/>
       <input


[11:26] 
кто скажет почему не парсит?


[11:27] 
java.time.format.DateTimeParseException: Text ‘2015-05-28 20:10’ could not be parsed at index 10


Rostish [11:45 AM] 
а надо где-то указывать что метод doPOST отрабатывает в UTF-8, а то у меня получилось внести в мой mockDB данные, но там абракадабра


[11:45] 
?


chimax [11:46 AM] 
в самом начале этого метода


[11:46] 
setCharacterEncoding("UTF-8");


Few [11:47 AM] 
request.setCharacterEncoding("UTF-8");


Rostish [11:48 AM] 
да, норм, спасибо, заработало


[11:52] 
Слушайте, как вы думаете, а можно реализовать счетчик с привязкой к параметру size моей коллекции map, которую я использую в качестве базы данных? с добавлением новой записи работает нормально, я просто делаю как-то так(*выделенным - это юзер айди*):
Meal meal = new Meal(LocalDateTime.parse(request.getParameter(“dateTime”),formatter),
               request.getParameter(“description”),Integer.parseInt(request.getParameter(“calories”)),;*MealsUtil.getDBSize()+1*);
       MealsUtil.addMeal(meal);

Или так не делается по best practise?


russell [11:55 AM] 
здесь, нужно учитывать работу с многопоточкой, так не делается, в однопоточке это было бы нормально.


Дима Жуков [11:56 AM] 
Не окажется что там объект с айди 6. Размер будет 1. А потом дойдет до 6 и что будет? Или норм


russell [11:58 AM] 
Вы в поле айди примитив или объект юзаете?


Дима Жуков [11:58 AM] 
Примитив

Belstrel
[12:09 PM] 
примитив потом в базе будет автоинкреминтироваться к тому же


[12:10] 
народ а кто как LocalDateTime в базе сохранял?

russell [12:15 PM] 
https://topjava12.slack.com/archives/C7UFKFCMC/p1510049371000463
кажется вот так Timestamp.valueOf(localDateTime);
Belstrel
примитив потом в базе будет автоинкреминтироваться к тому же
Thread in #hw1Nov 7th at 12:09 PM
(edited)
1 reply 4 days ago View thread

Rostish [12:40 PM] 
Как сделать, чтобы после delete сразу обновлялась страница и показывала уже список без? Сейчас надо переобновлять страницу, чтобы сервлет отработал с нуля.
С добавление проблемы нет, вставляется сразу, использую подобный код и что-то не идет

Rostish [12:45 PM] 
Все я понял почему)

[12:47] 
блин, в примере про симпл круд есть такой кусоок:
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
       String forward=“”;
       String action = request.getParameter(“action”);

       if (action.equalsIgnoreCase(“delete”)){
           int userId = Integer.parseInt(request.getParameter(“userId”));
           dao.deleteUser(userId);
           forward = LIST_USER;
           request.setAttribute(“users”, dao.getAllUsers()); 

Если я делаю также то ловлю NULL в строке с IF

[12:48] 
почему в примере работает

[12:48] 
случайно не потому что в index.jsp в пример есть строка <jsp:forward page=“/UserController?action=listUser” /> ?


Ivan [12:51 PM] 
@Rostish Давай меняться, у меня проблем с удалением совсем не возникло, а с добавлением мучаюсь.
 7 replies Last reply 2 days ago View thread
Rostish [12:52 PM] 
давай

Maksim [12:59 PM] 
В IDEI запускаю
Aleksandr N Potashev
@Maksim, запускаешь из идеи или отдельно?
Posted in #hw1Nov 7th at 11:16 AM


Shalukhau Dzmitry [1:47 PM] 
@Maksim Посмотри, как ты env задавал - возможно он чисто на сессию терминала действуйет. Попробуй задать глобально (попробуй в ~/.profile добавить и перезапустить X)

Maksim [1:47 PM] 
Кстати точно. Скорее всего дело в этом. Спасибо.
Shalukhau Dzmitry
@Maksim Посмотри, как ты env задавал - возможно он чисто на сессию терминала действуйет. Попробуй задать глобально (попробуй в ~/.profile добавить и перезапустить X)
Posted in #hw1Nov 7th at 1:47 PM

Shalukhau Dzmitry [1:48 PM] 
@Maksim - отпишись, а то я через property файл делал (оно как то более конфигурабельно мне показалось) (edited)

Maksim [1:48 PM] 
в bashrc добавить и перегрузиться


[1:48] 
и будет счастье

Shalukhau Dzmitry [1:49 PM] 
Сработало?


Maksim [1:49 PM] 
так с most сделал

Shalukhau Dzmitry [1:49 PM] 
Вроде bashrc только для консоли


Maksim [1:49 PM] 
не перегружался, но думаю поможет

[1:49] 
не только

[1:50] 
либо в /etc/environment


Shalukhau Dzmitry [1:53 PM] 
.bashrc - настройка console (читай man) стартует при запуске консоли. /etc/enviroment (для всех пользователей) либо ~/.profile (стартует после login)


Maksim [1:55 PM] 
сейчас проверю

vsimonov [2:04 PM] 
Народ, при удалении возникает ошибка java.lang.UnsupportedOperationException удаляю так
 String id = req.getParameter("id");
 list.remove(Integer.parseInt(id));
id передаётся. (edited)

russell [2:12 PM] 
а ты аррейлист создавал через Arrays.asList()?

vsimonov [2:13 PM] 
да
Ruslan Shakirov
а ты аррейлист создавал через Arrays.asList()?
Posted in #hw1Nov 7th at 2:12 PM


russell [2:13 PM] 
это как массив оттуда ничего нельзя удалить

[2:14] 
new ArrayList<>(Arrays.asList(1, 2));

[2:14] 
Так сделай

[2:14] 
он анмодифайбл


vsimonov [2:16 PM] 
работает,запомню Спасибо!

Maksim [2:20 PM] 
Не помогло. Ни в bashrc ни в profile
Shalukhau Dzmitry
.bashrc - настройка console (читай man) стартует при запуске консоли. /etc/enviroment (для всех пользователей) либо ~/.profile (стартует после login)
Posted in #hw1Nov 7th at 1:53 PM


[2:21] 
ладно, найду отпишусь

Shalukhau Dzmitry [2:24 PM] 
Ок


Shalukhau Dzmitry [2:57 PM] 
@Maksim добавил export TOPJAVA_ROOT=/home/ivol/topjava/src/main/ в ~/.profile. Создал /home/ivol/topjava/src/main/log, перезагрузился - заработало

Maksim [2:58 PM] 
без ковычек делал?

Shalukhau Dzmitry [2:58 PM] 
Конечно


Maksim [2:58 PM] 
я ковычки добавлял, может быть поэтому


Shalukhau Dzmitry [2:58 PM] 
Тут пробелов нет

Maksim [2:58 PM] 
ну да, без пробелов

Shalukhau Dzmitry [2:58 PM] 
Возможно ты export забыл либо забыл дирректорию log создать

[2:59] 
В кавычках должно работать

[2:59] 
Или ты идею из консоли запускаешь :slightly_smiling_face:

Maksim [2:59 PM] 
не, не из консоли

[3:00] 
самое интересное знаешь что, если в bash_rc добавить, то по идее  тоже должно работать, так как в profile сначала он прогружается

[3:00] 
сейчас без перезагрузки попробую сделать

[3:00] 
через source

Shalukhau Dzmitry [3:01 PM] 
не будет - т.к. он проверяет, запущен ли пользователь в консоли (без X)


Maksim [3:01 PM] 
понял

Maksim [3:08 PM] 
Тоже заработало


[3:08] 
спасибо дружище

[3:08] 
правда export забыл


chimax [5:39 PM] 
как использовать button без формы, например для кнопки Добавить?


russell [5:43 PM] 
<a><button></button></a> в хтмл 5 уже нельзя

[5:45] 
как вариант можно на ссылку повесить сиэсэс дисплей:блок


Maksim [5:47 PM] 
Либо сделать класс button-a и его описать как кновку

[5:47] 
*кнопку и повесить на тэг <a>

Anton K. [6:17 PM] 
сделай форму и в ней скрытый инпут

[6:17] 
и кнопка


Shalukhau Dzmitry [6:26 PM] 
Можно скриптом action добавить ( смотри onClick action).


Few [6:38 PM] 
просто ссылку оформи через css или style в виде кнопки


[6:39] 
https://www.w3schools.com/css/css_link.asp
w3schools.com
CSS Styling Links
Well organized and easy to understand Web building tutorials with lots of examples of how to use HTML, CSS, JavaScript, SQL, PHP, and XML.


Few [6:45 PM] 
added this Plain Text snippet
<!DOCTYPE html>
<html>
<head>
<style>
a:link, a:visited {
  border: 1px solid #26A69A;
  border-radius: 3px;
  background-color: #26A69A;
  color: white;
  padding: 7px 12px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
}
a:hover, a:active {
  background-color: #009688;
}
}
</style>
</head>
<body>
<p><a href="meals?action=insert">Add Meal</a></p>
</body>
</html>
Add Comment Collapse



shaakem [7:31 PM] 
Подскажите, форму для редактирования делать в той же jsp где и список? Или можно другую jsp создать?


russell [7:34 PM] 
лучше отдельно, но можно и на той же.


Valery [8:37 PM] 
>9 В web.xml принято группировать сервлет со своим маппингом
Это надо понимать как на каждый маппинг (страницу) должен быть отдельный сервлет?


anpotashev [8:57 PM] 
Это, полагаю, про порядок элементов

[8:57] 
описал сервлет, следом опиши маппинг

russell [8:59 PM] 
да скорее всего так или несколько маппингов на один сервлет, но чтобы порядок был примерно как в пом файле (edited)


anpotashev [9:00 PM] 
а при чем тут пом?


[9:00] 
очепятка?


russell [9:08 PM] 
имею ввиду что можно было депенденси перемешать все, но Григорий четко их структурировал. Логгинг отдельно, веб отдельно

anpotashev [9:12 PM] 
Ааа, теперь понял аналогию.


[9:12] 
Пора, видимо, отдохнуть (edited)

Dmitry Neustupov [9:48 PM] 
Товарищи, как вы при редактировании записи получали доступ к полям meal? Они файнал, убирали этот параметр? Или есть другой способ?
 2 replies Last reply 4 days ago View thread

Few
[9:49 PM] 
Меняю на новый со старым id

Vangelis [10:03 PM] 
Ребят, может и банальный вопрос, но как установить постоянную переменную окружения на mac? Пытался и в bash-profile писать, и в .profile, но при проверки через printenv такой переменной не выдает. Когда же делаю просто одноразовый экспорт, то при echo появляется, хотя идея все равно не видит и поэтому приходится хардкодить путь к руту проекта. У кого-нибудь была такая проблема?


Dmitry Makarov [10:13 PM] 
@Vangelis, /etc/environment в маке есть?


Dmitry Neustupov [10:17 PM] 
@Few спасибо, получилось )

Vangelis [10:20 PM] 
@Dmitry Makarov нет, нету, но разве profile и/или bash-profile недостаточно?

Dmitry Makarov [10:22 PM] 
понятия не имею

Vangelis [10:23 PM] 
Я JAVA_HOME оттуда выставлял, все прошло, а вот данной папки я и вообщем не могу найти


[10:24] 
поищу сейчас что-нибудь про это

Serge [10:26 PM] 
@Vangelis, 
nano ~/.bash_profile
export TOPJAVA_ROOT=[путь]
Сохраняем, закрываем, и выполняем следующую команду, чтобы значения данного файла были прочитаны:
source ~/.profile
Проверяем:
echo $TOPJAVA_ROOT


Vangelis [10:27 PM] 
Сейчас проверю

Serge [10:27 PM] 
source ~/.bash_profile (опечатка)


Vangelis [10:31 PM] 
При сорсе выдает следующее

[10:31] 
-bash: /Users/mac/IdeaProjects/topjava: is a directory


[10:32] 
Может я что-то неправильно понимаю в выставлении переменных среды


[10:35] 
Вот вообщем говоря весь процесс:


Vangelis [10:36 PM] 
added this Plain Text snippet: Шел
macs-MacBook-Air:~ mac$ nano .bash-profile
macs-MacBook-Air:~ mac$ source ~/.bash-profile
-bash: /Users/mac/IdeaProjects/topjava: is a directory
macs-MacBook-Air:~ mac$ echo $TOPJAVA_ROOT
macs-MacBook-Air:~ mac$ export TOPJAVA_ROOT=/Users/mac/IdeaProjects/topjava
macs-MacBook-Air:~ mac$ echo $TOPJAVA_ROOT
/Users/mac/IdeaProjects/topjava
Add Comment Collapse



Serge [10:38 PM] 
:+1:


[10:40] 
macs-MacBook-Air:~ mac$ echo $TOPJAVA_ROOT
/Users/mac/IdeaProjects/topjava  переменная прописана


Vangelis [10:40 PM] 
Да, но она не постоянная


[10:41] 
то есть при перезагрузки компа к примеру она будет спадать


[10:41] 
поэтому она и прописывается в bash-profile

[10:41] 
для моего конкретного юзера


Serge [10:42 PM] 
не будет ничего спадать, перезагрузись посмотри (edited)


Vangelis [10:43 PM] 
и странно следующее: я изменил путь на какую-то рандомную папку, написал echo и мне выдало путь к руту проекта :smile:


[10:44] 
Насчет того, что будет спадать, я проверял, помню, на JAVA_HOME, у меня спадало


[10:44] 
руководствовался этой статьей: http://www.sajeconsultants.com/how-to-set-java_home-on-mac-os-x/
Saje Consultants
How to set JAVA_HOME on Mac OS X - Saje Consultants
Trying to run a Java application on your Mac and need to set your JAVA_HOME?  Follow the instructions below to quickly and easily do it: Open Terminal Confirm you have JDK by typing “which java”. It should show something like /usr/bin/java. Check you have the needed version of Java, by typing “java -version”. JAVA_HOME is...
Feb 28th, 2012 at 4:15 AM
 


Vangelis [10:50 PM] 
По-моему все исправилось, по-крайней мере


[10:50] 
пока что) Спасибо)


Artem Pashkov [11:54 PM] 
Добавил в pom.xml зависимости
<dependency>
           <groupId>javax.servlet</groupId>
           <artifactId>jstl</artifactId>
           <version>1.2</version>
       </dependency>

jstl и 1.2 подсвечивает красным, зависимости не найдены
Что не так? (edited)


russell [11:56 PM] 
<dependency>
           <groupId>jstl</groupId>
           <artifactId>jstl</artifactId>
           <version>1.2</version>
       </dependency>


chimax [11:57 PM] 
added this Java snippet
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>jstl</artifactId>
      <version>1.2</version>
    </dependency>
Add Comment

russell [11:59 PM] 
а ты импорт зависимостей нажимал



----- Wednesday, November 8th -----
Shalukhau Dzmitry [12:13 AM] 
Сделай mvn clean

[12:13] 
И потом заново собери проект.

Shalukhau Dzmitry [12:20 AM] 
Кому интересно: для форматирования LocalDate можно написать Custom Tag (заодно и прокачать себя в этом) - https://docs.oracle.com/cd/E11035_01/wls100/taglib/quickstart.html



Дима Жуков [6:42 AM] 
@Shalukhau Dzmitry спасибо. Тоже переделал на свой тэг.


aanyukhin [10:56 AM] 
Всем привет. Можете объяснить, либо ссылку скинуть на тему, когда лучше использовать forward а когда sendRedirect? везде написано, в чём отличие. А когда что выгодно непонятно...

ujwegh [10:57 AM] 
вот неплохая статейка http://javarevisited.blogspot.ru/2011/09/sendredirect-forward-jsp-servlet.html
javarevisited.blogspot.ru
Difference between SendRedirect() and Forward() in JSP Servlet
Tutorials and Interview questions for Java, data structures, algorithms, programming, coding, FIX Protocol, Tibco RV, UNIX,SQL,books,certifications.
 
 


aanyukhin [11:01 AM] 
спасибо

CRCx86 [12:37 PM] 
друзья, почему при forward возникает ошибка java.lang.IllegalStateException: Cannot forward after response has been committed?


Shalukhau Dzmitry [12:37 PM] 
Ты наверное что то в респонс устанавливал


russell [12:38 PM] 
или после форварда еще что-то делаешь, forward(req, resp) не является return


CRCx86 [12:38 PM] 
List<MealWithExceed> mealWithExceeds = MealsUtil.getListMealsWithExceeded();
       request.setAttribute("mealsList", mealWithExceeds);
       RequestDispatcher view = request.getRequestDispatcher(request.getContextPath() + "/meals.jsp");
       view.forward(request, response);


[12:38] 
весь кусок

russell [12:39 PM] 
фильтрами не игрался?


CRCx86 [12:39 PM] 
нет


Shalukhau Dzmitry [12:39 PM] 
Кстати, да :slightly_smiling_face:

[12:39] 
Это все тело метода?

CRCx86 [12:40 PM] 
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

       log.debug("redirect to meals");
       response.sendRedirect("meals.jsp");

       List<MealWithExceed> mealWithExceeds = MealsUtil.getListMealsWithExceeded();
       request.setAttribute("mealsList", mealWithExceeds);
       RequestDispatcher view = request.getRequestDispatcher(request.getContextPath() + "/meals.jsp");
       view.forward(request, response);
   }


Shalukhau Dzmitry [12:40 PM] 
log.debug("redirect to meals");
       response.sendRedirect("meals.jsp");

russell [12:40 PM] 
ага

Shalukhau Dzmitry [12:40 PM] 
Выхода нет :slightly_smiling_face:

[12:40] 
Следом view.forward(request, response);

CRCx86 [12:40 PM] 
ставил return

[12:40] 
не помогло

[12:40] 
валиться на форварде

[12:40] 
валится*

Shalukhau Dzmitry [12:40 PM] 
закоментируй        log.debug("redirect to meals");
       response.sendRedirect("meals.jsp");


[12:41] 
И посмотри.

Dmitry Neustupov [12:41 PM] 
Товарищи, поделитесь, как реализовывали этот пункт? Можно в личку: 
16 после операции delete в браузере должен быть url http:\\localhost:8080\topjava\meals
У меня выходит http://localhost:8080/topJava/meals?action=delete&mealId=1

CRCx86 [12:42 PM] 
Спасибо за поправку, можно пояснение почему не работало?

Shalukhau Dzmitry [12:43 PM] 
@CRCx86 Объяснение: (сразу скажу, я не понимаю зачем ты так делал) ты поставив sendRedirect настроил и возможно отправил Response на сторону клиента, который ждет окончания респонса. После этого, ты пытаешься сделать forward (по сути внутренний редирект, который не трогает сторону клиента). Forward довольно умный метод и он способен проверить, не делал ли пользователь вещей, которые не стоит делать...


[12:44] 
@Dmitry Neustupov Реддиректь сюда: request.getContextPath()

[12:45] 
И не забывай выйти из метода (если это не делается естественным образом сразу после редиректа)

Dmitry Neustupov [12:50 PM] 
@Shalukhau Dzmitry Спасибо!

CRCx86 [12:52 PM] 
Не знаю как тут адресно отвечать. Спасибо за помощь!


Shalukhau Dzmitry [12:53 PM] 
@CRCx86 Пишешь @Ник и он подсвечивает.

[12:53] 
И уведомляет

CRCx86 [12:53 PM] 
@Shalukhau Dzmitry благодарю!


Shalukhau Dzmitry [12:53 PM] 
:slightly_smiling_face:


Ivan [1:07 PM] 
Ещё вопрос коллеги про кодировку... В IDEA, в Request, в JSP выставлен "UTF-8" , везде всё красиво, кроме консоли IDEA там так .... 
DEBUG MealServlet [MealServlet.java:71] Add meal Meal{id=7, dateTime=2017-05-31T13:01, description='Р—Р°РІС‚СЂР°Рє', calories=1000}
DEBUG MealServlet [MealServlet.java:43] Open update form for Meal{id=7, dateTime=2017-05-31T13:01, description='Р—Р°РІС‚СЂР°Рє', calories=1000}
DEBUG MealServlet [MealServlet.java:77] Update meal Meal{id=7, dateTime=2017-05-31T13:01, description='Р—Р°РІС‚СЂР°Рє', calories=900}


Shalukhau Dzmitry [1:12 PM] 
Кодировка логера?


[1:12] 
Кодировка консоли? - это я варианты скидываю

Ivan [1:52 PM] 
UTF-8 - и там и там.


chimax [2:32 PM] 
кодировка логгера


[2:33] 
запусти задание из HW0 и посмотри будет ли кодировка испорчена - напиши там описание по-русски


Ivan [2:34 PM] 
added this Java snippet: logback.xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="30 seconds">
​
  <!-- To enable JMX Management -->
  <jmxConfigurator/>
​
  <appender name="file" class="ch.qos.logback.core.FileAppender">
    <file>${TOPJAVA_ROOT}/log/topjava.log</file>
​
    <encoder>
      <charset>UTF-8</charset>
      <pattern>%date %-5level %logger{0} [%file:%line] %msg%n</pattern>
    </encoder>
  </appender>
​
  <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <charset>UTF-8</charset>
      <pattern>%-5level %logger{0} [%file:%line] %msg%n</pattern>
    </encoder>
  </appender>
​
  <logger name="ru.javawebinar.topjava" level="debug"/>
​
  <root level="info">
    <appender-ref ref="file"/>
    <appender-ref ref="console"/>
  </root>
</configuration>
Add Comment Collapse



Ivan [2:36 PM] 
Запустил. Всё хорошо.
MealWithExceed{id=1, dateTime=2015-05-30T10:00, description='Завтрак', calories=500, exceed=false}
MealWithExceed{id=4, dateTime=2015-05-31T10:00, description='Завтрак', calories=1000, exceed=true}
chimax
запусти задание из HW0 и посмотри будет ли кодировка испорчена - напиши там описание по-русски
Posted in #hw1Nov 8th at 2:33 PM


chimax [2:40 PM] 
а в jsp норм выдает? (edited)

Сергей Матвеев [2:43 PM] 
подскажите кто делал опшенел Где хранить имплементацию БД?


Zipper [2:43 PM] 
Подскажите пожалуйста, а то что после патча не добавляются зависимости, так и должно быть?

chimax [2:44 PM] 
кто где, я там же и оставил, где была

russell [2:44 PM] 
Нет после патча зависимости без проблем добавляются

Zipper [2:45 PM] 
У меня вообще ни одной не добавилось почему-то

vsimonov [2:47 PM] 
Народ а как на страницах jsp логируете действия?


chimax [2:47 PM] 
там не надо

[2:47] 
логируй в сервлете

vsimonov [2:47 PM] 
а на jsp что?

Ivan [2:47 PM] 
Да, во всех остальных местах, работает как часы. В консоле начал смотреть логи TomCat и увидел, такое:flushed:
chimax
а в jsp норм выдает?
Posted in #hw1Nov 8th at 2:40 PM


chimax [2:51 PM] 
значит мы локализовали проблему - копай в сторону логера

Сергей Матвеев [2:52 PM] 
подскажите кто делал опшенел Где хранить имплементацию БД? Я имею ввиду - где будет жить объект класса?

chimax [2:53 PM] 
в dao

Ivan [2:54 PM] 
@chimax Спасибо, уже занимаюсь.

chimax [2:57 PM] 
к input по имени можно из css обращаться?

Few [2:58 PM] 
По классу можно


chimax [2:59 PM] 
как-то там можно было через []

Few [2:59 PM] 
По input[ type=text]

chimax [3:00 PM] 
о

Few [3:00 PM] 
Как-то так га память

chimax [3:00 PM] 
то, что надо

vladimir.glinskikh [3:00 PM] 
@Ivan в doPost запиши response.setContentType("text/html; charset=UTF-8");

Ivan [3:07 PM] 
@vladimir.glinskikh Сделал, запустил, doPost отработал - без изменений. У меня лог пишется со старта проекта (добавляется "захардкоженная" еда), и уже там не та кодировка. Сейчас ещё проверю в какой кодировке в фаил пишется, а то я его блокнотом смотрю...


chimax [3:08 PM] 
блокнот - это не лучший вариант

[3:08] 
установи саблайм текст (edited)

chimax [3:14 PM] 
@Few нашел - это называется селектор атрибутов)

Ivan [3:21 PM] 
@vladimir.glinskikh Немножко не понимаю при чём здесь doPost, приложение отрабатывает корректно, проблему похоже локализовал, ещё минуту...


[3:23] 
Да, проблема в точно в логгере. В фаил тоже пишется не в UTF-8, <charset>UTF-8</charset> из logback. xml не отрабатывает...

aanyukhin [3:44 PM] 
Народ, вопрос. У кого-нибудь случалась такая вещь:
```The value for the useBean class attribute ru.javawebinar.topjava.model.UserMealWithExceed is invalid.```
Отследил, ошибка для UseBean если в классе UserMealWithExceed нет пустого конструктора. 
У всех работает с нормальным конструктором UserMealWithExceed?


chimax [3:51 PM] 
а ты точно передаешь в бин что-то?


[3:53] 
у меня нет пустого конструктора

aanyukhin [3:55 PM] 
@chimax
'''<jsp:useBean id="mealWithExceed" scope="page" class="ru.javawebinar.topjava.model.UserMealWithExceed"/>'''


Ivan [3:55 PM] 
added this Java snippet: Коллеги. Головоломка про кодировку. Перезалил logback.xml кодировка в файле лога стала UTF-8. Но проблема с консолью IDEA осталась. Теперь к самой головоломке... Если запустить конфигурацию с TomCat, то вывод такой:
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=1, dateTime=2015-05-30T10:00, description='Р—Р°РІС‚СЂР°Рє', calories=500}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=2, dateTime=2015-05-30T13:00, description='РћР±РµРґ', calories=1000}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=3, dateTime=2015-05-30T20:00, description='РЈР¶РёРЅ', calories=500}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=4, dateTime=2015-05-31T10:00, description='Р—Р°РІС‚СЂР°Рє', calories=1000}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=5, dateTime=2015-05-31T13:00, description='РћР±РµРґ', calories=500}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=6, dateTime=2015-05-31T20:00, description='РЈР¶РёРЅ', calories=510}
[2017-11-08 06:47:52,038] Artifact topjava:war exploded: Artifact is deployed successfully
[2017-11-08 06:47:52,039] Artifact topjava:war exploded: Deploy took 1 671 milliseconds
​
А если 
​
public class Main {
  private static DbMock dbMock = DbMock.getInstance();
​
  public static void main(String[] args) {
    System.out.println("Hello Topjava Enterprise!");
    dbMock.addMeal(new Meal(7L, LocalDateTime.of(2015, Month.MAY, 30, 10, 0), "Завтрак", 500));
  }
}
то в консоле будет так:
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=1, dateTime=2015-05-30T10:00, description='Завтрак', calories=500}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=2, dateTime=2015-05-30T13:00, description='Обед', calories=1000}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=3, dateTime=2015-05-30T20:00, description='Ужин', calories=500}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=4, dateTime=2015-05-31T10:00, description='Завтрак', calories=1000}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=5, dateTime=2015-05-31T13:00, description='Обед', calories=500}
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=6, dateTime=2015-05-31T20:00, description='Ужин', calories=510}
Hello Topjava Enterprise!
DEBUG DbMock [DbMock.java:45] Adding to DB Meal{id=7, dateTime=2015-05-30T10:00, description='Завтрак', calories=500}
​
Process finished with exit code 0
Add Comment Collapse



chimax [4:00 PM] 
added this Java snippet
<Connector port="8080" protocol="HTTP/1.1"
        connectionTimeout="20000"
        redirectPort="8443" 
        URIEncoding="UTF-8"/>
Add Comment



chimax [4:00 PM] 
попробуй это добавить в server.xml

[4:00] 
у томката

[4:00] 
точнее последнюю строку


Shalukhau Dzmitry [4:04 PM] 
@Ivan смотри HW0 там было про настройку кодировки консоли (там нужно было какой то файл редактировать)


russell [4:05 PM] 
stackoverflow Говорит Just create a setenv.bat file inside the TOMCAT/bin directory with the following contents:

set "JAVA_OPTS=%JAVA_OPTS% -Dfile.encoding=UTF8"


[4:05] 
еще вариант

[4:05] 
For Tomcat running as a Windows service neither %JAVA_OPTS% and neither setenv.bat answers works in my case.

I set the option "-Dfile.encoding=UTF8" in registry:

"HKEY_LOCAL_MACHINE\SOFTWARE\Apache Software Foundation\Procrun 2.0\tomcatstackTomcat\Parameters\Java --> Options*

Then it works.


Alexandr [4:13 PM] 
Народ хотел уточнить а список еды мы создаем прямо в сервлете и там преобразуем в mealWithExceed?

astronarh [4:18 PM] 
@Alexandr я так делаю, но не факт что это верно ) (edited)

Alexandr [4:19 PM] 
Просто не до конца понятно как без БД реальзовать


Ivan [4:31 PM] 
Я создал отдельный класс положил туда мапу и сделал его синглтоном.


astronarh 
[4:35 PM] 
Пока приложение живет развернутым, по моему, много вариантов всё хранить в памяти.

Ivan [4:40 PM] 
Сделал, в консоле, при старте появилось, 
08-Nov-2017 19:38:29.865 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dfile.encoding=UTF8
... не помогло... но спасибо, за открытие новых фишечек.:grinning:
Ruslan Shakirov
stackoverflow Говорит Just create a setenv.bat file inside the TOMCAT/bin directory with the following contents:

set "JAVA_OPTS=%JAVA_OPTS% -Dfile.encoding=UTF8"
Posted in #hw1Nov 8th at 4:05 PM


Shalukhau Dzmitry [4:41 PM] 
@Ivan У тебя проблема с консолью IDEA. Решение из HW0 применял?


Ivan [4:42 PM] 
Да, все. Даже шрифт менял на рекомендуемый, но потом сменил обратно - тяжко мне с ним.


anpotashev [4:46 PM] 
@Ivan, еще вариант - кодировку в проекте менял до создания этих файлов или уже после? Настройки кодировки применяются только к новым файлам.


Ivan [4:50 PM] 
Дело в том, что я из разных мест вызываю один и тот же метод, из psvm всё норм, а из конфигурации томкат - не верная кодировка в консоли ИДЕИ.
Все настройки делал ещё при HW0.
Сейчас ещё классы проверю, которые создались патчами.
Aleksandr N Potashev
@Ivan, еще вариант - кодировку в проекте менял до создания этих файлов или уже после? Настройки кодировки применяются только к новым файлам.
Posted in #hw1Nov 8th at 4:46 PM


Shalukhau Dzmitry [4:56 PM] 
@Ivan Попробуй томкат запустить не через идею, задеплоить war и посмотреть - будут ли проблемы. Есть подозрение, что когда ты через idea запускаешь - setEnv.bat не запускается.


[4:56] 
Стоп. Какая у тебя ОС?

Ivan [4:57 PM] 
Windows 10, setenv точно работает... 08-Nov-2017 19:38:29.865 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dfile.encoding=UTF8 строка появляется


anpotashev [4:58 PM] 
Погоди, а у тебя консоль томката отдельно от идеи? Ты томкат запускаешь из командной строки?

Shalukhau Dzmitry [4:59 PM] 
Это я сбил.

Ivan [5:09 PM] 
Нет, томкат запускаю из конфигурации ИДЕИ, консоль в ИДЕИ.
Aleksandr N Potashev
Погоди, а у тебя консоль томката отдельно от идеи? Ты томкат запускаешь из командной строки?
Posted in #hw1Nov 8th at 4:58 PM

Ivan [5:28 PM] 
Знаний не хватает, сценария при записи видео тоже, может это прояснит ситуацию. (100Mb) https://drive.google.com/open?id=1-mVMFUkau0DhFxMur8Gegl503zm1BxGa

Shalukhau Dzmitry [5:50 PM] 
https://topjava12.slack.com/archives/C7UFKFCMC/p1510152054000557
Сделай еще -Dconsole.encoding=UTF8
Ivan
Сделал, в консоле, при старте появилось, 
08-Nov-2017 19:38:29.865 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dfile.encoding=UTF8
... не помогло... но спасибо, за открытие новых фишечек.:grinning:
Posted in #hw1Nov 8th at 4:40 PM


[5:50] 
Не уверен, что поможет, но...

[5:51] 
В конфигах идеи и в bat tomcat. Естественно, перезапусти весь зоопарк и лучше перезагрузись (может Debug сессия где висит и томкат не отпускает)

Ivan [6:00 PM] 
Спасибо всем откликнувшимся, до утра мск+5 остался без Идеи, смогу попробовать только утром.

Иван [6:27 PM] 
у кого нибудь было такое что index.html не взирая на изменения и содержимое war не менялся в броузере?

[6:28] 
глюк какойто бесовской


[6:29] 
приложуха стартует на http://localhost:8081/topjava/ и показывает изначальный вариант

[6:30] 
а если я руками дописываю http://localhost:8081/topjava/index.html то новый кажет

Shalukhau Dzmitry [6:30 PM] 
Может браузер закешировал?

Иван [6:30 PM] 
хм

[6:30] 
господе ну точно же


[6:31] 
давно такого не было

chimax [6:31 PM] 
иногда f5 не помогает, нажимай энтер в строке адреса (edited)

Иван [6:31 PM] 
шыфт


[6:32] 
шыфт+ф5 обновляет отбросив кэш

[6:32] 
мне не зачем нажимать ентор ибо броузер с 0 открывает первую вкладку запускаясь каждый раз

chimax [6:33 PM] 
а ты разве не меняешь html или jsp или ccs по ходу дела без перезапуска?

russell [6:34 PM] 
может у тебя в веб хмл welcome-file-list другая страница подвязана

chimax [6:34 PM] 
она по умолчанию идет


[6:35] 
у меня тоже вчера такие глюки были

[6:35] 
в идеа код есть, а в исходниках страницы нет

Иван [6:36 PM] 
вово

[6:36] 
а я щас просто зажал шыфтф и мышкой стрелочку обновляющую ткнул


Дима Жуков 
[6:37 PM] 
Я всегда ctrl f5 делал... Может тож самое

chimax [6:37 PM] 
https://ru.wikipedia.org/wiki/%D0%92%D0%B8%D0%BA%D0%B8%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F:%D0%9A%D1%8D%D1%88
Wikipedia
Википедия:Кэш
Страницы Википедии сохраняются в нескольких местах, в так называемом кэше, чтобы разгружать серверы. Один такой кэш находится в браузере пользователя. Он записывает каждую посещённую страницу для того, чтобы её при повторном вызове не нужно было заново грузить с сервера. Второй кэш, он называется knams-кластер, находится в городе Амстердам. Он состоит из ряда компьютеров, которые находятся между сервером Википедии и компьютером пользователя. Они работают подобно кэшу на компьютере пользователя, но Show more… (19 kB)


Иван [6:37 PM] 
подхватывать изменения без перезапуска это если приложуха жырная

chimax [6:37 PM] 
есть волшебная кнопка в идеи для этого

Иван [6:38 PM] 
я ролик тоже смотрел :slightly_smiling_face:


chimax [6:38 PM] 
фуф, а то я думал, что каналом ошибся)))

Иван [6:39 PM] 
вы тут наверно уже доп задание допилили все

Дима Жуков [6:39 PM] 
Ждём-с нового и решения

chimax [6:39 PM] 
есть такое - над дизайном работаем) что бы не тошнило от вненего вида)

Иван [6:39 PM] 
в топку дизайн

Дима Жуков 
[6:39 PM] 
А на кой?

[6:40] 
Это ж все история... Идём дальше ж


chimax [6:40 PM] 
если нечего делать, то навыки фронтенда подтянуть не лишним будет

Дима Жуков [6:40 PM] 
Аааа


Иван [6:40 PM] 
лучше читай ресурсы и доп материалы и там туториалы какие хелоуворлдные


chimax [6:40 PM] 
кнопочку там сделать, полосочки, буковки покрасивше)))

Shalukhau Dzmitry [6:41 PM] 
@chimax А JSP подтянуть? По - моему это важнее....

chimax [6:41 PM] 
со спрингом намучаемся, даю себе возможность отдышаться перед этим)


Shalukhau Dzmitry [6:42 PM] 
@chimax Я вспоминал спринг с легкой грустью, т.к. он отлично справлялся с маппингом и DI (что в данной задаче самому приходится реализовывать)


chimax [6:43 PM] 
скажи спасибо, что не надо реализовывать JDBC в ручную)

russell [6:43 PM] 
как не надо?


chimax [6:43 PM] 
через спринг


Shalukhau Dzmitry [6:43 PM] 
Оставили на след. занятие???

chimax [6:43 PM] 
а не по старинке


Дима Жуков 
[6:43 PM] 
Jdbc вручную эт жесть


chimax [6:44 PM] 
это классно)


russell [6:44 PM] 
дату или темплейт? (edited)

Shalukhau Dzmitry [6:44 PM] 
На ассемблере :slightly_smiling_face:

Дима Жуков 
[6:44 PM] 
Тупо копипаст и правка запросов?


chimax [6:44 PM] 
это тоже было, но не jdbc

[6:44] 
Вам Руслан @russell расскажет, как это)) (edited)

Shalukhau Dzmitry [6:45 PM] 
@russell расскажи, всем интересно. Давай поговорим про это....

Дима Жуков 
[6:45 PM] 
Да я по смотрел. Задачк то тестовую делали) я глянул на эо

chimax [6:46 PM] 
куча try catch and exceptions


[6:46] 
всякие фабричные методы

Дима Жуков [6:46 PM] 
Ну ещё и rs.getstring getint setstring setint

[6:47] 
По-моему

chimax [6:47 PM] 
или по-порядковому номеру столбца) (edited)

Shalukhau Dzmitry [6:47 PM] 
@russell по моему пошел пить валерьянку по причине тяжести воспоминаний...

chimax [6:48 PM] 
если сущностей много, то на каждую надо создать интерфейс + реализацию + запросы к базе - куча стереотипного и повторяющегося кода (edited)

[6:49] 
а, если это еще делаешь, как трехлэйерноую архитектуру, где сущности сдержат в себе поведение...)

russell [6:49 PM] 
Да нет, воспоминания у меня как раз особенные. Это мое первое полноценное API.

Shalukhau Dzmitry [6:50 PM] 
Я вас слушаю - уже мурашки по коже. Хотя мне кажется не так уж и сложно сделать кастомный JDBC Driver. Достаточно понимать, как можно к конкретной БД подключиться (ее интерфейс), а дальше уже херачить в стандартные модели данные.


chimax [6:50 PM] 
самое яркое воспоминание - это первое в моей жизни отображение записи из базы на странице - вот это было круто)) (edited)


russell [6:50 PM] 
много boilerplate кода


Shalukhau Dzmitry [6:51 PM] 
Счас кстати на спор InMemoryDB JDBC Driver попробую сделать - хочу получить ваш опыт :slightly_smiling_face: (edited)

Дима Жуков 
[6:52 PM] 
Создай 10 entity. И crud для каждой реализуй!

Иван [6:53 PM] 
а вы куда данные хардкодили для списка еды?

Shalukhau Dzmitry [6:53 PM] 
Мы вроде про кастомный JDBC говорили...


Дима Жуков [6:53 PM] 
Аааа


russell [6:53 PM] 
Для полноты ощущение получай коннекшены через JNDI датасорс

Shalukhau Dzmitry [6:55 PM] 
@russell сначала прототип, потом все остальное :slightly_smiling_face:


Дима Жуков 
[6:58 PM] 
@russell Я так понимаю хибернэйт сильно облегчает жизнь?)


russell [6:58 PM] 
а спринг дата еще сильнее, там круд пишется в одну строчку (edited)


Дима Жуков 
[6:59 PM] 
Шикарно

[7:01] 
А если база сделана плохо. Без связей просто айдишники есть связь но она не прописана так чисто по смыслу. Эта петрушка как к этому относится?


chimax [7:01 PM] 
вот и узнаем)


[7:01] 
держи интригу

Дима Жуков 
[7:07 PM] 
Кстати на счёт ексепшенов. Я думал все dao их просто пробрасывают и они ловятся только в одном месте - сервлете. Это так делали?

chimax [7:09 PM] 
мы делали на каждом слое кастомный иксепшен и на каждом слое оборачивали. В итоге это все обрабатывалось в месте вызова метода (edited)


Дима Жуков 
[7:09 PM] 
Я вообще думал что сервлет должен быть один. И просто хорошая логика проработанна


[7:10] 
:slightly_smiling_face:

Иван [7:12 PM] 
я вот потерялся откуда в сервлет должны прийти данные списка еды


[7:12] 
не в нём же их хардкодить

Дима Жуков 
[7:12 PM] 
С dao ж


[7:12] 
Или что там

[7:12] 
getAll() что нить тип того?


Shalukhau Dzmitry [7:14 PM] 
@Ivan Я рефакторил MealUtils и добавил туда статик метод. В контроллере у меня в инит что - то вроде service = new MealService(new MealInMemoryDao(MealUtils.getData()); (edited)


chimax [7:15 PM] 
https://www.w3schools.com/css/css_form.asp
w3schools.com
CSS Forms
Well organized and easy to understand Web building tutorials with lots of examples of how to use HTML, CSS, JavaScript, SQL, PHP, and XML.


Дима Жуков [7:16 PM] 
Во во. От туда мой дизайн

Artem Pashkov [7:20 PM] 
В jsp передаю список meals и пытаюсь в цикле вывести один параметр, дату
<c:forEach var="meal" items="${meals}">
       <tr>
           <td><c:out value="${meal.dateTime}"/></td>
       </tr>
   </c:forEach>
получаю ошибку:
javax.el.PropertyNotFoundException: Property [dateTime] not found on type [ru.javawebinar.topjava.model.MealWithExceed]
Что я упустил?
1 reply 3 days ago View thread

Дима Жуков [7:21 PM] 
C out можно убрать впринципе

[7:21] 
А геттер есть там?

Artem Pashkov [7:22 PM] 
В дебаге все параметры вижу

Дима Жуков 
[7:25 PM] 
Хотя какая то разница должна быть логически если судить c:out или просто... Наверное c:out как то может текст обработать если там скрипт html например.

[7:26] 
Не просто ж его сделали


[7:27] 
@Artem Pashkov в этом разница? Или ты просто впихнул его

russell [7:31 PM] 
кажестя  ${} можно  хакнуть например в инпут включить свой стиль, htm tag, а с:out принимает только текст. Поэтому для вывода в value инпута надо использовать c:out (edited)


Shalukhau Dzmitry [7:37 PM] 
@russell не знал :slightly_smiling_face:

russell [7:37 PM] 
попробуй при редактировании в описание введи Обед<style>td {font-size: 50px}</style>

Valery [7:56 PM] 
в каких конфигурационных файлах надо прописать кодировку, чтобы отображалась латинница?
в jsp есть строчка pageEncoding="UTF-8", но недостаточно этого. Или надо это в сервлете решать? (edited)


Дима Жуков [7:57 PM] 
Я бы ещё сделал request.setencoding что то там

[7:57] 
И мета тег на всякий пожарный

Valery [7:59 PM] 
request.setCharacterEncoding("UTF-8"); response.setCharacterEncoding("UTF-8");  не помогли

[8:00] 
meta в jsp?

Дима Жуков [8:00 PM] 
Идея, проект все на utf8?

[8:00] 
Может кодировка jsp ascii какая нить

[8:00] 
Я впихнул

Valery [8:01 PM] 
собираю мавеном в консоли. Идея не при чем.


Дима Жуков [8:01 PM] 
А jsp страницы в идее создавал?

Valery [8:02 PM] 
да, но в jsp есть <%@ page contentType="text/html;charset=UTF-8" language="java" %>

Дима Жуков [8:03 PM] 
Ну да мета тут ничего не сделает эт точно)

Valery [8:07 PM] 
в идее и глобальная и в проекте utf-8

Дима Жуков [8:09 PM] 
Как сказали бы в СССР помехи за пределами союза... Или проекта. Хз. Что то странное


Valery [8:12 PM] 
не отображается кириллица только та, что в форме добавления задаю. буквы прописанные в jsp или из базы читаются нормально

[8:17] 
решил. добавил request.setCharacterEncoding("UTF-8"); в сервлет, обрабатывающий данные из формы. когда добавлял такие строчки в сервлет вывода таблицы - не срабатывало.

russell [8:21 PM] 
а до этого писал про латинницу
https://topjava12.slack.com/archives/C7UFKFCMC/p1510163803000252
Valery Trebukh
в каких конфигурационных файлах надо прописать кодировку, чтобы отображалась латинница?
в jsp есть строчка pageEncoding="UTF-8", но недостаточно этого. Или надо это в сервлете решать?
Posted in #hw1Nov 8th at 7:56 PM


Valery [8:23 PM] 
опечатка )

russell [8:23 PM] 
она тебе отдалила решение проблемы на пол часа

Valery [8:33 PM] 
я готов смирится с потерей получаса. но вопрос открыт - почему установка кодировки для запроса/ответа в сервлете, отображающем список, не решает эту проблему?
получается, что я с формы считываю данные в кривой кодировке, записываю в мапу, потом эту мапу передаю на печать, устанавливая utf-8... и не работает. (edited)


Viktor [8:42 PM] 
@Valery с формы данные приходят в UTF-8, а метод пытается прочитать их в другой. Кстати если идея открыта попробуй вывести на консоль дефолтную кодировку.

Dmitry Neustupov [8:43 PM] 
Мне помогла установка в Jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>


Valery [8:46 PM] 
request.getCharacterEncoding() == null

Дима Жуков [8:48 PM] 
Locale.getDefault() ?


Valery [8:50 PM] 
локаль en_US


Дима Жуков [8:50 PM] 
Значит это как то не так проверяется) извиняюсь

[8:51] 
Charset.getDefault?)))

Valery [8:54 PM] 
у чарсета нету такого метода.


Дима Жуков 
[8:54 PM] 
Что то дефалт должен быть вроде


[8:55] 
Но возможно это не то все равно

Valery [8:55 PM] 
на странице чарсет прописан utf-8, но реквест приходит с кодировкой null


Иван [9:24 PM] 
как достать поле из элемента списка в jsp?

[9:24] 
геттеры есть но чёт не хочет

[9:25] 
главно toString срабатывает если элемент просто оставить как есть

Dmitry Makarov [9:30 PM] 
ты еще первую часть делаешь?

Иван [9:34 PM] 
да


[9:35] 
не могу выпотрошить список который прислал в жспшку

Viktor [9:38 PM] 
@Valery https://stackoverflow.com/questions/12358101/request-getcharacterencoding-returns-null-why
stackoverflow.com
request.getCharacterEncoding() returns NULL... why?
A coworker of mine created a basic contact-us type form, which is mangling accented characters (è, é, à, etc). We're using KonaKart a Java e-commerce platform on Struts 1. I've narrowed the issu...
 


Dmitry Makarov [9:39 PM] 
Там нужно forEach делать. Как в listUser.jsp: https://danielniko.wordpress.com/2012/04/17/simple-crud-using-jsp-servlet-and-mysql/
WordPress.com danielniko
Simple CRUD Using Jsp, Servlet and MySQL
You can view and download the complete source code of this tutorial from my github account.
In this tutorial, we will create a simple CRUD (Create Read Update Delete) User Management Web Application using Jsp, Servlet and MySQL.
For this tutorial, we will need the following tools: (The older or newer version should also works). Moreover, basic Java knowledge is assumed.
1. Eclipse IDE for Java EE Developers (Indigo – ver. 3.7)
2. Apache Tomcat ver 7.0 Show more…
 


Dmitry Makarov [9:47 PM] 
Есто кто вторую часть сделал?

Иван [9:48 PM] 
вот это <c:out value="${user.userid}" /> у меня не работает

[9:48] 
работает вот так <c:out value="${user}" />


[9:48] 
а поле брать не хочет

Dmitry Makarov [9:50 PM] 
ты так и скопировал чтоли не переименовывая?


Few
[9:50 PM] 
имя метода геттера и имя поля какие?

Иван [9:50 PM] 
ну вот напирмер description и getDescription()


[9:50] 
стандартно всё


Dmitry Makarov [9:51 PM] 
у тебя там должно быть meal.description

Few
[9:51 PM] 
а строка с forEach из вьюшки?


Иван [9:51 PM] 
да только не meal а list там стоит


[9:51] 
объекты ловит и распечатывает через toString не явно

[9:52] 
форыч <c:forEach var="aaa" items="${list}">

Few
[9:53 PM] 
ну значит должен (edited)


[9:53] 
<c:out value="${aaa.description}" /> (edited)

Иван [9:54 PM] 
но не работает

[9:55] 
в шапке это есть <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

[9:55] 
оно вроде правильное

Few [9:55 PM] 
ну если forEach работает, то правильное


Иван [9:58 PM] 
однако же javax.el.PropertyNotFoundException: Property [description] not found on type [ru.javawebinar.topjava.model.MealWithExceed]

Viktor [9:59 PM] 
у меня так <c:forEach var="aaa" items="${list}"> не работало, пришлось из requestScope по ключу доставать.

Few 
[10:00 PM] 
у тебя геттер public?


Dmitry Makarov [10:01 PM] 
@Few, ты вторую часть начал?


Few 
[10:01 PM] 
Optional?

Dmitry Makarov [10:01 PM] 
ага


Few 
[10:02 PM] 
в Вс закончил еще


Dmitry Makarov [10:02 PM] 
как синхронизацию делал? прописывал блоки в методах дао?

Few 
[10:03 PM] 
коллекцию синхронизированную использовал

Dmitry Makarov [10:04 PM] 
т.е. пока 1 юзер редактирует сущность другой может её удалить? (edited)


Few 
[10:06 PM] 
идейно да, но юзеры имеют доступ только к своим записям по задумке

Viktor [10:06 PM] 
странно, сейчас поменял на "как у всех" и заработало.... ненавижу UI :smiley:
Sergeev Viktor
у меня так <c:forEach var="aaa" items="${list}"> не работало, пришлось из requestScope по ключу доставать.
Posted in #hw1Nov 8th at 9:59 PM


Иван [10:07 PM] 
может это от того что я просто захардкодил в сервлет данные


Dmitry Makarov [10:07 PM] 
По идее юзер может в 1 вкладке редактировать, а в другой удалить.:grinning: Ладно пока так же доделаю потом буду думать если успею (edited)

Few 
[10:10 PM] 
ну ты в любом случае для редактирования сначала гет делаешь, может ты просто посмотреть его взял, не блокировать же при этом коллекцию на случай если ты его отредактировать собрался )

Dmitry Makarov [10:10 PM] 
@Иван, у тебя это геттер в Meal или MealWithExceed?

Иван [10:10 PM] 
ахринеть перезагрузил идею и оп

Dmitry Makarov [10:11 PM] 
я хочу synchronized(meal) сделать


Few 
[10:11 PM] 
ну в памяти еще можно реализовать, а когда базу будем прикручивать?

Dmitry Makarov [10:12 PM] 
хаха озадачил


Few 
[10:13 PM] 
в общем моих знаний не достаточно чтобы рассуждать дальше ) может и есть способы, но я их пока не знаю


Иван [10:15 PM] 
в MealWithExceed ессно


[10:15] 
я ж их отсылаю


[10:15] 
вот вобщем такие дела просто перезагрузил идею и всё стало работать

[10:16] 
это к вопросу об обновлении jsp без рестарта :slightly_smiling_face:

Dmitry Makarov [10:16 PM] 
у меня jsp норм обновляется


Иван [10:16 PM] 
ну у меня щас тоже норм


[10:16] 
и до глюка тоже норм

[10:17] 
но бывает такое дело и надолго запоминаешь

Viktor [10:17 PM] 
Кто-нибудь ставил валидацию данных при создании или редактировании Meal? С датой косячоек какой-то у меня


Few 
[10:28 PM] 
Валидацию кажется позже прикручивать будем

[10:28] 
Возможно уже со спрингом


[10:30] 
Я дату через html5 делал

Viktor [10:30 PM] 
так не, там просто указать тип dateTime, сама валиадция работает, а вот при редактировании значение не встает...

[10:32] 
хаха просто не надо было использовать  javatime:format сразу закинуть localeDateTime :smiley:

Few [10:33 PM] 
Все уже сделано за нас,  только пользуйся :slightly_smiling_face:


Viktor [10:33 PM] 
я не очень дружу с UI :smiley:

[10:34] 
теперь надо парсинг поправить :smiley:

Few 
[10:35 PM] 
Завтра узнаем как надо было сделать



----- Thursday, November 9th -----
Дима Жуков [6:17 AM] 
switch (action == null ? "all" : action) - до этого я не додумался.... пришлось if else делать)


Иван [6:29 AM] 
чёт понять не могу meals.jsp это жаваскрипт или хтмл?

[6:30] 
тэги в тэгах и в итоге нельзя просто написать код жаваскрипта без обувания в тэги чтобы это был не текст


Дима Жуков 
[6:33 AM] 
как это может быть жаваскриптом?


Дима Жуков [6:42 AM] 
Есть TimeUtil, я еще DateUtil создал) ну идиот ж.. Ребята какой смысл в Objects.requireNonNull ? выкидывает NPE если он Null? это для чего? проверять на null и выкидывать все равно NPE


[6:46] 
ааа наверное чтобы в другой метод null не передавать.


LORREON [10:05 AM] 
added this Java snippet: Почему так не работает
//---MealServlet
 List<MealWithExceed> mealList = Arrays.asList(
      new MealWithExceed(...),
      new MealWithExceed(...),
      new MealWithExceed(...),
      ...
    );
    req.setAttribute("MealsListExeded", mealList);
    req.getRequestDispatcher("meals.jsp").forward(req, resp);
​
//---meal.jsp
<c:forEach items="${MealsListExeded}" var="meal">
      <tr id="tr">
        <td>${meal.getDateTime}</td>
        <td>${meal.getDescription}</td>
        <td>${meal.getCalories}</td>
        <td><a href="#">Редагувати</a></td>
        <td><a href="#">Видалити</a></td>
      </tr>
    </c:forEach>
Add Comment Collapse



LORREON [10:07 AM] 
но если <td>${meal}</td> ->toString работает


aanyukhin [10:10 AM] 
${meal.dateTime} так правильно


Nik [10:11 AM] 
@LORREON <td>${meal.Имя переменной (а не геттер)}</td>

LORREON [10:12 AM] 
неважно, не пашет

aanyukhin [10:12 AM] 
а геттеры вообще в MealWithExceed есть?


LORREON [10:12 AM] 
конечно)))

aanyukhin [10:12 AM] 
хм


Nik [10:13 AM] 
чудес не бывает, покажи код MealWithExceed


LORREON [10:14 AM] 
тоже что и в @Иван а


[10:17] 
код revert в version control c последнего патча

[10:17] 
ну и конечно  meal.Имя переменной )

[10:19] 
в IDEA если точку ставишь она должна подсказывать


aanyukhin [10:20 AM] 
нет. подскажет, если ты useBean используешь перед этим

aanyukhin [11:30 AM] 
Возвращаясь к теории. forward и sendRedirect. Можете пояснить, почему в doPost и в delete случае делается redirect а не forward?


Shalukhau Dzmitry [11:38 AM] 
@aanyukhin потому что нам важно, чтобы урл у пользователя поменялся. Чтобы он не нажал F5 и снова не начал удалять/редактировать. Одно из правил forward, что результат должен быть повторяем при тех же условиях. В случае с Delete результат не повторится - запись уже удалена



aanyukhin [11:42 AM] 
Ааааа!!!

[11:43] 
Вот в точку...

[11:43] 
Спасибо)

Rostish [12:34 PM] 
К чему привязать счетчик, чтобы при delete выравнивался список


[12:34] 
?


[12:34] 
я чет голову уже сколько ломаю, не могу придумать

[12:34] 
все работает, кроме счетчик

Shalukhau Dzmitry [1:29 PM] 
Зачем?


Rostish [1:29 PM] 
@grigory.kislin разобрал ваш вариант решения 1 задания. У меня есть вопрос. Это правильная логика, что после удаления записи, у счетчика не пересчитываются значения? Приер: у нас есть записи *от 1 до 6*, _мы удаляем 1_, *остаются записи от 2 до 6*, _добавляем новое_, *остаются от 2 до 7*. Так у меня решение похожее, только структуировано, конечно, не так проффесионально, но большую часть време я ломал голову именно, как после каждого удаления выравнивать id  записей.


Shalukhau Dzmitry [1:30 PM] 
Либо пересчитай вручную либо не парься - в БД никто индексы не правит :slightly_smiling_face:

[1:30] 
Т.к. могут быть записи связанные с индексом

vch [1:31 PM] 
@Rostish А зачем??? SqlServer такой ерундой не занимается

Rostish [1:31 PM] 
Ну я поэтому и задаю вопросы

[1:31] 
мне просто показалось - это красиво

[1:31] 
когда всегда ровный порядок

Shalukhau Dzmitry [1:32 PM] 
@Rostish Конечно, красиво. Но бессмысленно. Особенно, когда индекс числовой и его никто не видит.


Rostish [1:32 PM] 
Как раз вывел пару понимающих человек на эмоции, вы мне объяснили)


vch [1:32 PM] 
@Rostish т.е. у тебя всегда id записей начинаются с 1? Даже если много раз удалять/вставлять по-разному, всё равно id будут идти по порядку от 1 до N?

Rostish [1:32 PM] 
ну да, я к этоу стремился

[1:32] 
но у меня не получилось)

vch [1:32 PM] 
@Rostish и это прекрасно

Shalukhau Dzmitry [1:33 PM] 
Проходись по листу и перенумеровывай. В чем трудность?

Rostish [1:33 PM] 
либо я прикинул как сделать, но очень затратно каждый раз базу после удаления переиндексировать


Shalukhau Dzmitry [1:33 PM] 
index = 0;
for (Element el: elementList) {
el.setId(index++);
}

[1:34] 
Естественно это псевдокод

Rostish [1:34 PM] 
да это то понятно

[1:34] 
просто у меня нигде не хранился список с проставленным execed


[1:34] 
а только список meals

[1:35] 
и геморойно после каждого удаления пересчитывать опять все execed и наполнять map


vch [1:36 PM] 
@Rostish Ну представь, что на 2 страницах ты открыл список Meals.
На 1 удалил 5 запись. Затем на 2 удалил 6 запись.
А во второе удаление удалилась совсем не та запись, что ты хотел, т.к. вся нумерация слетела.
Нельзя так делать.


Rostish [1:37 PM] 
во, такой пример мне нравится

[1:37] 
до него я недогадался

Shalukhau Dzmitry [1:39 PM] 
@Rostish если ты постоянно работаешь с MealsWithExceed, то тебе после каждого удаления/редактирования нужно список пересчитывать...


Rostish [1:41 PM] 
не,я же написал, что у меня c meal работа была

[1:41] 
вообщем я поговорил с вами и понял, что индексы пересчитывать ненужно, стало легче)

[1:41] 
спасибо


Shalukhau Dzmitry [1:42 PM] 
Ну, с облегчением тебя...


Сергей Матвеев [2:02 PM] 
делаю по видео первый урок.   в этом месте у еды ИД нулл 
final Meal meal = action.equals("create") ? new Meal(LocalDateTime.now(), "", 1000) :
                   mealRepository.get(getId(request));
           request.setAttribute("meal", meal);
           request.getRequestDispatcher("mealEdit.jsp").forward(request,response);
       }
Когда это приходит в jsp оно падает с java.lang.NullPointerException (edited)


Shalukhau Dzmitry [2:05 PM] 
А зачем ты делаешь это в jsp? В сервлете если новый - создаешь meal без индекса. Если не новый (запрошен id) загружаешь. И потом в темплейт передаешь через setAttribite

vsimonov [2:06 PM] 
лист  с данными где угодно создавай но не в jsp

Сергей Матвеев [2:07 PM] 
это из сервлета кусок

[2:07] 
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
       String action = request.getParameter("action");

       if(action == null){
           log.info("getAll");
           request.setAttribute("meal",
                       MealsUtil.getWithExceeded(mealRepository.getAll(), 2000));
           request.getRequestDispatcher("meal.jsp").forward(request,response);
       } else if (action .equals("delete")){
           int id = getId(request);
           log.info("Delete {}", id);
           mealRepository.delete(id);
           response.sendRedirect("meal");
       } else {
           final Meal meal = action.equals("create") ? new Meal(LocalDateTime.now(), "", 1000) :
                   mealRepository.get(getId(request));
           request.setAttribute("meal", meal);
           request.getRequestDispatcher("mealEdit.jsp").forward(request,response);
       }


   }


[2:08] 
Новая еда без ИД

vsimonov [2:08 PM] 
что значит новая еда без ИД?

Shalukhau Dzmitry [2:08 PM] 
Ок. На какой строке падает?

Сергей Матвеев [2:08 PM] 
new Meal(LocalDateTime.now(), "", 1000)

[2:08] 
org.apache.jasper.JasperException: An exception occurred processing JSP page [/mealEdit.jsp] at line [18]

15: <jsp:useBean id="meal" scope="request" type="ru.javawebinar.topjava.model.Meal"/>
16: <form method="POST" action="meal">
17: 
18:     <input type="hidden" name="id" value="${meal.id}">
19: 
20:     DateTime : <input
21:         type="datetime-local" name="datetime"


Shalukhau Dzmitry [2:09 PM] 
Понятно. Ты в hidden пытаешься id запихнуть, не важно есть оно или нет.


vsimonov [2:09 PM] 
да а id нет


Shalukhau Dzmitry [2:10 PM] 
Вариантов несколько: фэйковый id для новых (скажем -1); проверка в jsp; разные jsp для new и для edit


vsimonov [2:11 PM] 
передавай патаметров в строке


[2:12] 
читай в jsp так <form method="post" action="meal?id=${id}&action=edit" (edited)

[2:13] 
в самом meal пронумеруй

[2:13] 
и передай так <td><a href="meal?id=${id}&action=edit"><img src="img/pencil.png"></a></td>


[2:14] 
когда зайдёшь на страниу mealEdit.jsp в строке у тебя будет id

[2:15] 
типа так http://localhost:8080/topjava/meal?id=0&action=edit

Konstantin [2:17 PM] 
подскажите, в чем может быть проблема: <%@ taglib prefix = "c" uri = "http://java.sun.com/jsp/jstl/core" %> подсвечивает красным, Cannot resolve...  в pom jstl подключен


Сергей Матвеев [2:17 PM] 
в репозитории при сохранении идёт проверка на новый
если у еды будет ИД это уже не новая еда  
  public Meal save(Meal meal) {
       if (meal.isNew()){
           meal.setId(couter.incrementAndGet());
       }
       return repository.put(meal.getId(),meal);
   }


Shalukhau Dzmitry [2:17 PM] 
@Konstantin попробуй апнуть в мавене депенденси.


vsimonov [2:18 PM] 
зачем провекру делаешь? если она есть ты перезатрёшь если нет до добавишь
Сергей Матвеев
в репозитории при сохранении идёт проверка на новый
если у еды будет ИД это уже не новая еда  
  public Meal save(Meal meal) {
       if (meal.isNew()){
           meal.setId(couter.incrementAndGet()); Show more…
Posted in #hw1Nov 9th at 2:17 PM


[2:19] 
при добавлении id не указывай

Сергей Матвеев [2:19 PM] 
проверка счётчик мотает


vsimonov [2:20 PM] 
счётчик тебе нужен тока когда в meal выводишь список жратвы

[2:20] 
потом номера раскидываешь по страницам

Сергей Матвеев [2:20 PM] 
Это счётчик ИД

vsimonov [2:20 PM] 
у id счётчик?

Сергей Матвеев [2:21 PM] 
да


vsimonov [2:21 PM] 
зачем?

Сергей Матвеев [2:21 PM] 
генерим ИД

vsimonov [2:21 PM] 
омг

[2:21] 
циклом ебашь


[2:21] 
от 0 до бесконечности

Сергей Матвеев [2:22 PM] 
мы видимо о разном я делал по видео от Григория )


vsimonov [2:22 PM] 
что за видоc,


Сергей Матвеев [2:22 PM] 
https://drive.google.com/file/d/0B9Ye2auQ_NsFQndBeWFOa3phRTg/view

Konstantin
[2:23 PM] 
как это сделать?
Shalukhau Dzmitry
@Konstantin попробуй апнуть в мавене депенденси.
Posted in #hw1Nov 9th at 2:17 PM


Сергей Матвеев [2:23 PM] 
Optional: реализация CRUD

vsimonov [2:23 PM] 
мм откуда ты его взял? нам же его её не высылали


Сергей Матвеев [2:24 PM] 
HW2 канал

[2:24] 
https://topjava12.slack.com/messages/C7WP8KY0Z

vsimonov [2:25 PM] 
блин я незаметил что уже 2 создали


Сергей Матвеев [2:25 PM] 
по четвергам

LORREON [2:41 PM] 
http://localhost:8080/meals?id=2  в сервлете int id = Integer.valueOf(req.getParameter("id")); ->java.lang.NumberFormatException: null


[2:44] 
как в сервлете принять get параметр и перевести его в int?

aanyukhin [2:49 PM] 
может у тебя в url не записывается id параметр? По тому что ты написал всё правильно...


LORREON [2:53 PM] 
в дебагу альт+ф8 параметр id="2\n" вот такой, substring не помогает

[2:55] 
без hibernate не выходит


aanyukhin [2:55 PM] 
лучше найти причину, откуда \n лезет. костыли не надо  городить


LORREON [2:59 PM] 
added this Java snippet: хз, может <@U7FD63QT1|@aanyukhin> ты подскажешь, код:
​
public class MealServlet extends HttpServlet {
  private static final Logger log = getLogger(MealServlet.class);
​
  @Override
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    log.debug("redirect to meals");
​
​
    int id = Integer.valueOf(req.getParameter("id"));
    if (req.getParameter("id") != null) {
​
      ListMeal.getListMeal().deleteMeal(id);
    }
​
    int n = 1;
    String table = "";
​
    for (Map.Entry<Integer, MealWithExceed> m : ListMeal.getListMeal().getMap().entrySet()) {
      DateTimeFormatter formatter = DateTimeFormatter.ofLocalizedDateTime(FormatStyle.SHORT);
      String date = m.getValue().getDateTime().format(formatter);
​
      String color = m.getValue().isExceed() ? "text-danger" : "text-success";
​
      table += "<tr id='tr' class='" + color + "'><th scope='row'>" + n++ + "</th><td>" + date
          + "</td><td>" + m.getValue().getDescription() + "</td><td>" + m.getValue().getCalories() + "</td>" +
          "<td><a href='#'>Редагувати</a></td><td><a href='meals?id="+m.getKey()+"'>Видалити</a></td></tr>";
    }
    req.setAttribute("table", table);
    req.getRequestDispatcher("meals.jsp").forward(req, resp);
​
  }
}
Add Comment Collapse



aanyukhin [3:04 PM] 
m.getKey() смотри, что там... 
А как объясни ты table в meals.jsp пользуешь, можешь показать?


[3:05] 
Что то сложно как то


aanyukhin [3:04 PM] 
m.getKey() смотри, что там... 
А как объясни ты table в meals.jsp пользуешь, можешь показать?


[3:05] 
Что то сложно как то


LORREON [3:05 PM] 
added this Java snippet: ListMeal
public class ListMeal {
  private static ListMeal LIST_MEAL = null;
  private static Map<Integer, MealWithExceed> map = new ConcurrentHashMap<>();
​
​
  public static synchronized ListMeal getListMeal() {
    if (LIST_MEAL == null) {
​
      LIST_MEAL = new ListMeal();
​
      map.put(1, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 29, 10, 0), "Cніданок", 500, true));
      map.put(2, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 29, 11, 0), "Обід", 500, false));
      map.put(3, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 29, 12, 0), "Вечеря", 500, true));
      map.put(4, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 30, 10, 0), "Cніданок", 500, false));
      map.put(5, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 30, 11, 0), "Обід", 500, true));
      map.put(6, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 30, 12, 0), "Вечеря", 500, true));
      map.put(7, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 30, 10, 0), "Cніданок", 500, false));
      map.put(8, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 30, 11, 0), "Обід", 500, false));
      map.put(9, new MealWithExceed(LocalDateTime.of(2017, Month.MAY, 30, 12, 0), "Вечеря", 500, true));
    }
    return LIST_MEAL;
  }
​
  private ListMeal() {
  }
​
  public Map<Integer, MealWithExceed> getMap() {
    return map;
  }
​
  public void deleteMeal(int id) {
    map.remove(id);
  }
​
  public void editMeal(int id, LocalDateTime date, String description, int calories, boolean exceed) {
    if (map.containsKey(id)) {
      MealWithExceed meal = new MealWithExceed(date, description, calories, exceed);
      map.put(id, meal);
    }
  }
}
Add Comment Collapse



LORREON [3:06 PM] 
added this HTML snippet: meals.jsp
<div class="container">
  <h3 class="text-warning">Table Meals</h3>
<table id="meals_table" class="table">
  <thead>
  <tr>
    <th scope="col">#</th>
    <th scope="col">Дата/Час</th>
    <th scope="col">Опис</th>
    <th scope="col">Калорій</th>
    <th scope="col"></th>
    <th scope="col"></th>
  </tr>
  </thead>
  <tfoot>
  <tr>
    <th scope="col">#</th>
    <th scope="col">Дата/Час</th>
    <th scope="col">Опис</th>
    <th scope="col">Калорій</th>
    <th scope="col"></th>
    <th scope="col"></th>
  </tr>
  </tfoot>
  <tbody>
  <c:out value="${table}" escapeXml="false"></c:out>
  </tbody>
</table>
</div>
Add Comment Collapse



aanyukhin [3:18 PM] 
Посмотри переменную table в дебаге, там после id что будет.


russell [3:53 PM] 
Привет. Просьба объясните для чего нужен useBean. Правильно ли я понимаю, это нужно больше, чтобы идея связала аттрибут с конкретным объектом и под капотом у него происходит кастинг с обджекта на конкретный класс (Meal) request.getAttribute("meal")?


tema.emelyan [4:13 PM] 
@russell это мне кажется только чтобы идея подсказывала, по-моему и без него всё работает


[4:14] 
может и нет, посмотри что будет если убрать


tema.emelyan [4:43 PM] 
@russell useBean, видимо, нужно использовать, если хотим создать новый объект класса в jsp.

[4:43] 
если хотим достать уже существующий объект, то можно не использовать я так понял

russell [4:44 PM] 
а новый объект же можно тогда и в сервлете в аттрибут вставить, скорее всего это только для подсказок идеа. в целом штука бесполезна имхо.


tema.emelyan [4:45 PM] 
ну jsp это и есть сервлет


[4:45] 
только специальный

[4:45] 
я недавно узнал, что на него в web.xml даже мапинг можно делать

[4:46] 
можно и в обычном сервлете создавать, это верно. но всё равно классно, когда идея подсказывает

russell [4:48 PM] 
просто если в джсп, что то делать кроме отображения, то нарушается паттерн мвиси


tema.emelyan [4:48 PM] 
согласен


aanyukhin [4:55 PM] 
Как я понял, используя useBean, мы берем имеющийся объект из scope либо создаём новый.


[4:56] 
если указан аттрибут type то ищет в scope, если аттрибут class то создает объект.

tema.emelyan [4:56 PM] 
Но работает все и без него


aanyukhin [4:56 PM] 
да

[4:56] 
нет


[4:56] 
не всё

[4:57] 
попробуй без него запустить TimeUtil.toString(....) в jsp. Не найдет

[4:59] 
я имею ввиду вот это вот
```<%=TimeUtil.formatedDateTime(meal.getDateTime())%>```


russell [5:04 PM] 
Так для скриплет экспрешна надо импорт делать <%@ page import="className" %>

aanyukhin [5:08 PM] 
Да и?

russell [5:10 PM] 
зачем jsp:useBean для скриплетов. (edited)


aanyukhin [5:20 PM] 
Чтобы объявить объект и пользовать в скриплете.

[5:22] 
Иначе мне кажется в скриплете взять этот объект из request( или откуда он там пришёл) и явно приводить


[5:22] 
Но не пробовал

russell [5:24 PM] 
все, кажется я понял о чем ты, по сути jspbean превращает ${} в практически скриплет, так становятся возможным вызовы не только геттеров но и вообще любых методов. Так?


aanyukhin [5:26 PM] 
Да.

[5:28] 
Когда ты делаешь useBean, там прописываешь id (как имя параметра) и пользуешь этот параметр как обычный объект в скриплете (обычном java коде)

russell [5:29 PM] 
Нет скриплет то ладно можно в el получить

[5:30] 
можно было так сделать ${meal.dateTime.toLocalDate()}


aanyukhin [5:32 PM] 
El такое даёт?


russell [5:33 PM] 
у меня получилось


aanyukhin [5:33 PM] 
Без useBean?

russell [5:36 PM] 
да только идея пишет no suggestions но работает. Отсюда вывод скорее, что этот бин нужен для идеи, чтобы подсказку дат или

[5:36] 
подчернуть что метода нет

aanyukhin [5:43 PM] 
Немного бессысленно. Проект пишется для бизнеса. А не для ide. Я к тому, что люди, когда писали jsp, думали облегчить жизнь программисту а не инструменту программиста)


russell [5:43 PM] 
вот и я не пойму для чего он. поэтому и спросил изначально. мне он тоже кажется безссмысленным для jstl


aanyukhin [5:45 PM] 
Как говорят все деятели: "Потому-что могу..."


russell [5:45 PM] 
:slightly_smiling_face:

Viktor [7:25 PM] 
насколько я понял, это "условно" приведение типов. Поскольку когда вы кладете объект в запрос, он будет преведен к Object. Получив его на странице jsp и уточнив класс через jsp:usebean вы получаете объект нужного вам класса (со всеми доступными полями и методами).
Ruslan Shakirov
Привет. Просьба объясните для чего нужен useBean. Правильно ли я понимаю, это нужно больше, чтобы идея связала аттрибут с конкретным объектом и под капотом у него происходит кастинг с обджекта на конкретный класс (Meal) request.getAttribute("meal")?
Posted in #hw1Nov 9th at 3:53 PM


[7:25] 
Но думаю есть ещё какой-то смысл :smiley:

Viktor [8:44 PM] 
added this Plain Text snippet: вопрос по решению (getId)
  private int getId(HttpServletRequest request) {
    String paramId = Objects.requireNonNull(request.getParameter("id"));
    return Integer.valueOf(paramId);
  }
Add Comment

Viktor [8:49 PM] 
@grigory.kislin вопрос тут появился, не очень важный но все же. Objects.requireNonNull выкинете NPE, которые очень часто не совсем понятны. Может лучше было заменить на IllegalArgumentException примерно так:


Viktor [8:50 PM] 
added this Plain Text snippet: new getId
private int getId(HttpServletRequest request) {
    String paramId = request.getParameter("id");
    if (paramId == null) {
      String url = request.getRequestURL() + "?" + request.getQueryString();
      throw new IllegalArgumentException("id mast be not empty in url: " + url);
    }
    return Integer.valueOf(paramId);
  }
Add Comment Collapse



Viktor [8:51 PM] 
мне просто понравились исключения спринга, которые часто прямо на ошибку указывают, а не безликий NPE


chimax [8:51 PM] 
NPE вообще следует избегать


russell [8:58 PM] 
и следом вопрос а вместо этого метода можно было вставить assert paramId != null (edited)


chimax [8:59 PM] 
наверно, этот метод используется для того что бы не писать try catch и не ловить иксепшен где-то, а получить его сразу тут, на месте

russell [9:00 PM] 
assert вообщем то сделает то же самое во время разработки


[9:00] 
его удобно включать через джавовские аргументы

Viktor [9:30 PM] 
@chimax IllegalArgumentException как и NPE это рантайм исключения, если надо, то без разницы какой ловить.

[9:32] 
@russell тут мнений несколько, кто-то совсем против assert в коде, т.к. лишний и в рантайм не сработает (если забыть флаги поставить), а значит многое может упасть и хз почему :smiley: Если вам удобно пользуйтесь, но всегда спрашивайте тех с кем пишите, удобно ли будет им.


grigory.kislin [9:38 PM] 
> но всегда спрашивайте тех с кем пишите, удобно ли будет им.
на каждом проекте свои правила. определяет лид или архитектор. и меняют уже редко. я проектов где пользуют assert  не встречал
их вроде в java 4 ввели и оне не особо прижились

Shalukhau Dzmitry [9:59 PM] 
@grigory.kislin насчет ассертов, у нас н проекте (не java) они используются для отлова своих же ошибок внутри защищенных методов, типа мягкие контракты. Но, учитывая возможности АОП в java - понимаю почему они не прижились...

Li0n13 [10:25 PM] 
Непонятен момент с форматтером даты. В классе `DateTimeUtil` поле `DATE_TIME_FORMATTER` объявлено как private final, к тому же используется только для чтения. Зачем надо в такой ситуации заботиться о потокобезопасности? (edited)


----- Yesterday November 10th, 2017 -----
Kirilo [3:20 AM] 
А мне не понятно зачем была использована вставка java-code в jsp при выводе даты, тогда, как остальные элементы мы доставали со списка? Почему нельзя было сделать в том же Meal метод для возврата даты с типом String?

aanyukhin [5:21 AM] 
@Kirilo, смысл с датой заключался в том, что по заданию требовалось вывести в списке дату отформатированную (без T) . Стандартный toString для LocalDateTime отображается по шаблону ISO_LOCAL_DATE_TIME (с T)

Few [5:47 AM] 
@Kirilo Сделать можно,  но в приложении нам может потребоваться несколько вариантов вывода даты,  поэтому форматирование лучше вынести в утилиты,  я так думаю



grigory.kislin [2:06 PM] 
@Shalukhau Dzmitry у нас будет на 4м уроке проверка предусловий. обычно обычными утильными классами пользуются. aop не при чем

grigory.kislin [2:08 PM] 
@Li0n13  Зачем надо в такой ситуации заботиться о потокобезопасности?
если я правильно вопрос понял- например старый SimpleDateFormatter хранит в себе состояние. те один экземпляр нельзя использовать на несколько потоков одновременно. С java 8 time API все ок
1 reply 1 day ago View thread

grigory.kislin [2:09 PM] 
@Kirilo
>  же Meal метод для возврата даты с типом String
ну и идеологически неверно отображение (форматирование) выностить в бин, который хранит данные
и при изменении формата менять не представление а данные


vsergeev [5:09 PM] 
Может я пропустил объяснение, но почему Meal save(), а не void save()? Я думал что методы которые что-то меняют не должны ничего возвращать и наоборот. Да и, вроде, нигде возвращаемое значение пока что не используется.

russell [5:31 PM] 
Тоже интересен этот вопрос. Возможно здесь мини паттерн как с мапой, она тоже возвращает значение при добавлении. (edited)


Дима Жуков [5:32 PM] 
Вроде ж говорили что часто когда сохраняешь, потом необходимо с сохранённым работать. Вроде (edited)

Grub [5:35 PM] 
ну например 
`log.debug("Create meal with id {}", mealRepository.save(meal).getId()) )`


russell [5:38 PM] 
@Grub Спасибо, теперь ясно (edited)


grigory.kislin [6:10 PM] 
save() для новой сущности id новое автогенерит. можно id возвращать, но в ORM принято сужность с новым id
опять включается в персистент контекст
дойдем до ORM- там все так



Kirilo [7:28 PM] 
@Few выглядит ночень. Если я правильно понимаю, вставлять java code в отображение не очень хороший стиль. Возможно jsp не сильно подходит для современных нужд? (edited)

Kirilo [7:40 PM] 
@aanyukhin ну, вот, находятся же такие, вот, граммотеи... Все то же самое можно сделать, если использовать методы, милсвизэксидед, вызвав сначала дату, затем время и вставив между ними пробел... Например, для первого задания первого урока, я так и делал... Формировал список не милс, а милс с эксидед. (edited)


kadmser [7:53 PM] 
В вопросах к первому HW есть:

[7:53] 
Objects.requireNonNull в MealServlet.getId(request) если у нас нет id в запросе бросает NPE (NullPointerException). Но оно вылетит и без этого метода. Зачем он нужен и почему мы его не обрабатываем?


russell [7:54 PM] 
что бы вылетело, на самом раннем этапе, а то потом концов не найдешь. Дебажить надо будет.

[7:55] 
unchecked exceptions обычно не обрабатывают, насколько я понимаю


[7:56] 
если только пробросить свой эксепшн надо

kadmser 
[7:57 PM] 
доперло)


Valery [8:11 PM] 
>вызвав сначала дату, затем время и вставив между ними пробел...
это какой-то костыль. Он дает урезанное решение. Форматтер позволяет больше вариаций вывода даты. Если тебе потребуется выводить не номер месяца, а название? или год не 2017, а 17?


Kirilo [8:14 PM] 
@Valery то есть java код в отображении - это красиво и изящно? (edited)


Valery [8:32 PM] 
ты же вызываешь дату и время. так же и с форматтером.

Kirilo [8:35 PM] 
вопрос не в том. Даже с применением шаблона в отображение можно выводить иначе. вообще по умолчанию там тип Object... (edited)


Dmitry Makarov [8:46 PM] 
Я уже после того как прочитал про ДТО тоже задумался почему бы не сделать это поле строкой. Ведь ДТО не обязательно должен иметь те же поля что и модель. Возможно с датой проще будет сделать локализацию. Например месяц писать по-английски, по-русски, или вообще предоставить пользователю возможноть выбора формата отображения находу, без пересоздания объекта. (edited)


Kirilo [8:52 PM] 
И затем так же можно преобразовывать строку в дату. Главное на вход поставить какие-то приемлемые параметры... и выбрасывать сообщение, если что-то введено не так...

grigory.kislin [9:04 PM] 
dto- теже данные. туда не надо форматирования

Viktor [9:09 PM] 
В данном случае jsp - "вид", контроллер отвечает за обработку данны, модель за хранение, вид за отображение. Поэтому именно вид получая данные модели от контроллера должен заниматься переделом их в читаемый вид.


aanyukhin [10:29 PM] 
@Kirilo, не совсем понятна постановка вопроса. В принципе, делать можно как душе угодно. Решений вопросов множество. Какие-то более красивы, какие-то менее, но от этого не перестают быть решением. Единственное ограничение, это code review который будут делать твои коллеги и (не)пропустят решение на прод. Мы тут все и занимаемся на этом курсе, чтобы впитывать эти решения.

new messages

----- Today November 11th, 2017 -----
Erick
[4:18 PM] 
uploaded and commented on this image: jsp.JPG
1 Comment
подскажите, откуда и куда библиотеку загрузить?



Дима Жуков [4:19 PM] 
в гугле набери мавен jstl 1.2, найдешь депенденси и в пом.хмл


[4:20] 
потом просто re-import, он поддтянет


Erick [4:26 PM] 
uploaded and commented on this image: pom
1 Comment
Reimport All Maven Projects
Generate Sources And Update Folders
Download Sources and Documentation
сделал перед тем как задавать вопрос.


Dmitry Neustupov [4:42 PM] 
added this Java snippet
<dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>jstl</artifactId>
      <version>1.2</version>
</dependency>
Add Comment



Dmitry Neustupov [4:43 PM] 
@Erick эта зависимость в pom.xml есть?


Erick [4:45 PM] 
<!--Web-->
       <dependency>
           <groupId>javax.servlet</groupId>
           <artifactId>jstl</artifactId>
           <version>1.2</version>
       </dependency>

да. сейчас из зависимостей и из репозитория Мэйвн удалю все, и поновой пропишу. может поможет (edited)


Erick [4:54 PM] 
да. зависимость есть, удалил зависимость, удалил библиотеку jstl из репозитория Maven. прописал и подтянул по новой. не помогло


Erick
[6:20 PM] 
uploaded and commented on this image: jsp с накатанным патчем.PNG
1 Comment
устал с идеей биться. 
форкнул с нуля и накатил патчи на другой машине, собрал проект топджава, запустил сервер. все работает. таблица отрисовывается. 
идея отказывается принимать строку <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>



russell [6:22 PM] 
@Erick попробуй эту зависимость <dependency>
   <groupId>jstl</groupId>
   <artifactId>jstl</artifactId>
   <version>1.2</version>
</dependency> (edited)

Erick
[6:25 PM] 
спасибо. не помогло.


russell [6:25 PM] 
web xml какой версии

Erick
[6:27 PM] 
version="3.1"


[6:29] 
apache-maven-3.5.2


tema.emelyan [6:30 PM] 
@Erick File->Invalidate Caches/Restart->Invalidate and Restart (по совету @Alexander _Gubanow) (edited)


russell [6:30 PM] 
так все правильно, инвалидейт должен помочь


Erick [6:37 PM] 
спасибо. заработало.


Andrew [8:11 PM] 
Друзья, знаю, неактуально, но может подскажет кто - Без фильтрации start time and end time - надо выставить просто 0, 0 - 23,59?


Антон Кляшторный [8:14 PM] 
LocalTime.MIN, LocalTime.MAX


Andrew [8:15 PM] 
Спасибо, друг!
Надо было добавлять геттеры в MealWithExceed? Ибо из jsp пока не понял как доставать значения..

Антон Кляшторный [8:22 PM] 
"геттеры в MealWithExceed" вставляй в поиск по slac, тут все ответы в истории, в среду тут было "горячо". Геттеры есть.


Антон Кляшторный [8:23 PM] 
все преувеличил, но многое есть :slightly_smiling_face:


Andrew [8:34 PM] 
Ох, всё равно не пашет item.description..


[8:34] 
Из jsp


Andrew [9:17 PM] 
Теперь в JSP не могу задать цвет тексту :disappointed: Сделал условие. Если вставляю обычный текст - красит, но этот - с вытягиванием переменных - нет (


russell [9:18 PM] 
ты через класс вставляешь, покажи код


Andrew [9:19 PM] 
uploaded this image: Pasted image at 2017-11-11, 8:18 PM
Add Comment



Andrew [9:19 PM] 
Тут я убрал выбор цвета, ибо ничего не работало


russell [9:21 PM] 
Для начала такой вариант с choose when не советуют, юзай тернарный оператор. Затем bool == true не пишут, делай ${bool}.


vch [9:21 PM] 
@Andrew Посмотри "Типичную ошибку 15". Цвет она не вернёт, но объём кода сократит.


Argentum_kuh [9:23 PM] 
Ну не знаю. У меня с choose работает. И с if тоже, кстати


russell [9:23 PM] 
в третьих должен быть <c:otherwise> означающее else


[9:24] 
@Andrew цвет как вставлял через инлайн стайл или класс? (edited)


Andrew [9:37 PM] 
Я пытался цвет влепить через span тег


[9:39] 
<span style="color: red;">${i}</span>


russell [9:41 PM] 
${i} это что. Цвет вроде правильно ставишь.


Andrew [9:41 PM] 
<span style="color: red;"><td>${itemBean.description}</td> <td></td> <td>${itemBean.calories}</td> <td></td> <td> ${itemBean.dateTime}</td></span>


[9:41] 
вот полная строка, то типа был заменитель :slightly_smiling_face:


russell [9:43 PM] 
спан же строковый, возможно из-за этого, сделай <tr style="color: red;">


Andrew [9:44 PM] 
Офигенно! Заработало, спасибо!!


Andrew [10:49 PM] 
Если не лень, подсткажите как в JSP кнопкой отправлять отмеченные чекбоксы , не используя JS


[10:50] 
Даже не знаю как искать..


russell [10:51 PM] 
как понять отправлять, там все тоже самое, только у них нейм одинаковый, а значения разные. Он сам в теле отправляет


Andrew [10:54 PM] 
Ну то есть, у меня есть кнопка Delete (ничего не делает) и табличка с чекбоксами (валйу чекбокса = айди записи). Как сделать, чтобы кнопка Делит отправляла айди серверу в Пост? Надо видимо мне почитать теорию..


[10:54] 
FrontEnd моя слабость


Li0n13 [10:56 PM] 
Чтобы кнопка отправляла, делай форму, и на ней - чекбоксы и кнопка.


russell [10:57 PM] 
либо делай форму, либо только джаваскриптом


Valery [11:02 PM] 
@Andrew, на каждую запись сделай кнопку удаления и в нее зашей ID. ты сейчас хочешь одим нажатием удалять несколько записей. этого не требовалось в задании.


Andrew [11:06 PM] 
@Valery Да, это звучит проще, попробую. Спасибо
