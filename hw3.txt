grigory.kislin [2:07 AM] 
joined #hw3.


grigory.kislin [2:07 AM] 
set the channel topic: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md


grigory.kislin [2:08 AM] 
WELCOME TO: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


[2:09] 
письмо как обычно днем (edited)


dyakoven [2:09 AM] 
joined #hw3 along with 18 others. 


MetalBro [10:23 AM] 
вопрос по реализации фильтрации по датам. Если зададим только время, в этой реализации будет учитываться только время дня без привязки к дням? Зачем просто ввод констант


[10:23] 
на дни


[10:24] 
пересмотрел, вроде все нормально)


grigory.kislin [11:11 AM] 
@MetalBro демо: http://topjava.herokuapp.com (edited)


Glumov Konstantin [2:14 PM] 
после накатывания патча 3_05 возникает ошибка при вызове mealServlet. У всех так или только у меня? Ругается что не может создать бин userServiceImpl


Glumov Konstantin [2:19 PM] 
помог clean, хотя думал что package автоматом должен его вызвать


MetalBro [7:55 PM] 
На почту будет?


grigory.kislin [8:51 PM] 
сорри, письмо счас будет
@Glumov Konstantin package его автоматом не должен вызывать


vch [9:05 PM] 
set the channel purpose: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md


Rostish [5:02 AM] 
у меня после патча с junit все ломается почему-то


[5:03] 
3.06, пропадают моки репозитория, а из-за этого в рест классе куча ошибок


[5:06] 
3.07


Few
[5:12 AM] 
Папку test создал предварительно?


Dmitry Neustupov [8:07 AM] 
@Rostish те же дела, папку test в src создал, накатил патч с junit и куча ошибок повыскакивало.


Dmitry Neustupov [8:28 AM] 
Видимо Идея глюканула, перезапустил - всё нормализовалось.


Denis1989 [8:41 AM] 
Ну да, реально беда. Идея все по подчеркивала красным (( а работать, работает.


[8:42] 
а вчера все норм было


[8:43] 
Она не может определиться из какой папки java классы грузить


Rostish [9:38 AM] 
я просто из тест копернул  в папку мок те же классы


[9:38] 
все норм сталло


[9:38] 
но у меня не подтягивает следующие классы

[9:38] 
//Assert.assertEquals(users.size(), 1);
       //Assert.assertEquals(users.iterator().next(), ADMIN);


[9:38] 
пришлось пока закомментить


[9:39] 
тьфу


[9:39] 
методы


Valery [9:40 AM] 
вот тут непонимание. классы надо копировать или переносить? патч их переносит.


[9:40] 
классы из папки мок


vch [9:41 AM] 
@Valery Переносить. mock в рабочей части проекта не нужны. Они для тестов.


Valery [9:44 AM] 
до тестирования у меня проект работал. после патча 307 не работает


vch [9:46 AM] 
@Valery Привыкай... Так в половине HW будет.
Не зря же 1 пунктом HW идёт починка проекта.


Rostish [9:59 AM] 
У меня не совпдает половина того, что на экране с тем, что после патчей))


[9:59] 
на экране - в видео


Katherine Buzatu [1:09 PM] 
Какую версию PostgreSQL ставить?


MetalBro [1:33 PM] 
какие привилегии должны быть у создаваемой роли юзера?


RNG [2:01 PM] 
@Katherine Buzatu На прошлой стажировке у меня стояла версия 9.5, проблем вроде бы не было с ней. Перед 3-им уроком обновился до 10.1, пока полет нормальный.



Ivan [4:57 PM] 
В связи с переходом на PostgreSQL из MemoryMealrepository и с учётом п. 3.2. (userId в класс Meal вставлять НЕ надо) осознавая, что в памяти мы хранили Мапу в Мапе! верно ли я создал столбцы в таблице Meals (id, userid, datetime, description, calories)? Или необходимо map<meal> хранить в каком-нибудь BLOB? ("save" реализовал без проблем, возникли вопросы при "get");


Grub [5:00 PM] 
userId будет ключ на таблицу юзеров


Ivan [5:07 PM] 
@Grub совершенно верно. У меня проблема (ступор, не приходит на ум, не знаю) как при при GET запросе через jdbcTemplate за один запрос вытащить meal (в котором нет userId) и userId на проверку.


MetalBro [5:38 PM] 
после патча 3.11 выскакивала ошибка создания бина, после 3.13 вылетает NPE. Так должно быть? До какого патча можно посмотреть работу приложения или оно ломается сразу?


Katherine Buzatu [5:56 PM] 
> выскакивала ошибка создания бина,
Бин сразу сломали. Как к тестам приступили.


MetalBro [6:02 PM] 
на каком патче еще работало, чтобы откатить посмотреть?)


[6:04] 
имею в виду, рабочего приложения с БД не было?


Katherine Buzatu [6:05 PM] 
Я пока на 3.10. Бин сломан.


MetalBro [6:06 PM] 
а на предыдущих проверяла? Я решил проверить только на 3.11


Katherine Buzatu [6:08 PM] 
Не проверяла, но знаю, что не работало. (Нашла причину)


Valery [7:58 PM] 
> До какого патча можно посмотреть работу приложения или оно ломается сразу?
ломается на патче 307


Anton K. [10:31 PM] 
Привет всем, подскажите как в идее настроить референс на текущую БД


[10:31] 
чтобы было автозаполнение и прочие плюшки


[10:31] 
А то у меня желтым подсечивает и пишет что не может найти


[10:32] 
я потыкался в настройках так и не понял где выставить


Katherine Buzatu [10:35 PM] 
Попробуй скриншот вставить, где у тебя желтым светится и что пишет.


Tanya [11:34 PM] 
@MetalBro в дз будет
> 6 Предложить решение, как почнинить SpringMain, InMemory*Test. InMemory*Test



----- Today November 18th, 2017 -----
Anton K. [12:04 AM] 
uploaded this image: image.png
Add Comment



Katherine Buzatu [12:21 AM] 
@Anton K. По видео `3_07_Set_db_in_IDEA` все сработало, как надо?

Anton K. [12:25 AM] 
Я уже не помню))


Anton K. [12:26 AM] 
Все работает просто не подсвечивает
 3 replies Last reply today at 10:33 AM View thread

Katherine Buzatu [12:27 AM] 
Там как раз подробно описывается, как подключить БД к Идее. Если не сделал - надо сделать. Если сделал и все равно не работает - уже другой вопрос.


Alexander _Gubanow [10:45 AM] 
У меня таблицы во вкладке Database в IDEA не отображаются после выполнения скриптов, что надо поднастроить?


Alexander _Gubanow [11:14 AM] 
uploaded this image: 01.jpg
Add Comment



Few [12:20 PM] 
Что-то не понимаю, как при текущей реализации JdbcUserRepositoryImpl роли пользователя будут в базу попадать?


Few 
[12:27 PM] 
@Alexander _Gubanow https://intellij-support.jetbrains.com/hc/en-us/community/posts/206433049-Database-stuck-on-Loading-when-showing-tables
IDEs Support (IntelliJ Platform) | JetBrains
Database stuck on "Loading" when showing tables
I am running into a fairly consistent issue in the Database Tool window where the tables never appear when I expand a db. All that shows is "Loading..." So far, the only way I can get it ... (31 kB)
 


[12:27] 
похоже на твою проблему


Alexander _Gubanow [1:11 PM] 
@Few Спасибо, помогло. Проблема была с кешем IDEA.


Katherine Buzatu [1:41 PM] 
Зачем в JdbcUserRepositoryImpl поле ROW_MAPPER static? У нас же все равно синглтон.


anpotashev [4:08 PM] 
Не пойму зачем метод List<Meal> getBetweenDateTimes в MealService


Katherine Buzatu [4:15 PM] 
Предположу, что это - основной метод, который делает выборку по входным параметрам типа поля модели (LocalDateTime). А другие методы, принимающие на вход параметры других типов, будут вызывать в итоге метод. Вроде как задел на расширяемость. (edited)


anpotashev [4:21 PM] 
Но зачем время в методе возвращающем список Meal, а не MealWithExeeded?


Katherine Buzatu [4:30 PM] 
Потому что это не та фильтрация по дате и времени, что у нас в интерфейсе, а фильтрация только по дате, но в формате DateTime


anpotashev [4:53 PM] 
Все равно не понимаю зачем в сервисе добавлять время, если можно в sql отбросить время и сравнивать только по датам.


Katherine Buzatu [5:25 PM] 
Коллеги, у меня произошел взрыв мозга тут:
> 5.1 Сделать тестовые данные MealTestData, АНАЛОГИЧНЫЕ пропопулированным в populateDB.sql.
Объясните, кому не лень, своими словами.


anpotashev [5:28 PM] 
Т.е., так понима, чтобы данные полностью совпадали с данными в бд, которые загружаются из sql-файла



russell [5:28 PM] 
создать точно такие же объекты чтобы можно было сравнить с данными в базе, expected vs actual
 


Viktor [6:02 PM] 
Вопрос, у меня у одного исчез SpringMain или так и должно быть? rfr-nj yt ecktlbk

[6:02] 
(глупая раскладка) как-то не уследил


russell [6:03 PM] 
@Viktor он не исчез, а в тесты переместился. (edited)


Few [6:07 PM] 
@Katherine Buzatu аналогично,  не понял этот пункт


Viktor [6:17 PM] 
@russell спс это я и не заметил


vsimonov [7:41 PM] 
у всех postgres нормально ставится?

Дима Жуков 
[7:42 PM] 
Я поставил 9.5. без проблем вообще

vsimonov [7:46 PM] 
9.5.10 ?
Жуков Дмитрий
Я поставил 9.5. без проблем вообще
Posted in #hw3Today at 7:42 PM


vsimonov [7:55 PM] 
у меня 9.4 заработала (edited)


Valery [7:58 PM] 
база встала, но проблемы с админкой...

Дима Жуков [8:00 PM] 
@vsimonov да


Viktor [8:11 PM] 
у меня уже стоял @vsimonov пишите, что конкретно не встает (ps тыжпрограммист) :smiley: (edited)


Valery [8:19 PM] 
в базе уже есть юзер с именем user. его надо сбросить?


Viktor [8:29 PM] 
зачем?

russell [8:30 PM] 
Подскажите LocalDateTime чем заменяли в сиквеле? Timestamp?


Viktor [8:30 PM] 
а базе это в таблице users? или в пользователях postgre?


Valery [8:31 PM] 
в пользователях postgre


[8:31] 
я не знаю его пароль. как я могу его использовать в проекте?


[8:32] 
пришлось пересоздать...

Viktor [8:34 PM] 
@Valery пока проект не настоящий, можете создать себе пользователя root root и не задумываться :smiley: у меня и постгресе и mysql такой есть


Dmitry Neustupov [8:38 PM] 
Товарищи, подскажите, в чём может быть проблема? Установил постгрес, создал базу topjava, создал юзера user с паролем password, в идее подключил постгрес, скачал и установил драйвер, но при попытке коннекта к базе пишет - 28000 для роли user вход запрещён. Пароли проверял, менял. Безрезультатно (


vsimonov [8:39 PM] 
@Viktor на винду postgres ставил?
1 reply Today at 8:47 PM View thread

MetalBro [8:39 PM] 
в pgAdmin привилегии надо выставить


[8:39] 
для user

Viktor [8:39 PM] 
@vsimonov да


Dmitry Neustupov [8:43 PM] 
@MetalBro Спасибо! ) Не думал, что нужно ручками возможность логиниться выставлять для юзера )


vsimonov [8:45 PM] 
версия?
Sergeev Viktor
@vsimonov да
Posted in #hw3Today at 8:39 PM


Katherine Buzatu [8:47 PM] 
У меня на винде. Версия 10 без проблем.

Viktor [8:49 PM] 
@vsimonov 9.6

Valery [8:54 PM] 
pgAdmin III говорит, что версия базы не поддерживаемая...

[8:54] 
как посмотреть версию postgre?

vsimonov [8:56 PM] 
расскажи как ставил
Sergeev Viktor
@vsimonov 9.6
Posted in #hw3Today at 8:49 PM

Viktor [8:59 PM] 
@vsimonovты пиши, что не получилось, я устанавливал несколько мес назад

[8:59] 
@Valery скачай админку 4 версии

[9:00] 
@Valery WARNING: pgAdmin 3 is no longer supported. It is recommended that you download pgAdmin 4 instead.

[9:00] 
@Valery https://www.pgadmin.org/download/
pgadmin.org
Download
pgAdmin Website

Valery [9:00 PM] 
4 только веб версию нашел

vch [9:01 PM] 
@Viktor А 4 версия нормально работает?
У нас один человек скачал 4 версию. После 1 дня работы цензурных слов в его лексиконе уже не было.

Viktor [9:02 PM] 
@vch у меня запросы не большие, мне там всего то надо было создать БД topjava, дальше все готовыми скриптами из IDEA

Valery [9:03 PM] 
если только создать БД, то и консоли достаточно.

Viktor [9:10 PM] 
ага

vsimonov [9:13 PM] 
Как ты ставила расскажи
Katherine Buzatu
У меня на винде. Версия 10 без проблем.
From a thread in #hw3Today at 8:47 PM
1 reply Today at 9:15 PM View thread
grigory.kislin [9:31 PM] 
слово АНОЛОГИЧНО в уроке заменил
у меня старенький postgres 9.5, по новым не подскажу
@Katherine Buzatu
> зачем ROW_MAPPER static? У нас же все равно синглтон
(в смысле JdbcUserRepositoryImpl в контесксте sprig как я понял)
я делаю скорее по логике... если например будет 2 контекста спринг- будет это static или нет
но вообще, если найдешь на эту тему ссылки, было бы хорошо.. 
константы то по любому статик делают, а тут могут быть варианты.. (edited)


Katherine Buzatu [12:01 PM] 
@grigory.kislin, можно пару слов в поддержку п. 1 раздела `Проверка по HW03 (сначала сделайте самостоятельно!)`? _(не цитирую - для тех, кто еще не сделал)_


vsimonov [7:55 PM] 
у меня 9.4 заработала (edited)

Valery [7:58 PM] 
база встала, но проблемы с админкой...

Дима Жуков [8:00 PM] 
@vsimonov да

Viktor [8:11 PM] 
у меня уже стоял @vsimonov пишите, что конкретно не встает (ps тыжпрограммист) :smiley: (edited)

Valery [8:19 PM] 
в базе уже есть юзер с именем user. его надо сбросить?

Viktor [8:29 PM] 
зачем?

russell [8:30 PM] 
Подскажите LocalDateTime чем заменяли в сиквеле? Timestamp?

Viktor [8:30 PM] 
а базе это в таблице users? или в пользователях postgre?

Valery [8:31 PM] 
в пользователях postgre

[8:31] 
я не знаю его пароль. как я могу его использовать в проекте?

[8:32] 
пришлось пересоздать...

Viktor [8:34 PM] 
@Valery пока проект не настоящий, можете создать себе пользователя root root и не задумываться :smiley: у меня и постгресе и mysql такой есть

Dmitry Neustupov [8:38 PM] 
Товарищи, подскажите, в чём может быть проблема? Установил постгрес, создал базу topjava, создал юзера user с паролем password, в идее подключил постгрес, скачал и установил драйвер, но при попытке коннекта к базе пишет - 28000 для роли user вход запрещён. Пароли проверял, менял. Безрезультатно (

vsimonov [8:39 PM] 
@Viktor на винду postgres ставил?
1 reply 20 hours ago View thread
MetalBro [8:39 PM] 
в pgAdmin привилегии надо выставить

[8:39] 
для user

Viktor [8:39 PM] 
@vsimonov да

Dmitry Neustupov [8:43 PM] 
@MetalBro Спасибо! ) Не думал, что нужно ручками возможность логиниться выставлять для юзера )

vsimonov [8:45 PM] 
версия?
Sergeev Viktor
@vsimonov да
Posted in #hw3Yesterday at 8:39 PM

Katherine Buzatu [8:47 PM] 
У меня на винде. Версия 10 без проблем.

Viktor [8:49 PM] 
@vsimonov 9.6

Valery [8:54 PM] 
pgAdmin III говорит, что версия базы не поддерживаемая...

[8:54] 
как посмотреть версию postgre?

vsimonov [8:56 PM] 
расскажи как ставил
Sergeev Viktor
@vsimonov 9.6
Posted in #hw3Yesterday at 8:49 PM

Viktor [8:59 PM] 
@vsimonovты пиши, что не получилось, я устанавливал несколько мес назад

[8:59] 
@Valery скачай админку 4 версии

[9:00] 
@Valery WARNING: pgAdmin 3 is no longer supported. It is recommended that you download pgAdmin 4 instead.

[9:00] 
@Valery https://www.pgadmin.org/download/
pgadmin.org
Download
pgAdmin Website

Valery [9:00 PM] 
4 только веб версию нашел

vch [9:01 PM] 
@Viktor А 4 версия нормально работает?
У нас один человек скачал 4 версию. После 1 дня работы цензурных слов в его лексиконе уже не было.

Viktor [9:02 PM] 
@vch у меня запросы не большие, мне там всего то надо было создать БД topjava, дальше все готовыми скриптами из IDEA

Valery [9:03 PM] 
если только создать БД, то и консоли достаточно.

Viktor [9:10 PM] 
ага

vsimonov [9:13 PM] 
Как ты ставила расскажи
Katherine Buzatu
У меня на винде. Версия 10 без проблем.
From a thread in #hw3Yesterday at 8:47 PM
1 reply 20 hours ago View thread
grigory.kislin [9:31 PM] 
слово АНОЛОГИЧНО в уроке заменил
у меня старенький postgres 9.5, по новым не подскажу
@Katherine Buzatu
> зачем ROW_MAPPER static? У нас же все равно синглтон
(в смысле JdbcUserRepositoryImpl в контесксте sprig как я понял)
я делаю скорее по логике... если например будет 2 контекста спринг- будет это static или нет
но вообще, если найдешь на эту тему ссылки, было бы хорошо.. 
константы то по любому статик делают, а тут могут быть варианты.. (edited)


----- Today November 19th, 2017 -----
Katherine Buzatu [12:01 PM] 
@grigory.kislin, можно пару слов в поддержку п. 1 раздела `Проверка по HW03 (сначала сделайте самостоятельно!)`? _(не цитирую - для тех, кто еще не сделал)_

grigory.kislin [2:02 PM] 
> Проверка по HW03 (сначала сделайте самостоятельно!)
ну, там могут быть явные подсказки.. если наступите на грабли- лучше запомнится
пользы думаю больше будет, если сначала сделать самому (крайний случай- когда только мои решения смотреть- тогда польза минимальна)

Katherine Buzatu [2:33 PM] 
Понятно. Ждем часа Х для обсуждения.

vsimonov [3:22 PM] 
added and commented on this Plain Text snippet
1 Понять, почему перестали работать SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest
1 Comment
тут нужно только понять или ещё попробовать починить?

chimax [3:23 PM] 
понять и ~простить~ починить)

ujwegh [3:44 PM] 
"Порядок таблиц при DROP и DELETE важен, если они связаны fk."  что такое fk?

Дима Жуков 
[3:46 PM] 
Foreign key. Внешний ключ. Таблицы связывают


philip.goldm [3:54 PM] 
>6 Предложить решение, как почнинить SpringMain, InMemory*Test. InMemory*Test должны использовать реализацию в памяти
Мне одному кажется `Предложить решение` двусмысленно написано?  Наверное лучше написать, починить ...?


chimax [3:54 PM] 
не забывай про бонусы, возможно, что это заэвуалированное приглашение их получить)
1 reply Today at 3:56 PM View thread

Дима Жуков [3:55 PM] 
Проверка дз есть?
 3 replies Last reply today at 3:57 PM View thread

ujwegh [3:59 PM] 
Дима Жуков спасибо


new messages
Антон Кляшторный [5:12 PM] 
uploaded this image: Вывод main.png
Антон Кляшторный [5:12 PM] 
Починеный main такой должен быть?


ujwegh [8:21 PM] 
возможно глупый вопрос, почему тест создаем из MealService, а не MealServiceImpl?


anpotashev [8:23 PM] 
Может быть несколько реализаций интерфейса и все они должны проходить эти тесты



[8:24] 
Ты можешь с помощью, например аннотаций, выбрать другую реализацию.


ujwegh [8:24 PM] 
понятно) спасибо


russell [8:25 PM] 
@anpotashev какая аннотация?


[8:25] 
profile


Dmitry Makarov [8:25 PM] 
Qualifier


anpotashev [8:25 PM] 
Она


russell [8:25 PM] 
там можно через @Profile включать


[8:26] 
например одна для тестов, другая для продакшена


anpotashev [8:26 PM] 
Profile не пользовался. Пойду почитаю что за зверь.

Shalukhau Dzmitry [8:48 PM] 
Добрался до HW3 - так много видео :slightly_smiling_face:


chimax [11:39 PM] 
Кто заглядывал в код реализации метода ConcurrentHashMap.computeIfPresent?


[11:39] 
такое.... воообще человек может написать?




----- Today November 20th, 2017 -----
Ivan [8:58 AM] 
Подскажите ни у кого не возникало проблем с обновлением записи, в частности с изменением времени?


Few [9:04 AM] 
Не вполне конкретный вопрос :slightly_smiling_face:


Shalukhau Dzmitry [9:07 AM] 
@chimax Ну пока что AI не умеет код сам писать...


vsimonov [9:18 AM] 
uploaded and commented on this image: autowired.jpg
  1 Comment
Гугл не помагает, притом дома всё работало :disappointed:



Few
[9:20 AM] 
Spring-db.xml скорее всего в настройках контекста не прописан (edited)


vsimonov [9:21 AM] 
а может потому что самой базы нет? :slightly_smiling_face:
Fedor Vershinin
Spring-db.xml скорее всего в настройках контекста не прописан
Posted in #hw3Today at 9:20 AM


Ivan [9:21 AM] 
Есть таблица (...dateTime TIMESTAMP DEFAULT now() NOT NULL,...), с которой работают все наши CRUD методы, кроме update,
(namedParameterJdbcTemplate.update(
                  "UPDATE meals SET datetime=:dateTime, description=:description,  calories=:calories " +
                          "WHERE id=:id AND userid=:userId", source)

при этом "UPDATE meals SET description=:description, calories=:calories " +
"WHERE id=:id AND userid=:userId - работает прекрасно, правда дату не меняет:grimacing:


Few [9:21 AM] 
Ха


vsimonov [9:27 AM] 
а не ошибка таже

Few [9:27 AM] 
Timestamp.valueOf(localDateTime);


vsimonov [9:27 AM] 
бин есть


vsimonov [9:28 AM] 
added this Plain Text snippet
<bean id="dataSource"
     class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="org.postgresql.Driver"/>
    <property name="url" value="${database.url}"/>
    <property name="username" value="${database.username}"/>
    <property name="password" value="${database.password}"/>
  </bean>
Add Comment Collapse



vsimonov [9:29 AM] 
added this Plain Text snippet: полный вывод ошибки
Exception in thread "main" org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
10:26:13.201 WARN o.s.context.support.AbstractApplicationContext.refresh:551 - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:749)
  at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:189)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1193)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1095)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  at org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  at org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:83)
  at ru.javawebinar.topjava.SpringMain.main(SpringMain.java:20)
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.raiseNoMatchingBeanFound(DefaultListableBeanFactory.java:1493)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1104)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1066)
  at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835)
  at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741)
  ... 15 more
Add Comment Collapse



Rostish [9:39 AM] 
я чет тоже подзавис на понимании почему не работает

[9:39] 
уже 2 часа гуглю

[9:39] 
на спринге прочитал все варианты этой ошибке в туториале


Few
[9:39 AM] 
@vsimonov А запускаешь что? тест, SpringMain или сервлет на томкате?

Rostish [9:39 AM] 
но они чет не подходят сюда

Few
[9:39 AM] 
в каждом случае в своем месте контекст настраивается

Rostish [9:40 AM] 
это часть дз 1 Понять, почему перестали работать SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest


Few
[9:40 AM] 
чтобы понимать куда смотреть дальше


Rostish [9:40 AM] 
у всех не работает по одной и той же причине


russell [9:40 AM] 
@Rostish ответ вообщем то есть в видео, только Григорий делает в обратную сторону

Few [9:40 AM] 
ну я не знаю, стоит ли сюда писать ответ?


Rostish [9:41 AM] 
нет, ты можешь сказать где почитать

[9:41] 
так тоже пойдет

Few
[9:42 AM] 
да в общем то надо смотреть в сторону того, какие бины при текущей конфигурации в контекст попадают


Ivan [9:42 AM] 
@Few Спасибо большое, всё заработало (не знал, что TimeStamp есть в Джаве). Здоровенный + в карму!


vsimonov [9:44 AM] 
SpringMain
Fedor Vershinin
@vsimonov А запускаешь что? тест, SpringMain или сервлет на томкате?
Posted in #hw3Today at 9:39 AM


[9:45] 
дома у меня всё проходило,ну ок

Katherine Buzatu [9:51 AM] 
Копай на тему того, чего ему не хватает, откуда оно берется и откуда спринг должен знать, что у тебя все это уже есть.


vsimonov [9:52 AM] 
Спасибо Кэп!
Katherine Buzatu
Копай на тему того, чего ему не хватает, откуда оно берется и откуда спринг должен знать, что у тебя все это уже есть.
Thread in #hw3Today at 9:51 AM
 3 replies Last reply today at 10:21 AM View thread

Rostish [10:38 AM] 
Я вот не могу только понять, у нас в текущей реализации с контролера при создании еды пробрасывается юзер ид, но в бд мы юзер ид для таблицы meal не делаем, его надо удалить теперь из контролера? Или его надо все-таки пробрасывать,а я неправильно понял часть дз, где написано *(userId в класс Meal вставлять НЕ надо (для UI и REST это лишние данные, userId это id залогиненного пользователя - в класс ненадо, в бд надо)*, так как без этого ид у нас не будет отношейний между таблицами еды и пользователей
и бд должен быть и idmeal и iduser


Сергей Матвеев [10:39 AM] 
какую версию PostgreSQL  ставить?

Rostish [10:39 AM] 
я поставил 10, все работает

Сергей Матвеев [10:39 AM] 
ок) попробуем повторить)

Few 
[10:40 AM] 
@Rostish userId передается в методы и хранится в базе, но в Meal entity он не нужен

Rostish [10:40 AM] 
это очевидно)


[10:41] 
я спрашиваю в таблице meal


[10:41] 
нужен userId

[10:41] 
или нет?

Few [10:43 AM] 
ну а иначе как определить чья еда?

Rostish [10:44 AM] 
логично, я просто прочитал дз и сидел в раздумьях имеется в виду только класс приложения или + бд, второе вызывало недоумение


Few [10:44 AM] 
можно конечно еще запилить таблицу дополнительную с полями mealId и userId, но это уже перебор по-моему, каждый запрос с JOINами будет


Rostish [10:46 AM] 
ну сейчас тоже джоинить можно, если ты хочешь и питание посмотреть и информацию по пользователю)))


Few [10:46 AM] 
да, но пока не требуется )


[10:49] 
кстати, я уже выше задавал вопрос, но никто не ответил:

[10:49] 
Как при текущей реализации JdbcUserRepositoryImpl информация о ролях пользователя будет в базу попадать?

[10:50] 
или мы это позже будем прикручивать?


Антон Кляшторный [10:58 AM] 
может логикой в таблицах базы? https://www.postgresql.org/docs/9.2/static/ddl-constraints.html


vsimonov [10:58 AM] 
ещё одну реализацию запилим, потом. (edited)

Rostish [11:02 AM] 
Чет при запуске кидает java.lang.NoSuchMethodException: ru.javawebinar.topjava.model.Meal.<init>()


[11:03] 
сталкивался кто-то?

[11:03] 
это при попытке  getall в mealservlet


Few 
[11:03 AM] 
ну так в эксепшене есть указание на строку которая вызвала его

[11:03] 
а, ок

[11:04] 
ну всю цепочку надо смотреть как запрос по слоям движется

[11:04] 
весь стектрейс выложи

Rostish [11:05 AM] 
Root Cause

java.lang.NoSuchMethodException: ru.javawebinar.topjava.model.Meal.<init>()
    java.base/java.lang.Class.getConstructor0(Class.java:3322)
    java.base/java.lang.Class.getDeclaredConstructor(Class.java:2510)
    org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:102)
    org.springframework.jdbc.core.BeanPropertyRowMapper.mapRow(BeanPropertyRowMapper.java:277)
    org.springframework.jdbc.core.RowMapperResultSetExtractor.extractData(RowMapperResultSetExtractor.java:93)
    org.springframework.jdbc.core.RowMapperResultSetExtractor.extractData(RowMapperResultSetExtractor.java:60)
    org.springframework.jdbc.core.JdbcTemplate$1QueryStatementCallback.doInStatement(JdbcTemplate.java:463)
    org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:408)
    org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:474)
    org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:484)
    ru.javawebinar.topjava.repository.jdbc.JdbcMealRepositoryImpl.getAll(JdbcMealRepositoryImpl.java:71)
    ru.javawebinar.topjava.service.MealServiceImpl.getAll(MealServiceImpl.java:40)
    ru.javawebinar.topjava.web.meal.MealRestController.getAll(MealRestController.java:47)
    ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:88)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:634)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
    org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)


[11:05] 
конструктора вроде как ему не хватает

[11:05] 
в meal

Few [11:05 AM] 
а есть без аргументов конструктор?


[11:06] 
нужен для корректной работы с spring jdbc

Rostish [11:07 AM] 
у нас там файнал переменные он без аргументов не дает создать

[11:07] 
потому что их проинициилизировать нужно

Few [11:08 AM] 
ну да, убираем final

[11:08] 
смотри на реализацию User

Rostish [11:08 AM] 
о, точно

[11:08] 
а я голову ломаю

[11:08] 
спасибо


[11:08] 
а зачем мы до этого файналами пользовались?

[11:09] 
потому что в мапе как-то после созданния можно просетить?


[11:09] 
пока у нас mock был

Few 
[11:12 AM] 
ну всегда стоит наверное самый безопасный вариант использовать, на данный момент не можем уже так, поэтому снижаем уровень )


Дима Жуков [11:13 AM] 
Ни у кого проблем с зависимостью postgres не возникало? Не хочет загружать. Нифига не пойму из за чего

Сергей Матвеев [11:14 AM] 
в PostgreSQL юзеру каких прав добавить?

Few [11:15 AM] 
было что-то, не могу вспомнить как решил (edited)


anpotashev [11:16 AM] 
Право login


[11:16] 
Остальные роли раздаешь на бд topjava

Дима Жуков
[11:17 AM] 
Я понимаю почему mysql популярнее этого ..... Зла не хватает на этот постгрес


anpotashev [11:18 AM] 
Это еще что :slightly_smiling_face: Было удовольствие работы с ingres


Сергей Матвеев [11:21 AM] 
схему в идеи не показывает от посгреса (edited)

Few [11:23 AM] 
@Дима Жуков ты когда Data Source в Idea добавляешь он тебе в этом окне предлагает драйвер скачать

[11:23] 
я там нажимал и все ок

Дима Жуков [11:30 AM] 
Ё моё. Я тоже так сделал и добавил в помку зависимость. Как оказалось он скачал другой версии jar и типо была не совместимость... (edited)


Few 
[11:31 AM] 
меня видимо пронесло, совпали версии


Rostish [12:07 PM] 
в каком формате в таблице meal должно храниться dateTime?


[12:07] 
TIMESTAMP?

[12:07] 
2015-05-31 12:00:00.000000 как-то так?


[12:08] 
потому что с таким форматом, при попытке сделать get all вылетает:
java.lang.NullPointerException
    ru.javawebinar.topjava.model.Meal.getDate(Meal.java:42)
    java.base/java.util.stream.Collectors.lambda$groupingBy$49(Collectors.java:1075)
    java.base/java.util.stream.ReduceOps$3ReducingSink.accept(ReduceOps.java:169)
    java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1492)
    java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)
    java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)
    java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:913)
    java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
    java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:511)
    ru.javawebinar.topjava.util.MealsUtil.getFilteredWithExceeded(MealsUtil.java:36)
    ru.javawebinar.topjava.util.MealsUtil.getWithExceeded(MealsUtil.java:31)
    ru.javawebinar.topjava.web.meal.MealRestController.getAll(MealRestController.java:47)
    ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:88)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:634)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
    org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)


Few [12:11 PM] 
а столбец у тебя помечен NOT NULL, может у тебя туда залетело без даты?

Rostish [12:12 PM] 
да стоит NOT_NULL

Few [12:14 PM] 
с подчеркиванием?


[12:14] 
date_time        TIMESTAMP DEFAULT now()  NOT NULL,

Rostish [12:15 PM] 
нет просто dateTime


[12:15] 
CREATE TABLE meals
(
 meal_id INTEGER PRIMARY KEY NOT NULL,
 user_id INTEGER NOT NULL,
 dateTime TIMESTAMP NOT NULL,
 description VARCHAR NOT NULL,
 calories INTEGER NOT NULL,
 CONSTRAINT meals_dateTime_unique_idx UNIQUE (dateTime,user_id)

);


Few [12:15 PM] 
кладу в базу Timestamp.valueOf(localDateTime)


[12:16] 
достаю через BeanPropertyRowMapper


[12:16] 
работает, NPE не было
покажи просто метож геталл
в репозитории
в личку


Rostish [12:27 PM] 
чтобы rowmapper сработал правильно, названия должны совпадать и в бд и классе?


Few [12:33 PM] 
кстати хороший вопрос


fbochkarev [12:56 PM] 
Что не так делаю, при тестовом подключение к postgres пишет "Connection to topjava@localhost failed.
[08004] The server does not support SSL." Разобрался. (edited)


Few 
[12:59 PM] 
у тебя на вкладке SSH/SSL при создании в Idea Data Source  флаг SSL не выбран?
1 reply Today at 1:41 PM View thread

Rostish [1:08 PM] 
Люди, помогайте, не берет из БД время почему-то, уже дебаг врубил, картина такая


Rostish [1:08 PM] 
uploaded this image: Снимок экрана 2017-11-20 в 21.07.31.png
Add Comment



russell [1:14 PM] 
@Rostish а ты сеттеры установил?


[1:14] 
сеттеры нужны

Rostish [1:14 PM] 
Few мне помог, мы сидели час наверно, он после картинки тоже про них подумал


[1:15] 
я смотрю id приходит, а сеттера на него нет, думал не в этом дело, а он сеттер через супер брал

vsimonov [2:10 PM] 
тоже на этом же моменте
Ruslan Shakirov
@Rostish а ты сеттеры установил?
Posted in #hw3Today at 1:14 PM


philip.goldm [3:36 PM] 
@Rostish в Meal.class свойства должны быть одинаково именованы. Вся магия магия происходит здесь. 
RowMapper<Meal> ROW_MAPPER = BeanPropertyRowMapper.newInstance(Meal.class);

>я смотрю id приходит, а сеттера на него нет, думал не в этом дело, а он сеттер через супер брал
есть 

Включи org.springframework.jdbc логи в logback.xml. Сможешь увидеть детали ошибки.


Viktor [5:05 PM] 
вопрос по первому пункту "1 Понять, почему перестали работать SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest"
Main сделал, а вот по InMemoryAdminRestControllerTest, надо сделать так чтобы для тестов бралась InMemoyUserRepository или переделать, чтобы брал сервис или чтобы брал интерфейс?


Katherine Buzatu [5:06 PM] 
InMemoyUserRepository только для тестов


russell [5:07 PM] 
все остально оставляешь меняешь только реализации jdbc на inMemory


Viktor [5:09 PM] 
@Katherine Buzatu так и вопрос про тестовый класс.  В идеале там надо поставить заглушку для сервиса и проверять только рест класс
 2 replies Last reply today at 5:13 PM View thread

Few [5:10 PM] 
Все по идее должно работать,  только репо ин мемори


russell [5:10 PM] 
в идеале надо мок через мокито делать для сервиса, это наверно на следующих занятиях


Viktor [5:11 PM] 
@russell т.е. надо тип репозитория с конкретного сменить на интерфейс? или на сервис?


Few
[5:12 PM] 
я так понял что все должно остаться как до jdbc реализации

Viktor [5:12 PM] 
Тогда такой вопрос, кто смог закинуть тестовую кофигурацию в ресурсы тестов и вытащить оттуда? или это невозможно?


Few
[5:12 PM] 
в контекст при тестировании inMemory должны попадать только InMemory репозитории


[5:13] 
да вроде работает именно так

russell [5:14 PM] 
тестовая конфигурация это тестовый контекст?



Viktor [5:15 PM] 
@Few на мой взгляд 2 варианта, создать ещё одну конфигурацию в classpath:resource (это не сложно), либо создать тестовую конфигурацию в test/resources и как-то её достать. По последнему ответа не нашел, обращение по полному пути в target е помогло


[5:15] 
либо использовать профили


russell [5:15 PM] 
а в чем проблема ее достать


Viktor [5:16 PM] 
не видна она, попробуй


[5:16] 
у меня пока не получилось

russell [5:16 PM] 
не видна из папки тест?


Viktor [5:17 PM] 
не видна в аннотации @ContexConfiguration


russell [5:17 PM] 
classpath:spring-test.xml


[5:17] 
все видно

[5:17] 
клади в ресурсы теста

Viktor [5:17 PM] 
это ту, что в classpath а ты создай в ресурсы test/resources


Few
[5:18 PM] 
src\test\resources\spring

[5:18] 
видит норм



russell [5:18 PM] 
да это один класспас


[5:18] 
класспасс вообще один на всех


Viktor [5:19 PM] 
@russell только потом тестовые ресурсы и классы кладуться не в папку class куда ссылаеться classpath, а в папку test-classes


[5:19] 
ща иедю запущи скринами закидаю :smiley:

Few
[5:22 PM] 
где вообще про classpath почитать? это серьезный пробел

[5:22] 
так чтоб понятно и не на 10 страниц

Shalukhau Dzmitry [5:24 PM] 
@Few +1

Katherine Buzatu [5:24 PM] 
classpath - это те места, где java ищет классы. :slightly_smiling_face:
_если найдешь, кинь ссылку, пусть все знают_ (edited)


russell [5:25 PM] 
про джаву 9 не забудь там теперь класпасс не помойка для всего, они модули добавили.


[5:25] 
http://dev.solita.fi/2015/10/15/goodbye-glasspath-java-9.html
/dev/solita
Goodbye classpath - welcome Java 9
Java 9 module system is going to kick out the old classpath


Few
[5:26 PM] 
гудбай это сильно, я еще и поздороваться не успел толком )


Viktor [5:27 PM] 
"Твоюж картошку" :smiley: я назвал конфиг sprint-test-config, а искал spring-test-config :smiley: (edited)


[5:27] 
bpdtyz.cm pf ie[th :smiley:

Few [5:28 PM] 
я так попался с подчеркиванием вместо дефиса


Katherine Buzatu [5:28 PM] 
а автодополнение?.. как раз для склеротиков. спасает. (edited)



Viktor [5:29 PM] 
в аннотации не сработало


[5:30] 
тут не склероз, тут косоглазие :smiley: конфиг был открыт в соседней веладке

Антон Кляшторный [5:53 PM] 
подскажите какой sql запрос в методе public List<Meal> getBetween(LocalDateTime startDate, LocalDateTime endDate, int userId) JdbcMealRepositoryImpl.class?


russell [5:54 PM] 
between ? and ?
1 reply Today at 7:00 PM View thread

grigory.kislin [6:11 PM] 
Привет!
замечания про fk и "предложить решение" в уроке поправил
класспасс из википедии, но мне кажется лучше не читать, чтобы не запутаться:)
https://en.wikipedia.org/wiki/Classpath_(Java)
место окуда java классы грузит и реcурсы через ClassLoader.getResource()
Ресурсы и туда кладет maven при сборке (из `src/main/resources` и для тестов 
`src/test/resources`) как и скомпилированные классы.
те если есть какой то конкретный вопрос- то задавайте
Wikipedia
Classpath (Java)
Classpath is a parameter in the Java Virtual Machine or the Java compiler that specifies the location of user-defined classes and packages. The parameter may be set either on the command-line, or through an environment variable.


Few [6:14 PM] 
Насколько я понимаю, есть четко прописанная структура каталогов для расположения java, xml, jsp, html, properties и т.д. в проекте webapp. Хотелось бы почитать об этом, т.к. на данный момент в голове каша если честно


Viktor [6:17 PM] 
@Few для сборки важна только архитектура мавена, остальное это архитектура проекта и тут думаю выбирают любую архитекутуру


Few [6:18 PM] 
т.е. мавен ждет четкого расположения, но где это настраивается?


Viktor [6:18 PM] 
либо выбираете архитип, либо сами делаете каталоги


[6:18] 
https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html

[6:19] 
тут важно понять зачем это нужно. 
Мавен не ИИ, чтобы собрать проект он должен положить все классы в итоговый архив, а для этого ему надо их найти.
Искать он будет только в определенных пакетах


Few
[6:20 PM] 
хотелось бы увидеть где это настроено, так стало бы понятнее


[6:20] 
или это глубоко в мавене и не меняется?


Viktor [6:21 PM] 
думаю сам поиск прописан в мавене, менять если и возможно, то нет особого смысла

grigory.kislin [6:21 PM] 
архетип- это при старте проекта уже создается заготовка
> Introduction to the Standard Directory Layout
:+1:
без нужды менять не надо. настраивается в maven-resources-plugin (ест спец теги resource и test-resource)
меняем в проекте  masterjava, в нашем не надо


Few
[6:23 PM] 
@Viktor Спасибо за ссылку


[6:23] 
стало понятнее

grigory.kislin [6:24 PM] 
у нас кстати там есть уже logback-test.xml


Few [6:28 PM] 
Вот еще попутно нашел:


[6:29] 
https://tomcat.apache.org/tomcat-7.0-doc/appdev/deployment.html

grigory.kislin [6:32 PM] 
добавил ссылки на  standard-directory-layout и maven-resources-plugin  в урок после Apply 3_12_test_logging.patch


Few [7:01 PM] 
@grigory.kislin Спасибо

Дима Жуков 
[7:34 PM] 
ребята, у меня тест update вытаскивает еду у юзера, update эту еду у админа. 0 rows affected. Но тест проходит) это ж не правильно?)


russell [7:35 PM] 
а ты как ассерт делаешь?


Дима Жуков [7:36 PM] 
никак естественно) спасибо

[7:37] 
я подумал там и без него notFound выскочит


russell [7:38 PM] 
да без ассерта должен выскочить


Дима Жуков [7:39 PM] 
мне not found нужен...


[7:40] 
а у вас вылетает норм? или вы как тестите?


Дима Жуков [7:47 PM] 
разобрался, пригодились тесты заодно)) спасибо @russell


Marina [8:46 PM] 
Ребята, подскажите, как у вас JdbcMealRepository вытаскивает еду из базы? Сделала getAll по аналогии с JdbcUserRepository, но вытаскивает еду с ненулевым только id, остальные поля null, хотя в базе есть данные: Meal{id=1, dateTime=null, description='null', calories=0} . Что-то уже запуталась не могу найти в чем дело.


russell [8:47 PM] 
@Marina сеттеры в мил энтити не забудь добавить


Marina [8:49 PM] 
СПАСИБО!!!


dyakoven [10:12 PM] 
так как мы не храним userId в Meal, как проверить принадлежность Еды, которую достали из базы, конкретному юзеру?


Valery [10:15 PM] 
почему нельзя это сразу сделать когда достаешь еду из базы?


[10:16] 
SELECT * FROM meals WHERE id=? AND user_id=?

dyakoven [10:18 PM] 
логично) спасибо


Viktor [10:23 PM] 
Я в замешательстве... Таблица meals создается, но не в postgre клиенте её нет, ни в идее. Select к ней сделать могу..


Viktor [10:23 PM] 
uploaded this image: Pasted image at 2017-11-20, 11:25 PM


Viktor [10:29 PM] 
нашел, только вот сфигали она улетела в другую базу...


Valery [10:31 PM] 
в скрипте инициализации?


Viktor [10:31 PM] 
все же видят слева  topjava@localHost? меня же не глючт?


Valery [10:35 PM] 
у тебя база example.public, у меня - topjava.public. структура базы такая же


Viktor [10:35 PM] 
да я уже понял, что он укатил в example , осталось понять почему :smiley:


[10:36] 
и почему postgre не знает команды show databases


Valery [10:36 PM] 
а почему идея не показывает example справа в структуре? (edited)


Viktor [10:37 PM] 
Дружише у меня теперь столько вопросов и твой один из них :smiley:


[10:37] 
С какого вообще перепугу коннект к topjava, а скрипты исполняются на example


Valery [10:40 PM] 
у тебя все три таблицы одним скриптом создаются?
может рестарт нужен? (edited)


Viktor [10:40 PM] 
скрипт 1 команды разные. Хоть все вместе выполняй, хоть по одной, надо попробовать на mysql переключиться


Viktor [11:02 PM] 
нашел. На скрине наверху слева от окна соединения есть небольшой выпадающий список. Оказывается недостаточно в соединение указать к какой БД подсоединяться, надо ещё и там указать...


[11:06] 
а вообще интересный вопрос, как общаться с postgres, может есть у кого ссылочка на переводчик sql->postgre. А то не знает ни show databases ни show tables;


Valery [11:18 PM] 
с консоли http://www.postgresqltutorial.com/postgresql-show-tables/
postgresqltutorial.com
PostgreSQL Show Tables
This tutorial shows you various ways to show tables in a specific database using psql and querying pg_catalog schema in PostgreSQL


Viktor [11:48 PM] 
да спасибо, прочитал уже когда таблицу искал, только не вникал сильно :smiley:


Dmitry Neustupov [11:54 PM] 
Коллеги, подскажите, в чём проблема может быть? Жму в идее ctrl+shift+T, по идее должен создаваться класс теста, а у меня ничего не происходит. То ли лыжи не едут, то ли я уже пересидел сегодня...


dyakoven [11:59 PM] 
посмотри в настройках Keymap, что у тебя на эту комбинацию клавиш стоит (edited)



----- Today November 21st, 2017 -----
dyakoven [12:00 AM] 
uploaded and commented on this image: Screenshot from 2017-11-20 23-59-33.png
1 Comment
справа вверху можно нажать комбинацию клавиш



Dmitry Neustupov [12:02 AM] 
navigate to the test of the selected class


dyakoven [12:03 AM] 
у тебя он уже походу создан


Dmitry Neustupov [12:05 AM] 
надо оказывается было открыть нужный класс а не просто в структуре проекта на нём щелкать... пора спать наверное )



Viktor [3:16 AM] 
Опять вопрос. Почему мы из репозитория берем с фильтрацией даты и времени? Сначала думал поглючило, но проверил реализацию inMemory.


Anton K. [3:24 AM] 
ну а почему не брать сразу отфильтрованные данные, нежеле брать все и потом фильтровать


Viktor [3:30 AM] 
Тогда не получиться посчитать каллории за день и сказать превысил ли пользователь норму.


Dmitry Makarov [3:39 AM] 
Попробуй по дате один и тот же день послать для фильтрации(startDate.toLocalDate() например). В интерфейсе сервиса указывается диапазон по времени, что бы доставать данные за весь день. Если просто с датой сравнивать, БД будет сравнивать с началом дня. (edited)


Katherine Buzatu [7:10 AM] 
@Viktor Мы задаем время от min до max, так что фактически фильтруем по дате


Alexander _Gubanow [11:07 AM] 
Как запретить создавать у одного и того-же юзера еду с одинаковой dateTime?(п.7)CREATE UNIQUE INDEX meals_unique_date_time_idx ON meals (date_time) не помогло.


RNG [11:18 AM] 
@Alexander _Gubanow нужно еще учесть user_id (edited)


Marina [11:34 AM] 
CONSTRAINT user_meals_idx UNIQUE (user_id, date_time)


vsimonov [12:18 PM] 
При запуске приложения в методе init
springContext = new ClassPathXmlApplicationContext("spring/spring-app.xml", "spring/spring-db.xml");
возникает ошибка 
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jdbcMealRepositoryImpl': Failed to introspect bean class [ru.javawebinar.topjava.repository.jdbc.JdbcMealRepositoryImpl] for lookup method metadata: could not find class that it depends on; nested exception is java.lang.NoClassDefFoundError: org/springframework/jdbc/core/RowMapper (edited)


[12:19] 
jdbcMealRepositoryImpl - помечен как @Repository

Few 
[12:20 PM] 
он кажется RowMapper найти не может


Marina [12:21 PM] 
Ребят, а можно как то аннотацией заставить Autowired Service выбрать определенную реализацию репозитория или только через spring-context? Никак что-то не могу найти.


Katherine Buzatu [12:21 PM] 
@Marina Qualifier


Few [12:21 PM] 
аннотировать с квалификатором


Ганичев Максим [12:24 PM] 
Мне кажется в данном случае проще создать конфиг отдельный для тестов


Marina [12:25 PM] 
Qualifier насколько я поняла позволяет выбрать реализация самого service, а чтобы он внутри себя выбрал нужную реализацию репозитория, тоже как то через него? Просто service один и на mock реализацию и на jdbc, хотела в serviceTest заставить внутренний service брать jdbc репозиторий.


Few 
[12:26 PM] 
ну в сервисе у тебя тоже Autowired аннотация есть

[12:27] 
но вообще Максим дело говорит

Katherine Buzatu [12:27 PM] 
Позволяет выбрать реализацию для любого интерфейса.

vsimonov [12:27 PM] 
<dependency>
           <groupId>org.springframework</groupId>
           <artifactId>spring-jdbc</artifactId>
           <version>${spring.version}</version>
       </dependency>
Fedor Vershinin
он кажется RowMapper найти не может
Posted in #hw3Today at 12:20 PM


[12:31] 
всё подкачено


vsimonov [12:47 PM] 
@Katherine Buzatu Ваши советы пришлись бы к месту.


Katherine Buzatu [12:58 PM] 
Я бы для начала посмотрела, на месте ли библиотеки. Project structure - Libraries.

vsimonov [1:01 PM] 
uploaded this image: на месте
Add Comment



Few
[1:02 PM] 
а ты ексепшн весь выложил?


Katherine Buzatu [1:03 PM] 
Вот-вот...


[1:04] 
Как ROW_MAPPER инициализируется?


vsimonov [1:49 PM] 
щас


vsimonov [1:50 PM] 
added this Plain Text snippet: весь лог
ype Exception Report
Message Servlet.init() for servlet [mealServlet] threw exception
Description The server encountered an unexpected condition that prevented it from fulfilling the request.
Exception
javax.servlet.ServletException: Servlet.init() for servlet [mealServlet] threw exception
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Root Cause
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jdbcMealRepositoryImpl': Failed to introspect bean class [ru.javawebinar.topjava.repository.jdbc.JdbcMealRepositoryImpl] for lookup method metadata: could not find class that it depends on; nested exception is java.lang.NoClassDefFoundError: org/springframework/jdbc/core/RowMapper
  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:269)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1118)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1091)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:93)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Root Cause
java.lang.NoClassDefFoundError: org/springframework/jdbc/core/RowMapper
  java.lang.Class.getDeclaredMethods0(Native Method)
  java.lang.Class.privateGetDeclaredMethods(Class.java:2701)
  java.lang.Class.getDeclaredMethods(Class.java:1975)
  org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:613)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:524)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:510)
  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:247)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1118)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1091)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:93)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Root Cause
java.lang.ClassNotFoundException: org.springframework.jdbc.core.RowMapper
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1269)
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1104)
  java.lang.Class.getDeclaredMethods0(Native Method)
  java.lang.Class.privateGetDeclaredMethods(Class.java:2701)
  java.lang.Class.getDeclaredMethods(Class.java:1975)
  org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:613)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:524)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:510)
  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:247)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1118)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1091)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:93)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Note The full stack trace of the root cause is available in the server logs.
Add Comment Collapse



Marina [1:51 PM] 
Спасибо, в итоге так и сделала.
Ganichev Maxim
Мне кажется в данном случае проще создать конфиг отдельный для тестов
Posted in #hw3Today at 12:24 PM


vsimonov [1:51 PM] 
До ROW_MAPPER дело не доходит
Katherine Buzatu
Как ROW_MAPPER инициализируется?
Posted in #hw3Today at 1:04 PM


Few
[1:53 PM] 
томкат не находит RowMapper кажется


vsimonov [1:55 PM] 
Как это выяснить?
Fedor Vershinin
томкат не находит RowMapper кажется
Posted in #hw3Today at 1:53 PM


Few
[1:59 PM] 
у тебя в папке проекта topjava\target\topjava\WEB-INF\lib\ есть spring-jdbc jar?


Katherine Buzatu [1:59 PM] 
Сделай еще на всякий `mvn clean` - для чистоты экспериментов.


vsimonov [2:00 PM] 
делал раза 3
Katherine Buzatu
Сделай еще на всякий `mvn clean` - для чистоты экспериментов.
Posted in #hw3Today at 1:59 PM


[2:01] 
там нет папки lib
Fedor Vershinin
у тебя в папке проекта topjava\target\topjava\WEB-INF\lib\ есть spring-jdbc jar?
Posted in #hw3Today at 1:59 PM


Few
[2:01 PM] 
в target нет lib?


vsimonov [2:03 PM] 
нету
Fedor Vershinin
в target нет lib?
Posted in #hw3Today at 2:01 PM


[2:03] 
ща добавлю это в артифактах помоему

Few [2:04 PM] 
ты  war exploded деплоишь?


vsimonov [2:04 PM] 
да


Few [2:06 PM] 
просто у томката же наверное нет своих либ спринга (или есть?)


[2:06] 
так что ты должен ему все дать

[2:08] 
ты в мавене клин пробовал запускать?


vsimonov [2:08 PM] 
много раз запускал
Fedor Vershinin
ты в мавене клин пробовал запускать?
Posted in #hw3Today at 2:08 PM


[2:09] 
нету
Fedor Vershinin
просто у томката же наверное нет своих либ спринга (или есть?)
Posted in #hw3Today at 2:06 PM


Katherine Buzatu [2:10 PM] 
@vsimonov а если попробовать не запускать, а `maven clean` - `maven package`, что он вообще в target создает? Что пишет? Где lib? (edited)


vsimonov [2:12 PM] 
clean всё убивает


[2:12] 
package делает такое


vsimonov [2:14 PM] 
uploaded this image: maven.jpg
Add Comment



vsimonov [2:14 PM] 
maven в консоль ошибки конечно срёт на тесты, я их не делал. не знаю критично ли это


Viktor [2:15 PM] 
@vsimonov что ты пвтаешься сделать? просто собрать?

vsimonov [2:15 PM] 
запустить проект
Sergeev Viktor
@vsimonov что ты пвтаешься сделать? просто собрать?
Posted in #hw3Today at 2:15 PM


vsimonov [2:16 PM] 
added this Plain Text snippet
15:11:06.446 WARN o.s.context.support.AbstractApplicationContext.refresh:551 - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
[ERROR] Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 0.143 s <<< FAILURE! - in ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest
[ERROR] ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest Time elapsed: 0.142 s <<< ERROR!
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest.beforeClass(InMemoryAdminRestControllerTest.java:23)
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest.beforeClass(InMemoryAdminRestControllerTest.java:23)
[ERROR] ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest Time elapsed: 0.142 s <<< ERROR!
java.lang.NullPointerException
  at ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest.afterClass(InMemoryAdminRestControllerTest.java:30)
[INFO] Running ru.javawebinar.topjava.web.InMemoryAdminRestControllerSpringTest
15:11:06.533 WARN o.s.context.support.AbstractApplicationContext.refresh:551 - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
15:11:06.535 ERROR o.springframework.test.context.TestContextManager.prepareTestInstance:234 - Caught exception while allowing TestExecutionListener [org.springframework.test.context.support.DependencyInjectionTestExecutionListener@481ba2cf] to prepare test instance [ru.javawebinar.topjava.web.InMemoryAdminRestControllerSpringTest@46b61c56]
java.lang.IllegalStateException: Failed to load ApplicationContext
  at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:124)
  at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:83)
  at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.injectDependencies(DependencyInjectionTestExecutionListener.java:117)
  at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.prepareTestInstance(DependencyInjectionTestExecutionListener.java:83)
  at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:230)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.createTest(SpringJUnit4ClassRunner.java:228)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner$1.runReflectiveCall(SpringJUnit4ClassRunner.java:287)
  at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.methodBlock(SpringJUnit4ClassRunner.java:289)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:247)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:94)
  at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
  at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
  at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
  at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
  at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
  at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
  at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
  at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:191)
  at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:369)
  at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:275)
  at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:239)
  at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:160)
  at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:373)
  at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:334)
  at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:119)
  at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:407)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:749)
  at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:189)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1193)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1095)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:128)
  at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:60)
  at org.springframework.test.context.support.AbstractDelegatingSmartContextLoader.delegateLoading(AbstractDelegatingSmartContextLoader.java:108)
  at org.springframework.test.context.support.AbstractDelegatingSmartContextLoader.loadContext(AbstractDelegatingSmartContextLoader.java:251)
  at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:98)
  at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:116)
  ... 27 common frames omitted
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.raiseNoMatchingBeanFound(DefaultListableBeanFactory.java:1493)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1104)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1066)
  at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835)
  at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741)
  ... 45 common frames omitted
15:11:06.567 WARN o.s.context.support.AbstractApplicationContext.refresh:551 - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
15:11:06.568 ERROR o.springframework.test.context.TestContextManager.prepareTestInstance:234 - Caught exception while allowing TestExecutionListener [org.springframework.test.context.support.DependencyInjectionTestExecutionListener@481ba2cf] to prepare test instance [ru.javawebinar.topjava.web.InMemoryAdminRestControllerSpringTest@1c93f6e1]
java.lang.IllegalStateException: Failed to load ApplicationContext
  at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:124)
  at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:83)
  at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.injectDependencies(DependencyInjectionTestExecutionListener.java:117)
  at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.prepareTestInstance(DependencyInjectionTestExecutionListener.java:83)
  at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:230)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.createTest(SpringJUnit4ClassRunner.java:228)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner$1.runReflectiveCall(SpringJUnit4ClassRunner.java:287)
  at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.methodBlock(SpringJUnit4ClassRunner.java:289)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:247)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:94)
  at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
  at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
  at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
  at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
  at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
  at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
  at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
  at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:191)
  at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:369)
  at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:275)
  at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:239)
  at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:160)
  at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:373)
  at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:334)
  at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:119)
  at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:407)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:749)
  at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:189)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1193)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1095)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:128)
  at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:60)
  at org.springframework.test.context.support.AbstractDelegatingSmartContextLoader.delegateLoading(AbstractDelegatingSmartContextLoader.java:108)
  at org.springframework.test.context.support.AbstractDelegatingSmartContextLoader.loadContext(AbstractDelegatingSmartContextLoader.java:251)
  at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:98)
  at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:116)
  ... 27 common frames omitted
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.raiseNoMatchingBeanFound(DefaultListableBeanFactory.java:1493)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1104)
  at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1066)
  at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835)
  at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741)
  ... 45 common frames omitted
[ERROR] Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 0.107 s <<< FAILURE! - in ru.javawebinar.topjava.web.InMemoryAdminRestControllerSpringTest
[ERROR] testDeleteNotFound(ru.javawebinar.topjava.web.InMemoryAdminRestControllerSpringTest) Time elapsed: 0.001 s <<< ERROR!
java.lang.IllegalStateException: Failed to load ApplicationContext
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
[ERROR] testDelete(ru.javawebinar.topjava.web.InMemoryAdminRestControllerSpringTest) Time elapsed: 0.001 s <<< ERROR!
java.lang.IllegalStateException: Failed to load ApplicationContext
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Errors: 
[ERROR]  InMemoryAdminRestControllerSpringTest.testDelete » IllegalState Failed to load...
[ERROR]  InMemoryAdminRestControllerSpringTest.testDeleteNotFound » IllegalState Failed...
[ERROR] ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest.ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest
[ERROR]  Run 1: InMemoryAdminRestControllerTest.beforeClass:23 » UnsatisfiedDependency Error c...
[ERROR]  Run 2: InMemoryAdminRestControllerTest.afterClass:30 NullPointer
[INFO] 
[INFO] 
[ERROR] Tests run: 19, Failures: 0, Errors: 3, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 9.754 s
[INFO] Finished at: 2017-11-21T15:11:06+03:00
[INFO] Final Memory: 19M/258M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.20.1:test (default-test) on project topjava: There are test failures.
[ERROR] 
[ERROR] Please refer to /home/simonov/GIT/topjava/target/surefire-reports for the individual test results.
[ERROR] Please refer to dump files (if any exist) [date]-jvmRun[N].dump, [date].dumpstream and [date]-jvmRun[N].dumpstream.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
Process finished with exit code 1
Add Comment Collapse This snippet was truncated for display: see it in full.



Viktor [2:16 PM] 
в идее или томкате?


Few [2:16 PM] 
либы должны быть в \target\topjava\WEB-INF\lib


vsimonov [2:18 PM] 
идея
Sergeev Viktor
в идее или томкате?
Posted in #hw3Today at 2:16 PM


[2:19] 
сейчас либы создались
Fedor Vershinin
либы должны быть в \target\topjava\WEB-INF\lib
Posted in #hw3Today at 2:16 PM


vsimonov [2:20 PM] 
uploaded this image: lib.jpg
Add Comment



Viktor [2:20 PM] 
попробуй "spring/spring-app.xml" заменить на "classpath:spring/spring-app.xml" мало ли


vsimonov [2:21 PM] 
Ошибка теперь такая


vsimonov [2:21 PM] 
added this Plain Text snippet
Type Exception Report
Message Servlet.init() for servlet [mealServlet] threw exception
Description The server encountered an unexpected condition that prevented it from fulfilling the request.
Exception
javax.servlet.ServletException: Servlet.init() for servlet [mealServlet] threw exception
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Root Cause
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/topjava/WEB-INF/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jdbcTemplate': Failed to introspect bean class [org.springframework.jdbc.core.JdbcTemplate] for lookup method metadata: could not find class that it depends on; nested exception is java.lang.NoClassDefFoundError: org/springframework/dao/UncategorizedDataAccessException
  org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:749)
  org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:189)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1193)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1095)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:93)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Root Cause
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jdbcTemplate': Failed to introspect bean class [org.springframework.jdbc.core.JdbcTemplate] for lookup method metadata: could not find class that it depends on; nested exception is java.lang.NoClassDefFoundError: org/springframework/dao/UncategorizedDataAccessException
  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:269)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1118)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1091)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
  org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:208)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1138)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1066)
  org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835)
  org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741)
  org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:189)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1193)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1095)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:93)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Root Cause
java.lang.NoClassDefFoundError: org/springframework/dao/UncategorizedDataAccessException
  java.lang.ClassLoader.defineClass1(Native Method)
  java.lang.ClassLoader.defineClass(ClassLoader.java:763)
  java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
  org.apache.catalina.loader.WebappClassLoaderBase.findClassInternal(WebappClassLoaderBase.java:2257)
  org.apache.catalina.loader.WebappClassLoaderBase.findClass(WebappClassLoaderBase.java:799)
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1238)
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1104)
  java.lang.Class.getDeclaredMethods0(Native Method)
  java.lang.Class.privateGetDeclaredMethods(Class.java:2701)
  java.lang.Class.getDeclaredMethods(Class.java:1975)
  org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:613)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:524)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:510)
  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:247)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1118)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1091)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
  org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:208)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1138)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1066)
  org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835)
  org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741)
  org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:189)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1193)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1095)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:93)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Root Cause
java.lang.ClassNotFoundException: org.springframework.dao.UncategorizedDataAccessException
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1269)
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1104)
  java.lang.ClassLoader.defineClass1(Native Method)
  java.lang.ClassLoader.defineClass(ClassLoader.java:763)
  java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
  org.apache.catalina.loader.WebappClassLoaderBase.findClassInternal(WebappClassLoaderBase.java:2257)
  org.apache.catalina.loader.WebappClassLoaderBase.findClass(WebappClassLoaderBase.java:799)
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1238)
  org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1104)
  java.lang.Class.getDeclaredMethods0(Native Method)
  java.lang.Class.privateGetDeclaredMethods(Class.java:2701)
  java.lang.Class.getDeclaredMethods(Class.java:1975)
  org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:613)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:524)
  org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:510)
  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:247)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1118)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1091)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
  org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:208)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1138)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1066)
  org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:835)
  org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:741)
  org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:189)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1193)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1095)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:513)
  org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:483)
  org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)
  org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)
  org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)
  org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
  org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:761)
  org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:867)
  org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:543)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)
  org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:93)
  ru.javawebinar.topjava.web.MealServlet.init(MealServlet.java:31)
  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:475)
  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
  org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:651)
  org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
  org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:498)
  org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
  org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:796)
  org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1374)
  org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
  java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
  java.lang.Thread.run(Thread.java:748)
Note The full stack trace of the root cause is available in the server logs.
Add Comment Collapse This snippet was truncated for display: see it in full.



Viktor [2:22 PM] 
покажи класс с ошибкой. Либо поставь там пустой конструктор, а всем полям пропиши @Autowired и посмотри кто не появиться


vsimonov [2:23 PM] 
писать путь от корня? /home/simonov/GIT/topjava ....
Sergeev Viktor
попробуй "spring/spring-app.xml" заменить на "classpath:spring/spring-app.xml" мало ли
Posted in #hw3Today at 2:20 PM


[2:24] 
мм Ошибка возникает в MealServlet
Sergeev Viktor
покажи класс с ошибкой. Либо поставь там пустой конструктор, а всем полям пропиши @Autowired и посмотри кто не появиться
Posted in #hw3Today at 2:22 PM


vsimonov [2:24 PM] 
added and commented on this Plain Text snippet
 @Override
  public void init(ServletConfig config) throws ServletException {
    super.init(config);
    springContext = new ClassPathXmlApplicationContext("spring/spring-app.xml", "spring/spring-db.xml");
    mealController = springContext.getBean(MealRestController.class);
  }
1 Comment Collapse
в этом методе



vsimonov [2:24 PM] 
томкат стратует и появляется index.html


[2:25] 
я жму на Select USer


Viktor [2:25 PM] 
У тебя ошибка в jdbcMealRepositoryImpl т.к. он не может его создать :smiley:


vsimonov [2:26 PM] 
?
Sergeev Viktor
У тебя ошибка в jdbcMealRepositoryImpl т.к. он не может его создать :smiley:
Posted in #hw3Today at 2:25 PM


[2:27] 
класс есть, щас крин сделаю
Sergeev Viktor
У тебя ошибка в jdbcMealRepositoryImpl т.к. он не может его создать :smiley:
Posted in #hw3Today at 2:25 PM


vsimonov [2:27 PM] 
uploaded this image: jdbc.jpg
Add Comment



Few
[2:28 PM] 
В одном из представленных эксепшенов четко было указано что не может создать бин репозитория,  т.к. Не находит определения класса RowMapper



vsimonov [2:29 PM] 
да написано, но класс есть, в чём ошибка?
Fedor Vershinin
В одном из представленных эксепшенов четко было указано что не может создать бин репозитория,  т.к. Не находит определения класса RowMapper
Posted in #hw3Today at 2:28 PM
(edited)


Few [2:30 PM] 
Пока не понятно, к сожалению не могу изучить последнюю простыню,  за рулём


[2:32] 
Но запускаешь ты помоему на томкате


vsimonov [2:34 PM] 
uploaded and commented on this image: tom.jpg
1 Comment
через идею в томкат,да



Few
[2:34 PM] 
Ну да


vsimonov [2:35 PM] 
uploaded and commented on this image: tom2.jpg
1 Comment
вот так



Few
[2:35 PM] 
Вот томкат и ругался помоему


vsimonov [2:35 PM] 
нет это не томкат ругается


[2:35] 
бин не созадётся

Katherine Buzatu [2:40 PM] 
а папка lib никуда не делась?


vsimonov [2:40 PM] 
lib есть


[2:40] 
что в ней длджно быть?

[2:41] 
может чего не хватает


vsimonov [2:41 PM] 
uploaded this image: lib.jpg
Add Comment



Katherine Buzatu [2:42 PM] 
spring-jdbc на месте...


Few
[2:44 PM] 
Надо простыню посмотреть последнюю,  но уж больно она длинная))

[2:47] 
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcMealRepositoryImpl' defined in file [/home/simonov/GIT/topjava/target/topjava/WEB-INF/classes/ru/javawebinar/topjava/repository/jdbc/JdbcMealRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jdbcTemplate': Failed to introspect bean class


[2:47] 
Опять та же петрушка,  только теперь не находит jdbctemplate

vsimonov [2:51 PM] 
что то не так с этими xml файлами


[2:51] 
хотя через main работает

Few [2:52 PM] 
А ты их в студию


vsimonov [2:52 PM] 
да нет проблем


vsimonov [2:52 PM] 
added this Plain Text snippet: db
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
  <context:property-placeholder location="classpath:db/postgres.properties" system-properties-mode="OVERRIDE"/>
  <!--no pooling-->
  <bean id="dataSource"
     class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="org.postgresql.Driver"/>
    <property name="url" value="${database.url}"/>
    <property name="username" value="${database.username}"/>
    <property name="password" value="${database.password}"/>
  </bean>
  <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
    <constructor-arg ref="dataSource"/>
  </bean>
  <bean id="namedJdbcTemplate" class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate">
    <constructor-arg ref="dataSource"/>
  </bean>
</beans>


vsimonov [2:53 PM] 
added this Plain Text snippet: app
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
  <!--
    <bean class="ru.javawebinar.topjava.repository.mock.MockUserRepositoryImpl" id="mockUserRepository"/>
    <bean class="ru.javawebinar.topjava.service.UserServiceImpl">
      <property name="repository" ref="mockUserRepository"/>
    </bean>
  -->
  <!-- Not necessary, already included with component-scan -->
  <!--<context:annotation-config/>-->
  <context:component-scan base-package="ru.javawebinar.**.repository.jdbc"/>
  <context:component-scan base-package="ru.javawebinar.**.service"/>
  <context:component-scan base-package="ru.javawebinar.**.web"/>
</beans>
Add Comment Collapse



vsimonov [2:53 PM] 
я их на само деле не трогал


[2:55] 
притом если зажимать Ctrl то "spring/spring-app.xml", "spring/spring-db.xml" к файлам переходит


RNG [2:57 PM] 
Может проблема с самой ДБ? Пробовал Postgres перезапускать?


[2:57] 
И да, какая версия стоит?


vsimonov [2:57 PM] 
10


[2:59] 
дб тут точно никак не замешана


RNG [3:00 PM] 
Если я правильно понял, то СпрингМейн работает, да? А при попытке запустить приложение через Томкат оно падает?


vsimonov [3:01 PM] 
да


[3:01] 
ща у гуру джавы спрошу


Few [3:01 PM] 
Спринг миейн не использует спринг jdbc

vsimonov [3:05 PM] 
всё посоны, похоже разобрался


[3:06] 
гуру в 2 сек сказал что надо сделать


[3:08] 
В томкат мы по рекомендации Гриши пуляем exploded файл, это вещь глючная бывает работает бывает нет. Лучше использовать только war. У меня через war всё разаботало (edited)


Few [3:09 PM] 
Была такая мыслишка


[3:09] 
Ну ок,  хорошо что заработало

vsimonov [3:13 PM] 
Странно что в предыдущих потоках не было таких проблем и Гриша об этом не предупреждает


Katherine Buzatu [3:16 PM] 
Вот интересно, будет такой же косяк, если напрямую в tomcat деплоить, или это только из Идеи так?


vsimonov [3:16 PM] 
да получается idea не такая уж и крутая и безупречная


Few
[3:23 PM] 
Она удобная,  но багов в ней достаточно

vsimonov [3:31 PM] 
Всем спасибо за помощь


Viktor [3:43 PM] 
@Few "не баг а фича", это называется гибкостью :smiley: Как у меня вчера идея писала в другую базу, а оказалось надо не только в коннекте писать базу но и при выполнении скрипта выбирать в какую


Glumov Konstantin [4:09 PM] 
у меня после накатывания 3_07 патча мавен тоже перестал проходить тесты. При выборе юзера в браузере кидает ошибку "Description The server encountered an unexpected condition that prevented it from fulfilling the request."


dyakoven [5:20 PM] 
каким методом лучше сравнивать два списка Еды в assertMatch?


russell [5:21 PM] 
isEqualTo сравнивает по equals. сравнивать поле к полю (edited)


dyakoven [5:22 PM] 
то есть нужно переопределить equals() в Meal?

russell [5:23 PM] 
нет в ассерте джей есть fieldbyfield


Дима Жуков 
[5:23 PM] 
Я сделал по isequalto. Надо переделать. Но вроде проверял все работало)


[5:23] 
Даже другие поля))) вроде


russell [5:23 PM] 
а ты икуалз переопределял


Дима Жуков [5:24 PM] 
Хотя в икуалс только по айди


russell [5:24 PM] 
он по айди и сравнивает


Дима Жуков [5:25 PM] 
Я хз. Сейчас переделывать буду.


dyakoven [5:25 PM] 
isEqualToComparingFieldByField() подходит для сравнения двух объектов Meal. для списков такого метода нет


Katherine Buzatu [5:26 PM] 
там еще много интересных методов


dyakoven [5:26 PM] 
да вот копаюсь в них


russell [5:42 PM] 
У кого-нибудь джава машина умирает, при прогонке тестов через мейвен? The forked VM terminated without properly saying goodbye. VM crash or System.exit called?


Дима Жуков 
[5:45 PM] 
У кого нибудь есть проблема копипаста? Иногда лень печатать и даже переменные забываю переименовать с юзера)


micredis [5:50 PM] 
Shift+F6 в Идее, нет?
to Дима


Дима Жуков [5:52 PM] 
@micredis  есть...


micredis [5:55 PM] 
Я имею в виду массовое переименование. Предложенная комбинация решила проблему?
Жуков Дмитрий
@micredis  есть...
Posted in #hw3Today at 5:52 PM


Дима Жуков [5:59 PM] 
Просто видишь похожее сделано в юзер* где нибудь. Копируешь вставляешь в меал* что нибудь. Немного правишь и уаля) но не всегда получается чисто) я просто увидел сейчас там не просто isEqualTo, а IsEqualToIgnoringgivenfields. И переменная users в meal repo. Вчера я этого не видел


micredis [6:04 PM] 
@Дима Жуков Понятно, со всеми бывает :wink:


russell [5:42 PM] 
У кого-нибудь джава машина умирает, при прогонке тестов через мейвен? The forked VM terminated without properly saying goodbye. VM crash or System.exit called?

Дима Жуков 
[5:45 PM] 
У кого нибудь есть проблема копипаста? Иногда лень печатать и даже переменные забываю переименовать с юзера)

micredis [5:50 PM] 
Shift+F6 в Идее, нет?

[5:50] 
to Дима

Дима Жуков [5:52 PM] 
@micredis  есть...

micredis [5:55 PM] 
Я имею в виду массовое переименование. Предложенная комбинация решила проблему?
Жуков Дмитрий
@micredis  есть...
Posted in #hw3Today at 5:52 PM

Дима Жуков [5:59 PM] 
Просто видишь похожее сделано в юзер* где нибудь. Копируешь вставляешь в меал* что нибудь. Немного правишь и уаля) но не всегда получается чисто) я просто увидел сейчас там не просто isEqualTo, а IsEqualToIgnoringgivenfields. И переменная users в meal repo. Вчера я этого не видел

micredis [6:04 PM] 
@Дима Жуков Понятно, со всеми бывает :wink:

ujwegh [7:36 PM] 
такой вопрос: если я правильно понимаю при тестировании мы идем в базу берем там еду и сравниваем ее по полям c одной из MealTestData. По идее, при добавлении в базу, id еды у нас инкрементится, начиная с 1. Тогда почему когда я прошу в тесте получить еду с id =1, и в MealTestData у еды стоит id=1, мне кидается NotFoundException? Или я что-то не то делаю?

Дима Жуков 
[7:37 PM] 
не с 1 ж, а 1000001

russell [7:38 PM] 
100001

ujwegh [7:42 PM] 
уууу вот я дурак) спасибо

Антон Кляшторный [8:20 PM] 
isEqualTo при сравнении списков еды учитывает только id AbstractBaseEntity остальные поля игнорируются, если не переопределять equls в Meals. Нам нужно сравнивать по всем полям или только по id еды?

Katherine Buzatu [8:28 PM] 
По всем полям надо сравнивать.


Valery [8:35 PM] 
>запретить создавать у одного и того-же юзера еду с одинаковой dateTime.
добавил условие в скрипт. при попытке добавить новую сточку с той же датой падает сервер. А что в итоге надо получить?
- предупреждение пользовотелю выдавать?
- игнорировать новую запись?
- перезаписывать существующую?


vch [8:36 PM] 
@Valery Лучше предупреждение. Но пока можно и падать.


[8:36] 
Но никак не игнорировать и не перезаписывать...

Marina [8:37 PM] 
По всем, я вообще id еды в тесте не учитываю, сделала аналогично UserTestData, через usingElementComparatorIgnoringFields(...).isEqualTo(...), и сравнивает по всем полям


Valery [8:37 PM] 
под запретом имеется ввиду ограничение на уровне БД? ведь можно делать проверку перед попыткой добавления.


Katherine Buzatu [8:38 PM] 
@Valery как падает? Должен бросить исключение.


Few [8:38 PM] 
constraint на уровне таблицы


[8:38] 
и автоматически полоучишь ексепшн


Valery [8:38 PM] 
HTTP Status 500 – Internal Server Error


[8:39] 
вот так падает )


Few [8:39 PM] 
неуникальный индекс

Marina [8:40 PM] 
Должен DataAccessException

Few [8:40 PM] 
DuplicateKeyException


Katherine Buzatu [8:41 PM] 
> HTTP Status 500 – Internal Server Error
@Valery , а дальше - исключение. Это нормально.


Valery [8:42 PM] 
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "user_meal_idx"
то есть, потом это исключение надо будет пробрасывать через все слои в контроллер, чтобы он в браузере что-то написал пользователю?


Katherine Buzatu [8:42 PM] 
...но это будет потом.


Few [8:42 PM] 
по идее springmvc умеет в одном месте все ексепшены обрабатывать помоему и выдавать удобоваримые странички


[8:43] 
но это будет позже

[8:43] 
видимо

Valery [8:45 PM] 
говорилось же, что исключения надо обрабатывать чем раньше тем лучше. а тут получается, что исключения является управляющим элементом


Few [8:48 PM] 
ну а зачем дважды обращаться в базу сначала проверять, а потом писать если можно получить эксепшн (как задумано в реализации драйвера) и обработать его


[8:50] 
Можно написать спец контроллер аннотированный @ControllerAdvice и в нем методы аннотированные @ExceptionHandler(Exception.class)


[8:50] 
он будет со всех контроллеров собирать ексепшены и отвечать пользователю в чем он не прав (edited)


Katherine Buzatu [8:51 PM] 
Коллеги, это сегодня видели? Что это значит?
[topjava:master] 14 new commits by gkislin:
`ab2a2c0` 3_0_fix - gkislin
`482d749` 3_01_HW2_repository - gkislin
`669ed3b` 3_02_HW2_meal_layers - gkislin
`4ad9634` 3_03_HW2_optional_MealServlet - gkislin
`a03ebc2` 3_04_HW2_optional_filter - gkislin
`419791b` 3_05_HW2_optional_select_user - gkislin
`887f36e` 3_06_bean_life_cycle - gkislin
`f21a2ab` 3_07_add_junit - gkislin
`8dae74b` 3_08_add_spring_test - gkislin
`2a6e74b` 3_09_add_postgresql - gkislin
`23d6173` 3_10_db_implementation - gkislin
`3d4b31d` 3_11_test_UserService - gkislin
`361a6cc` 3_12_test_logging - gkislin
`16a2d2a` 3_13_fix_servlet - gkislin
Posted in #project_change


Few
[8:54 PM] 
патчи накачены на мастер видимо


Valery [8:54 PM] 
Commits on Nov 16, 2017


[8:55] 
это ж не сегодня


vch [8:55 PM] 
Интеграция с guthub видимо подтормаживает...


Few
[8:55 PM] 
Григорий онлайн, прояснит наверное )


[8:55] 
хотя по содержанию это те самые патчи

Katherine Buzatu [8:57 PM] 
@Few да, ты прав. А я перепугалась, что патчи поменялись - аж моск думать перестал!


Dmitry Neustupov [10:44 PM] 
Мальчишки и девчёнки, никак не могу возбудить InMemoryAdminRestControllerSpringTest, все время выстреливает 
NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' - оба контекста висят в структуре проекта.


[10:45] 
Остальные тесты работают, квалификаторы вроде правильно расставил.


[10:45] 
Может кто сталкивался ? )

Katherine Buzatu [10:55 PM] 
@Dmitry Neustupov
> оба контекста висят в структуре проекта
1. Какие оба?
2. Они должны не просто висеть. Надо еще сообщить, что мы их хотим в нашей конфигурации.


Tanya [11:02 PM] 
InMemoryAdminRestControllerSpringTest должен работать с inMemory соотв там не должно быть bean of type 'javax.sql.DataSource'


new messages
Dmitry Neustupov [11:07 PM] 
@Katherine Buzatu spring-app и spring-db добавлены в структуру, как им сообщит, что мы их хотим? Оо...


[11:09] 
@Tanya но в нём же запросы уходят в AdminRestController а оттуда, соответственно в JDBCMealRepository


Tanya [11:17 PM] 
@Dmitry Neustupov а должны в "InMemor...RepositoryImpl"


Dmitry Neustupov [11:19 PM] 
@Tanya но при этом всё должно работать одновременно? и сервлет и все тесты и спринг-мейн?


Tanya [11:19 PM] 
ага


Dmitry Neustupov [11:32 PM] 
Спасибо за наводки ) Заработал всё одновременно )



----- Today November 22nd, 2017 -----
Viktor [12:54 AM] 
Такой вопрос появился (снова).
репозиторий кидает исключение, если попробовать добавить еду на занятое время. По идее это тоже надо протестировать, но тестировать это в сервисе на мой взгляд не правильно, т.к. сервис управляет репозиториями, но не знает какой конкретно реализацией. Т.е. исключение дубликата от спринга надо тестировать в тестах реализации Jdbc.
Как вы думаете? или как вы уже сделали?


itAvgur [6:45 AM] 
У меня репозиторий отдает null, а сервис его проверяет (checkNotFoundWithId) и бросает исключение.
Sergeev Viktor
Такой вопрос появился (снова).
репозиторий кидает исключение, если попробовать добавить еду на занятое время. По идее это тоже надо протестировать, но тестировать это в сервисе на мой взгляд не правильно, т.к. сервис управляет репозиториями, но не знает какой конкретно реализацией. Т.е. исключение дубликата от спринга надо тестировать в тестах реализации Jdbc.
Как вы думаете? или как вы уже сделали?
Posted in #hw3Today at 12:54 AM


Few
[7:04 AM] 
Ты ексепшн ловишь в репо и null возвращаешь? Ну вроде неуникальный ключ и not found это не одно и то же


Dmitry Neustupov [8:27 AM] 
У меня экзепшн из репозитория прилетает.


itAvgur [9:41 AM] 
Уже есть метод checkNotFoundWithId, который принимает на вход и проверяет на null. 
Я использовал существующую реализацию, чтобы не изобретать Америку.
2Few ага, я тоже подумал, что логичнее сделать еще одно исключение, типа DuplicateEntryFound.


Katherine Buzatu [10:00 AM] 
Тут, наверное, вопрос в том, что разные реализации репозитория будут вести себя по-разному в такой ситуации. И если от нашего jdbc летит DuplicateKeyException, то InMemory вообще все нравится, а третья реализация еще что-то третье выдаст. 
Запрет создавать записи с одинаковым временем - как бы бизнес-логика и, значит, дело сервиса. Но решается на уровне БД - репозитория. Может, как-то обязать репозитории выкидывать исключение? Но оно тогда должно быть checked, а мы их не любим... В общем, непонятно, как правильно. Давайте поговорим об этом :slightly_smiling_face: (edited)


russell [10:31 AM] 
Кажется для каждого слоя будет создаваться своя обертка для всех исключений и пробрасываться. А обработка уже будет в контроллере проходить централизовано.


Few 
[10:34 AM] 
они же и сами до контроллера всплывут

russell [10:35 AM] 
ну так их же надо залогировать на каждом слое


[10:35] 
Немчинский по крайней мере так говорил


Katherine Buzatu [10:35 AM] 
Вот сейчас мы тестируем сервис. Какого поведения мы ожидаем от него, когда создаем запись с существующим датаТаймом?


Few 
[10:36 AM] 
@Test(expected = DuplicateKeyException.class)


[10:36] 
))

Katherine Buzatu [10:37 AM] 
нерулезно как-то...


Few [10:38 AM] 
да самому не нравится )


Katherine Buzatu [10:39 AM] 
Ну, я схитрила и создала свое исключение - типа лично сервисное. Но тогда сервис должен проверить ~спринговое~ исключение реализации и тем самым повязаться с ~спрингом~ реализацией по гроб жизни.
_описка_ (edited)

vch [10:41 AM] 
@Katherine Buzatu А причём тут Spring? Вроде самое нижнее исключение - ConstraintException из Hibernate?


Few [10:44 AM] 
в общем я для этого здесь, один из тех моментов когда хочется узнать как делают в реальных проектах специалисты


[10:45] 
если нас интересуют много разных вариантов отказа репозитория, то false/null уже не достаточно и он должен кидать ексепшены


[10:46] 
и чекед вроде были бы к месту


Katherine Buzatu [10:46 AM] 
Ага. Заявленные интерфейсом и checked.


itAvgur [10:49 AM] 
"Запрет создавать записи с одинаковым временем - как бы бизнес-логика и, значит, дело сервиса"
Да как бы наверное и не бизнес-логика, иначе на кой черт создавать CONSTRAINT в скуле.
Получается, что это вопрос к репозиторию и исключение надо бросать из него (наследоваться от Runtime).


Few 
[10:49 AM] 
Ну при разных реализациях репо должен быть один интерфейс взаимодействия (определенный список исключений или возвращаемых значений :)), иначе сервис будет зависеть от реализации репо (edited)


Katherine Buzatu [10:55 AM] 
>  наверное и не бизнес-логика, иначе на кой черт создавать CONSTRAINT в скуле.
Я так понимаю, что бизнес-логика - это обеспечение поведения, которого мы ожидаем от сервиса. CONSTRAINT - не вынужденное ограничение из-за особенностей и ущербности хранилища. Это бизнес-логика, спущенная в БД для повышения эффективности.


Сергей Матвеев [12:03 PM] 
подскажите может кто наткнулся после запроса все поля кроме ИД в null 
List<Meal> meals = jdbcTemplate.query("SELECT * FROM meals WHERE user_id=?",ROW_MAPPER,userId);


Few [12:03 PM] 
Сеттеры и геттеры нужны в Meal

Сергей Матвеев [12:07 PM] 
так и есть ) благодярю


grigory.kislin [12:08 PM] 
@Viktor
> репозиторий кидает исключение, если попробовать добавить еду на занятое время
хороший вопрос. у нас действительно в inmemory реализации нет таких проверок
когда будем работать с эксепшенами (в конце стажировки) у нас будет тест на контроллер с проверкой занятого времени
пока предлагаю оставить без теста
вообще мой UserServiceTest.duplicateMailCreate не будет работать в inMemory реализации.. (edited)


[12:10] 
@russell
> ну так их же надо залогировать на каждом слое
зачем одно и тоже исключение много раз логировать?? централизовано будем ловить, логировать и обрабатывать (edited)


[12:11] 
@Few
>  один из тех моментов когда хочется узнать как делают в реальных проектах специалисты
в реальных проектах специалисты делают кому как захочется...
на каждом проекте выходит по своему (edited)


grigory.kislin [12:23 PM] 
добавил в урок: 8: Еще раз: в тестах проверять через JUnit Assert нельзя. Он проверяет через equals, который, учитавая будующие JPA реализации, мы не можем переопределить как сравнение по всем поля.


Сергей Матвеев [12:35 PM] 
проверял фильтрацию еды 
Message PreparedStatementCallback; bad SQL grammar [SELECT * FROM meals WHERE user_id=? AND datetime BETWEEN 2015-05-30 00:00 AND 2015-05-30 23:59]; nested exception is org.postgresql.util.PSQLException: ОШИБКА: ошибка синтаксиса (примерное положение: "00")
И время из формы не приходит только дата
Как в запрос дату со временем правильно сложить?


Сергей Матвеев [12:40 PM] 
return jdbcTemplate.query("SELECT * FROM meals WHERE user_id=? AND datetime BETWEEN "+ DateTimeUtil.toString(startDate) +" AND " + DateTimeUtil.toString(endDate)  ,ROW_MAPPER,userId);


[12:40] 
то в браузере посыпает)



vch [12:43 PM] 
@Сергей Матвеев Сработает, если используешь формат вида `'20150530 00:00'` В кавычки главное не забудь поставить.
P.S. но это я из разряда вредных советов... Не надо так в реальном коде. (edited)


Katherine Buzatu [1:13 PM] 
@Сергей Матвеев отчего дату не подставил так же, как id?


Glumov Konstantin [1:36 PM] 
откуда брать userId при создании еды в JdbcMealRepositoryImpl?

Few
[1:37 PM] 
Передается из контроллера через все слои (edited)


Belstrel [2:11 PM] 
Товарищи подскажите куда копать, getAll() работает нормально а при удалении или изменениии падает -
public boolean delete(int meal_id, int user_id) {
       return jdbcTemplate.update("DELETE FROM meals WHERE meal_id=? AND user_id=?", meal_id , user_id) != 0;}


vch [2:12 PM] 
@Belstrel а какой текст ошибки? Но я бы для начала заменил `WHERE meal_id=` на `WHERE id=`


Belstrel [2:16 PM] 
meal_id работает нормально метод save


[2:16] 
ошибка 500  For input string:""


[2:17] 
Сервер обнаружил внутреннюю ошибку, которая помешала ему выполнить этот запрос.


vch [2:17 PM] 
@Belstrel PostgreSQL 500 ошибку выдаёт???

Belstrel [2:17 PM] 
скрипт DELETE работает норм на базе


[2:18] 
ДА 9.5.9 версия помоему


[2:21] 
java.lang.NumberFormatException: For input string: ""

[2:23] 
видимо чтото в сервлете надо подправить,чтото с парсом траблы наверное

Few [2:27 PM] 
Ексепшн весь выложи

Belstrel 
[2:29 PM] 
java.lang.NumberFormatException: For input string: ""
    java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
    java.lang.Integer.parseInt(Integer.java:592)
    java.lang.Integer.parseInt(Integer.java:615)
    ru.javawebinar.topjava.web.MealServlet.getId(MealServlet.java:96)
    ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:74)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:622)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
    org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)


[2:30] 
2017-11-22 15:28:48,549 INFO  ru.javawebinar.topjava.web.meal.MealRestController.create:53 - create Meal{id=null, dateTime=2017-11-22T15:28, description='мясо-сало', calories=1000} for user 100000
2017-11-22 15:28:48,641 INFO  ru.javawebinar.topjava.web.meal.MealRestController.getAll:46 - getAll for user 100000


[2:30] 
это лог- получаеться у меня создается еда с id=null


Katherine Buzatu [2:32 PM] 
Так и должно быть. ИД потом в базе генерируется.


Сергей Матвеев [2:34 PM] 
ID это у поле в базе ... старт и энд это не поля
Katherine Buzatu
@Сергей Матвеев отчего дату не подставил так же, как id?
Posted in #hw3Today at 1:13 PM


Katherine Buzatu [2:35 PM] 
Это значения, их тоже можно через ?


Сергей Матвеев [2:38 PM] 
да.. нашел - ларчик просто открывался.. благодарю.
Katherine Buzatu
Это значения, их тоже можно через ?
Posted in #hw3Today at 2:35 PM


Few [2:40 PM] 
@Belstrel нужен код сервлета пока не могу посмотреть
1 reply Today at 2:43 PM View thread

Few
[2:50 PM] 
У тебя почему-то параметр id в запросе пустой приходит


Belstrel [2:51 PM] 
тоже туда копаю

Few
[2:52 PM] 
Возможно при заполнении вьюхи модель туда уже с пустым id передается


[2:54] 
Может серьезно столбец в id переименовать

Belstrel 
[2:57 PM] 
буду пробовать,сейчас создал новую еду ,проверил оба id но так и падает.


Few [3:04 PM] 
Ты вью не менял?


Belstrel 
[3:06 PM] 
вроде бы нет


Few [3:07 PM] 
Тогда покажи из логов что достается из базы по getAll

Belstrel 
[3:11 PM] 
2017-11-22 16:10:07,156 INFO  o.s.jdbc.datasource.DriverManagerDataSource.setDriverClassName:133 - Loaded JDBC driver: org.postgresql.Driver
2017-11-22 16:10:15,741 INFO  ru.javawebinar.topjava.web.meal.MealRestController.getAll:46 - getAll for user 100000


[3:11] 
это с идеи лог


Few
[3:18 PM] 
Добавь в лог значения полей meal в списке,  который в getAll формируется


[3:19] 
Или через дебаг посмотри его содержимое


Belstrel 
[3:20 PM] 
2017-11-22 15:55:54,789 INFO  ru.javawebinar.topjava.web.meal.MealRestController.create:53 - create Meal{id=null, dateTime=2017-11-22T15:55, description='макароны', calories=1000} for user 100000


Few [3:21 PM] 
Это create


Belstrel 
[3:21 PM] 
это когда нажимаешь делит

[3:21] 
сейчас креет сделаю

Few
[3:21 PM] 
Так он у тебя create вызывает чтоли?

Belstrel [3:25 PM] 
2017-11-22 16:23:48,808 INFO  ru.javawebinar.topjava.web.meal.MealRestController.create:53 - create Meal{id=null, dateTime=2017-11-22T16:23, description='полдник', calories=500} for user 100000
2017-11-22 16:23:49,062 INFO  ru.javawebinar.topjava.web.meal.MealRestController.getAll:46 - getAll for user 100000


[3:26] 
создаю новую еду,перехожу на meals.jsp всё норме,но когда пытаюсь её удалить -ошибка


Few [3:26 PM] 
У тебя в обоих логах create метод


Katherine Buzatu [3:27 PM] 
Поставь брейкпоинт в самом начале doGet. Запусти дебаг и посмотри, что приходит в запросе при удалении. (edited)


Belstrel [3:38 PM] 
дебагер пока чтото не хочет показывать,а зато в идееских логах пишет 
2017-11-22 16:28:57,817 [22279325]   INFO - tbrains.idea.tomcat.TomcatUtil - Cannot load /home/belstrel/git-sam/topjava/target/topjava/META-INF/context.xml: /home/belstrel/git-sam/topjava/target/topjava/META-INF/context.xml (Нет такого файла или каталога)


[3:39] 
гдето видимо неправльно переименовал навеное


[3:39] 
странно как тогда креэйт работает

Belstrel 
[3:55 PM] 
А вот такой файл у всех есть??  /target/topjava/META-INF/context.xml

Few [3:55 PM] 
Нет,  а что в нем?

[3:55] 
Что за контекст там может быть (edited)

[3:59] 
попробуй деплой WAR сделать вместо WAR Exploded

Belstrel 
[4:00 PM] 
делал,у меня WAR вообще не хочет работать никак,тоьлко Exploded

[4:00] 
у меня тоже нет этого файла просто на него ругаються логи

Viktor [4:04 PM] 
попобуй без IDEA прямо в томкат закинуть


Few [4:06 PM] 
попробуй идею перезапустить чтоли :slightly_smiling_face:


grigory.kislin [4:18 PM] 
> "SELECT * FROM meals WHERE user_id=? AND datetime BETWEEN "+ DateTimeUtil.toString(startDate) +" AND
так не делайте! счас ссылку в урок вставлю на SQL injection


[4:20] 
НЕ делайте склейку SQL запросов вручную из параметров, только через jdbcTemplate параметры! См. Внедрение_SQL-кода
https://ru.wikipedia.org/wiki/%D0%92%D0%BD%D0%B5%D0%B4%D1%80%D0%B5%D0%BD%D0%B8%D0%B5_SQL-%D0%BA%D0%BE%D0%B4%D0%B0
Wikipedia
Внедрение SQL-кода
Внедрение SQL-кода (англ. SQL injection) — один из распространённых способов взлома сайтов и программ, работающих с базами данных, основанный на внедрении в запрос произвольного SQL-кода.
Внедрение SQL, в зависимости от типа используемой СУБД и условий внедрения, может дать возможность атакующему выполнить произвольный запрос к базе данных (например, прочитать содержимое любых таблиц, удалить, изменить или добавить данные), получить возможность чтения и/или записи локальных файлов и выполнения произвольных Show more…
(edited)


vch [4:26 PM] 
@grigory.kislin Ну, конкретно в данном случае sql-инъекция не грозит - т.к. в репозиторий приходит LocalDateTime, а не строка.


grigory.kislin [4:27 PM] 
согласен. но мы же не будем различать - какие можно приклеивать, какие - нет
все делается одинаково чз ппраметры jdbcTemplate


Belstrel 
[4:38 PM] 
пробую дебажить,перезапуск идеи не решил проблему,потом попробую напрямую в томкат вставить


Few [4:56 PM] 
added this Plain Text snippet
java.lang.NumberFormatException: For input string: ""
  java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
  java.lang.Integer.parseInt(Integer.java:592)
  java.lang.Integer.parseInt(Integer.java:615)
  ru.javawebinar.topjava.web.MealServlet.getId(MealServlet.java:96)
  ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:82)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:635)
  javax.servlet.http.HttpServlet.service(HttpServlet.java:742)
  org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
Add Comment Collapse



Few
[4:57 PM] 
получил у себя


new messages
Belstrel [4:57 PM] 
да у меня так же


[4:58] 
чтото с парс не так


Few [4:58 PM] 
достаточно в getAll взять из базы объекты c null вместо id


[4:58] 
они нормально отрисуются на вьюхе


[4:58] 
но при удалении или апдейте будет ожидаемый результат


russell [5:05 PM] 
Глянул ему в код, он в сиквеле meal_id поле создал и beanpropertyrowmapper не знал как замэпить на id в baseEntity


Few
[5:06 PM] 
вот и получалось без id


russell [5:07 PM] 
кому интересно в доке BeanPropertyRowMapper - Column values are mapped based on matching the column name as obtained from result set metadata to public setters for the corresponding properties. The names are matched either directly or by transforming a name separating the parts with underscores to the same name using "camel" case.


Few
[5:08 PM] 
это бы в лекцию добавить


[5:09] 
скинь Григорию в личку


russell [5:10 PM] 
а может это как часть задания, чтобы помучились?


Few [5:11 PM] 
ну в основном просто скопировали с users не задумываясь и все работает


[5:11] 
но информация достаточно важная чтобы осмысленно создавать таблицу


Belstrel [5:15 PM] 
всем спасибо,заработало,ребята предлагали ранее сменить meal_id на id,но как то не видно было в это великого смысла вот и проковырялся столько))


Few
[5:15 PM] 
вот она скрытая магия Спринга


vch [5:16 PM] 
@Few а где там спринг? Вроде там всё Hibernate делает


Belstrel 
[5:16 PM] 
а где там хибернейт??

Few [5:16 PM] 
гибернейта нет у нас пока


vch [5:17 PM] 
гмм.... Значит я забыл, о чём HW3. Приношу извинения.


Few [5:17 PM] 
https://docs.spring.io/spring-framework/docs/4.3.0.RELEASE/javadoc-api/org/springframework/jdbc/core/RowMapper.html


[5:18] 
короче говоря полагаясь на магию, все же надо знать как она изнутри работает



Belstrel [5:19 PM] 
а я начал Spring for prof читаать но не успеваю,читать много))


Few
[5:20 PM] 
я Spring in Action читаю, но до работы с базами еще не дошел


grigory.kislin [5:20 PM] 
думаю, счас главное пройти все темы стажировки и все ДЗ сделать
книжками можно будет потом догоняться и вообще- уже даже можно не все подряд, а выборочно


Few
[5:21 PM] 
ну это задание было попроще предыдущего, поэтому осталось время почитать )



Belstrel [5:22 PM] 
спасибо Григорий за совет,стараемся выполнять ДЗ потом теорию смотреть))



grigory.kislin [7:40 PM] 
по просьбам участников добавил в замечания, хотя для текущего потока поздновато:(
10: Напомню: BeanPropertyRowMapper работает через отражение. Ему нужны геттеры/сеттеры и имена полей должны "совпадать" с колонками ResultSet (Column values are mapped based on matching the column name as obtained from result set metadata to public setters for the corresponding properties. The names are matched either directly or by transforming a name separating the parts with underscores to the same name using "camel" case).


LORREON [8:23 PM] 
Как временно убрать логи Spring-a c консоли?


Valery [8:26 PM] 
в файле topjava/src/main/resources/logback.xml  поменяй level


[8:27] 
или строчку <appender-ref ref="console"/> закоментируй


[8:27] 
это мои догадки, сам не проверял


Nick [8:28 PM] 
added this Java snippet
public Meal save(Meal meal, int userId) {
    MapSqlParameterSource map = new MapSqlParameterSource()
        .addValue("userId", userId)
        .addValue("id", meal.getId())
        .addValue("description", meal.getDescription())
        .addValue("calories", meal.getCalories())
        .addValue("dateTime", meal.getDateTime());
​
    if (meal.isNew()) {
      Number newKey = insertMeal.executeAndReturnKey(map);
      meal.setId(newKey.intValue());
    } else {
      namedParameterJdbcTemplate.update(
          "UPDATE meals SET id=:id, description=:description, calories=:calories, date_time=:dateTime WHERE id=:id", map);
    }
    return meal;
  }
Add Comment Collapse



Nick [8:28 PM] 
Этот код жалуется, что Id еды равен null

[8:29] 
Даже хардкодил, все равно null

Valery [8:35 PM] 
в 3 строчке может быть если новая еда


Few [8:36 PM] 
при создании или обновлении записи?


Nick [8:36 PM] 
При создании


Valery [8:36 PM] 
а вот тут сеттер лишний - SET id=:id


[8:37] 
смотри еще метод insertMeal


[8:37] 
он тебе id возвращает

Few
[8:39 PM] 
как у тебя таблица в sql скрипте задана?


Tanya [8:40 PM] 
проверки по userId нет


Few
[8:40 PM] 
да мы пока про создание говорим


Valery [8:40 PM] 
meal.isNew() - это не проверка?


Few
[8:40 PM] 
проверки при обновлении нет


Nick [8:40 PM] 
added this SQL snippet
CREATE TABLE meals
(
 id INT PRIMARY KEY NOT NULL,
 user_id INTEGER NOT NULL,
 description VARCHAR NOT NULL,
 calories INT NOT NULL,
 date_time TIMESTAMP NOT NULL,
 FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
Add Comment Collapse



Few
[8:41 PM] 
у тебя автогенерации id нет

[8:41] 
в таблице

[8:42] 
новый мил поступает без id и база должна его сгенерить


[8:42] 
а у тебя не генерит, а ждет от тебя ненулевого значения


[8:44] 
id               INTEGER PRIMARY KEY DEFAULT nextval('global_seq'),


[8:44] 
сделай так

Nick [8:45 PM] 
Спасибо большое, заработало.

Few [8:47 PM] 
апдейт у тебя на первый взгляд не рабочий



Nick [8:48 PM] 
Не, все работает. Магия


Few [8:48 PM] 
чужую еду может апдейтить


[8:49] 
а не должен

[8:50] 
ты пишешь WHERE id=id, но не проверяешь что userId=userid


[8:50] 
и если WHERE id=id, то его упдейтить нет смысла SET id=:id

Nick [8:53 PM] 
Все исправил, благодарю.

Few
[8:53 PM] 
и еще момент, тебе надо предусмотреть правильное возвращаемое значение если ничего не обновлено (т.е. была попытка обновить то, что нельзя)


Nick [8:57 PM] 
А как пользователь может изменять то что нельзя, он же только свою еду видит?


Valery [8:57 PM] 
хакнуть может)

Few [8:57 PM] 
ну мы тут REST API реализовываем, т.о. запрос может прийти любой


Nick [8:58 PM] 
Spring Security, наверное, эти дыры закроет


vch [9:05 PM] 
А как, простите, вам поможет Security?


Few
[9:05 PM] 
если не сверять userid, можно обновить любую запись


Viktor [12:29 AM] 
Никому при сборке не мешал плагин "maven-surefire-plugin"? У меня с ним тесты падают (не сами тесты, они даже не запускаются). Закомментил его и все отлично.


Viktor [12:38 AM] 
сами тесты при этом даже не запускаются [INFO] Tests run: 0, Failures: 0, Errors: 0, Skipped: 0


[12:39] 
все что пишет в дамп (единственный файл, который пишет)


Viktor [12:39 AM] 
added this Plain Text snippet
# Created on 2017-11-23T01:38:27.699
Killing self fork JVM. Maven process died.
Add Comment



Viktor [12:41 AM] 
нашел ответ, что surface не поддерживает библиотеки где используется System.exit(), осталось угадать где и используется ли?


grigory.kislin [1:41 AM] 
Занятие 4 готово!
*Welcome: #hw4*


Viktor [2:21 AM] 
@grigory.kislin можете подсказать по плагину? сам поискал ответа не нашел. Если удалить плагин, то мавен береть версию 2.12.4 и работает. Подумал, что проблема в версии мавена, поставил новую но все равно не работает с плагином 2.20.1. Попробовал все инструкции с сайта мавена к этому плагину, тоже не пошло. В логах нашел ошибку MojoExecutionException, но по ссылке там ни какой полезной инфы не нашел. Немного в замешательстве, починить починил, но как-то не правильно :smiley:


[2:24] 
при всем при этом не тестируется даже начальный вариант в master ветке. НО я могу внутри идеи запустить деплой на томкат и все сработает.


Viktor [2:30 AM] 
И видимо это баг 2.20.1 версии т.к. 2.20 работает так же отлично... я снова в замешательстве...


grigory.kislin [2:40 PM] 
@viktorpavlovi4 без плагига тесты maven не запустит
без idea- mav test - запускается?
у russel были проблемы что jvm крешился, а  у меня его тесты шли. .. решилось понижением версии surface


Katherine Buzatu [3:07 PM] 
> 1: В MealTestData еду делайте константами.
@grigory.kislin прокомментируйте, пожалуйста. Чем монстрообразный набор констант лучше, к примеру, более гибкого и аккуратного списка?


Viktor [3:16 PM] 
@grigory.kislin у меня тоже пошло с понижением версии, просто интересно почему последняя так себя ведет


grigory.kislin [3:54 PM] 
@Viktor
бага. толи в surefire, толи в JVM


[3:55] 
@Katherine Buzatu мне кажется с константами тестировать проще


Maksim [3:31 PM] 
Всем привет. Почему в MavenProjects в ветке Dependensies подсвечивается красным org.springframework:spring-test:4.3.12.RELEASE (test)


grigory.kislin [5:31 PM] 
@Maksim
у меня все ок. зависимость подтянулась, тесты идут? реимпорт алл (первая кнопка)- делал?


Maksim [6:51 PM] 
Тесты UserServiceTest ни один не проходит


Maksim [6:51 PM] 
added this Plain Text snippet
/usr/lib/jvm/default-java/bin/java -ea -Dfile.encoding=UTF-8 -Didea.test.cyclic.buffer.size=1048576 -javaagent:/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/lib/idea_rt.jar=36097:/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/bin -classpath /home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/lib/idea_rt.jar:/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/plugins/junit/lib/junit-rt.jar:/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/plugins/junit/lib/junit5-rt.jar:/usr/lib/jvm/default-java/jre/lib/charsets.jar:/usr/lib/jvm/default-java/jre/lib/ext/cldrdata.jar:/usr/lib/jvm/default-java/jre/lib/ext/dnsns.jar:/usr/lib/jvm/default-java/jre/lib/ext/icedtea-sound.jar:/usr/lib/jvm/default-java/jre/lib/ext/jaccess.jar:/usr/lib/jvm/default-java/jre/lib/ext/localedata.jar:/usr/lib/jvm/default-java/jre/lib/ext/nashorn.jar:/usr/lib/jvm/default-java/jre/lib/ext/sunec.jar:/usr/lib/jvm/default-java/jre/lib/ext/sunjce_provider.jar:/usr/lib/jvm/default-java/jre/lib/ext/sunpkcs11.jar:/usr/lib/jvm/default-java/jre/lib/ext/zipfs.jar:/usr/lib/jvm/default-java/jre/lib/jce.jar:/usr/lib/jvm/default-java/jre/lib/jsse.jar:/usr/lib/jvm/default-java/jre/lib/management-agent.jar:/usr/lib/jvm/default-java/jre/lib/resources.jar:/usr/lib/jvm/default-java/jre/lib/rt.jar:/home/maximus/IdeaProjects/topjava/target/test-classes:/home/maximus/IdeaProjects/topjava/target/classes:/home/maximus/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar:/home/maximus/.m2/repository/org/slf4j/jcl-over-slf4j/1.7.25/jcl-over-slf4j-1.7.25.jar:/home/maximus/.m2/repository/org/slf4j/jul-to-slf4j/1.7.25/jul-to-slf4j-1.7.25.jar:/home/maximus/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar:/home/maximus/.m2/repository/ch/qos/logback/logback-core/1.2.3/logback-core-1.2.3.jar:/home/maximus/.m2/repository/org/springframework/spring-context/4.3.12.RELEASE/spring-context-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/springframework/spring-aop/4.3.12.RELEASE/spring-aop-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/springframework/spring-beans/4.3.12.RELEASE/spring-beans-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/springframework/spring-core/4.3.12.RELEASE/spring-core-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/springframework/spring-expression/4.3.12.RELEASE/spring-expression-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/springframework/spring-jdbc/4.3.12.RELEASE/spring-jdbc-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/springframework/spring-tx/4.3.12.RELEASE/spring-tx-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/postgresql/postgresql/42.1.4/postgresql-42.1.4.jar:/home/maximus/.m2/repository/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.jar:/home/maximus/.m2/repository/javax/servlet/jstl/1.2/jstl-1.2.jar:/home/maximus/.m2/repository/junit/junit/4.12/junit-4.12.jar:/home/maximus/.m2/repository/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar:/home/maximus/.m2/repository/org/springframework/spring-test/4.3.12.RELEASE/spring-test-4.3.12.RELEASE.jar:/home/maximus/.m2/repository/org/assertj/assertj-core/3.8.0/assertj-core-3.8.0.jar com.intellij.rt.execution.junit.JUnitStarter -ideVersion5 -junit4 ru.javawebinar.topjava.service.UserServiceTest
21:50:24.821 DEBUG o.springframework.jdbc.datasource.DataSourceUtils.doGetConnection:110 - Fetching JDBC Connection from DataSource
21:50:24.822 DEBUG o.s.jdbc.datasource.DriverManagerDataSource.getConnectionFromDriver:142 - Creating new JDBC DriverManager Connection to [jdbc:postgresql://localhost:5432/topjava]
21:50:24.827 DEBUG org.postgresql.Driver.loadDefaultProperties:131 - Loading driver configuration via classloader sun.misc.Launcher$AppClassLoader@18b4aac2
21:50:24.829 DEBUG org.postgresql.Driver.connect:240 - Connecting with URL: jdbc:postgresql://localhost:5432/topjava
21:50:24.844 DEBUG org.postgresql.jdbc.PgConnection.<init>:182 - PostgreSQL JDBC Driver 42.1.4
21:50:24.845 DEBUG org.postgresql.jdbc.PgConnection.setDefaultFetchSize:1012 -  setDefaultFetchSize = 0
21:50:24.846 DEBUG org.postgresql.jdbc.PgConnection.setPrepareThreshold:1021 -  setPrepareThreshold = 5
21:50:24.855 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:136 - Trying to establish a protocol version 3 connection to localhost:5432
21:50:24.866 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:186 - Receive Buffer Size is 530 904
21:50:24.867 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:187 - Send Buffer Size is 1 313 280
21:50:24.985 INFO o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:441 - Executing SQL script from class path resource [db/populateDB.sql]
21:50:25.012 DEBUG o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:473 - 2 returned as update count for SQL: DELETE FROM user_roles
21:50:25.019 DEBUG o.springframework.jdbc.datasource.DataSourceUtils.doReleaseConnection:329 - Returning JDBC Connection to DataSource
21:50:25.028 WARN o.springframework.test.context.TestContextManager.beforeTestMethod:273 - Caught exception while allowing TestExecutionListener [org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@6caf0677] to process 'before' execution of test method [public void ru.javawebinar.topjava.service.UserServiceTest.create() throws java.lang.Exception] for test instance [ru.javawebinar.topjava.service.UserServiceTest@413d1baf]
org.springframework.jdbc.datasource.init.ScriptStatementFailedException: Failed to execute SQL script statement #2 of class path resource [db/populateDB.sql]: DELETE FROM meals; nested exception is org.postgresql.util.PSQLException: ERROR: relation "meals" does not exist
 Позиция: 13
  at org.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript(ScriptUtils.java:491)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.populate(ResourceDatabasePopulator.java:238)
  at org.springframework.jdbc.datasource.init.DatabasePopulatorUtils.execute(DatabasePopulatorUtils.java:48)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.execute(ResourceDatabasePopulator.java:253)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:210)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:142)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.beforeTestMethod(SqlScriptsTestExecutionListener.java:112)
  at org.springframework.test.context.TestContextManager.beforeTestMethod(TestContextManager.java:269)
  at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
  at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
  at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
  at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:252)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:94)
  at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
  at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
  at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
  at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
  at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
  at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
  at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
  at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:191)
  at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
  at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
  at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
  at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
  at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: org.postgresql.util.PSQLException: ERROR: relation "meals" does not exist
 Позиция: 13
  at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2477)
  at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2190)
  at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:300)
  at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:428)
  at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:354)
  at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:301)
  at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:287)
  at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:264)
  at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:260)
  at org.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript(ScriptUtils.java:470)
  ... 27 common frames omitted
org.springframework.jdbc.datasource.init.ScriptStatementFailedException: Failed to execute SQL script statement #2 of class path resource [db/populateDB.sql]: DELETE FROM meals; nested exception is org.postgresql.util.PSQLException: ERROR: relation "meals" does not exist
 Позиция: 13
  at org.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript(ScriptUtils.java:491)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.populate(ResourceDatabasePopulator.java:238)
  at org.springframework.jdbc.datasource.init.DatabasePopulatorUtils.execute(DatabasePopulatorUtils.java:48)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.execute(ResourceDatabasePopulator.java:253)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:210)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:142)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.beforeTestMethod(SqlScriptsTestExecutionListener.java:112)
  at org.springframework.test.context.TestContextManager.beforeTestMethod(TestContextManager.java:269)
  at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
  at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
  at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
  at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:252)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:94)
  at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
  at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
  at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
  at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
  at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
  at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
  at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
  at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:191)
  at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
  at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
  at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
  at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
  at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: org.postgresql.util.PSQLException: ERR...
Add Comment Collapse This snippet was truncated for display: see it in full.



Maksim [6:53 PM] 
И остальные тесты перестали идти


[6:53] 
Странно как-то


Maksim [6:54 PM] 
added this Plain Text snippet
/usr/lib/jvm/default-java/bin/java -Dmaven.multiModuleProjectDirectory=/home/maximus/IdeaProjects/topjava -Dmaven.home=/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/plugins/maven/lib/maven3 -Dclassworlds.conf=/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/plugins/maven/lib/maven3/bin/m2.conf -javaagent:/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/lib/idea_rt.jar=37323:/home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/bin -Dfile.encoding=UTF-8 -classpath /home/maximus/Develop/IntellijIDEA/idea-IU-171.3780.107/plugins/maven/lib/maven3/boot/plexus-classworlds-2.5.2.jar org.codehaus.classworlds.Launcher -Didea.version=2017.2.6 install
[INFO] Scanning for projects...
[INFO]                                     
[INFO] ------------------------------------------------------------------------
[INFO] Building Calories Management 1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ topjava ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 6 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.7.0:compile (default-compile) @ topjava ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ topjava ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 1 resource
[INFO] 
[INFO] --- maven-compiler-plugin:3.7.0:testCompile (default-testCompile) @ topjava ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.20.1:test (default-test) @ topjava ---
[INFO] 
[INFO] -------------------------------------------------------
[INFO] T E S T S
[INFO] -------------------------------------------------------
[INFO] Running ru.javawebinar.topjava.service.UserServiceTest
21:53:49.509 INFO o.s.jdbc.datasource.DriverManagerDataSource.setDriverClassName:133 - Loaded JDBC driver: org.postgresql.Driver
21:53:49.803 DEBUG o.springframework.jdbc.datasource.DataSourceUtils.doGetConnection:110 - Fetching JDBC Connection from DataSource
21:53:49.804 DEBUG o.s.jdbc.datasource.DriverManagerDataSource.getConnectionFromDriver:142 - Creating new JDBC DriverManager Connection to [jdbc:postgresql://localhost:5432/topjava]
21:53:49.809 DEBUG org.postgresql.Driver.loadDefaultProperties:131 - Loading driver configuration via classloader sun.misc.Launcher$AppClassLoader@7f31245a
21:53:49.810 DEBUG org.postgresql.Driver.connect:240 - Connecting with URL: jdbc:postgresql://localhost:5432/topjava
21:53:49.823 DEBUG org.postgresql.jdbc.PgConnection.<init>:182 - PostgreSQL JDBC Driver 42.1.4
21:53:49.824 DEBUG org.postgresql.jdbc.PgConnection.setDefaultFetchSize:1012 -  setDefaultFetchSize = 0
21:53:49.825 DEBUG org.postgresql.jdbc.PgConnection.setPrepareThreshold:1021 -  setPrepareThreshold = 5
21:53:49.834 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:136 - Trying to establish a protocol version 3 connection to localhost:5432
21:53:49.852 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:186 - Receive Buffer Size is 530 904
21:53:49.853 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:187 - Send Buffer Size is 1 313 280
21:53:49.932 INFO o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:441 - Executing SQL script from class path resource [db/populateDB.sql]
21:53:49.942 DEBUG o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:473 - 0 returned as update count for SQL: DELETE FROM user_roles
21:53:49.963 DEBUG o.springframework.jdbc.datasource.DataSourceUtils.doReleaseConnection:329 - Returning JDBC Connection to DataSource
21:53:49.974 WARN o.springframework.test.context.TestContextManager.beforeTestMethod:273 - Caught exception while allowing TestExecutionListener [org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@38467116] to process 'before' execution of test method [public void ru.javawebinar.topjava.service.UserServiceTest.create() throws java.lang.Exception] for test instance [ru.javawebinar.topjava.service.UserServiceTest@5b7a7f33]
org.springframework.jdbc.datasource.init.ScriptStatementFailedException: Failed to execute SQL script statement #2 of class path resource [db/populateDB.sql]: DELETE FROM meals; nested exception is org.postgresql.util.PSQLException: ERROR: relation "meals" does not exist
 Позиция: 13
  at org.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript(ScriptUtils.java:491)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.populate(ResourceDatabasePopulator.java:238)
  at org.springframework.jdbc.datasource.init.DatabasePopulatorUtils.execute(DatabasePopulatorUtils.java:48)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.execute(ResourceDatabasePopulator.java:253)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:210)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:142)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.beforeTestMethod(SqlScriptsTestExecutionListener.java:112)
  at org.springframework.test.context.TestContextManager.beforeTestMethod(TestContextManager.java:269)
  at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
  at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
  at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
  at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:252)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:94)
  at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
  at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
  at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
  at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
  at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
  at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
  at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
  at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:191)
  at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:369)
  at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:275)
  at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:239)
  at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:160)
  at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:373)
  at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:334)
  at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:119)
  at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:407)
Caused by: org.postgresql.util.PSQLException: ERROR: relation "meals" does not exist
 Позиция: 13
  at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2477)
  at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2190)
  at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:300)
  at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:428)
  at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:354)
  at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:301)
  at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:287)
  at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:264)
  at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:260)
  at org.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript(ScriptUtils.java:470)
  ... 30 common frames omitted
21:53:50.018 DEBUG o.springframework.jdbc.datasource.DataSourceUtils.doGetConnection:110 - Fetching JDBC Connection from DataSource
21:53:50.018 DEBUG o.s.jdbc.datasource.DriverManagerDataSource.getConnectionFromDriver:142 - Creating new JDBC DriverManager Connection to [jdbc:postgresql://localhost:5432/topjava]
21:53:50.019 DEBUG org.postgresql.Driver.connect:240 - Connecting with URL: jdbc:postgresql://localhost:5432/topjava
21:53:50.020 DEBUG org.postgresql.jdbc.PgConnection.<init>:182 - PostgreSQL JDBC Driver 42.1.4
21:53:50.021 DEBUG org.postgresql.jdbc.PgConnection.setDefaultFetchSize:1012 -  setDefaultFetchSize = 0
21:53:50.022 DEBUG org.postgresql.jdbc.PgConnection.setPrepareThreshold:1021 -  setPrepareThreshold = 5
21:53:50.026 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:136 - Trying to establish a protocol version 3 connection to localhost:5432
21:53:50.028 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:186 - Receive Buffer Size is 530 904
21:53:50.029 DEBUG org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl:187 - Send Buffer Size is 1 313 280
21:53:50.034 INFO o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:441 - Executing SQL script from class path resource [db/populateDB.sql]
21:53:50.040 DEBUG o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:473 - 0 returned as update count for SQL: DELETE FROM user_roles
21:53:50.042 DEBUG o.springframework.jdbc.datasource.DataSourceUtils.doReleaseConnection:329 - Returning JDBC Connection to DataSource
21:53:50.044 WARN o.springframework.test.context.TestContextManager.beforeTestMethod:273 - Caught exception while allowing TestExecutionListener [org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@38467116] to process 'before' execution of test method [public void ru.javawebinar.topjava.service.UserServiceTest.delete() throws java.lang.Exception] for test instance [ru.javawebinar.topjava.service.UserServiceTest@5884a914]
org.springframework.jdbc.datasource.init.ScriptStatementFailedException: Failed to execute SQL script statement #2 of class path resource [db/populateDB.sql]: DELETE FROM meals; nested exception is org.postgresql.util.PSQLException: ERROR: relation "meals" does not exist
 Позиция: 13
  at org.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript(ScriptUtils.java:491)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.populate(ResourceDatabasePopulator.java:238)
  at org.springframework.jdbc.datasource.init.DatabasePopulatorUtils.execute(DatabasePopulatorUtils.java:48)
  at org.springframework.jdbc.datasource.init.ResourceDatabasePopulator.execute(ResourceDatabasePopulator.java:253)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:210)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.executeSqlScripts(SqlScriptsTestExecutionListener.java:142)
  at org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener.beforeTestMethod(SqlScriptsTestExecutionListener.java:112)
  at org.springframework.test.context.TestContextManager.beforeTestMethod(TestContextManager.java:269)
  at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
  at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
  at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
  at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:252)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:94)
  at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
  at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71...
Add Comment Collapse This snippet was truncated for display: see it in full.



Maksim [6:54 PM] 
Когда делаю mvn package, то появляется ошибка,


Maksim [7:01 PM] 
и почему-то стало при запуске тестов появляться следующее:


Viktor [7:02 PM] 
@Maksim org.springframework.jdbc.datasource.init.ScriptStatementFailedException: Failed to execute SQL script statement #2 of class path resource [db/populateDB.sql]: DELETE FROM meals; nested exception is org.postgresql.util.PSQLException: ERROR: relation "meals" does not exist


[7:03] 
тебе спринг говорит, что таблицы meals не существует


Maksim [7:04 PM] 
а она в каком патче добавляется?


Viktor [7:05 PM] 
ты к какой БД подсоединяешься? к своей?


Maksim [7:05 PM] 
Да


[7:05] 
вроде нашел

[7:05] 
в hw4


[7:05] 
в патке 4_1


[7:05] 
перезапустил idea вроде прошлая ошибка ушла


[7:06] 
Ага, точно, спасибо Виктор


[7:07] 
помогло


[7:07] 
точно не было таблицы


CRCx86 [2:13 PM] 
подскажите плз, где посмотреть как в идее откатиться до предыдущего урока? всё запорол, ничего не работает


Maksim [5:29 PM] 
Не переживай. Все тут так делали. Посмотри вот здесь
AleksandrZinov
подскажите плз, где посмотреть как в идее откатиться до предыдущего урока? всё запорол, ничего не работает
Posted in #hw3Today at 2:13 PM


[5:29] 
https://github.com/JavaOPs/topjava/wiki/Git
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 


[5:29] 
С места как откатить патч


Shalukhau Dzmitry [6:45 PM] 
Народ, я помню версию postgresql обсуждали: 10.1 смог кто-либо попробывать?

Katherine Buzatu [2 hours ago] 
У меня работает


Few [2 hours ago] 
+1


Shalukhau Dzmitry [2 hours ago] 
Спасибо всем.


Argentum_kuh [6:45 PM] 
Я. Пашет норм.


Shalukhau Dzmitry [6:48 PM] 
Спасибо всем.


chimax [9:02 PM] 
ды


CRCx86 [10:05 AM] 
здравствуйте! создал базу PgSQL, создал user, подключиться к идее не получается
идея пишет, что не подходит пользователь или пароль
чяднт?


Dmitry Neustupov [10:47 AM] 
@CRCx86 нужно в постгессе включить у юзера возможность авторизации.



CRCx86 [10:48 AM] 
@Dmitry Neustupov а это, когда я создаю пользователя, у меня появляется значок группы, это правильно?


anpotashev [11:02 AM] 
uploaded and commented on this image: Pasted image at 2017-11-28, 12:01 PM
2 Comments

can login



Shalukhau Dzmitry [11:22 AM] 
Я счас тоже pgAdmin4 веселился. У меня Linux Mint. И оптимальнее всего было подымать в Docker. Но я почему то не решил подымать postgres в докере. В общем, кому нужна информация postgres (на локалхосте)+ админка в докере и все работает - обращайтесь (не тратьте свое время, я 3 часа жизни у себя забрал :disappointed:

CRCx86 [6 hours ago] 
разобрался, спасибо!


CRCx86 [11:28 AM] 
commented on anpotashev’s file Pasted image at 2017-11-28, 12:01 PM
спасибо!


aanyukhin [9:03 PM] 
@grigory.kislin а можно в методе в репозиториях в методах save вместо MapSqlParameterSource, использовать BeanPropertySqlParameterSource. Думаю более лаконично будет, за исключением случаев когда надо явно смапить.


grigory.kislin [9:04 PM] 
@aanyukhin :+1: можно! (edited)


Maksim [8:37 AM] 
У меня тоже mint. Ничего сложного в поднятии postgresql нет. Справился за 15 минут. Причем еще стоит и mysql
Shalukhau Dzmitry
Я счас тоже pgAdmin4 веселился. У меня Linux Mint. И оптимальнее всего было подымать в Docker. Но я почему то не решил подымать postgres в докере. В общем, кому нужна информация postgres (на локалхосте)+ админка в докере и все работает - обращайтесь (не тратьте свое время, я 3 часа жизни у себя забрал :disappointed:
Thread in #hw3Yesterday at 11:22 AM


Shalukhau Dzmitry [9:13 AM] 
@Maksim У меня проблемы не с postgres возникли, а с pgAdmin4 в докере (а по другому из исходников собирать), который не видел postgres на хосте


Maksim [9:14 AM] 
А. Понял. Я оставил pgAdmin3. А так пользуюсь DBeaver Community. Очень удобно.
Shalukhau Dzmitry
@Maksim У меня проблемы не с postgres возникли, а с pgAdmin4 в докере (а по другому из исходников собирать), который не видел postgres на хосте
Posted in #hw3Today at 9:13 AM


Shalukhau Dzmitry [9:15 AM] 
@Maksim pgAdmin3 - deprecated. За DBeaver Community - спасибо.


Maksim [9:50 AM] 
Попробовал тоже через докер. Не видит он локальную базу и все тут.


CRCx86 [9:50 AM] 
доброе утро, почему при создании в initDB.sql двух полей в таблице meals с типом timestamp происходит ошибка? с одним полем всё нормально, таблица создаётся (edited)


Shalukhau Dzmitry [10:01 AM] 
@Maksim не увидит до тех пор пока ты postgres не скажешь, что к ней можно достучаться по сети.


Shalukhau Dzmitry [10:02 AM] 
http://vivazzi.ru/it/remote-access-postgresql/

CRCx86 [11 hours ago] 
CREATE TABLE meals
(
 id          INTEGER PRIMARY KEY DEFAULT nextval('global_seq'),
 user_id     INTEGER NOT NULL,
 description VARCHAR NOT NULL,
 calories    INTEGER NOT NULL,
 dateTime   TIMESTAMP NOT NULL,

 FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
);


CRCx86 [11 hours ago] 
а на этом ошибка

CREATE TABLE meals
(
 id          INTEGER PRIMARY KEY DEFAULT nextval('global_seq'),
 user_id     INTEGER NOT NULL,
 description VARCHAR NOT NULL,
 calories    INTEGER NOT NULL,
 dateTime   TIMESTAMP NOT NULL,
 localTime   TIMESTAMP NOT NULL,

 FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
);


Shalukhau Dzmitry [11 hours ago] 
@CRCx86 Назвать причину или подсказать, чтобы сам нашел?

CRCx86 [11 hours ago] 
подсказать, конечно лучше


Shalukhau Dzmitry [11 hours ago] 
@CRCx86 дай имя полю не localTime а например localTime1. Подумай, почему так работает. Второй вариант возьми localTime в кавычки (тоже должно сработать). (edited)


CRCx86 [11 hours ago] 
да, были подозрения, что localTime ключевое слово


Shalukhau Dzmitry [11 hours ago] 
Это функция :slightly_smiling_face:


Shalukhau Dzmitry [10:02 AM] 
@CRCx86 скинь sql


CRCx86 [10:38 AM] 
подскажите пожалуйста, вот у нас SpringMain переехал в test, тогда с т.з. работы приложения где у нас точка входа? вот начинает работать приложение, прежде чем вывести новую страничку в бразуере, что у нас начинает работать?


Katherine Buzatu [10:46 AM] 
В браузере - сервлет.

CRCx86 [11 hours ago] 
Но почему тогда если ставить точку останова и нажать дебаг попадаем в test/SpringMain?


CRCx86 [11 hours ago] 
просто у меня вылетает ошибка: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {} и я думаю, что это из-за того, что test не видит каких-то данных из основного приложения


Katherine Buzatu [10 hours ago] 
>  No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate.
Он сообщает, что где-то ему нужен бин типа DataSource, а он такого не знает. Где у тебя DataSource прописан конфигурации?


CRCx86 [10 hours ago] 
spring-db.xml


CRCx86 [10 hours ago] 
я пытаюсь заставить работать ветку мастер


Katherine Buzatu [10:55 AM] 
uploaded and commented on this image: @CRCx86
3 Comments
Смотри, что у тебя тут.



CRCx86 [11:24 AM] 
у меня пока что 3 урок

CRCx86 [11:26 AM] 
коллеги, почему при попытке отладки всего приложения выполнение сначала попадает в test/.../SpringMain?


[11:27] 
а, всё, это мой косяк

CRCx86 [11:28 AM] 
commented on Katherine Buzatu’s file @CRCx86
спасибо, разобрался)



CRCx86 [11:47 AM] 
подскажите пожалуйста, почему Number newKey = insertMeal.executeAndReturnKey(map); для  public Meal save(Meal meal, int userId) возвращает ошибку:

org.springframework.dao.DataIntegrityViolationException: PreparedStatementCallback; SQL []; ОШИБКА: INSERT или UPDATE в таблице "meals" нарушает ограничение внешнего ключа "meals_user_id_fkey"
 Подробности: Ключ (user_id)=(100001) отсутствует в таблице "users".; nested exception is org.postgresql.util.PSQLException: ОШИБКА: INSERT или UPDATE в таблице "meals" нарушает ограничение внешнего ключа "meals_user_id_fkey"
 Подробности: Ключ (user_id)=(100001) отсутствует в таблице "users".


[11:49] 
ага, пустая база, ок


CRCx86 [12:22 PM] 
подскажите пожалуйста, почему это не работает:
namedParameterJdbcTemplate.update("UPDATE meals SET description=:description, calories=:calories, " +
                   "datetime=:datetime WHERE user_id =: user_id AND id =: id", map);


[12:22] 
валится с ошибкой: org.springframework.jdbc.BadSqlGrammarException: PreparedStatementCallback; bad SQL grammar [UPDATE meals SET description=?, calories=?, datetime=? WHERE user_id =: user_id AND id =: id]; nested exception is org.postgresql.util.PSQLException: ОШИБКА: ошибка синтаксиса (примерное положение: ":")
 Позиция: 74


vch [12:23 PM] 
пробелы убери после `:`


Few [12:24 PM] 
можешь ставить перед, но не после


CRCx86 [12:29 PM] 
@vch @Few спасибо!


CRCx86 [9:07 AM] 
доброе утро! подскажите пожалуйста такую вещь, исправляю работу UserServiceImpl и добавляю работу MealServiceImpl, а так же пытаюсь заставить работать SpringTest и InMemory**Test, все тесты валятся с ошибкой Error creating bean with name, а MealServiceTest и UserServiceTest еще и в **Impl предлагают выбрать квалификаторы. Подскажите куда идти? Самостоятельно уже не разобраться, а урок пока смотреть не хочу.

Katherine Buzatu [8 minutes ago] 
> Error creating bean with name
Насколько я помню, дальше описана причина. Так? (edited)

Katherine Buzatu [10 hours ago] 
> Error creating bean with name
Насколько я помню, дальше описана причина. Так? (edited)


CRCx86 [9 hours ago] 
Error creating bean with name 'jdbcMealRepositoryImpl' defined in file


CRCx86 [9 hours ago] 
для UserServiceTest и MealServiceTest для конструктора предлагает, как одно из решений, выбрать квалификтор, о которых в видео было сказано вскользь


CRCx86 [9 hours ago] 
пока не знаю, как решать


Katherine Buzatu [9 hours ago] 
Не это ли про квалификаторы?
```Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate.```


CRCx86 [8 hours ago] 
а что это значит? типа он пытается выбрать более чем из 1 одного кандидата на связывание?


Katherine Buzatu [8 hours ago] 
типа ему нужен хотя бы один, но он ни одного не находит.


CRCx86 [9:08 AM] 
если это уже было рассказано в видео, то ткните пальцем, будьте любезны
спассибо


grigory.kislin [10:14 AM] 
@CRCx86 видео 9. Тестирование UserService через AssertJ.


CRCx86 [10:51 AM] 
@grigory.kislin спасибо!


Lezenford [5:03 PM] 
Кто то ловил ошибку org.springframework.jdbc.BadSqlGrammarException: PreparedStatementCallback; bad SQL grammar []; nested exception is org.postgresql.util.PSQLException: ERROR: syntax error at or near ")"
 Position: 19
при тестировании метода create? В дебаге не вижу запроса, на который ругается... падает в коде
Number newKey = insertMeal.executeAndReturnKey(map);
аналогичном из userService...


[5:03] 
не могу разобраться что именно ему не нравится...


[5:04] 
при этом оба sql скрипта корректны, работают, прогонял их тестово


[5:04] 
Ошибка падает еще на этапе подключения к базе:
17:58:34.825 DEBUG o.springframework.jdbc.datasource.DataSourceUtils.doReleaseConnection:329 - Returning JDBC Connection to DataSource
17:58:34.826 DEBUG o.s.jdbc.support.SQLErrorCodesFactory.getErrorCodes:176 - SQL error codes for 'PostgreSQL' found
17:58:34.826 DEBUG o.s.jdbc.support.SQLErrorCodesFactory.registerDatabase:244 - Caching SQL error codes for DataSource [org.springframework.jdbc.datasource.DriverManagerDataSource@1dc5318]: database product name is 'PostgreSQL'
17:58:34.827 DEBUG o.s.j.support.SQLErrorCodeSQLExceptionTranslator.logTranslation:397 - Translating SQLException with SQL state '42601', error code '0', message [ERROR: syntax error at or near ")"
 Position: 19]; SQL was [] for task [PreparedStatementCallback]


grigory.kislin [8:48 PM] 
@Lezenford я подозреваю проблема у тебя в Sql, как написано в exception


Lezenford [8:49 PM] 
Другие тесты, например на get all проходят корректо


[8:50] 
Падает именно создание объекта и при этом ошибочного запроса я в дебаге не вижу...

[8:50] 
В частности ругается на метод, который идет после проверки на isNew


grigory.kislin [8:50 PM] 
скажи, как нам тебе помочь, если ты его не показываешь???

Lezenford [8:51 PM] 
Что именно нужно показать?) укажи вещи какие ты хочешь видеть. Либо могу показать в репозитории


grigory.kislin [8:53 PM] 
почитай еще раз внимательно ексепшен. и подумай с чем он связан. это и показывай


Lezenford [8:54 PM] 
Я вижу ошибку грамматическую в эксепшенн. Вопрос в том, что дебаг не выводит мне запрос, который он считает ошибочным.


[8:54] 
Все падает до того как проходит транзакция в базу

[8:54] 
Это меня в тупик и ставит


[8:55] 
Домой приду еще буду ковырять...


grigory.kislin [8:55 PM] 
> падает в коде Number newKey = insertMeal.executeAndReturnKey(map);
не тут?


Lezenford [8:56 PM] 
Тут


grigory.kislin [8:57 PM] 
ну.. :slightly_smiling_face:?


Lezenford [8:58 PM] 
Рпзмотать цепочку не получилось))) приду еще буду ковырять. Грешил на присвоение идентификатора. Но в базе он корректен


grigory.kislin [9:12 PM] 
@Lezenford судя по эксепшену и месту у меня подозрение на твой sql в инсерте (edited)


Lezenford [9:15 PM] 
До него не доходит, инечн бы он в качестве дебега в лог упал.. Или я не прав?


Ma3stro [2:10 PM] 
uploaded and commented on this image: image.png
1 Comment
Как сие исправить? У меня из-за этого ломается всё, лишнего ничего не трогал



Ma3stro [2:12 PM] 
После накатки патча 3_08 add Spring test (edited)


grigory.kislin [5:04 PM] 
@Ma3stro ответил в личку- попробуй проект скомпилировать чз maven
