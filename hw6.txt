grigory.kislin [6:26 AM] 
joined #hw6 along with Few.


grigory.kislin [6:37 AM] 
6е занятие: начинаем изучать Spring-MVC и слой Web:
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson06.md
Занятие и домашнее задание относительно большие, поэтому следующее занятие будет через 2 недели, 21.12
Отстающие могут догнать группу, остальные- заняться  выпускным проектом.

Планирую 14.12 в 20.00 (Москва, Минск, 19.00 Киев) провести вебинар на тему ~ "Взросление  в программировании".
Буду делать доп. рассылку (+ напишу в slack). Готовьте вопросы по любой теме
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 
(edited)


itAvgur [6:40 AM] 
joined #hw6 along with 17 others.


chumak [5:26 PM] 
Добрый вечер. А запись вебинара будет (Киев. Из-за разницы во времени+ пробки не уверен что смогу быть онлайн)? Спасибо (edited)


new messages
grigory.kislin [6:04 PM] 
@chumak да, скорее всего будет hangout и видео на youtube


Marina [9:04 PM] 
После накатки патча 6-8 add test validation, idea подчеркивает передачу emptySet в качестве     ролей юзеру и из-за этого выдает ошибку, так и должно быть и это после починится или у меня что-то не так пошло? Накатила следующий патч, но эта ошибка так и осталась.


[9:05] 
вроде написано что только тесты валидации для jdbc не должны работать, а у меня все не работает


Marina [9:17 PM] 
Поняла почему не принимает, у меня у юзера в конструкторе еще должна быть дата рагистрации перед ролями, а в тесте юзер без нее создается,  это я какой-то патч не поставила, где у юзера такой конструктор добавили?


RNG [9:19 PM] 
@Marina Самый первый вроде как, 6_0_фикс. (edited)


Marina [9:23 PM] 
@RNG странно его первым ставила


[9:25] 
смотрю в первом патче, там у юзера не добавляется такой конструктор без даты регистрации


RNG [9:42 PM] 
@Marina только что проверил и у меня тоже валятся тесты с подобной ошибкой


Andrew [11:02 PM] 
Нет нужного конструктора, может один из дальнейших патчей добавит


RNG [11:12 PM] 
Ну можно еще добавить дату в тесты перед проблемным местом (к примеру `new Date()`). (edited)




----- Today December 8th, 2017 -----
Ivanushka [3:22 AM] 
У меня такая же проблема, но вчера заметил, что есть ещё несколько отличий от эталонного кода после накатки патчей, вчера пришлось выкачать всё по новой.


Sergey [10:12 AM] 
Да, подтверждаю. После 8 патча всё валится, следующими патчами не чинится


Сергей Матвеев [10:48 AM] 
залил 11 патч томкат не поднимает  org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Invocation of init method failed; nested exception is org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment


Sergey [11:05 AM] 
RNG+ добавление даты решает проблему, конструктор не нужен.


[11:06] 
У меня после всех патчей не работают тесты jdbcUserServiceTest и InMemoryAdminRestControllerSpringTest Тесты InMemoryAdminRestControllerTest - ignored (Это что значит ?)

Few 
[11:06 AM] 
Домашнее задание HW06

1.1 Починить тесты InMemoryAdminRestControllerSpringTest/InMemoryAdminRestControllerTest (в новой версии Spring классы spring-mvc требуют WebApplicationContext, поэтому поправьте mock.xml)


Sergey [11:16 AM] 
Да, верно это нужно сделать в ДЗ. Второй раз уже дают нерабочий проект и сиди разбирайся, то ли патч не так поставился, то ли задумано так.


Sergey [11:30 AM] 
Ещё патчи расходятся с коммитами, Например тот же AbstractUserServiceTest.java в коммите на 8 патч testValidation с newDate() https://github.com/JavaWebinar/topjava/blob/778176c2001160eac6efdae76fa252c65e40cec4/src/test/java/ru/javawebinar/topjava/service/AbstractUserServiceTest.java А в патче без.
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


Ivanushka [2:03 PM] 
На самом деле, это всё не страшно - мы же учимся. Тут важно понять @grigory.kislin специально нас в "миску носом тыкает" или мы где-то сворачиваем не туда по своей невнимательности.


Sergey [3:32 PM] 
После патча 6_14 у меня дочерняя страница валится (meals) валится страница с ошибкой 404. Никакого лога ни в браузере ни в TomCat Log тоже не выдаёт. А после патча 6_15 вообще tomCat валится с ошибкой 500. Логи показывают, что это из за замены fmt на spring в index.jsp Так и должно быть или только у меня упало ?


Chaika [3:32 PM] 
Блин, опять какая-то фигня:) Я накатил патчи до 6.02 , запускаю тесты и сразу java.lang.IllegalStateException: Failed to load ApplicationContext


[3:32] 
Я думал что в дз косячу, решил на ветке master проверить

Few [3:41 PM] 
А почему все думают, что после патчей должно все работать? Как раз в рамках дз часто нужно что-нибудь починить :slightly_smiling_face:


Sergey [3:43 PM] 
ну до 5 занятия после патчей всё работало)


Chaika [4:43 PM] 
это все java 9


[4:43] 
<dependencies>
       <dependency>
           <groupId>com.sun.xml.bind</groupId>
           <artifactId>jaxb-impl</artifactId>
           <version>2.2.11</version>
       </dependency>

       <dependency>
           <groupId>com.sun.xml.bind</groupId>
           <artifactId>jaxb-core</artifactId>
           <version>2.2.11</version>
       </dependency>
       <dependency>
           <groupId>javax.xml.bind</groupId>
           <artifactId>jaxb-api</artifactId>
           <version>2.3.0</version>
       </dependency>
       <dependency>
           <groupId>javax.activation</groupId>
           <artifactId>activation</artifactId>
           <version>1.1.1</version>
       </dependency>


[4:43] 
если будут проблемы)

Sergey [5:00 PM] 
У меня Java 8 используется в проекте


grigory.kislin [5:47 PM] 
коллеги, привет!
1. по поводу нерабочего проекта- в ДЗ написано что чинить и после патчей также стараюсь писать. Учимся мы здесь все таки программировать, а не патчи накатывать и нажимать на зеленую кнопку, поэтому на meals 404 полезно подумать, что произошло. я бы сказал даже что если это не делается, то стажировка прошла даром и нужен повтор
2. в 6_08_add_test_validation действительно ошибка- нужно в вызов конструктора до коллекций добавить new Date(). Патчи я уже вчекинил- то можно сравнить с github
3. наконец воспринимайте все как возможность поучиться. в реальном проекте таких ситуаций будет гораздо больше
4. извиняюсь за опоздание с письмом- сейчас вышлю


MetalBro [3:15 PM] 
Не работают тесты сразу после патчей домашнего HW5, так должно быть? Как вообще тогда проверить правильность?


MetalBro [3:26 PM] 
SEVERE: Unable to create initial connections of pool.
java.sql.SQLException: Driver:org.postgresql.Driver@12365c88 returned null for URL:jdbc:hsqldb:file:D:/temp/topjava


[3:27] 
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Invocation of init method failed; nested exception is org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment]
Caused by: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment]
Caused by: org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be null when 'hibernate.dialect' not set


MetalBro [3:36 PM] 
честно говоря, раздражают очень сильно такие ситуации, когда после решения ДЗ хочешь посмотреть как сделано master


MetalBro [3:54 PM] 
Проблема разрешилась внесением небольшого изменения


[3:54] 
Значит с 6.08 основные проблемы?


Sergey [4:22 PM] 
Да,ещё будут с 6,14 и 6,15

MetalBro [7 hours ago] 
ну те хоть плановые, для ДЗ по новой теме. Считай не проблемы) (edited)


Dmitry Neustupov [6:17 PM] 
@MetalBro У меня тесты работали на всех патчах до 6.08


meldenev.aleksandr [7:38 PM] 
Не подскажете куда копать?  Тест JdbcUserServiceTest,  тест getAll если запускать отдельно, то все ок,  если в составе модуля,  то находит только одну запись в базе (с админом) и, соответственно не проходит. Другие тесты(dataJpa и jpa) при этом работают нормально. (edited)


Few
[8:04 PM] 
ощущение что у тебя между тестами база не восстанавливается


[8:06] 
это ты уже HW6 делаешь?


Few
[8:11 PM] 
еще кэш не валидный может так влиять по идее


meldenev.aleksandr [9:13 PM] 
Больше  похоже на кеш - скрипты запускаются,  по крайней мере в логе пишутся. По поводу кеша,  я думал что мы работаем с кешем хибернейта и на jdbc он не распространяется. Видимо там копать надо.

Few [25 minutes ago] 
Теперь могу с уверенностью сказать, что копать нужно в сторону кэша :slightly_smiling_face:


anpotashev [1:17 AM] 
Кто-нибудь победил фф с его AM PM в поле типа "time"?


Dmitry Makarov [1:18 AM] 
а что не так?


anpotashev [1:19 AM] 
На сервлет/контроллер приходят значения с этими же АМ и РМ


Dmitry Makarov [1:20 AM] 
у меня все ок


anpotashev [1:21 AM] 
А ввод у тебя в 24-часовом формате?


Dmitry Makarov [1:21 AM] 
да


anpotashev [1:21 AM] 
А файрфокс какой версии?


Dmitry Makarov [1:21 AM] 
Quantum 57.0 (64-бит) (edited)


anpotashev [1:23 AM] 
один в один как у меня


Dmitry Makarov [1:23 AM] 
в хроме все ок?

anpotashev [1:23 AM] 
Да


[1:24] 
В tor-е еще так же как в фф


Dmitry Makarov [1:24 AM] 
в торе же Firefox-ESR?


anpotashev [1:24 AM] 
А фф у тебя русская версия?


Dmitry Makarov [1:24 AM] 
русская


anpotashev [1:24 AM] 
А у меня инглиш


[1:25] 
Видимо поэтому и идет западный стандарт


[1:30] 
С тором соврал, похоже

Dmitry Makarov [1:31 AM] 
тор, насколько я помню, не понимает ни время ни дату HTML5


anpotashev [1:33 AM] 
Да, помнил, что что-то у него не так, вот и попутал


[1:34] 
У кого ФФ английский, посмотрите, плиз, как у вас полями типа time, плиз. Заранее спасибо. (edited)


Dinara [1:48 PM] 
Привет всем! ПОдскажите, плиз, совсем не догоняю про дз  - разнести запросы на update/delete/.. по разным методам (попробуйте вообще без action=).


[1:49] 
то есть должно быть несколько методов get и post (отдельный метод для каждой операции), а не так, как у нас сейчас в сервлете?



Katherine Buzatu [2:11 PM] 
uploaded this image: Коллеги, у кого-то было так с локализацией?
Add Comment



Dinara [2:19 PM] 
у меня чую будет примерно так же.. там есть подсказка на эту тему. вы ее применяли уже?


Valery [2:22 PM] 
> то есть должно быть несколько методов get и post
методы можно называть как угодно, не обязательно get и post. Например, те же update, delete, save.
я только лекции еще смотрю, но думаю, это оно.



Dinara [2:23 PM] 
это понятно, что как угодно. не понимаю, как их без анализа этого action различить


Valery [2:27 PM] 
@RequestMapping


Dinara [2:50 PM] 
да, но там же тогда будет action=что-то , чего нам надо избежать

Valery [8 hours ago] 
сейчас у нас запрос уходит в таком виде - href="meals?action=update&id=${meal.id}"
где actions - параметр.
и потом в контроллере мы эти параметры парсим - switch (action == null ? "all" : action). это все в одном методе происходит.


Valery [7 hours ago] 
через mapping получится такое: 
href="meals/update/{meal.id}" (edited)


Dinara [2:50 PM] 
в requestMapping


Katherine Buzatu [2:50 PM] 
uploaded this image: @Dinara это?
Add Comment



Dinara [2:51 PM] 
я про эту подсказку Неверная кодировка UTF-8 с Spring обычно решается фильтром CharacterEncodingFilter:
   <filter>
       <filter-name>encodingFilter</filter-name>
       <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
       <init-param>
           <param-name>encoding</param-name>
           <param-value>UTF-8</param-value>
       </init-param>
       <init-param>
           <param-name>forceEncoding</param-name>
           <param-value>true</param-value>
       </init-param>
   </filter>
   <filter-mapping>
       <filter-name>encodingFilter</filter-name>
       <url-pattern>/*</url-pattern>
   </filter-mapping>


MetalBro [2:58 PM] 
смущает 1.2 Починить Jdbc тесты (валидацию исключить)


[2:59] 
не работает ведь только testValidation, кого чинить? Его?


Valery [3:00 PM] 
тут половина проекта стостоит в починке тестов...


MetalBro [3:01 PM] 
нет, ну что значит валидацию исключить. Работают 9 тестов, один не работает testValidation


Valery [3:01 PM] 
чем же QA тогда должны заниматься гогда разработчики сами тестируют?

MetalBro [3:01 PM] 
я не про это


[3:01] 
ну да, нам тут профиль общий дают)


[3:02] 
условие неясно


MetalBro [3:08 PM] 
аннотацию повесить только что ли


Dmitry Makarov [4:07 PM] 
@MetalBro , насколько я понял, при запуске всех тестов скипнуться должны только 2 метода. Как это сделать в задании приводятся ссылки.



grigory.kislin [5:11 PM] 
@MetalBro после HW5( 6_07_HW5_graph_batch_size) все тесты проходят
`Tests run: 62, Failures: 0`
а после 6_08_add_test_validation в уроке написано ширным шрифтом
`Тесты валидации для Jdbc не работают, нужно будет починить в HW6`
>  раздражают очень сильно такие ситуации
мне кажется тут все дело в твоем отношении к проекту и программированию... если не поменяешь, на работе будет тяжело. посмотри видео якова фейна как стать профессиональным программистом. в программисты требуются люди, которые могут решать проблемы. те не должно быть отношения на работе, что тебе должны решить возникающие у тебя проблемы (а их будет немало) (edited)


MetalBro [5:19 PM] 
уже сделал это все


[5:19] 
просто когда я делал дз по предыдущему заданию, все получилось, делаю патч и снова менять надо. Как оказалось совсем мелочь


[5:21] 
проблема была в том, что контексте по-прежнему не были убраны холдеры     <!--<context:property-placeholder location="classpath:db/hsqldb.properties" system-properties-mode="OVERRIDE"/>-->


[5:22] 
дело не в том, что решать проблемы, а в том, когда заявлено что работает, а оно не работает. Тут я изменюсь вряд ли, конфликты такие были всегда


[5:23] 
исправлять зону ответственности другого никогда не любил)


grigory.kislin [5:27 PM] 
@Valery @MetalBro
> чем же QA тогда должны заниматься гогда разработчики сами тестируют?
> нам тут профиль общий дают)
1. у QA на порядок больше тестов. часто на уровне браузера (типа selenium). 
2. иногда (на маленьких проектах)бывает что QA вообще нет
3. тесты обязательны даже в тестовых заданиях на работу, не говоря уж о проекте


grigory.kislin [5:29 PM] 
@Katherine Buzatu в твоей картинке default encoding for property files ISO-8859-1
поставь UTF-8. и проверь кодировку файлов локализации

Katherine Buzatu [5 hours ago] 
Не помогло. Насильно заменила русские символы на escape-последовательности. Только тогда с галкой в настройках и в Идее читается, и в браузере порядок.


kadmser [7:58 PM] 
После патча 6,09 все jdbc тесты падать должны? У меня JdbcMealServiceTest проходит кроме testValidator


Dinara [7:59 PM] 
Добавлю как действующий QA) QA в очень редких случаях пишут unit тесты, про которые у нас тут речь, это святая обязанность девелопера. И да, чинить тесты приходится очень часто, а так же писать их на новую функциональность тоже. У нас вообще в мастер впушить нельзя код, если с  ним test coverage падает. А те, кто филонят, получают нагоняй)
Grigory Kislin
@Valery @MetalBro
> чем же QA тогда должны заниматься гогда разработчики сами тестируют?
> нам тут профиль общий дают)
1. у QA на порядок больше тестов. часто на уровне браузера (типа selenium). 
2. иногда (на маленьких проектах)бывает что QA вообще нет Show more…
Posted in #hw6Today at 5:27 PM@Katherine Buzatu в твоей картинке default encoding for property files ISO-8859-1
поставь UTF-8. и проверь кодировку файлов локализации


1 reply


grigory.kislin [12:40 AM] 
@Katherine Buzatu  ок. еще: escape-последовательности нужны только для jsp. спринг умеет с UTF-8 работать


Few [8:13 AM] 
Добрый день. Не могу до конца осознать как работает формирование пути при использовании href, form action, возвратов из методов контроллера. Как это все друг с другом связано? Иной раз вроде думаешь что вот оно, понял наконец, но в следующий момент находишь место в коде которое работает, хотя вроде не должно :grinning:


[8:13] 
Методом подбора это все конечно решается, но это не вариант. Буду благодарен за хорошую ссылку по этой теме


CRCx86 [8:19 AM] 
здравствуйте! вопрос по патчу 6_04. "зайдите в исходники @Profile и посмотрите (подебажте) его реализацию через @Conditional(ProfileCondition.class)" что значит подебажить через аннотацию?


grigory.kislin [11:45 AM] 
@Few если начинать пусть с "/" - то он считается от домена, если без- то он относительный
ссылка из урока https://stackoverflow.com/questions/4764405/how-to-use-relative-paths-without-including-the-context-root-name
но если есть лучше- тоже буду благодарен
stackoverflow.com
How to use relative paths without including the context root name?
To working my static file (CSS, JS) I have to write absolute path like /AppName/templates/style/main.css. Is there any solution, that I could write relative path like style/main.css?
 


[11:46] 
@CRCx86 подебажить можно ProfileCondition


Few 
[11:50 AM] 
@grigory.kislin если в href и action написать /meals/save, то попадем на http://localhost:8080/meals/save тут от домена, а если из контроллера вернуть "redirect:/meals", то http://localhost:8080/topjava/meals, здесь относительно приложения получается


grigory.kislin [11:52 AM] 
на Spring редирект есть 2я ссылка.  
`A logical view name such as redirect:/myapp/some/resource will redirect relative to the current Servlet context`


Few [11:57 AM] 
немного сбивает с толку /myapp в этом примере, напрашивается мысль что в нашем случае /topjava. Так то вроде и понятно, но сбивают эти маленькие различия. У себя в итоге в формах использовал servletRelativeAction


Katherine Buzatu [11:57 AM] 
А как бы не упоминать meals в href... (`href="delete..."`)

Few [22 hours ago] 
это вопрос? :slightly_smiling_face:


Few 
[22 hours ago] 
ради эксперимента указал <base href="/topjava/meals/"/> в голове страницы и теперь работает href="update?id=${meal.id}"



anpotashev [19 hours ago] 
@Few вот проект в урл указывать не стоит. 
1) Ты можешь задеплоить проект на сервер в корень и у тебя будет адресация типа http://localhost:8080/meals/
2) Или может быть настроен "маппинг" адресов, где адрес http://topjava.server.com/ будет переадресовываться на http://localhost:8080/topjava/. 
В обоих случаях /topjava/ будет лишней в адресации.


Few [19 hours ago] 
Да это я экспериментирую


Few 
[19 hours ago] 
для эксперимента и захардкодить пойдет, а в рабочем варианте можно вычислять из запроса базу наверное


Few [12:08 PM] 
@grigory.kislin спасибо, еще раз перечитаю по этим ссылкам


vsimonov [3:43 PM] 
uploaded and commented on this image: wtf.jpg
1 Comment
У всех такое или это у меня касяк с патчами?



Few [3:57 PM] 
сравни с доступными конструкторами


[3:57] 
надо параметр Date добавить (new Date())



vsimonov [4:29 PM] 
@Few я про то что должна быть такая ошибка или это мой косяк. Вместо Date стоит emptyset, такого контрукотра нет. (edited)


Few [4:34 PM] 
Да, эта ошибка у всех (edited)



Dmitry Makarov [8:51 PM] 
это только у меня mealForm.jsp не видит css?


Katherine Buzatu [8:54 PM] 
не только



Dmitry Makarov [9:11 PM] 
проблема нашлась в headTag.jsp :grinning:



Andrew [10:23 PM] 
В AbstractUserSrivceTest у меня не цепляется JPAUtil, плохо патч встал или так норм?


Andrew [10:33 PM] 
В профиле JDBC нет такого бина, а когда вставляю, бин нот фаунд ексепшн :disappointed:


kadmser [10:34 PM] 
У всех через плагин добавленный патчем 6.13 мавен деплоится без проблем?

Andrew [10:37 PM] 
Andrew [9:23 PM] 
В AbstractUserSrivceTest у меня не цепляется JPAUtil, плохо патч встал или так норм?

Беда в том, что в JPAUtil нужен Entuity Manager.. Надо прикрутить его и к JDCB профилю? Или игнорировать ?


[10:42] 
В общем, добавил интити менеджер для JDBC, глупо, но работает


anpotashev [10:55 PM] 
@Andrew здря

[10:56] 
не нужен там ни em ни jpaUtil


[10:57] 
Ищи как его убрать только из jdbc

Andrew [11:06 PM] 
Можно переопределить метод, где он рабоатет с кешем


anpotashev [11:14 PM] 
Не пойму о чем ты.


Andrew [11:15 PM] 
Не могу понять, почему падает на jsp, когда в контроллере отдаю милс атрибутом? Никакой инфы из эксепшна не вытянуть..


Argentum_kuh [11:15 PM] 
@kadmser Вот такое говорит и падает:  Failed to execute goal org.codehaus.cargo:cargo-maven2-plugin:1.6.5:deployer-start (default-cli) on project topjava


Andrew [11:15 PM] 
На метод getAll... Проверил, отдаётся нормально


Argentum_kuh [11:16 PM] 
@kadmser Еще это: 
You did not specify a container home nor any installer.


[11:16] 
Копаю сейчас


Andrew [11:21 PM] 
java.lang.ClassCastException: ru.javawebinar.topjava.model.Meal cannot be cast to ru.javawebinar.topjava.to.MealWithExceed - вот , что перестало работать..


[11:22] 
Понял, я глупышка



----- Today December 12th, 2017 -----
Marina [9:31 AM] 
Подскажи, пожалуйста, нужно как то типа как по этой ссылке делать https://stackoverflow.com/questions/22349120/spring-profiles-on-method-level/43645463#43645463 ? Или я зря так пытаюсь? Просто из рабочих вариантов переопределить у jdbc и jpaUtil и testValidation, но я так понимаю какое-то более красивое решение есть?
Aleksandr N Potashev
Ищи как его убрать только из jdbc
Thread in #hw6Yesterday at 10:57 PM
 stackoverflow.com
Spring Profiles on method level?
I'd like to introduce some methods that are only executed during development. I thought I might use Spring @Profile annotation here? But how can I apply this annotation on class level, so that this

Katherine Buzatu [8 hours ago] 
Посмотри ссылки под этим пунктом ДЗ


Marina [8 hours ago] 
Спасибо большое, как то я их не заметила. Как тесты пропустить теперь понятно, но что делать с jpaUtil для jdbc?


RNG [7 hours ago] 
Попробуй вынести в промежуточный класс, о котором JDBC классы не будут знать, в отличии от DataJpa and Jpa. (edited)


Marina [6 hours ago] 
Что-то никак не могу понять как это сделать? Можно конечно сделать промежуточный класс с jpaUtil и все тесты кроме jdbc унаследовать от него, но так наверное не правильно. А если делать класс, который Autowired  в  AbstractTest, то как сделать чтобы о нем не знал jdbc и для него он не загружался?


anpotashev [6 hours ago] 
У aurowired есть дефолнтые параметры, которые можно переопределить


Marina [6 hours ago] 
Пробовала в реализации jdbc ставить @Autowired(required = false) на JpaUtil jpaUtil но была такая же ошибка загрузки jpaUtil


anpotashev [6 hours ago] 
Не в реализации, а в абстрактном классе

Marina [6 hours ago] 
точно, спасибо, уже сама так сделала и все пошло


RNG [10:59 AM] 
Кстати, по поводу игнора теста валидации в JDBC с помощью org.junit.Assume. Это нормально что он падает с сообщением `org.junit.AssumptionViolatedException: got: <false>, expected: is <true>` и в идее отображается с перечеркнутым желтым кружком?


anpotashev [11:59 AM] 
@RNG, имхо, нормально. В статье есть про это упоминание: "Стоит отметить, что несмотря на то, что по умолчанию класс, запускающий тесты (test runner), помечает тесты, бросающие исключение org.junit.AssumptionViolatedException (которое происходит при нарушении предположения), как пропущенные, такое поведения может быть переопределено (с помощью пользовательского класса для запуска тестов)."


Marina [12:09 PM] 
@RNG И  мавен при этом  считает тесты пройдеными без ошибок "Process finished with exit code 0", так что думаю так и должно быть


vsimonov [1:17 PM] 
uploaded and commented on this image: tomcat.jpg
  1 Comment
Ребят это что, специально задуманно?



CRCx86 [2:08 PM] 
добрый день, папка messages должны быть пустая после всех пачтей?


anpotashev [2:08 PM] 
нет


vsimonov [2:41 PM] 
Что, никто такую ошиюку не встречал при старте томката?


Vladimir_X [3:03 PM] 
А ты про которую??? Их у нас две :grinning:
Та, которая в resourcec -- да.
AleksandrZinov
добрый день, папка messages должны быть пустая после всех пачтей?
Posted in #hw6Today at 2:08 PM


vsimonov [3:14 PM] 
Если у кого такая ошибка будет, нужно в артифакты добавить все либы из Available (edited)


grigory.kislin [4:34 PM] 
@vsimonov ничего руками в зависимости добавлять нельзя. если добавил- удали .idea и iml и заново проект открой
делал как в уроке написано?
` mvn clean package -DskipTests=true org.codehaus.cargo:cargo-maven2-plugin:1.6.5:run`  ?
у меня все запускается (edited)


[4:35] 
2. по поводу JpaUtil было верно сказано- просто ИСКЛЮЧИТЬ из jdbc (edited)


grigory.kislin [4:41 PM] 
3. на тему Assume - да, в idea так... если запускать чз maven будет 
`Tests run: ..., Failures: 0, Errors: 0, Skipped: 1`


Valery [10:36 PM] 
У нас сейчас на главной странице приложения три ссылки ведут на страницу с едой: "Подсчет калорий" в заглавии, по кнопке "Выбрать" в форме и в списке ссылка "Моя еда".
Насколько я понимаю, еда должна появляться после "логина", то есть, нажатия кнопки в форме. 
Каково назначение ссылок "Подсчет калорий" и "Моя еда"? Куда они должны вести, когда пользователь не авторизован? На страницу логина/регистрации?



----- Today December 13th, 2017 -----
Viktor [1:27 AM] 
по исключению JpaUtils из jdbc, на мой взгляд красивее было бы создать заглушку для jdbc, которая ничего не делает.


MetalBro [4:32 AM] 
При починке тестов ведь сами тесты можно поправить? Вместо Iterable<User> сделал Set, считаю, что так правильнее)


grigory.kislin [6:27 AM] 
@Valery предлагаю сейчас не заморачиваться такими проблемами. После авторизации, если останется что-то непонятное, можно будет задать вопрос


[6:28] 
@Viktor нууу.. мне кажется проще исключить. но попробуй


[6:29] 
@MetalBro откуда же Set, если у нас List ?


MetalBro [7:17 AM] 
@grigory.kislin я переделал методы, чтобы не зависели от порядка полученных объектов, а сравнивались по содержанию. А в репозитории ввел SimpleJdbcInsert insertUserRoles;

Few [1 hour ago] 
Но мы же осознанно из репозитория возвращаем отсортированный список, поэтому и в тестах проверяем в том числе сортировку


Few 
[1 hour ago] 
Или я не правильно понял какие методы ты изменил?


MetalBro [1 hour ago] 
менял в тестах, да, без сортировки было. У меня метод репозитория возвращал без сортировки, думал где-то глюк. Сейчас вот увидел с утра новое)


MetalBro [7:33 AM] 
сейчас смотрю, возможно напишу компаратор для сортировки в маппере))


MetalBro [7:40 AM] 
точно))


MetalBro [7:52 AM] 
все на месте, сетов нет


CRCx86 [8:40 AM] 
@Vladimir_X а где вторая?

Few [45 minutes ago] 
topjava\src\main\resources\messages


Few 
[44 minutes ago] 
topjava\config\messages


CRCx86 [36 minutes ago] 
у меня почему-то вылетает следующее: javax.servlet.jsp.JspTagException: No message found under code 'app.title' for locale 'ru_RU'


vch [35 minutes ago] 
@CRCx86 переменную окружения точно установил?


CRCx86 [34 minutes ago] 
так это ж локализация


vch [33 minutes ago] 
именно такая ошибка у меня вылетала без переменной окружения... У нас ресурсы локализации подтягиваются таким хитрым образом.


CRCx86 [31 minutes ago] 
ужс!



CRCx86 [31 minutes ago] 
спасибо


Atrieron [9:20 AM] 
У кого-нибудь при деплое в томкат была ошибка 
    java.io.FileNotFoundException: C:\Program%20Files\Apache%20Software%20Foundation\Tomcat%209.0\webapps\topjava\WEB-INF\classes\cache\ehcache.xml (Системе не удается найти указанный путь)?
По этому пути проходил, файл лежит на месте.

Глубинные изыскания показывают, что некий объект класса ParallelWebappClassLoader(судя по гуглу, он относится к томкату) получает в метод getResource параметр cacheManagerUri из файла spring-tools.xml и выдает тот самый путь.

Few [3 minutes ago] 
избавься от пробелов и русских символов в пути к проекту и все заработает


Few 
[2 minutes ago] 
в твоем конкретном случае по всей видимости именно пробелы (%20) в пути к томкату (edited)


CRCx86 [9:20 AM] 
скажите пожалуйста, что это такое и что там нужно выбирать? (вылезло для xml файлов)


CRCx86 [9:20 AM] 
uploaded this image: image.png
  Add Comment
  
  
Kaa [12:23 PM] 
у меня выдает ошибку org.postgresql.Driver.connect Connection error:
org.postgresql.util.PSQLException: ВАЖНО: слишком много подключений для роли "user"


[12:24] 
в самом postgres maxconnection = 1000, подскажите в чем пожет быть проблема пожалуйста.


Дима Жуков [3:19 PM] 
Я как то пул пробовал, он почему то connection не закрывал, а переводил их в sleep. Там такая здоровенная куча была sleep connection. Они наверное тоже коннекторы занимают... Их ограниченно в самих настройках бд. Возможно я пул не правильно настроил. Может у кого ещё такая проблема была со sleep?


[3:21] 
Но дз ещё не делал) просто помню такое было (edited)


grigory.kislin [3:41 PM] 
@MetalBro из репозитория возвращаются отсортированные списки. их нельзя хранить в Set (кроме ролей)


[3:43] 
@Atrieron
> при деплое в томкат была ошибка  java.io.FileNotFoundException
была. у нескольких. не надо пути делать с пробелами и русскими буквами


[3:47] 
@CRCx86 https://github.com/JavaOPs/topjava/wiki/IDEA#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D1%8C%D1%82%D0%B5---%D0%BD%D0%B5%D1%82-%D0%BB%D0%B8-%D0%BB%D0%B8%D1%88%D0%BD%D0%B8%D1%85-%D0%B1%D0%B8%D0%BD%D0%BE%D0%B2-%D0%B8%D0%BB%D0%B8-%D0%BD%D0%B0%D0%BE%D0%B1%D0%BE%D1%80%D0%BE%D1%82-%D0%B8%D1%85-%D0%BD%D0%B5-%D1%85%D0%B2%D0%B0%D1%82%D0%B0%D0%B5%D1%82-%D0%B2-project-structure-modules-spring-%D0%B5%D1%81%D0%BB%D0%B8-%D0%BD%D0%B5-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82-%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5--%D1%83%D0%B4%D0%B0%D0%BB%D0%B8%D1%82%D1%8C-%D0%B8-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%B7%D0%B0%D0%BD%D0%BE%D0%B2%D0%BE делал?
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 


[3:48] 
@Kaa 1. как с постгрес работаешь?
2. попробуй с уровнем trace посмотреть логи- закрываются ли у тебя коннекшены (edited)


Kaa [3:56 PM] 
я уже сделал клон проекта с https://github.com/JavaWebinar/topjava - ошибка сохраняется. работает только если в проперти указать для пула maxActive=5, с большим - эта ошибка снова вылазит.
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


CRCx86 [4:20 PM] 
uploaded this image: @grigory.kislin
Add Comment


Kaa [5:55 PM] 
Сам себе проблему создал. Убитый день, чтобы вспомнить, что при настройке user в постгресе поставил conection limit = 5:grinning: точнее если бы не взялся переставлять постгрес - не вспомнил бы.


grigory.kislin [6:54 PM] 
@Kaa а почему у тебя с лимитом 5 идут ошибки? ты больше чем с одного браузера работаешь? (edited)


Kaa [7:06 PM] 
Нет. Собственно проект вообще не запускается, скорее всего по умолчанию пул коннектора больше 5 подключений создать пытается.


[7:06] 
*пул коннектов

Ruslan [7:35 PM] 
Может кто рядом с моей проблемой как логировать транзакции(отслеживать открытие и закрытие)? Что можно почитать(посмотреть)?

Антон Кляшторный [12 hours ago] 
я расскоментировал <logger name="org.springframework.jdbc" level="debug"/> (в тестах в папке resources) в лог выводится об открытии и коммите транзакций


Ruslan [9 hours ago] 
Спасибо.


PugV [8:03 PM] 
объясните, пожалуйста по п 1.3 дз, почему  @GetMapping("meals/delete/{id}") - правильно,  а при @DeleteMapping("meals/delete/{id}") - HTTP Status 405 – Method Not Allowed
Type Status Report
Message Request method 'GET' not supported
Description The method received in the request-line is known by the origin server but not supported by the target resource. (edited)


grigory.kislin [8:57 PM] 
@Ruslan настрой логирование postgres драйвера. Trace уровень вроде- там пишется


grigory.kislin [9:02 PM] 
@PugV суда по ошибке у тебя метод get с неверным url
а зачем тебе delete?


PugV
[9:30 PM] 
@grigory.kislin нашла примеров много, где delete делается с использованием @DeleteMapping, хотела по аналогии сделать. По мне, так  красивее))


grigory.kislin [9:31 PM] 
как рест будет- будет делать (с json)
со html по умолчанию в tomcat закрыто


Anton K. [9:49 PM] 
Подскажите куда смотреть - выкидывает эксепшн - "No tag [] defined in tag library imported with prefix [form]", я в jsp использую префикс form: и соответственно строка "<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>"  присутствует, почему еще может кинуть такой эксепшн


Viktor [11:52 PM] 
@PugV все зависит от того какой запрос отправляешь. Чтобы отработала аннотация удаления, надо отправить не get запрос а delete. Это можно сделать с помощью js как на чистом html не знаю :smiley: Если найдешь ответ поделись. И заранее по поводу update или add через PUT запрос, там тоже все сложно, из <form> можно отправить либо get либо post запрос, другие так же через js


[11:56] 
@Anton K. покажи весь jsp


Kaa [11:58 PM] 
под linux javax.servlet.jsp.JspTagException: No message found under code 'app.title' for locale 'ru_RU' кидает. пи этом идея по контрол все проперти правильно находит, может кто сталкивался? а то уже 1,5 часа ковыряюсь, а толку 0.



----- Today December 14th, 2017 -----
Ruslan [12:11 AM] 
@grigory.kislin @Антон Кляшторный Спасибо.


anpotashev [12:14 AM] 
@Kaa, export TOPJAVA_ROOT=/.... в исполняемом файле setenv.sh в каталоге bin tomcat-а


[12:15] 
Или это при запуске томката из идеи?

[12:17] 
Еще вариант - с кодировкой в app_ru.properties может быть не в порядке.


Kaa [12:37 AM] 
anpotashev не вижу такого файла в томкате. TOPJAVA_ROOT в /etc/evironment указывал.


[12:40] 
app_ru.properties открывал в Kate, тот показывает, что кодировка UTF-8


anpotashev [12:40 AM] 
Его создать надо


[12:41] 
Но, если из идеи запускаешь томкат, то дело не в этом.


Kaa [12:41 AM] 
из идеи. отдельно не стартую.


anpotashev [12:44 AM] 
Можешь еще попробовать пересоздать файл


[12:44] 
Вдруг с переносами строк какой-то косяк. Редко, но бывает.


Kaa [12:45 AM] 
попробую сейчас.


Kaa [12:51 AM] 
не, фокус не удался. даже назвал файл на всякий пожарный app_ru_RU.properties - не помогло.


anpotashev [12:53 AM] 
А без него как? Если попробовать один басурманский оставить, то нормально запускается?


Kaa [12:54 AM] 
и без него тоже самое.


anpotashev [12:57 AM] 
Можно еще попробовать в файле spring-mvc.xml указать полный путь без переменной topjava_root.


Kaa [12:57 AM] 
а там file:/// оставаться должно или убрать?


anpotashev [12:58 AM] 
Вроде должно. Сейчас у себя попробую


[1:02] 
оставил - работает

[1:02] 
<property name="basenames" value="file:///tmp/config/messages/app"/> - так у меня


Kaa [1:05 AM] 
ага. спасибо. так - заработало.

anpotashev [1:06 AM] 
Значит ищи почему томкат, не видит переменную окружения.

[1:08] 
Попробуй вариант с setenv.sh. И, кстати, ты после того как в /etc/evironment переменную прописал, перезаходил в систему?


[1:08] 
велкам


Kaa [1:11 AM] 
о. спсибо за идею. сейчас попробую. у меня переменная окружения была через ~/ указана, может в этом вся загвоздка.


Kaa [1:20 AM] 
да. еще раз спасибо. в этом проблема и была. переменную поставил не /home/user, а ~/ потом спохватился и поменял, но в систему не перезаходил. теперь все работает.


Rostish [8:31 AM] 
ни у кого не было проблемы с обновлением зависимостей в пом файле после патчей?


[8:31] 
у меня некоторые зависимости не подтягиваются, хотя на сайте мавена они находятся


CRCx86 [9:23 AM] 
@grigory.kislin получается у меня не правильно сделана настройка? как тогда правильно?


Rostish [10:08 AM] 
Cannot access central (https://repo.maven.apache.org/maven2) кто нибудь сталкивался с этой проблемой?


[10:08] 
у меня где с 7 патча пару связей в помнике не отрабатывает


[10:08] 
и билд пэкэдж не проходит

[10:12] 
нашел где отключить офлейн мод, в помнике подтянул зависимости, но в вкладке мавен, которая справа, эти зависимости всеравно подчеркнуты красной линией


CRCx86 [11:08 AM] 
@Rostish я решил переподключением горящих красным плагинов


Rostish [11:12 AM] 
удалял из помника и вставлял назад?)


[11:14] 
смех смехом а помогло


[11:14] 
осталась одна проблема


[11:14] 
No message found under code for locale


[11:14] 
Spring-mvc.xml уже как только не пытался переписать в части messageSource


[11:14] 
не работает и вс

[11:15] 
Сейчас бандл лежит в config/messages


[11:15] 
и как заставить его видеть не могу понять

[11:15] 
я на маке работаю, такую конструкцию видимо не понимает file:///#{systemEnvironment[‘TOPJAVA_ROOT’]}/config/messages/app


Rostish [12:04 PM] 
Неужели никто не сталкивался, не могу начать делать задание, просто потому что не работает spring message


Kaa [12:16 PM] 
@Rostish пропиши путь без переменной. было подобное под линуксом, задал абсолютный путь - заработало. правда потом и через переменную сделал, я ее просто с ошибкой задавал. может у тебя тоже такое же.


Rostish [12:18 PM] 
@Kaa     <bean id=“messageSource” class=“org.springframework.context.support.ReloadableResourceBundleMessageSource”
         p:defaultEncoding=“UTF-8”>
       <property name=“basenames” value=“/Users/alex/Documents/GitHub/topjava/config/messages”/>
       <property name=“fallbackToSystemLocale” value=“false”/>
   </bean>
так?


Rostish [12:32 PM] 
ну это адд какой-то


[12:32] 
я просто перенес в WEB-INF

[12:32] 
поменял на     <bean id=“messageSource” class=“org.springframework.context.support.ReloadableResourceBundleMessageSource”
         p:defaultEncoding=“UTF-8”>
       <property name=“basenames” value=“WEB-INF/messages/app”/>
       <property name=“fallbackToSystemLocale” value=“false”/>
   </bean>


[12:32] 
и заработало


Kaa [12:34 PM] 
@Rostish <property name=“basenames” value=“file:///Users/alex/Documents/GitHub/topjava/config/messages”/> так попробуй - у меня так работало.


RNG [1:20 PM] 
Блин, эти релятивные пути просто новый круг ада. Сначало контроллеры не хотели работать нормально пока не воспользовался подсказками после урока, но после этого jsp-фрагменты поотваливались. Казалось бы починил фрагменты и все, но нет! Перестали подключаться стили в форме и после применения фильтра. Пришлось их включать  в нужные страницы напрямую. Соре за оффтоп, пригорел немного. (edited)


Marina [3:33 PM] 
Ребята, у кого тоже  неверная кодировка UTF-8 с Spring была, куда вставлять этот  filter из подсказки, что-то у меня везде пишет is not allowed here?


Few [3:34 PM] 
https://stackoverflow.com/questions/5141403/utf-8-encoding-in-spring-mvc-problem-with-forms
stackoverflow.com
UTF-8 encoding in Spring MVC, problem with FORMs
I have this in web.xml <filter> <filter-name>encoding-filter</filter-name> <filter-class> org.springframework.web.filter.CharacterEncodingFil...
 


Anton K. [5:30 PM] 
Ребят, подскажите по Optional, я для того чтобы у меня из резалтСета User с ролями выходил в sql запросе использую LEFT OUTER JOIN и чтобы роли нормально мапились пытаюсь использовать SimpleFlatMapper, но нифига не получается, подскажите какие еще варианты есть или куда посмотреть))


anpotashev [5:48 PM] 
делал свой маппер. Подходящего готового не нашел.


Anton K. [8:33 PM] 
Объясните пожалуйста, почему ни MapSqlParameterSource, ни BeanPropertySqlParameterSource не мапят roles для сохранения


dyakoven [9:21 PM] 
тесты в JdbcUserServiceTest нужно пропускать вне зависимости от выбранного профиля jpa/datajpa/jdbc?


kadmser [9:29 PM] 
@dyakoven тесты же все запускаются, независимо от выбранного профиля


Andrew [10:13 PM] 
2.1 Добавить транзакционность (DataSourceTransactionManager) в Jdbc реализации: киньте, пожалуйста, в меня полезной ссылкой? :disappointed:
  7 replies Last reply today at 12:36 PM View thread


----- Today December 15th, 2017 -----
grigory.kislin [12:13 AM] 
@CRCx86 так правильно: https://github.com/JavaOPs/topjava/wiki/IDEA#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D1%8C%D1%82%D0%B5---%D0%BD%D0%B5%D1%82-%D0%BB%D0%B8-%D0%BB%D0%B8%D1%88%D0%BD%D0%B8%D1%85-%D0%B1%D0%B8%D0%BD%D0%BE%D0%B2-%D0%B8%D0%BB%D0%B8-%D0%BD%D0%B0%D0%BE%D0%B1%D0%BE%D1%80%D0%BE%D1%82-%D0%B8%D1%85-%D0%BD%D0%B5-%D1%85%D0%B2%D0%B0%D1%82%D0%B0%D0%B5%D1%82-%D0%B2-project-structure-modules-spring-%D0%B5%D1%81%D0%BB%D0%B8-%D0%BD%D0%B5-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82-%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5--%D1%83%D0%B4%D0%B0%D0%BB%D0%B8%D1%82%D1%8C-%D0%B8-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%B7%D0%B0%D0%BD%D0%BE%D0%B2%D0%BE
а в видео этого нет?
GitHub
JavaOPs/topjava
topjava - Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery
 
(edited)


Marina [8:43 AM] 
Ребята, не могу понять, поясните, кто понял пункт "9: Проверьте, что config\messages\app_ru.properties у вас в кодировке UTF-8 (в любом редакторе/вьюере или при отключенном Transparent native-to-ascii conversion в IDEA). ASCII коды нужны были только для JSP." Что это значит, у меня все нормально работает, но в файле app_ru.properties ASCII код, это нужно как то исправить? Или оно само должно исправиться после вставки фильтра, у меня ничего не изменилось.


Marina [8:55 AM] 
Вопрос снимается, переписала все русскими буквами, ничего в работе не поменялось, но требованию соответствует.



Rostish [12:09 PM] 
Добрые люди, помогите советом


[12:09] 
сделал такую штуку

[12:09] 
@GetMapping(“/meals/update”)
   public String update(@RequestParam(“id”) int id, HttpServletRequest request) {
       int userId = AuthorizedUser.id();
       Meal meal = mService.get(id, userId);
       request.setAttribute(“meal”, meal);
       return “mealForm”;
   }

   @PostMapping(“/meals/change”)
   public String change(HttpServletRequest request) {
       int userId = AuthorizedUser.id();
       Meal meal = new Meal(LocalDateTime.parse(request.getParameter(“dateTime”))
               , request.getParameter(“description”), Integer.parseInt(request.getParameter(“calories”)));
       if (request.getParameter(“id”).isEmpty()) {
           mService.create(meal, userId);
       } else {
           mService.update(meal, userId);
       }
       return “redirect:/meals”;
   }


[12:09] 
все работает


[12:09] 
но


[12:09] 
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint “meals_unique_user_datetime_idx”
 Подробности: Key (user_id, date_time)=(100000, 2015-05-31 20:00:00) already exists.


Rostish [12:10 PM] 
я ведь вызываю метод апдейт, там по цепочки доходит до репозитория и там либо sql либо еще с синтаксисом UPDATE

Katherine Buzatu [4 hours ago] 
А в дебаггере проверял, что на самом деле вызывается?



grigory.kislin [2 hours ago] 
1. в методе update у тебя почемуто реализация get
2. ты добавляешь еду, с той же датой. а у нас в базе констрайнтс- нельзя у юзера иметь 2 еды с одной датой-временем


Atrieron [1 hour ago] 
В методе update он получает еду по переданному айдишнику и перекидывает в форму редактирования. Этот метод обрабатывает запрос от клиента, а не заносит изменения в базу.
Вот только в GetMapping у него почему-то нет параметра id, я так подозреваю, у него id всегда 0.


Viktor [1 hour ago] 
@Atrieron потому, что id пользователя мы берем из AuthorizedUser.id(). Если брать из запроса, то это огромная дыра в безопасности.


Atrieron [1 hour ago] 
Я про id еды


Viktor [1 hour ago] 
@RequestParam(“id”) int id - она здесь передается как параметр запроса


Atrieron [1 hour ago] 
Оно еще должно быть указано в GetMapping. @GetMapping("/meals/update/{id}") примерно так.


Atrieron [1 hour ago] 
Но еда у него, похоже, все-таки как-то находится, судя по выходящей ошибке


Viktor [1 hour ago] 
я тоже немного запутался, но он использует не PathVariable, чтобы брать переменную из пути запроса, а RequestParam - чтобы брать из параметров.


Viktor [1 hour ago] 
В гет запросе параметры идут после знака вопроса. Если в jsp у него указан пусть meals/update?id=.... то все нормально :smiley:


Rostish [12:10 PM] 
почему пытается новую вставку сделать?


Marina [12:21 PM] 
А как ты роли добавлял? У меня при попытке создать свой маппер, в итоге создается два админа с одинаковым id, у одного роль USER, у другого ADMIN, а как их обе в одного userа запихнуть что-то никак не пойму?
Aleksandr N Potashev
делал свой маппер. Подходящего готового не нашел.
Thread in #hw6Yesterday at 5:48 PM

Anton K. [4 hours ago] 
Попробуй через resultsetextractor


anpotashev [4 hours ago] 
Пост-обработка результата


Marina [4 hours ago] 
В маппере?


anpotashev [4 hours ago] 
Я пост-обработку сделал в репе


Marina [4 hours ago] 
что-то не представляю как в моем случае такую пост-обработку сделать, в каждом методе собирать таких юзеров в одиноковым id, как то совсем сложно получается :disappointed:


anpotashev [4 hours ago] 
Учти, что у нас юзеры выходят отсортированными - это упрощает дело

Marina [3 hours ago] 
Т.е. ты так и делал в каждом методе?


Marina [3 hours ago] 
@Anton K. Спасибо через него и сделала, и без постобработки получилось:+1:


Anton K. [3 hours ago] 
@Marina Не забудь только отсортировать возвращаемый список, а то ORDER BY не сортирует почему то и я долго промучился


Marina [3 hours ago] 
я тоже, заметила что не сортирует на save, по getall без ошибки возвращало


Marina [3 hours ago] 
только наверное не совсем правильно, что по любому запросу сортировать будет


Marina [3 hours ago] 
@Anton K. А "2.4.1 В реализации getAll НЕ делать запрос ролей для каждого юзера (N+1 select)" сделать получилось? У меня во всех запросах LEFT JOIN user_roles, чтобы роли можно было сравнить.


Viktor [3:25 PM] 
@Rostish никто не пытается сделать новую вставку, вы пытаетесь обновить еду и видимо еда от пользователя 100000 на дату 2015-05-31 20:00:00 уже существует. У нас эти значения должны быть уникальными. При обновлении это правило так же можно нарушить, что вы и пытаетесь сделать.


Nick [6:18 PM] 
Всем привет! После накатки 6.08 на всех тестах,кроме JDBC, вылетает  java.lang.IllegalStateException: Failed to load ApplicationContext, Error creating bean with name 'entityManagerFactory'. Как я понял, нужно добавить в Abstract тесты в вызов конструктора new Date(); Сделал, но не помогло. В чем может быть проблема?

Katherine Buzatu [1 day ago] 
В выбранном профиле Maven (edited)


philip.goldm [6:21 PM] 
@grigory.kislin
>https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson06.md#apply-14_spring_i18npatch
>Apply 14_spring_i18n.patch
думаю необходимо поправить Apply 6_15_spring_i18n.patch



Nick [7:44 PM] 
Ребята, Spring не может найти CacheManager, хотя бин описан в spring-tools.xml.   XML добавлен в Spring Context. Что делать?


Nick [7:48 PM] 
added this XML snippet
<bean id="cacheManager" class="org.springframework.cache.jcache.JCacheCacheManager">
    <property name="cacheManager">
      <bean class="org.springframework.cache.jcache.JCacheManagerFactoryBean"
         p:cacheManagerUri="classpath:cache/ehcache.xml"/>
    </property>
  </bean>
Add Comment Collapse



shaakem [8:04 PM] 
Всем привет! Подскажите пожалуйста, в MealRestController нужно делать только REST методы? Т.е. никаких return String там не должно быть? Как тогда вызывать mealForm.jsp?


Katherine Buzatu [10:41 PM] 
Товарищи, направьте, что с РестКонтроллером делать? Куда его маппить? Как его будет приложение отличать от обычного контроллера? И что он должен отдавать? (edited)


anpotashev [11:01 PM] 
Полагаю, обрабатывать REST запросы. А аннотация будет, наверно, другая. У нас рест - на следующем занятии.


Katherine Buzatu [11:33 PM] 
А в этом ДЗ MealsRestController делать не надо?



----- Yesterday December 16th, 2017 -----
Ruslan [12:20 AM] 
@Rostish else {  meal.setId(id);
         mService.update(meal, userId);
     }


Viktor [1:47 AM] 
@Katherine Buzatu могу ошибаться, но вижу так:
Мапится не контроллер, а методы помеченные аннотацией @...Request, которые потом превращаются в методы сервлетов и мапятся на нужные адреса. А дальше диспетчер сервлетов вызывает нужный сервлет по запросу.


CRCx86 [8:55 AM] 
@Viktor научите меня тоже на эльфийском разговаривать)



CRCx86 [11:39 AM] 
Подскажите пожалуйста вот что: в 
InMemoryAdminRestControllerSpringTest:
@Autowired
   private AdminRestController controller; - подчеркивается красным

в AbstractUserController:
@Autowired
   private UserService service; - подчеркивается красным

куда копать? это и есть домашнее задание?


[11:40] 
could not awtowired пишет

CRCx86 [12:06 PM] 
uploaded and commented on this image: image.png
1 Comment

тут должно быть пусто?



CRCx86 [12:16 PM] 
что нужно поправить в mock.xml? там теги и скан мок-репозитория)


CRCx86 [12:41 PM] 
куда хоть думать-то?


Few [1:04 PM] 
нам для запуска тестов нужен бин контроллера, он находится в пакете web, сканирование которого раньше было в spring-app.xml, а теперь нет


[1:05] 
вот это и надо как-то исправить

CRCx86 [6:47 PM] 
@Few спасибо за наводку! буду думать


grigory.kislin [6:59 PM] 
@shaakem @Katherine Buzatu не надо rest. он будет позже
подправил ДЗ: 
- 1.3 Удалить сервлеты и перенести функциональность `MealServlet` в `JspMealController` контроллер (по аналогии с `RootController`).
`MealRestController` у нас останется, с ним будем работать позже. (edited)


CRCx86 [7:52 PM] 
@grigory.kislin должен ли быть заполен jpa на скрине выше?


grigory.kislin [8:06 PM] 
@CRCx86 все верно. справа должна появится вкладка Persistanceи там можно назначить DataSource
ну и понятно, что это все никак на исполнение не влияет, только IDEA интеграция



----- Today December 17th, 2017 -----
Viktor [12:08 AM] 
@Katherine Buzatu я только сейчас понял о чем ты спрашивала... отстал немного :smiley: Но сейчас у меня появился вопрос, если у нас есть рест контроллер в котором уже все реализованно, почему бы не autowired его и испрользовать его методы? или мы их потом поменяем?


Viktor [12:49 AM] 
либо "1.3.2 в одном контроллере нельзя использовать другой. Чтобы не дублировать код можно сделать наследование." на это и намекает.

1 reply
Katherine Buzatu [20 minutes ago] 
А это не будет гвоздем в крышку гроба РестКонтроллера, и при необходимости внести в нем специфические изменения придется вводить новую сущность, наследуемую от самого себя изначального?


Eugeniy [12:03 PM] 
Всем доброго дня! Никто не сталкивался с исключением"NoSuchBeanDefinitionException: No qualifying bean of type 'javax.persistence.EntityManagerFactory' available"? Если кто может подскажите пожалуйста откуда ноги растут. Вообще какой-то затык.


Few 
[12:15 PM] 
Не находит бин EntityManagerFactory


[12:16] 
Точнее не сказать без полного текста эксепшена



Eugeniy [1:20 PM] 
вот строка с исключением: Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpautil': Injection of persistence dependencies failed; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.persistence.EntityManagerFactory' available


Viktor [1:22 PM] 
@Eugeniy "Error creating bean with name 'jpautil': " ошибка создания jpaUtil



Eugeniy [1:22 PM] 
я так подозреваю что Spring  не может инициализировать поле EntityManager em


grigory.kislin [1:26 PM] 
Все ошибки на отсутствия бина в контексте или его нескольких реализациях относятся к пониманию основ: Spring application context
Если нет понимания этих основ, двигаться дальше нельзя, нужно вернуться к видео Спринг, где объясняется что это такое
Также посмотрите видео 
https://drive.google.com/file/d/1SPMkWMYPvpk9i0TA7ioa-9Sn1EGBtClD
Начиная с 11.30 как раз разбираются подобные ошибки


grigory.kislin [1:26 PM] 
shared this file
3_09_test_UserServiceN.mp4
55 MB
MPEG 4 Video from Google Drive
 Click to open in Google Drive

Add Comment



grigory.kislin [1:28 PM] 
Error creating bean with name 'jpautil' - смотрим как всегда верх последнего эксепшена


vsimonov [1:43 PM] 
Посоны, прописываю так в mock.xml <context:component-scan base-package="ru.javawebinar.**.web"/> тесты по прежнему не проходят, что за чума?


Few
[1:44 PM] 
информации не достаточно
нужен лог


vsimonov [1:48 PM] 
@Few org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'ru.javawebinar.topjava.service.jdbc.JdbcUserServiceTest': Unsatisfied dependency expressed through field 'jpaUtil'; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'ru.javawebinar.topjava.repository.JpaUtil' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}


Few
[1:51 PM] 
No qualifying bean of type 'ru.javawebinar.topjava.repository.JpaUtil' available: expected at least 1 bean which qualifies as autowire candidate.


[1:51] 
нет бина в контексте

vsimonov [1:51 PM] 
я и указываю где искаит


grigory.kislin [1:55 PM] 
@vsimonov
у тебя есть ВСЯ информация- в контексте отсутствует `JpaUtil`
если самостоятельно не решить этого, какой смысл в обучении?


Few
[1:56 PM] 
в каком профиле у тебя этот бин посмотри


vsimonov [1:57 PM] 
@grigory.kislin верно, плёткой меня плёткой


Few
[1:58 PM] 
ну и назначение его тоже важно для правильного решения поблемы (edited)


grigory.kislin [2:00 PM] 
название у него по умолчанию. совсем неважно


Few
[2:05 PM] 
@grigory.kislin я про назначение



grigory.kislin [2:40 PM] 
да, сорри:)
назначение- очистка кэша хибернайт для JPA-based реализаций
дописал в подсказки п. 2 про ошибки на отсутствия бина в контексте или его нескольких реализациях


vsimonov [2:58 PM] 
Валидацию в тестах нужно исключать по какому принципу?


grigory.kislin [2:59 PM] 
@vsimonov верный ход мыслей:) попробуй еще точнее вопрос задать (edited)


vsimonov [3:08 PM] 
@grigory.kislin я проверку на null везде сделал , теперь работают все тесты.

grigory.kislin [3:10 PM] 
нуок.. один из вариантов... а попробуй на свой вопрос теперь ответить
> Валидацию в тестах нужно исключать по какому принципу?


vsimonov [3:11 PM] 
Выбран ли профиль jdbc или как у меня jpaUtil null


grigory.kislin [3:12 PM] 
ну, это не думаю что принцип.. это его реализация


Valery [4:18 PM] 
при сабмите все элементы <form> записываются в атрибуты request и позже вынимаются через request.getParameter
как собрать эти элементы в один объект, с которым сможет работать метод-обработчик, принимающий заданный объект в параметрах вместо HttpServletRequest?


Few
[4:19 PM] 
а зачем вместо?


Valery [4:20 PM] 
чтобы потом не собирать объект заново из request.getParameter


Few
[4:23 PM] 
видимо я не совсем понял вопрос


Eugeniy [4:24 PM] 
@grigory.kislin Григорий, спасибо. С контекстом вопрос отпал: всему виной невнимательность, использовал профиль в котором нет нужного бина.


Few
[4:24 PM] 
приходят значения полей объекта в запросе, достаем и собираем объект, сохраняем его


Valery [4:30 PM] 
да. но если полей много?
сейчас мы собираем еду в три обращения к request
Meal meal = new Meal(
                   LocalDateTime.parse(request.getParameter("dateTime")),
                   request.getParameter("description"),
                   Integer.parseInt(request.getParameter("calories")));


[4:30] 
А хотелось бы сразу получать собранный объект.

Few [4:31 PM] 
ну дальше в REST будем в виде JSON отправлять



[4:33] 
хотя пусть специалисты ответят :slightly_smiling_face:


vch [4:33 PM] 
@Valery а кто мешает получать собранный объект? Спринг ведь умеет.


Valery [4:33 PM] 
вот и спрашиваю - как ? пока не нашел.


Few [4:33 PM] 
вот Valery и спрашивает, как?


grigory.kislin [4:36 PM] 
@Valery будет в след. уроке (edited)


Valery [4:36 PM] 
@grigory.kislin в лекции или в дз?


Viktor [4:38 PM] 
@Valery гугли "spring form bean binding", сюда ответ кидать не буду, пообсуждать можно будет в лс



Valery [4:40 PM] 
встретил @modelattribute, но пока у меня он не заработал...


[4:41] 
и если в форме будут поля разных объектов, как они соберутся?...


Few [5:00 PM] 
@ModelAttribute интересно, но придется с форматом даты колдовать


vch [5:08 PM] 
@Few форматтеры и конверторы никто не отменял.


Few [5:10 PM] 
Ну раз уж спринг берет на себя львиную долю работы, хотелось бы чтобы он и об этом позаботился


[5:10] 
:slightly_smiling_face:


vch [5:13 PM] 
@Few не, ну формат даты сообщить же ему надо. Все разный формат используют, Spring ещё мысли читать не умеет (что, на мой взгляд, очень хорошо... )


Few
[5:19 PM] 
@vch да уж, магии в спринге и так достаточно



----- Today December 18th, 2017 -----
dyakoven [12:08 AM] 
когда мы фильтруем еду и создаем/редактируем еду - выполняется POST запрос и падает на /meals. Подскажите, как правильно разделить функционал в MealController так как мы делали в MealServlet при помощи значения параметра action


grigory.kislin [12:50 AM] 
@dyakoven через разные url


Marina [12:33 PM] 
Ребята, кто сделал, подскажите по пункту "2.4.1 В реализации getAll НЕ делать запрос ролей для каждого юзера (N+1 select)" куда можно посмотреть? У меня во всех запросах  get в JdbcUserRepisitory в итоге есть LEFT JOIN, чтобы можно было получить и сравнить роли, а как то можно без него?

anpotashev [4 hours ago] 
Можно и без него. Получаешь юзеров без джойнов, затем циклом по результату и по каждому выбираешь роли. И будет ровно n+1 (edited)


Katherine Buzatu [4 hours ago] 
А это как раз не n+1 выходит?


Marina [4 hours ago] 
Спасибо, а то я не совсем поняла, думала, что как раз так и будет N+1


Few 
[4 hours ago] 
ну по-моему это и будет n+1


grigory.kislin [12:43 PM] 
@Marina можно через LEFT JOIN, можно двумя запросами-  юзеры и роли


vsimonov [12:45 PM] 
у нас метод есть getFilteredWithExceeded он дату  не принимает, только список и время. Получается мы фильтруем только по времени?

Katherine Buzatu [4 hours ago] 
В него список приходит уже отфильтрованный по дате (edited)


Few [12:47 PM] 
мы сначала берем все записи для даты, чтобы правильно вычислить exceeded


[12:47] 
а потом фильтруем по времени


[12:47] 
кажется так


Katherine Buzatu [12:50 PM] 
@grigory.kislin насколько глубоко копать `JdbcUserRepositoryImpl` по поводу ролей? Там же вскрывается и проблема вставки, и изменения...


Marina [12:52 PM] 
Я во вставку добавила роли, а изменение не стала трогать, вроде как у нас у юзера один раз роли выставляются, может конечно я не правильно поняла.
Katherine Buzatu
@grigory.kislin насколько глубоко копать `JdbcUserRepositoryImpl` по поводу ролей? Там же вскрывается и проблема вставки, и изменения...
Posted in #hw6Today at 12:50 PM


grigory.kislin [12:52 PM] 
@Katherine Buzatu у меня в решении такой коммент:
```            // Simplest roles implementation (delete all/ insert all)
            // More complicated : get user roles from DB and compare them with user.roles (assume that roles are changed rarely).
            // If roles are changed, calculate difference in java and delete/insert them.
```


Katherine Buzatu [12:53 PM] 
То есть нет предела совершенству, но и так нормально :slightly_smiling_face:


grigory.kislin [12:54 PM] 
нуда. всегда так, не только у меня:)


[12:55] 
и всегда выбирать приходится

Дима Жуков
[12:56 PM] 
Товарищи, а какая аннотация на контроллер url-pattern  навесить как в web.xml?


[12:58] 
Спасибо, нашел.


vsimonov [1:37 PM] 
при реализации getbeetween в результирующий список должны попадать фильтрующие даты. Если я выбрал 29 и 30 ичсло одного месяца что в результате должно получиться?


Дима Жуков [1:59 PM] 
Ребят, такое было у кого-нибудь? Редирект сначала сделал через response по-старинке редиректит на  meals/meals.. нагуглил redirect:meals и тоже самое... (edited)


vch [2:00 PM] 
@Дима Жуков а если так? ` redirect:/meals`


Дима Жуков [2:00 PM] 
Хм...)) И правда надо попробовать


Andrew [10:57 PM] 
Коллеги, по добавлению админу ещё одной роли - нужно в ините базы данных менять, что теперь у юзера роль может быть енумом? Или это проще решить через саму джаву?


Andrew [11:09 PM] 
Не очень понятно, зачем ему две роли? Прошу прощения, если вопрос глупый


Viktor [11:33 PM] 
пользователь -> роли = связь один ко многим. Т.е. один пользователь может иметь несколько ролей. 1 или 2 роли, у пользователя лежит список ролей.
В initdb менять не надо, там все это уже сделано (отдельная таблица для связки пользователей и ролей). Поменять можно в populateDb - добавить роль.


[11:34] 
2 роли нужны, чтобы админ мог быть и пользователем. Как пример в этом чате: Григорий может добавлять удалять людей, сохранять историю (функции админа), так и общаться (функции пользователя). Если бы у каждого была только 1 роль, то Григорию пришлось бы завести 2 учетки
 



----- Today December 19th, 2017 -----
dyakoven [2:53 PM] 
кто может объяснить по пункту
>1.3.2 в одном контроллере нельзя использовать другой. Чтобы не дублировать код можно сделать наследование.
?
почему плохо использовать контроллер в контроллере?


[2:53] 
в одном контроллере ведь можно создать инстанс другого и делегировать к его методам


anpotashev [3:06 PM] 
Контроллеры - это "конечные продукты". Допустим, ты захочешь что-то поменять в рест-контроллере, тогда тебе надо будет оглядываться на то, что его изменения могут повлиять на контроллер сервлета, который от него будет зависеть.


dyakoven [3:09 PM] 
но если мы его наследуем в контроллере сервлета,  то изменения тоже повлияют на контроллер сервлета


anpotashev [3:19 PM] 
А не надо наследовать его от сервлета


[3:20] 
Тоже так сперва в сервлет добавил зависимость от реста, указали что неверно. (edited)


Viktor [3:47 PM] 
тогда по логике можно весь рест контроллер выделить в ещё один слой сервиса. Тогда в рест контроллере дергать его напрямую, а в jsp контроллере дергать его и класть все в jsp.


grigory.kislin [4:34 PM] 
@dyakoven у контроллера по классике не должно быть логики- только аннотации по приему запросов
мы же сервлеты один в другой не вставляем
