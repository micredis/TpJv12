grigory.kislin [1:19 AM] 
joined #graduate_project.


grigory.kislin [1:37 AM] 
Общение по выпускному проекту https://github.com/JavaWebinar/topjava/blob/doc/doc/graduation.md
Особое внимание на замечания по нему!
Начинайте делать в проекте темы, которые мы уже прошли, уже сейчас
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


Argentum_kuh [1:54 AM] 
joined #graduate_project along with 18 others.


grigory.kislin [5:29 PM] 
Привет!
по выпускному: задание дано как есть, но делать в нем надо только то, что уже прошли
например объектную модель, слой сервиса, слой контроллера пока без ввода данных снаружи (edited)


MetalBro [6:22 PM] 
Кто-нибудь начал смотреть? Думаете, функции админа только в выставлении меню по ресторанам, или функция выбора места для обеда у него тоже должна быть?


Few
[6:23 PM] 
из текста кажется что это разные пользователи


[6:23] 
т.е. админская учетка отдельно только для администрирования


anpotashev [6:55 PM] 
Думаю, для выбора места ему надо еще роль юзера добавить. если же у него только одна роль админа, то и голосовать он не должен (edited)


Katherine Buzatu [7:06 PM] 
Нам сказано, что юзеров очень много, а админов очень мало, и что усложнять не надо. Думаю, админы подвинутся и заведут отдельную учетку для голосования.


anpotashev [7:12 PM] 
Или несколько и будут продвигать нужные рестораны


Ivanushka [12:25 PM] 
Добрый день, начал копать проект, каждую строчку стараюсь вставить осознанно, застрял на том, что во вкладке Persistence (IDEA) есть мой проект, но, в отличии от TopJava, не могу туда добавить dataSource т.к. нет SessionFactory...

anpotashev [4 hours ago] 
И тебе добрый. У тебя в project structure -> modules или -> facets что есть? JPA или Hibernate?
И там же в группе spring проверь, что подтянута конфигурация.


grigory.kislin [1:00 PM] 
@Ivanushka (выбрать нужный как головоломка:)
Assign Data Source можно делать на датасорсы, которые у тебя есть в вкладке Database

Ivanushka [2 hours ago] 
Решил головоломку.:stuck_out_tongue_winking_eye:


Ivanushka [1:10 PM] 
Спасибо. Работает. Решил буквально только что - пересмотром видео (4_5_orm_jpa)


MetalBro [2:51 PM] 
Мы же Spring Data JPA будем разбирать? Его нельзя использовать?


[2:51] 
в этом проекте


Yuri [4:53 PM] 
Печально, что на выпускной проект надо использовать Hibernate, а не Spring Data JPA


Yuri [4:58 PM] 
Или можно?
16: Предпочтительно использовать DATA-JPA (можно без лишней делегации, напрямую из сервиса/контроллера дергать Repository). В случае JPA позаботьтесь о своем собственном generic DAO.


Andrey [5:56 PM] 
Юра, это сам спросил и сам ответил?)))
Бывает.
Эх.. я иногда по 2 часа обдумываю как метод назвать...:grinning:
Yuri D. Beljaeff
Или можно?
16: Предпочтительно использовать DATA-JPA (можно без лишней делегации, напрямую из сервиса/контроллера дергать Repository). В случае JPA позаботьтесь о своем собственном generic DAO.
Posted in #graduate_projectToday at 4:58 PM


grigory.kislin [8:50 PM] 
> Мы же Spring Data JPA будем разбирать
@MetalBro @Yuri
https://github.com/JavaWebinar/topjava, урок 5
> надо использовать Hibernate, а не Spring Data JPA
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson04.md - см вопрос у рооке 4. большая путаница в голове
> Чистого JPA не существует, т.е. это всего лишь интерфейс, спецификация? Говорим JPA, подразумеваем какой-то ORM фрэймворк? А что тогда используют чистый jdbc, Spring-jdbc, MyBatis? MyBatis не реализует JPA?
ORM это технология связывания БД и объектов приложения, а JPA - это JavaEE спецификация (API) этой технологии. Реализации JPA - Hibernate, OpenJPA, EclipceLink, но, например, Hibernate может работать по собственному API (без JPA, которая появиласть позже). Spring-JDBC, MyBatis, JDBI не реализуют JPA, это обертки к JDBC. Все ORM и JPA также реализованы поверх JDBC.
GitHub
JavaWebinar/topjava
Contribute to topjava development by creating an account on GitHub.
 


Yuri [9:34 PM] 
Андрей, да нет, не то что бы ответил, скорее непонятно мне))

Yuri [9:50 PM] 
Григорий, я наверно не очень вразумительно выразился. Я понимаю, что hibernate это абстракция над Jdbc, что jpa это интерфейс для привнесения стандарта... 
Просто в формулировке задания было указано hibernate, а прочитав п.16 у меня по ассоциации проскочило в голове "spring Data jpa":) Вот поэтому и задал вопрос такой!


Yuri [10:35 PM] 
Просто понравилось, пишешь интерфейсы и все, очень лаконично:)


anpotashev [2:03 PM] 
Друзья, вот такой вопрос по голосованию: т.к. дата голосования берется системная, то тесты теоретически могут свалиться, если проводить их в районе полуночи.
Как думаете, понять и простить?

Katherine Buzatu [7 hours ago] 
Ну, тут вообще с датой и временем запутанно. Они выбирают ресторан на ланч - т. е. первая половина дня.  Вопрос, когда поступает меню, и когда начинается и когда заканчивается голосование.


anpotashev [7 hours ago] 
Ну это то как рез легко решается в тестах


Katherine Buzatu [7 hours ago] 
а может, дата и время вообще не понадобятся...


Few [2:04 PM] 
Наверное да :slightly_smiling_face:


vsimonov [2:11 PM] 
а как создать два FOREIGN_key к двум разным таблицам в postgres? в две строки ругается


anpotashev [2:13 PM] 
а как у тебя сейчас?


[2:13] 
FOREIGN KEY (dish_id) REFERENCES dish (id) ON DELETE CASCADE
 ,  FOREIGN KEY (restaurant_id) REFERENCES restaurant (id) ON DELETE CASCADE


[2:14] 
У меня так примерно

vsimonov [3:25 PM] 
а капец запятую забыл) (edited)


russell [7:06 PM] 
Скажите, а нужно давать админу устанавливать дату или если меню публикуют каждый день, устанавливать текущую дату автоматически?


anpotashev [7:45 PM] 
Пока не добрался, но думаю первое. Меню на завтра могут заполнять заранее.


russell [7:47 PM] 
спасибо, так и сделаю, админ все таки


MetalBro [5:06 AM] 
После 5 урока останется только дождаться разбора Security для выполнения проекта? Вроде по описанию проекта остальное уже все прошли. Или я ошибаюсь?


[5:09] 
фронтенд не надо, т.е. в методах сервлета, контроллера будут только импровизированные внешние запросы.


Andrey [9:57 AM] 
Я один не успел сделать Graduation-project или есть ещё?



Few [9:58 AM] 
этот проект нам до самого выпуска, еще на 8 недель


[9:58] 
что значит ты не успел? :slightly_smiling_face:


Andrey [11:48 AM] 
Вопрос, а нужна ли там вообще дата?
Ruslan Shakirov
Скажите, а нужно давать админу устанавливать дату или если меню публикуют каждый день, устанавливать текущую дату автоматически?
Thread in #graduate_projectYesterday at 7:06 PM

anpotashev [7 hours ago] 
Дату, имхо, надо делать обязательно: "Нужно сделать все максимально просто, удобно для доработок". В качестве потенциальных доработок предполагаю будет статистика. В коде ее реализовывать не надо, а вот в б.д. - да.


russell [11:51 AM] 
@Andrey Григорий пишет: Историю еды и голосований лучше сделать. Если история еды есть, то и дата скорей всего нужна.


Dmitry Neustupov [12:17 PM] 
@Andrey я ещё даже не начинал (


Andrey [12:23 PM] 
ыч)
Dmitry Neustupov
@Andrey я ещё даже не начинал (
Posted in #graduate_projectToday at 12:17 PM


anpotashev [12:25 PM] 
Дату, имхо, надо делать обязательно: "Нужно сделать все максимально просто, удобно для доработок". В качестве потенциальных доработок предполагаю будет статистика. В коде ее реализовывать не надо, а вот в б.д. - да.



russell [12:26 PM] 
@anpotashev так меню надо вводить содержащий список еды, или все в еде указывать и дату и рестор?


anpotashev [12:29 PM] 
@russell Кто как реализует. У меня такой сущности как меню вообще нет.


Ivanushka 
[12:35 PM] 
@anpotashev +1, ресторан и еда с датой? Но тут есть нюансы...


Andrey [12:36 PM] 
Дима, у всех графики разные, тут у кого как выходит.
Andrey O.
ыч)
Posted in #graduate_projectToday at 12:23 PM

vsimonov [12:41 PM] 
а какая может нужна статистика? по рейтингу если тока в порядке сортировки, или прям в какой день сколько голосов было отдано такомуто ресторану?


anpotashev [12:47 PM] 
@vsimonov Например, по блюдам. При наличии блюда А в меню при цене до XX больше народу голосует за обед вне зависимости в каком она ресторане


russell [12:47 PM] 
@anpotashev а как ты голос привязываешь сразу ко всем блюдам?


anpotashev [12:48 PM] 
Я - к ресторану


russell [12:48 PM] 
а у тебя на каждую дату свой ресторан идет?


anpotashev [12:48 PM] 
Зачем?


russell [12:48 PM] 
а все уловил


anpotashev [7:49 PM] 
Привет!
Почему-то не работает валидация на уровне модели.
Мы вроде в topjava специально ее нигде не включали, только добавили аннотации к полям модели и hibernate-validator в pom.xml


[7:49] 
Или еще что-то было сделано?


grigory.kislin [8:47 PM] 
@anpotashev hibernate-validator при сохранение в базу через hibernate делает валидацию (edited)


anpotashev [8:47 PM] 
Спасибо. Только что разобрался. javax.el забыл включить в зависимости.


anpotashev [11:18 PM] 
Друзья, еще один вопрос. По кэшу.
Есть метод с кэшем: 
@Cacheable("menu")
   public DayMenu getDayMenu(LocalDate date) {
...
и есть второй метод в этом же классе:
   public DayMenu getDayMenu() {
       LocalDate date = LocalDate.now();
       return getDayMenu(date);
   }
Почему при вызове первого метода из второго не срабатывает кэш, а идет обращение к бд? (edited)


[11:21] 
Или это компилятор так оптимизирует


grigory.kislin [11:14 AM] 
@anpotashev хорошо, что споткнулся:) как работает @Cacheable? (edited)



anpotashev [12:04 PM] 
understood. 10x


	
Антон Кляшторный 12:02 PM
https://www.myvote.io/restaurant_demo
MyVote.IO
Restaurant Ratings (35 kB)


Дима Жуков 12:03 PM
Написал уже?)


Антон Кляшторный 12:03 PM
powerred by myvote.io


12:04
изучаю конкурентов


Дима Жуков 12:04 PM
:slightly_smiling_face:


vch 12:06 PM
кто-то сумел монетизировать выпускной проект?


Антон Кляшторный 12:07 PM
Григорий из нас походу только :slightly_smiling_face:


vch 12:08 PM
а вдруг myvote.io тоже из наших


grigory.kislin 1:01 PM
участникак с контактом  support@myvote.io у меня нет:( (edited)


Vladimir 1:31 PM
логично, ибо на курс регистрируются обычно под личным мейлом, а не под саппортом ), так что не факт


philip.goldm 9:32 PM
Тоже находил. Кому будет интересно http://lunchvote.org
lunchvote.org
lunch vote!
Vote on where to go for lunch with your co-workers. 


Ivanushka [10:14 AM] 
Поделитесь мыслями на счёт архитектуры проекта. На TopJava у нас 2 репозитория и 2 сервиса (User, Meal) сделано это, я так понимаю, в учебных целях, или нет? В нашем проекте хочу обойтись одним, или это не верно?


Viktor [10:32 AM] 
@Ivanushka обычно 1 репозиторий отвечает за 1 таблицу, а если более общим словом то 1 класс отвечает за 1 конкретное занятие "Принцип единой\единственной ответственности".


[10:35] 
Если вы ещё не знакомы с SOLID, это набор принципов объектно-ориентированного дизайна (ООД), которые популяризовал дядя Боб Мартин. SOLID — это акроним для:

S – SRP – Принцип единственной ответственности (Single Responsibility Principle)
O – OCP – Принцип открытости/закрытости (Open Closed Principle)
L – LSP – Принцип подстановки Барбары Лисков (Liskov Substitution Principle)
I – ISP – Принцип разделения интерфейса (Interface Segregation Principle)
D – DIP – Принцип инверсии зависимостей (Dependency Inversion Principle)
https://habrahabr.ru/post/343966/
Хабрахабр
Принципы SOLID в действии: от Slack до Twilio
Похоже, что в наши дни RESTful API существует абсолютно для всего. От платежей до бронирования столиков, от простых уведомлений до развёртывания виртуальных... (53 kB)


Ivanushka 
[10:38 AM] 
@Viktor Спасибо. Изучу.


Viktor [10:51 AM] 
не особо внимательно, сам читал в пол глаза :smiley:


anpotashev [4:37 PM] 
Привет!
Кто может помочь с jpql?
Надо чтобы на выходе было что-то вроде: (edited)


anpotashev [4:41 PM] 
added this Java snippet
select
*
from
restaurant
left join
(select * from vote where date='today') votes1_
on restaurant.id=votes1_.restaurant_id
Add Comment Collapse



Дима Жуков 
[4:44 PM] 
left join (select * from vote) нельзя ли заменить просто left join vote where


[4:44] 
ну или on вместо where



[4:45] 
?


anpotashev [5:01 PM] 
В этом случае в результате не будет тех у кого нет vote в этот день


Дима Жуков 
[5:11 PM] 
аааа, просто если без подготовки или по не знанию даже, глянуть, то бьет по глазам конструкция


anpotashev [5:14 PM] 
Ответ нашел. Отбой.


grigory.kislin [11:04 PM] 
@anpotashev лично мое мнение- НЕ надо этого


[11:06] 
@Ivanushka
> у нас 2 репозитория и 2 сервиса (User, Meal) сделано это, я так понимаю, в учебных целях, или нет? В нашем проекте хочу обойтись одним,
в реальном проекте сотни сервисов и репозиториев.... неужели приходит  в голову мысль слепить их в один?
> обычно 1 репозиторий отвечает за 1 таблицу
не строго. у нас например User+Role в одном репозитории/сервисе


russell [10:56 PM] 
Подскажите, а надо ли писать общий дженерик интерфейс для круда в сервисе?



----- Today December 8th, 2017 -----
Dmitry Neustupov [7:41 AM] 
@russell 16: Предпочтительно использовать DATA-JPA (можно без лишней делегации, напрямую из сервиса/контроллера дергать Repository). В случае JPA позаботьтесь о своем собственном generic DAO.



alphadoub [9:19 PM] 
Вопрос: по итогу будет код с которым можно будет сравнить своё решение, если ты без проверки дз участвуешь в topjava?

Или действует строго проверка для участвующих с проверкой дз, а те, кто без проверки по итогу и образца не увидят?


grigory.kislin [12:02 AM] 
@alphadoub 1. можно доплатить только за ревью
> будет код с которым можно будет сравнить своё решение
после окончания стажировке  и в личке


Антон Кляшторный [8:11 PM] 
подскажите эти курлы "couple curl commands to test it" мы будем проходить или это самостоятельно освоить нужно?


Valery [11:59 PM] 
альтернатива курлу - постман



----- Today December 17th, 2017 -----
grigory.kislin [12:07 AM] 
будем использовать curl (и ссылка на postman) когда к rest подойдем
в виде ссылок на гайд- что его проходить:)?
еще интересный инструмент https://httpie.org/
HTTPie
HTTPie – command line HTTP client
CLI HTTP that will make you smile. JSON support, syntax highlighting, wget-like downloads, extensions, and more. (184 kB)



anpotashev [2:49 PM] 
Подскажите, как предполагаете, будут создаваться админы? В ТЗ ничего не сказано что админы могут управлять ролями пользователей или самими пользователями.


Katherine Buzatu [2:52 PM] 
Думаю, один админ были изначально. И создаст он других админов и юзеров. Иначе замкнутый круг выходит.


anpotashev [2:54 PM] 
Про юзеров - думаю, сами народятся, через регистрацию.


Few
[2:54 PM] 
Ну к примеру взять любую ОС


[2:55] 
Есть один изначальный админ, он может создавать в том числе админов, которые могут то же


anpotashev [3:11 PM] 
Наличие какой-то роли вовсе не означает, что пользователи с этой ролью смогут назначить ее другим. Прямо о том что админы могут плодить других админов не говорится.
Что до юзеров, так они вообще могут оказаться какими-нибудь левыми, например с фб. Да и админы тоже могут оказаться левыми (например, из AD) (edited)


Few [3:24 PM] 
Думаю тут уж как ты сам решишь, так и будет. Не принципиально



[3:25] 
Главное чтобы запрограммировано было толково



[3:30] 
А вообще, из условия и рекомендаций: админов может быть несколько, ролей всего две. Тогда откуда же возьмутся несколько админов, если одни админы не смогут создавать других?


anpotashev [3:45 PM] 
Откуда могут взяться - пример с AD/LDAP уже привел. Могу еще пару с ходу придумать.
Сейчас добрался до юзеров вот и задался вопросом, как не сделать лишнего и предусмотреть разные варианты.


Few [3:48 PM] 
ну насчет LDAP я думаю это как раз усложнение, надо проще думать


Viktor [4:00 PM] 
как вариант создавать нового админа может владелец БД :smiley:


Few [4:01 PM] 
ага, запросом SQL из командной строки, чтоб хардкорнее )

Viktor [4:01 PM] 
типо того :smiley:
либо добавить возможность админу менять роли у пользователей.

anpotashev [4:02 PM] 
Вообще не уверен, а надо-ли хранить пользователей в этом проекте.


Few
[4:04 PM] 
а с чем сверять? как авторизовывать пользователей?


[4:04] 
сразу лдап прилепить?


anpotashev [4:06 PM] 
Можно указать что авторизацией занимается сервер приложений. А в нем уже настраивается как авторизовывать из бд, из лдап или еще как.


[4:06] 
как пример


grigory.kislin [5:07 PM] 
по поводу кто создает админы предлагаю не парится вообще. и на будующее наблюдать, как ум отвлекает программиста от собственно программирования:)
@anpotashev на тему авторизации мысль твою  не понял: что значит занимается сервер приложений? авторизация на уровне AS - это общий пароль- например tomcat/tomcat и общий допуск
как можно на его основе конкретного пользователя авторизовать?

anpotashev [3 hours ago] 
Например Realm в томкате.


[5:08] 
вы атворизацию пока захордкодьте как у нас- мы ее будет в конце стажировки делать


grigory.kislin [10:11 PM] 
https://habrahabr.ru/company/yandex/blog/265569/
Хабрахабр
15 тривиальных фактов о правильной работе с протоколом HTTP
Внимание! Реклама! Пост оплачен Капитаном Очевидность! Ниже под катом вы найдёте 15 пунктов, описывающих правильную организацию ресурсов, доступных по... (435 kB)



----- Today December 19th, 2017 -----
grigory.kislin [1:56 AM] 
Определились сроки набора на оплачиваемую AT consulting стажировку (участникам стажировки предполагается выплачивать небольшую стипендию в размере 15-25 000 руб.):
Старт первой стажировки намечен на 25.01, прием graduation до 22.01 
К сожалению компания дольше ждать не может, поэтому сроки такие сжатые. Но стажировки планируется проводить периодически по мере набора группы


Katherine Buzatu [7:59 AM] 
@grigory.kislin на этой стажировке возможен удаленный вариант?

Few [9 hours ago] 
Григорию в личку задавал вопрос. Стажировка удаленно возможна.


Katherine Buzatu [11:12 AM] 
А для иностранцев?


Дима Жуков [11:16 AM] 
Сказано в письме вроде было все, работа только по-моему в 3-х городах России, удаленной нет. Если только переезжать собрались



Katherine Buzatu [11:21 AM] 
Да... Даже не светит...


Дима Жуков
[11:21 AM] 
Интересно, а если проект сделаешь, но завалишь, но на практику прям сильно пресильно хочешь))) может им немного заплатить и на бесплатную практику к ним?


Anton K. [11:22 AM] 
лучше проект не заваливай))



Katherine Buzatu [11:23 AM] 
...и переезжай к ним поближе...


PugV [2:04 PM] 
то есть для иностранцев(Беларусь) удаленная стажировка возможна? и как будет проходить набор группы - примут всех, кто справился с заданием, или же ограничено количество мест и примут тех, кто первый сдал? (edited)


Viktor [3:45 PM] 
@PugV думаю будут смотреть на код


PugV [3:59 PM] 
так это понятно, что будут. я имею в виду, если будет хороший код, примут или можно не успеть, так как группа наберется?


Viktor [4:02 PM] 
ну если вдруг так получиться, что все претендующие напишут одинаковый код, то думаю выбирать будут считалочкой :smiley:


grigory.kislin [4:26 PM] 
по стажировке: примем всех
1. с хорошим выпускным проектом
2. прошедшим предварительное собеседование со мной и представителем компании
3. кто после окончания готов пойти в штат компании (Москва, СПб, Нижний Новгород)

рограмма будет идти 2-3 недели с куратором от компании, которых будет проверять твой код и давать личные советы по реализации требуемого функционала. 
учитавая п.2 - просьба не списывать! (edited)


kadmser [4:35 PM] 
@grigory.kislin продолжительность стажировки известна?


Shalukhau Dzmitry [4:35 PM] 
@grigory.kislin Удаленная работа возможна?


grigory.kislin [4:38 PM] 
http://javaops.ru/view/news

Стажировка будет основана на реальном проекте, который используется компанией, на стеке: Spring, Hazelcast, JMS, XML/JAXB, AS WebSphere. Программа будет идти 2-3 недели с куратором от компании, которых будет проверять твой код и давать личные советы по реализации требуемого функционала. По итогам стажировки будет проводиться финальное собеседование, прошедшие его будут приняты в штат компании на обговоренных заранее условиях и смогут принять участие на одном из самых передовых проектов по разработке банковской системы общероссийского значения. Условия обговариваются с каждым кандидатом дополнительно по итогам предварительного собеседования. Прохождение стажировки возможно удаленно, но локация трудоустройства после ее прохождения: только Москва, Санкт-Петербург и Нижний Новгород (удаленной работы нет). Стажировку планируется проводить периодически по мере набора группы
Java Online Projects
Онлайн обучение и стажировки Java Web, Spring/JPA, Enterprise. От новичков до эксперта. БЕСПЛАТНОЕ вступительное занятие, помощь в трудоустройстве
Онлайн обучение Java Web, Spring/JPA, Enterprise. От новичков до эксперта. Совместная разработка проектов. БЕСПЛАТНОЕ вступительное занятие. Стажировки и помощь в трудоустройстве. Получи опыт работы его в реальном Spring/JPA Enterprise проекте (43 kB)


Shalukhau Dzmitry [4:54 PM] 
@grigory.kislin спасибо (edited)


Sergey [5:02 PM] 
Не могу решить, в  выпускном проекте делать логгирование ? Так то ничего про это в условии не сказано, но  я так понял оно должно быть в любом подобном проекте


Дима Жуков [5:03 PM] 
Конечно делать) да хоть просто для себя (edited)



Shalukhau Dzmitry [5:12 PM] 
Логи конфигурируй таким образом, чтобы автоматом отправлялись на почту представителю компании, чтобы было видно что ты настроен серьезно. И минимальный уровень для отправки ставь где-нибудь в районе Debug :slightly_smiling_face: (edited)


Дима Жуков [5:16 PM] 
прям как в баяне -Какие ваши сильные стороны? -Настойчивость. -Мы Вам перезвоним. - Я подожду здесь.


vch [5:17 PM] 
@Shalukhau Dzmitry Уровень TRACE тоже не стоит игнорировать


Few
[5:23 PM] 
каждую строку отдельным письмом? :slightly_smiling_face:


Shalukhau Dzmitry [5:29 PM] 
@Few Желательно, чтобы письма отправлялись через proxy с использованием различных одноразовых ящиков пачками по 100 - 200 писем....


vch [5:30 PM] 
@Shalukhau Dzmitry а вот чтобы научиться делать массовые многопоточные рассылки - это на masterjava учат


Shalukhau Dzmitry [5:31 PM] 
Зачем? Достаточно logger сконфигурить для отправки через какой либо мэйлер. + мэйлер сконфигурить :slightly_smiling_face:


Few
[5:31 PM] 
на мастерджава учат спамить? :slightly_smiling_face:


anpotashev [5:31 PM] 
Давно это было - делал просмотр логов с помощью ussd команды на мобильном. Только сейчас понял, что можно было емейлом слать :slightly_smiling_face:


vch [5:31 PM] 
@Few письма отправлять. Многопоточно. Через SOAP.


Shalukhau Dzmitry [5:32 PM] 
@vch Мы же java учим. Remote bean :slightly_smiling_face:


[5:33] 
По ходу я оффтопик завел :slightly_smiling_face: Заканчиваем и продолжаем грызть гранит науки...



Andrey [7:27 PM] 
-Какие ваши сильные стороны? -Самоуверенность. -Мы Вам перезвоним завтра - Не звоните: завтра я буду уже на новой работе.
Жуков Дмитрий
прям как в баяне -Какие ваши сильные стороны? -Настойчивость. -Мы Вам перезвоним. - Я подожду здесь.
Posted in #graduate_projectYesterday at 5:16 PM



----- Today December 20th, 2017 -----
Kaa [10:58 AM] 
Появился внезапно вопрос по проекту. Мы используем @SequenceGenerator для генерации id. Попалось на глаза информация, что это deprecated метод работы с последовательностями. Нужно использовать @GenericGenerator со стратегией org.hibernate.id.enhanced.SequenceStyleGenerator. Не получается это чудо прикрутить к проекту, оно почему-то по новой все id генерирует, хотя в базе уже есть такие-же сгенерированные sql скриптом. Никто с подобным не сталкивался?


anpotashev [11:19 AM] 
@Kaa не понял, у тебя вопрос про автогенерациею таблиц?


Few 
[11:23 AM] 
про это:


[11:23] 
https://stackoverflow.com/questions/39861098/replace-sequencegenerator-since-its-deprecated
stackoverflow.com
Replace @SequenceGenerator since its deprecated
I have a problem with @SequenceGenerator: @SequenceGenerator(name="pk_user_id", sequenceName="seq_user_id", allocationSize=1) @GeneratedValue(strategy=GenerationType.SEQUENCE, generator="pk_user_i...
 


Kaa [11:31 AM] 
вопрос снимается. там наименование параметров задаются просто как строки, подсказок нет, и получилась ошибка в имени параметра. seqeunce_name написал вместо sequence_name, вот он и не видел табличную. Но гад не предупреждает, просто генерит заново.


MetalBro [8:19 PM] 
Кто как думает, нужен будет какой-то личный кабинет для юзера? Я так понимаю, на ближайшем занятии расскажут про REST, авторизацию и как избежать конфликтов при одновременной обработке контроллером запросы юзеров (в частности, правильное определение авторизированного юзера для передачи на view)?


grigory.kislin [11:40 PM] 
> личный кабинет для юзера
не обязательно
> расскажут про REST, авторизацию
будет, см. расипсание занятий


grigory.kislin [11:58 AM] 
друзья, привет!
сегодня в течении дня будет ссылка на урок. задержался, тк. пришлось переделывать видео про тесты


Few 
[11:59 AM] 
@grigory.kislin там в general уже чуть бунт не начался :slightly_smiling_face:


grigory.kislin [12:00 PM] 
еще и промахнулся:)



Katherine Buzatu [3:53 PM] 
Возник вопрос. БД есть две таблицы с одинаковой структурой, но с разными именами. Каждой надо свою Entity и свой Repository. В моем конкретном случае таблицы две, и по 2 класса создать - ладно. А как поступают в случаях, когда, например, по логике постоянно создаются новые таблицы (периодический бэкап, например)?


dart_rabbit [3:54 PM] 
Бэкап в ту же базу? Это какой-то неправильный бэкап...


Katherine Buzatu [3:56 PM] 
Ну, не бэкап. Просто данные сохраняются в новые таблицы. Вопрос не о бизнес-логике, а о том, как ее разрулить. (edited)


anpotashev [4:00 PM] 
Т.е. когда создаются временные таблицы?


[4:01] 
Или постоянные таблицы вида YYYY_DD_<TABLE_NAME>



[4:05] 
Про второй вариант встречал следующее:
на текущий месяц создается таблица <TABLE_NAME>, а в начале следующего месяца она переименовывается в YYYY_MM_...., и создается новая пустая с тем же именем.


Katherine Buzatu [4:07 PM] 
Допустим... Но все равно все таблицы с именем НЕ<TABLE_NAME> оказываются "незаперсистенными" и для любого доступа к ним мы уже не сможем воспользоваться нашей entity. (edited)


anpotashev [4:09 PM] 
Возможно, можно создать view к которой привязать все "архивные таблицы" и ентити привязать к view а не к таблице


[4:09] 
Это только предположение

Katherine Buzatu [4:11 PM] 
Казалось, что это не такой уж редкий случай, и в Hibernate ну должен быть инструмент для его обработки.


Viktor [4:19 PM] 
@Katherine Buzatu не совсем понял о чем ты. Про бекап таблицы или про похожую таблицу? В любом случае если тебе надо заменить 1 таблицу другой такой же, можно просто переименовать их :smiley:


Viktor [4:20 PM] 
У меня такой вопрос по проекту попался. У нас 1 ланч на 1 ресторан в день? или ресторан может предоставить несколько разных вариантов ланчей?

Katherine Buzatu [1 hour ago] 
у нас нет понятия "ланч". Есть меню: блюда и цены.


anpotashev [4:22 PM] 
Что значит один ланч на ресторан? Просто список блюд (edited)


russell [4:22 PM] 
Так у нас же можно от 2 до 5 блюд, Разве можно за один ланч сразу 5 блюд съесть?


anpotashev [4:24 PM] 
@russell Можно. Салат, первое, второе, десерт и морс.

anpotashev [4:24 PM] 
Это у нас бизнес-ланч

Katherine Buzatu [1 hour ago] 
то есть без пива и водки? :wink:


anpotashev [1 hour ago] 
С пивом - дальше и идти дольше. Ну и дороже, разумеется.


russell [4:25 PM] 
ого, это точно не обед?


anpotashev [4:25 PM] 
Бизнес-ланч, 250 руб.


[4:25] 
Мы так же перед обедом просматривали куда пойти :slightly_smiling_face: Был у нас сайт гдемойобед.рф


[4:25] 
Или как-то так


Viktor [4:28 PM] 
не я про вариант, в ресторанах всегда 1 бизнес-обед. Вот и интересно может быть так, что ресторан предложит выбор из 2 бизнес обедов в 1 день, люди голосуют именно за еду или за поход в этот ресторан. Пока писал понял, что за ресторан, а там по месту каждый сам выберет :smiley:


[4:29] 
ладно сделаю как понял, а там разберемся :smiley:


Дима Жуков [4:29 PM] 
мне кажется голосуют за еду)))


[4:32] 
ну или вернее за меню)

Katherine Buzatu [4:33 PM] 
За ресторан голосуют. В ТЗ, кажется, так и написано.


Дима Жуков 
[4:34 PM] 
надо бы мне перечитать


[4:36] 
Я изначально подумал что они голосуют за меню представленного ресторана, голосуют за хорошее меню, ну и как бы за ресторан


[4:36] 
заочно

Katherine Buzatu [4:38 PM] 
Они смотят меню, конечно (или не смотрят), но вопрос ТЗ в том, чтобы решить, где контора будет кушать.


russell [4:41 PM] 
после 11 голосование для всех закрывается или только для переголосований?


Katherine Buzatu [4:43 PM] 
Написано, что для переголосований. Но тогда возникает вопрос, когда они ланчуют. Или это для авторов ТЗ настолько понятно, что решили не вдаваться в подробности.


russell [4:46 PM] 
Eastern Europe[edit]
In Russia, the midday meal is taken in the afternoon. Usually, lunch is the biggest meal[e] and consists of a first course, usually a soup, and a second course which would be meat and a garnish. Tea is standard.


Katherine Buzatu [4:48 PM] 
Так это обед, что ли?


Дима Жуков 
[4:48 PM] 
это обед


Viktor [4:51 PM] 
я понял так, что голосование после 11 закрывает на совсем. В любом случае это  уровень сервиса(контроллера) так, что это исправить не сложно. А вот на этапе создания сущностей я пока сижу :smiley:

anpotashev [26 minutes ago] 
Ну почему же насовсем. Голосить можно, переголосовывать нельзя.


russell [4:51 PM] 
В википедии написано, что для восточно-евр стран ланч - это обед, для запада - это перекус после завтрака (edited)


MetalBro [6:08 PM] 
Запрещать ли юзеру голосовать за ресторан на несколько дней вперед? Или если даже меню нет?


[6:09] 
задача обновления меню полностью на совести админов


MetalBro [6:09 PM] 
Но думаю, почему им нельзя выставить меню не на грядущий день, а не неделю вперед?

anpotashev [17 hours ago] 
А кто запрещает?
В прошлом - да нельзя, а с будущим почему нет?


MetalBro [6:18 PM] 
все индивидуально)


Дима Жуков [6:20 PM] 
Главное функционал который в ТЗ выполнить короче

Katherine Buzatu [17 hours ago] 
В нем много недосказанного.


Dmitry Makarov [6:23 PM] 
я вот думаю админы могут каждому ресторану добавлять ланчи или админ это представитель ресторана/ресторанов?


anpotashev [6:23 PM] 
каждому, т.к. админы по ТЗ могут заводить сами рестораны


Dmitry Makarov [6:24 PM] 
ну может появляется у хозяина ресторана еще один, он его и создает. Потом с ним сам же работает. (edited)


MetalBro [6:25 PM] 
я предполагаю, что есть просто админские учетки, под которыми заходят и выставляют меню или добавляют рестораны


[6:26] 
естественно, эти люди должны отдавать себе отчет в том что они делают, и рестораны добавлять. Но это все на их совести

Dmitry Makarov [6:27 PM] 
наверно если в тз такой конкретики нет то и не надо добавлять, потом легко будет докрутить при необходимости


MetalBro [6:27 PM] 
возможно, т.е. база ресторанов уже должна быть заранее

[6:27] 
тогда*

[6:28] 
в этом случае можно вообще с одной сущностью работать

[6:28] 
в базе

Дима Жуков [6:28 PM] 
Ну сидит дядя админ, рестораны присылают меню, он их публикует, люди ставят звездочки. Одного админа и хватит)


MetalBro [6:28 PM] 
я рассматриваю админа не как дядю, а как учетку, под которой может зайти любой кто надо


[6:28] 
)


[6:28] 
в принципе одно и то же

Dmitry Makarov [6:28 PM] 
так можно конкурентам цены подправить


MetalBro [6:29 PM] 
нельзя!


[6:29] 
в том и смысл, что ты только свои рестораны можешь обслуживать

Дима Жуков 
[6:29 PM] 
Хозяин портала)) а рестораны пускай ему деньги платят за выставление меню. Пускай меню присылают, желательно в XML))


MetalBro [6:30 PM] 
ну ведь по идее все равно должно идти потдверждение заказа


[6:30] 
ну проголосовал юзер, ну и что


[6:30] 
он обязан идти обедать?

Дима Жуков 
[6:30 PM] 
В ТЗ такого нет


MetalBro [6:30 PM] 
вот после 11 и звонят за подтверждением


[6:30] 
это да, но мы немного в сторону ушли и про логику думаем


Dmitry Makarov [6:30 PM] 
это же не заказы, а просто рейтинг или я не так читал?


MetalBro [6:31 PM] 
вот тоже момент


[6:31] 
если рейтинг, то почему нельзя менять голоса?

[6:31] 
или ставить несколько


[6:31] 
еще время такое 11.00


[6:32] 
получается юзер должен проголосовать за ресторан до самого обеда


MetalBro [6:32 PM] 
а не после него, типа понравилось или нет

anpotashev [17 hours ago] 
Почему? Можно и после


MetalBro [17 hours ago] 
после 11 уже нельзя


anpotashev [17 hours ago] 
Переголосовать нельзя, а голосовать можно (edited)


Dmitry Makarov [17 hours ago] 
If user votes again the same day:

   If it is before 11:00 we asume that he changed his mind.
   If it is after 11:00 then it is too late, vote can't be changed


anpotashev [17 hours ago] 
CAN'T BE CHANGED

MetalBro [17 hours ago] 
ты понимаешь по-своему


MetalBro [17 hours ago] 
думаю тут все же не голос изменить нельзя, а все-таки то же самое что проголосовать по новой. И это запрещается после 11.00


MetalBro [17 hours ago] 
просто иначе не понимаю смысла дедлайна этого


anpotashev [17 hours ago] 
Смысл посмотреть как реализуете такую возможность

anpotashev [17 hours ago] 
Когда изменить нельзя, а создать можно

MetalBro [17 hours ago] 
ну другие варианты видятся нелогичными. Сказано же, что юзер выбирает где обедать. Он что в 16.00 придет голосовать на текущий день?


MetalBro [17 hours ago] 
и какой смысл принимать голос?


anpotashev [17 hours ago] 
После обеда укажет где обедал.
Нигде не сказано что создать голос нельзя. Имхо, это значит, что можно.


MetalBro [17 hours ago] 
если после обеда голосовать где обедал, смысл запрещать изменять голос?

MetalBro [17 hours ago] 
допустим так, после обеда уже никто не сможет проверить на самом ли деле юзер обедал где указал. Если до 11 он указал место, то его по идее надо будет подтверждать в ресторане


russell [17 hours ago] 
Это же просто рейтинг, не?


MetalBro [17 hours ago] 
вот вроде рейтинг, но зачем вводить дедлайны для рейтинга


MetalBro [17 hours ago] 
хз


anpotashev [17 hours ago] 
Подумайте, на какой вопрос вы сможете аргументированно, со ссылкой на ТЗ, ответить вернувшемуся ПМ: "почему нельзя голосовать после 11?" или "почему можно голосовать после 11?"



MetalBro [17 hours ago] 
Build a voting system for deciding where to have lunch.


MetalBro [17 hours ago] 
вот эта строчка


MetalBro [17 hours ago] 
имхо, предполагает, что решение должно быть принято на будущее


MetalBro [17 hours ago] 
а не постфактум


anpotashev [17 hours ago] 
А во сколько у людей ланч?


MetalBro [17 hours ago] 
середина дня

MetalBro [17 hours ago] 
рестораны, кафе как правильно выставляют время что-то вроде 12...15 для комплексных обедов

MetalBro [17 hours ago] 
а у нас получается комплексный и есть

anpotashev [17 hours ago] 
Уже видишь что не 11

MetalBro [17 hours ago] 
и это правильно


anpotashev [17 hours ago] 
У меня обед как-раз в это время и был с 12 до 15


anpotashev [17 hours ago] 
Так что я не могу проголосовать в 13?


MetalBro [17 hours ago] 
потому что до 11 принимается решение, а потом юзера ждут и готовят на него порцию


MetalBro [17 hours ago] 
потому что тебе могут сказать, что мы не приготовим


MetalBro [17 hours ago] 
поздно, кухня сворачивается, заказывайте по ресторанному меню)


Viktor [6:48 PM] 
чет вы совсем в дебри полезли :smiley:


anpotashev [6:49 PM] 
Как раз по-моему, очень важный пункт


Viktor [6:49 PM] 
какой конкретно? тут походу обсуждают заговор не существующих админов, по демпингу цены несуществующего ресторана друга с целью привлечь туда посетителей :smiley:



MetalBro [6:50 PM] 
не, сейчас главная тема


[6:50] 
может ли юзер поставить первичный голос после 11


Viktor [6:50 PM] 
тут один ответ: "У вас конечно есть много мыслей, для чего нужно приложение, как исправить ТЗ, дополнить его и сделать правильно. НО НЕ НАДО ИХ РЕАЛИЗОВЫВАТЬ В КОДЕ. Нужно сделать все максимально просто, удобно для доработок и очевидно (если конечно в ТЗ нет оговорок). "
 


[6:51] 
написать этот момент так, чтобы можно было быстро поменять :smiley:


anpotashev [6:53 PM] 
added this Java snippet: ТЗ
Кричал Кот Великану, мол, не верю,
Что примешь облик ты любого зверя!
Меня одним лишь только убедишь —
Коли немедля превратишься в мышь!
Развеять чтоб кошачие сомненья,
Стал мышкой Великан в одно мгновенье.
Но Кот поймать её, увы, не смог,
Поскольку та, взлетев под потолок,
Обгадила Кота говённой кучей …
Как оказалось, мышь была летучей!
Мораль: Как говорится, в назиданье —
Корректней формулируйте заданье!
Add Comment Collapse



Дима Жуков [6:53 PM] 
uploaded this image: TyI8-Mm_9PQ.jpg
Add Comment




Дима Жуков [6:54 PM] 
Немного тож типо в тему вроде


Viktor [6:06 PM] 
@grigory.kislin У меня тут снова вопрос появился, у гугла не спросить :smiley: В нашем проекте topjava в сущности meal есть пользователь. Раньше у нас там лежал только id пользователя, теперь и сам пользователь. Это обязательное условие(практика) jpa? 
Почему такой вопрос: у меня есть сущность "голос", она ссылается на пользователя и ланч, по факту доставать из неё ни пользователя ни ланч не понадобиться, но это создает много проблем при запросах и сравнении(в тестах).
Я сделал через int userId и int lunchId, так и оставлю, но интересно практикуется ли такой вариант или всегда надо использовать ссылки на объекты?


Katherine Buzatu [6:14 PM] 
Если не ошибаюсь, подобное обсуждалось, когда мы в Милз добавляли Юзера, вытаскивать которого нам по Еде не было нужды.


Viktor [6:39 PM] 
@Katherine Buzatu там у нас был пользователь как одна из характеристик еды, у меня же получается что голос состоит из даты, ланча и пользователя. Ланч и пользователь - ссылки. Если как и мы убрать их из сравнения, то и сравнивать нечего, хотя конечно можно сравнивать по id :smiley: Ладно над этим стоит ещё подумать, но мне все равно интересно: создавать связи обязательное условие (признанная практика) или это все только ради удобства?


alphadoub [8:51 PM] 
Вопрос: так ли нужны jpa-аннотации валидации в entities, если с внешним миром планируется общаться исключительно через ТО? В ТО - да, суть ясна, нужны, но зачем второй раз проверять значения в persistent классах (если уже все проверено в ТО)?

Я бы разгрузил код entities и оставил бы там только аннотации mapping’а, по возможности, а все валидации «унёс» бы в TO (ну большинство). 

Правильно ли я хочу? Или аннотации валидации также обязательно нужны и в entities, как правило хорошего тона? Типа вдруг будет принято решение, по каким-то абстрактным причинам, отказаться от TO. Опыта нет, поэтому не знаю, может ли такое произойти (edited)


Viktor [8:55 PM] 
@alphadoub тут наверно зависит от того где будете ловить ошибку. Если валидация в ТО, то ошибку придется ловить в слое web, если ошибка в Entity то её надо словить в сервисе (перевод из TO в Entity). Если обработка связана с логикой приложения, то ловить стоит в сервисе т.е при перегоне с TO в Entity.


[8:56] 
Т.е. дублирование валидации на ТО не особо нужно. ИМХО

alphadoub [9:08 PM] 
Ну я думаю, что стараться ловить ошибки именно валидации на высоком уровне (как можно раньше) - это хорошо же. То есть я не про логику же говорю, а о проверке входных данных. Ну то есть зачем проверять перед сохранением в базу значение поля, если это значение проверено у TO. Я наоборот склоняюсь к тому, что не нужно дублировать валидацию в entity, если она есть в TO. Лишние телодвижения получаются. (edited)


grigory.kislin [9:10 PM] 
> создавать связи обязательное условие (признанная практика) или это все только ради удобства?
1. связи определют таблицы в RMDB. елси в коде связи не нужны- то и не надо.
2. думаю что есть случаи, когда используют id. но тут приходится идти против JPA (edited)


[9:12] 
@alphadoub
> так ли нужны jpa-аннотации валидации в entities
да в разных проектах по разному делают. не обязательно


alphadoub [9:16 PM] 
@grigory.kislin, понял спасибо. Просто хочется лаконичности, вот и подумал, когда сейчас смотрел свой код: а зачем я 2 раза делаю одни и те же проверки (edited)


grigory.kislin [9:51 PM] 
тут как всегда есть и за и против (edited)


Viktor [1:15 AM] 
заметил ещё одну забавную вещь:
Есть ланч связанный с рестораном Многие к одному, fetch не указывал. 
Если вызывать findById то идет 1 запрос и достаются оба объекта через join.
Если же вызвать findAll получаю N+1 запрос.


MetalBro [11:31 AM] 
может быть глупый вопрос, но для фронтенда в DTO в виде JSON'а можно пихать сколь угодно информации? Например помимо самого объекта, еще и доп. параметры, которые он будет использовать для отображения/скрытия форм или элементов в зависимости от залогиненного юзера. Или может от REST контроллера можно послать не только сущность в виде JSON, а еще и какие-то доп. параметры установить как делали для model в jsp. Надеюсь ситуация прояснится в ближайшие недели)

anpotashev [1 day ago] 
Возможно,  неправильно понял вопрос, но, откуда ты знаешь какой будет фронтэнд? Может это будет веб, может другое серверное приложение или что-то на мобильные платформы. Или и то и другое и третье и еще что-нибудь. REST-API должно быть по возможности универсальным и не содержать лишнего.


MetalBro [1 day ago] 
ну вот у меня задумка отдавать на фронтенд display:none или disabled для полей форм в зависимости от того, админ залогинен или нет. Для Jsp я знаю как это сделать (на одной и той же Jsp будут отображаться разные возможности для юзеров). С переходом на REST и JSON'ы мне пока неясно как это реализовать и что я должен отдавать


MetalBro [1 day ago] 
Ту же проверку времени голосования можно на фронтенде сделать, Javascript позволяет дату смотреть. В бэкенде даже логика не нужна будет, туда сразу будет приходить что нужно


anpotashev [1 day ago] 
Ну а какой-нибудь продвинутый в js юзер сможет переголосовать в неположенное время.


anpotashev [1 day ago] 
Не забывай про принцип "минимальных привилегий".


MetalBro [1 day ago] 
поэтому хочу отдавать проперти, чтобы на фронтенде просто убиралась функция голосования у юзера)


MetalBro [1 day ago] 
как хочет пусть делает) Пользователю как-то все равно надо сообщать, что его голос не принят (edited)


anpotashev [23 hours ago] 
Так сообщение и будет. Вернешь эксепшн, потом его обработаешь и отправишь код ошибки.


anpotashev [23 hours ago] 
PS Мы отправку кодов ответов на рест-запросы еще не прошли


[11:32] 
пока не хватает знаний, чтобы сделать всю задумку вместе с фронтендом, чтобы понимать как это все


grigory.kislin [1:42 PM] 
@MetalBro из ТЗ: сделать rest без UI


MetalBro [2:01 PM] 
@grigory.kislin там вроде видел, что нужно документацию написать, как с этим работать. Какие-то рекомендации фронтендщику ведь ?


grigory.kislin [3:27 PM] 
@MetalBro примеры curl
собственно тоже, что и в нашем HW7 (edited)


alphadoub [10:30 PM] 
Ещё вот смотрю и сомневаюсь:
Вопрос по иерархичности ресурсов и корректности строения запросов к ним:
1) GET ...appname/restaurants/{restId}/dishes/{dishId}
2) GET ...appname/dishes/id

И тот и другой запрос - получение блюда по id, но первый учитывает иерархичность и принадлежность к ресторанному контексту.

Вот сижу и думаю, а нужна ли эта иерархия, если для получения блюда мне не нужен id ресторана. И запрета доступа к блюдам конкретного ресторана у меня как у пользователя нет (если бы был - другой вопрос): я волен посмотреть (не менять состояние) любое блюдо любого ресторана. Я остановился на втором варианте. Правильно ли я принял решение?


alphadoub [10:47 PM] 
Когда нужно добавить блюдо(мы добавляем блюдо конкретному ресторану) или список блюд получить надо, там необходимость иерархии очевидна (и то в будущем может понадобиться список всех блюд всех ресторанов, но пока вроде не нужно) А вот при получении одного блюда не понимаю необходимость указывать в пути ID ресторана. Не знаю как оставить лучше. (edited)


grigory.kislin [3:28 PM] 
@alphadoub rest- это набор рекомендаций... и сделать можно по разному
2 варианта по любому делать не нужно... потому я бы на 1м остановился


alphadoub [3:40 PM] 
@grigory.kislin, 2 варианта излишне, понимаю. Я и выбираю один из 2. Твой выбор понял, спасибо. (edited)


Alexander _Gubanow [4:22 PM] 
Друзья, у меня вопросы по архитектуре проекта: 1)мы исходим из того что у нас один админ, которому доступны все рестораны для изменения обедов? Или же у нас может быть несколько админов? 2)Тогда каждый может админить только свои рестораны( т.е. которые он создал) или вообще все существующие рестораны?


Дима Жуков 
[5:22 PM] 
По-моему по ТЗ второй вариант. Admin can input a restaurant and it's lunch menu of the day. Было бы Admin can input restaurants and their lunch menu. Тогда да первый)) ну и admins do updates так вроде написано. Но хотя впринципе возможно admin несколько ресторанов может ввести...) (edited)


[5:23] 
А ты как думаешь?


Alexander _Gubanow [6:30 PM] 
Склоняюсь ко второму


[6:33] 
Причем каждый админ "ведет" свой ресторан


[6:37] 
и может иметь несколько ресторанов


Viktor [6:51 PM] 
@Alexander _Gubanow т.е. если 1 админ заболел, то использовать его рестораны никто не может и сотрудники будут голодать? :smiley:


[6:52] 
ИМХО: Рестораны и еда, это вещи не связанные с админами, админ ими только управляет. Если в основном проекты мы можем сказать, что еда принадлежит пользователю, то вот с ресторанами и ланчем так сказать нельзя.


[6:53] 
Ими пользуются все админы и все пользователи

[6:53] 
А вообще ответ в копипасте:
тут один ответ: "У вас конечно есть много мыслей, для чего нужно приложение, как исправить ТЗ, дополнить его и сделать правильно. НО НЕ НАДО ИХ РЕАЛИЗОВЫВАТЬ В КОДЕ. Нужно сделать все максимально просто, удобно для доработок и очевидно (если конечно в ТЗ нет оговорок). "


vch [6:53 PM] 
@Viktor Можно ввести понятие заместителей. Чтобы при временном отсутствии админа (отпуск или болезнь) его мог замещать кто-то другой

Viktor [6:55 PM] 
@vch что-то как-то усложняете :smiley: каждому админу по 2-3 зама, а им ещё по 2-3 зама и в работе их надо рассадить по разным офисам и кормить разной едой, а то вдруг эпидемия в городе, а меню не кому обновить, т.к. админ, которые внес этот ресторан болеет.


vch [6:57 PM] 
@Viktor Нет, я предлагаю лишь 1 заместителя на время отсутствия.
Это ж несложно - перед уходом в отпуск найти кого-нибудь неболеющего в данный момент и передать ему полномочия.


Viktor [6:58 PM] 
а вдруг он сделает что-то не то? его же ещё обучить надо, пользоваться админкой (ладно шутка). Ради какой цели хотите разделить рестораны и еду по админам? Что от этого станет легче и удобнее? (edited)


Дима Жуков [6:59 PM] 
в тз вроде написано так


[7:00] 
За что купил, за то и продаю, как говорится - admins do the updates, Admin can input a restaurant. Или много админов и у них супер права. ну тоже вариант)


Дима Жуков [7:10 PM] 
Ребята, так что если админ ресторан создал и внес меню, любой админ может это поменять или только админ который создал? :thinking_face:

Viktor [7:12 PM] 
я так делаю

Alexander _Gubanow [7:20 PM] 
Получается если у тебя isAdmin=true заходи и меняй еду в любом ресторане, если false - то только голосовать сможешь


Alexander _Gubanow [7:26 PM] 
Тогда уже не сильно важно сколько админов будет, но что не один может быть - это точно



----- Today December 27th, 2017 -----
Dmitry Makarov [7:34 AM] 
Когда запускаю отдельный тест не загружается контекст спринга. Если запустить все тесты все нормально проходит. Кто-нибудь сталкивался?

JavaDev [4 hours ago] 
у меня что-то похожее было. А что по стектрейсу - скинь что пишет когда выдает Эксепшен


Dmitry Makarov [4 hours ago] 
я уже разобрался


Dmitry Makarov [4 hours ago] 
короче это объяснять с ума сойдешь)) я пока нашел в чем причина всю идею перековырял


JavaDev [4 hours ago] 
))


JavaDev [8:58 AM] 
Всем привет, подскажите кто как делает: админы могут сами голосовать? Или все-таки четко по ТЗ, админы - делают апдейты, юзеры - голосуют.


JavaDev [9:23 AM] 
Я вначале делал админа с правами юзер+админ, А сейчас подумал, если в ТЗ нет такого, то и делать буду проще. Юзеры только голосуют, админы только админят рестораны, но не голосуют и не админят пользовательские данные.


Dmitry Makarov [9:27 AM] 
еще надо как-то учесть что админов мало а юзеров много


[9:31] 
>4: учитывайте, что пользователей может быть ооочень много, а админов- мало


[9:31] 
я кажется догадываюсь для чего, но надо еще подумать

JavaDev [9:32 AM] 
cache


Dmitry Makarov [9:32 AM] 
ага


JavaDev [9:32 AM] 
)


Sergey [11:57 AM] 
В задании вообще сказано что админ один, а юзеров много: 2 types of users: admin and regular users


Few 
[12:01 PM] 
@Sergey интересное замечание :slightly_smiling_face: действительно так написано


Dmitry Makarov [12:14 PM] 
>4: учитывайте, что пользователей может быть ооочень много, а админов- мало


dart_rabbit [12:15 PM] 
Сказано, что два типа пользователей "admin" and "regular"

Few [12:37 PM] 
2 types of users: admin and regular users
фраза из оригинального задания, админ в ед. числе а users в множ.


[12:38] 
если читать дословно, без учета раздела Рекомендаций, то замечание верное )


Dmitry Makarov [12:42 PM] 
это будет как из того анекдота про яйца и молоко


Alexander _Gubanow [12:47 PM] 
Ключевое слово types


[12:50] 
и тут видно что админ не один (admins do the updates)


Few [12:57 PM] 
а мы тут сейчас серьезно? :slightly_smiling_face:
делать то конечно будем нескольких, просто интересная неточность в задании



new messages
anpotashev [9:19 PM] 
Друзья, подскажите, возможно-ли как-то получить инстанс эксцепшна по его классу?
```public class ValidationException extends RuntimeException {
    public ValidationException(String message) {
        super(message);
    }

    public ValidationException(String message, Throwable cause) {
        super(message, cause);
    }
}```
Вот такой вот суперкласс. Имею класс одного из потомков, хотелось бы вызвать исключение. (edited)


Viktor [9:45 PM] 
new ValidationException("") не подходит? :smiley: или именно рефлексией хочешь?


anpotashev [9:46 PM] 
@Viktor мне надо не ValidationException получить а одного их наследников


[9:47] 
На стеке задал https://ru.stackoverflow.com/questions/764183/%D0%9A%D0%B0%D0%BA-%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-instance-exception-%D0%BF%D0%BE-%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D1%83 Там чуть более подробно
ru.stackoverflow.com
Как можно получить instance Exception по классу
Добрый день! Подскажите, плиз. Имеется следующий класс: public class ValidationException extends RuntimeException { public ValidationException(String message) { super(message); } ...
 


Viktor [9:49 PM] 
а какой конкретно?


anpotashev [9:51 PM] 
Который придет в параметре.
У меня такая вот аннотация:
```@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface ThrowIfException {
    String message() default "Error!";
    Class<? extends ValidationException> exception() default ValidationException.class;
}```
В ней и указывается какой экцепшн бросить.


[9:52] 
Сейчас у меня на каждый экцепшн своя аннотация, хочу попробовать упросить.


Viktor [9:55 PM] 
эта аннотация оборачивает метод в try-catch и выбрасывает твое исключение если вы методы вывалилось любое?


anpotashev [9:57 PM] 
Нее, эти аннотации отвечают за валидацию на слое сервисов. Некоторые проверяют результат на нулл, некоторые на полученный эксцепшн, некоторые проверяют параметры. По сути это наш ValidationUnit, только с использованием АОП.


[9:57] 
Например, повесил аннотацию на метод и если в результате будет нулл, то получишь исключение. (edited)


Viktor [10:00 PM] 
тоесть теперь ты хочешь сделать 1 аннотацию, которая делает много дел, проверка на null, на исключение...?


anpotashev [10:01 PM] 
Ну скажем не одну, но придать гибкость, указывая тип исключения в качестве параметра
Вот например:
```@AfterReturning(value = "throw404IfNullResult() && @annotation(annotation)", returning = "result")
    public void checkResult1(Object result, Throw404IfNullResult annotation) {
        log.debug("checking result for null");
        if (result == null) {
            log.debug("throwing Exception404");
            throw new Exception404(annotation.message());
        }
    }```
Чтобы Exception404 можно было бы задать в качестве параметра (edited)


Viktor [10:06 PM] 
так а через Аоп почему не кинуть ошибку которая указана в аннотации? Как вариант посмотреть как работает ожидаемое исключение в тестах

anpotashev [10:07 PM] 
Не понял, что значит кинуть ошибку?

[10:08] 
Предлагаешь HttpStatus добавить вместо экцепшна?


Viktor [10:23 PM] 
что ты хочешь делать этой аннотацией?


[10:28] 
И в идеале покажи что делаешь, что получается и что ожидаешь.

anpotashev [10:37 PM] 
Дык вроде показал. Аннотация на методом инициирует валидацию и в случае чего кидается исключение. Это исключение затем обрабатывается в rest и пользователь получает ту или иную ошибку. Вот и хочу чтобы тип исключения можно было задать в аннотации в качестве параметра. А вот чтобы его в итоге сгенерировать из класса пока не нашел подходящего решения. (edited)


[10:42] 
т.е. примерно хочу:

```    public void checkResult1(Object result, ValidationAnnotation annotation) {
        log.debug("checking result for null");
        if (result == null) {
            Class<? extends ValidationException> clazz = annotation.execption();
            ValidationException exception = bla-bla-bla(clazz);
            throw exception;
        }
    }```


Viktor [10:45 PM] 
ValidationException exception = clazz.getInstance() там ещё как-то с конструктором надо подружиться


[10:46] 
https://docs.oracle.com/javase/tutorial/reflect/member/ctorInstance.html
docs.oracle.com
Creating New Class Instances (The Java™ Tutorials >                     The Reflection API > Members)
This reflection Java tutorial describes using reflection for accessing and manipulating classes, fields, methods, and constructors


[10:46] 
тут почитай и как конструктор нужный найти и как инстанс создать.

anpotashev [11:10 PM] 
Спасибо, натолкнул на мысль, как можно сделать. Сейчас попробую.



----- Today December 28th, 2017 -----
anpotashev [12:20 AM] 
Супер! Сработало. @Viktor, спасибо!
Количество кода весьма сократилось.


anpotashev [12:26 AM] 
Только теперь возник еще один вопрос: Как это тестировать?
Если эксепшны бросаются в зависимости от аннотаций, то правильно-ли их проверять в тестах, как это сделано в топджава?


Erick [7:56 AM] 
подскажите по архитектуре, в каком случае нагрузка на базу будет меньше?
и будем ли мы расширять сущность Dish (у которой сейчас 2 поля name и price)?
как лучше сделать?
1: две таблицы dishes и menu, и хранить ссылки друг на друга и джойнить в запросах?
2: одну большую таблицу menu (включающую dishes) на 15-20 полей, и при доставании данных из базы мапить эту реляционную модель на две объектных? (edited)


[8:00] 
второй вопрос риторический... т.к. "... ПМ (лид, архитектор) дал вам ТЗ и некоторое время недоступен."


Erick [8:59 AM] 
и сумеет ли Hibernate реализовать второй пункт? пока буду делать первый вариант.


grigory.kislin [12:05 PM] 
@Erick  
> одну большую таблицу menu (включающую dishes) на 15-20 полей
а как там еду хранить?? если например 21:)?  судя по вопросы- проблемы с RMDB моделями. посмотри на программу basejava- там мы делаем модель посложнее, чем на topjava



alphadoub [9:15 PM] 
Я без меню делаю. Не вижу необходимости в нём, когда есть просто сущность блюдо, возможность вытащить список этих блюд (по любому интересному тебе критерию), и возможность устанавливать relationships между сущностями.



anpotashev [9:56 PM] 
Я вот еще чего недопонимаю, так это что лучше повесить на rest-root. Или можно вообще ничего не отдавать по нему.



----- Today December 29th, 2017 -----
grigory.kislin [1:02 AM] 
@anpotashev у нас - только rest. на руте его быть не должно (edited)


anpotashev [1:21 AM] 
Под рутом подразумеваю /rest/.


MetalBro [1:48 AM] 
@alphadoub и где собираешься хранить отношение к дате и ресторану, тоже в сущности блюд?


[1:51] 
если делать меню, то может быть проще будет вытащить актуальные меню на несколько дней, хз. Если в соответствие меню ставится блюдо


anpotashev [2:01 AM] 
@MetalBro именно там и хранить. Прекрасно работает.


MetalBro [2:53 AM] 
Насколько удобно таким образом реализовывать историю, выдавать список меню на неделю например?


[2:54] 
получает RestController будет отдавать List<Dish> или List<List<Dish>> при запросах к ресторану? и отдельным ссылкам на дата-меню на страницах ресторана


[2:55] 
Надо посмотреть, может и правда удобнее. Но кажется, что будет много хитросплетений с вызовом методов)


Erick
[3:23 AM] 
@anpotashev я тоже хочу обойтись без меню. есть ресторан, в нем List<Dish> menu. в базе 2 таблицы: рестораны и блюда. 
как хранишь историю голосований? (edited)


Viktor [5:22 PM] 
@grigory.kislin подскажите по ТО. Идея появилась отправлять вместе с ТО ссылки. Допустим отправляем ланч и вмести с ним ссылки delete. edit. Но в тоже время доступы к этим ссылкам у обычного пользователя быть не должно. Это можно оставить, чтобы "решал" тот кто делает фронт или об этом надо заботиться нам?


grigory.kislin [9:20 PM] 
@Viktor если хочешь линки, то см. https://spring.io/understanding/HATEOAS
мы на create делали- чтото на это похожее
spring.io
Understanding : HATEOAS (16 kB)
(edited)




----- Yesterday December 30th, 2017 -----
grigory.kislin [7:10 PM] 
добавил:
*Отнеситесь к проекту как к вашему тестовому заданию на работу! Это означает, что НЕ будет возможности объяснять, почему ты так сделал код и что для запуска надо создать базу данных или переменную окружения. Если что-то не по ТЗ или не запускается и нет инструкции или код непонятный и нет комментариев - молча вычеркнут из кандидатов.* (edited)


Katherine Buzatu [5:00 PM] 
>что пользователей может быть ооочень много
Товарищи, мы еще не обсуждали вопрос масштаба системы. Если рекомендуется использовать инмемори БД, то это не гугл-масштабы. Тогда очень много - это сколько? Давайте поговорим об этом :)


vch [5:03 PM] 
@Katherine Buzatu вроде субд SAP HANA вполне работает с 50-терабайтными базами. Кто скажет, что она не `inmemory` - пусть первый бросит в меня камень.


Katherine Buzatu [5:10 PM] 
@vch я правильно понимаю, что с `inmemory` проблем с производительностью будет меньше, и не надо сильно заморачиваться на тему денормализации и прочего колдовства уровня БД, дабы не усложнять?


Дима Жуков [5:11 PM] 
Возможно тут главное принцип работы показан должен быть) понимание есть что может быть много)


[5:12] 
Inmemory хорошо им проверять. Не надо париться)


vch [5:12 PM] 
@Katherine Buzatu увы, нет. Обычные СУБД тоже кэшируют часто используемые данные. Т.е. разница, конечно, будет, но не такая кардинальная, как хотелось бы.

Katherine Buzatu [19 hours ago] 
то есть надо все-таки решить проблему с потенциально большим количеством юзеров и счетчиков?


vch [19 hours ago] 
индексы никто не отменял


Katherine Buzatu [18 hours ago] 
А индекс поможет, если N пользователей захотят одновременно отдать свой голос? То есть много запросов на изменение и чтение одной и той же записи. Мне кажется, эту проблему можно оставить на совести инмемори БД, а при переходе на другую это уже не пройдет. (edited)


vch [18 hours ago] 
Смотря какая структура таблицы.
1 очевидное поле для индекса - это день. Если мы собрали данные за 100 лет, то это 36500 дней, т.е. поиск нужного дня - это 15 шагов. Мизер.
2 поле - юзер. Мы амбициозны, поэтому заложим 1 миллион юзеров (где вы найдёте ресторан, принимающий столько гостей - не знаю, это уже не мои проблемы). Поиск по индексу - 20 шагов.
Итого - чтобы добраться до нужной 1 записи, СУБД надо потратить 35 шагов.
По-моему, совсем немного.
А что касается `одной и той же записи` - если индексы уникальные, то эта запись, с которой идёт постоянная работа, будет в кэше. И доступ ещё быстрее получится.


Katherine Buzatu [18 hours ago] 
Вот во последнему абзацу и вопрос: в задании не сказано, это будет одно голосование в день или международная система "выбери ресторан". Насколько большим имеет право быть кэш?


vch [18 hours ago] 
в задании сказано, что 1 юзер голосует только 1 раз в день.


Dmitry Makarov [18 hours ago] 
@Katherine Buzatu если система международная тогда надо часовой пояс ресторана учитывать при голосовании


vch [18 hours ago] 
@Dmitry Makarov Тут не в часовом поясе будет проблема. 
Для начала надо группировать юзеров по какому-нибудь признаку (например, городу) и считать результаты по этой группе.
Иначе голосование выиграет китайский ресторан, а туда лететь половине пользователей 10 часов.


Dmitry Makarov [18 hours ago] 
@vch тоже важный момент


Katherine Buzatu [17 hours ago] 
В задании сказано, что только 1 голос юзера будет учтен. И что до 11 они могут сидеть и тыкать в голосовалку, сколько угодно. И голосований может быть больше одного. К примеру, каждая компания может открывать свое голосование со своим списком ресторанов. И все это в один день. Нам не сказано, что в день будет только один список для голосования...


dart_rabbit [17 hours ago] 
Мне кажется, вы слишком глубоко копаете)) 
Вводные данные ничего такого не содержат. Т.е. сделать историю голосований (рекомендации п.13) - логично, потому, что это нормальный функционал. А часовые пояса, несколько списков для голосования... - имхо, это уже измышления :slightly_smiling_face:



vch [16 hours ago] 
мы мыслим, следовательно существуем :slightly_smiling_face: (с) Декарт 
Если же чуть вернуться к практической стороне вопроса - то сделанный проект будет показывать Григорию малая часть участников. Все остальные не ограничены в творчестве и могут экспериментировать в своё удовольствие. (edited)


grigory.kislin [12:39 AM] 
привет! мои мысли на тему "много юзеров"

1. в п. 6 базу лучше взять без установки (H2 или HSQLDB) 
это как сказали уже- чисто для удобства проверки, чтобы запусить - и сразу заработало. инмемори нигде нет, этим парится не надо
2. много означает что для каждого юзера при голосовании надо минимизировать запросы к базе
думаю что добавлю в ТЗ:)


[12:41] 
да собственно там все есть: тщательно считайте количество обращений в базу на каждый запрос. Особенно при запросах от юзеров, которых очень много! Также на сложность запросов от них, чтобы не положить базу


Viktor [3:36 AM] 
@grigory.kislin может быть выражу общую проблему в запросами (ну мою точно).
Сколько запросов должно быть на пользователя при голосовании? По 1-2 запроса на голосование\переголосование 1 пользователя это нормально?


[3:38] 
Есть 3 крайних варианта:
1) 1,000,000 пользователей и каждый проголосовал 1 раз = 1,000,000 запросов в базу.
2) 1 пользователь, который спамит запросами и 1,000,000 раз меняет голос.
3) самый плохой 1,000,000 пользователей, которые по 1,000,000 раз меняют голос в день.


[3:39] 
В первом случае 1-2 запроса на пользователя выглядят нормально.
Во втором уже не очень и может стоит кешировать, но есть шанс потерять данные.
В третьем 1-2 запроса на голос\переголос уже очень много.


[3:40] 
У меня просто нет хоть какого-либо понимания "очень много запросов от юзеров", сколько это, как посчитать и на что ориентироваться.


[3:42] 
Пока ориентируюсь на наш основной проект. Т.е. если уж пользователь начнет спамить запросами то будет плохо, но мы этот вариант не рассматриваем и на каждое действие идем в базу за едой. Взял это за норму.


Katherine Buzatu [12:19 PM] 
Поддержу предыдущего оратора и немного продолжу.
> 1) 1,000,000 пользователей и каждый проголосовал 1 раз = 1,000,000 запросов в базу.
Применим это предположение к нашей предметной области.
Ресторан принимает определенное кол-во человек, следовательно, на одно голосование может быть не больше 200-300 пользователей. Я не спец по БД, но могу предположить, что это не много, к тому же вероятность того, что они все одномоментно пошлют в базу разные запросы, можно приравнять к нулю.
Если пользователей даже не очень, а "ооочень" много, то очевидно, что список для голосования на каждый день будет не один, и это сильно меняет и структуру модели, и логику работы приложения, особенно кеширования.
К примеру, 1,000,000 юзеров / 250 чел. на голосование  = 4000 возможных списков голосования в день, а то и больше. И если с одним списком на 200-300 юзеров можно использовать кэш практически для всех операций чтения, то с "ооочень большим" количеством, наверное, так не получится.
Дальше. Если таблицы будут расти в день на миллион-другой, то одной таблицей уже, наверное, не обойтись.
В общем, если бы не рекомендация 4, :
>  учитывайте, что пользователей может быть ооочень много
делала бы, не задумываясь, в расчете на масштабы небольшого предприятия, которое в полном составе в состоянии принять один ресторан. (edited)


grigory.kislin [4:15 PM] 
@Viktor @Katherine Buzatu я возможно раскрою детали..
посмотреть данные для голосования лучше вообще без запроса в базу
проголосовать - 1 запрос
защиту от брутфорс, ddos и пр. в тестовых заданиях обычно не делают, если спец. не упоминается (edited)


dart_rabbit [4:18 PM] 
@grigory.kislin
"посмотреть данные для голосования лучше вообще без запроса в базу" 
Не понял))  У нас в базе рестораны и набор блюд на дату - как без запроса-то?! %)

Valery [1 day ago] 
После того как админ создал список для голосования его достаточно считать один раз из базы и держать в кеше.


dart_rabbit [1 day ago] 
"А, ви в этом смисле!" (с) А то я уж перепугался)))


Viktor [5:42 PM] 
@grigory.kislin примерно так я и рассчитывал :smiley: Просто все эти "пользователей много, следите за запросами" толкало на мысли, что надо ещё меньше запросов на 1 голос (edited)



alphadoub [7:02 PM] 
А как принято поступать с логированием в файл? Какой путь указывать? На разных машинах же может запускаться приложение? Если в настройках путь указать через переменную окружения, а в readme к проекту написать:
«Товарищ, нужно создать такую-то переменную окружения» - это нормально?
Или так не принято делать?



Valery [7:13 PM] 
>Отнеситесь к проекту как к вашему тестовому заданию на работу! Это означает, что НЕ будет возможности объяснять, почему ты так сделал код и что для запуска надо создать базу данных или переменную окружения. Если что-то не по ТЗ или не запускается и нет инструкции или код непонятный и нет комментариев - молча вычеркнут из кандидатов


Viktor [8:04 PM] 
@alphadoub а спринг в какой файл пишет логи? :smiley:


alphadoub [8:07 PM] 
@Valery , вот я именно это прочитал и именно поэтому возник вопрос: «если нет инструкций». Информация в readme - инструкция?


alphadoub [9:02 PM] 
Обошёлся :slightly_smiling_face:


----- Today January 7th, 2018 -----
grigory.kislin [1:58 AM] 
@alphadoub логировать лучше в текущий каталог



dart_rabbit [4:16 PM] 
Вопрос по синтаксису запросов - получаю результаты голосования за дату 
@Query("SELECT DISTINCT r FROM Restaurant r JOIN FETCH r.votes v WHERE v.date=?1 ORDER BY r.votes.size DESC")
List<Restaurant> getAllWithVotes(LocalDate date);
В списке только те рестораны, по которым за эту дату были голоса. Как сделать так, чтобы в этом списке были и рестораны с нулевым списком голосов?


Дима Жуков [4:28 PM] 
Full join, outer join, cross join. Может с этим поиграться?


vch [4:39 PM] 
cross join - это жестоко...

dart_rabbit [4:41 PM] 
Ну, да..)


[4:43] 
В native query, к тому же запрос будет. Иначе есть только LEFT и INNER ) (edited)

Дима Жуков [4:43 PM] 
:sunglasses:


dart_rabbit [4:45 PM] 
Можно в два запроса, конечно, сначала выбрать рестораны с блюдами на дату, потом с голосами и .... )) Но хотелось в один запрос)


Дима Жуков [4:47 PM] 
Full join возможно hsql база и не поддерживает. Postgres то наверное  не поддерживает


[4:51] 
А cross join это несколько  я помню просто через запятую таблицы указать? Select * from restaurants, votes ... -?  По-моему я как то смотрел это почему то быстрее исполнилось чем через join в mysql в phpmyadmine. Кто знает это cross join  просто?


dart_rabbit [4:54 PM] 
кросс - это когда тебе выдаст все пересечения двух таблиц. Т.е. три ресторана на три дня голосований трех пользователей дадут 27 строк))


Дима Жуков [4:56 PM] 
ОК. Я помню что через запятую таблицы после  from это тоже типо на самом деле какой то join у которого есть название)))


[4:59] 
Ну или альтернатива какому то joinу. Ну не cross конечно...


vch [5:01 PM] 
@Дима Жуков см. https://ru.wikipedia.org/wiki/Join_(SQL) :
```SELECT *
FROM
  Person
  CROSS JOIN
  City```
эквивалентен
```SELECT *
FROM
  Person,
  City```
(edited)



Дима Жуков [5:04 PM] 
Так все таки cross join? Память не подвела


[5:06] 
Ну если добавить условие то inner join обыкновенный

vch [5:07 PM] 
Да, именно так. Впрочем, без условий обычно не пишут. Но лучше запятую не использовать, чтобы читающему не приходилось изучать весь запрос, пытаясь понять, какой же JOIN тут имеется в виду.


dart_rabbit [5:10 PM] 
Ну, по факту-то получится один запрос - рестораны с блюдами закэшированы, т.е.  мы запрашиваем только голоса на дату (если на прошлую, то тоже из кэша, если на сегодняшнюю, то может и не из кэша)))))


Yuri [6:06 PM] 
Всем привет! И с Рождеством:)
Кто-нибудь пытался как-то упорядочить моки в тестах? Поделитесь идеями, как правильно это делать))
А то у меня как-то совсем адово получается... моки доменных объектов, еще и dto, и кое-где надо это объединять в списки для проверки результата... а в результате голосования надо либо заново генерить список из существующих моков, либо менять имеющийся список...
Я просто смотрю на то, что получилось и понимаю, что хотя оно для меня понятно, и оно работает, но возникает мысль - может все-таки есть какое-то более правильное решение?)


Yuri [7:03 PM] 
Вот. И еще несколько вопросов, с которыми столкнулся. Если кто знает - пишите, если нет - будет повод поразмыслить:)


Yuri [7:11 PM] 
1. В контроллере надо проверять то, что дается на вход. С @ RequestBody понятно, а @ RequestParam и @ PathVariable надо ли проверять на null всегда или только в случае когда required = false?


Yuri [7:17 PM] 
uploaded and commented on this image: изображение.png
1 Comment
2. Если я делаю обертку над методом Spring Data JPA, например:



Yuri [7:19 PM] 
Надо ли делать проверку аргументов или это надо оставить, т.к. Spring Data JPA само разберется? Я сделал, т.к. в исходнике getOne() в Spring указано, что id не должен быть null.


anpotashev [7:22 PM] 
@Yuri а метод научного тыка? Запустить и попробовать отправаить нулл


Yuri [7:25 PM] 
@anpotashev - пробовал, если required=false - то @ RequestParam можно сделать null. Если true - то у меня не получилось сделать его null. Но то, что у меня не получилось, еще не означает, что это принципиально невозможно, вот в чем вопрос))

anpotashev [1 hour ago] 
про аргументы datajpa


Yuri [1 hour ago] 
ммм?


anpotashev [1 hour ago] 
Про это писал "Надо ли делать проверку аргументов или это надо оставить, т.к. Spring Data JPA само разберется?"
Подсунь ему нулл и посмотри что будет.


Yuri [1 hour ago] 
Оно выдает свой exception. Вопрос в том - как будет правильнее)


anpotashev [1 hour ago] 
не скажу как правильнее, могу сказать каку меня: эксепшны которые прилетают из репозиториев оборачиваются в еще одно исключение на слое сервисов. А дальше обработка исключений на слое веба и возврат соответствующих ошибок клиенту.


Yuri [7:32 PM] 
3. Логика приложения подразумевает цепочку вызовов контроллер->сервис->репозиторий. Если входные параметры в методе контроллера проверены на валидность (в частности not null), надо ли делать еще одну проверку, например, в репозитории? Я делал в репозитории ассерты, по сути еще проверку.


Yuri [7:41 PM] 
4. Насколько правильно/неправильно использовать native sql? Я понимаю преимущества абстракции, которые дает Spring Data JPA (или думаю, что понимаю:) ) и JPA, но некоторые вещи мне удобнее просто взять и написать просто на SQL, например, выборку с подсчетом голосов.

anpotashev [1 hour ago] 
Некоторые sql конструкции могут различаться в зависимости от конкретных б.д. jpql и т.п. дают в первую очередь универсальность в отличие от sql.
Имхо sql в приложении надо минимизировать


Yuri [1 hour ago] 
Да, я понимаю это. Но вот с агрегатными функциями мне так и не удалось совладать на JPQL. И еще проблема была со сравнением даты из поля БД и now() - но тут я догадываюсь как надо переписать. А вообще в запросах я старался использовать только то, что входит в стандарт SQL.


anpotashev [1 hour ago] 
А в чем затруднение с агрегатными?


Дима Жуков [7:48 PM] 
Напиши проект как знаешь, чему научился, как считаешь правильно. На ревью проекта тебе скажут что не так и почему. Увидишь свои изьяны в какой то степени. Там ревьюят люди опытные. Проверка дз есть? Или ты на стажировку хочешь попробовать?


Yuri [7:55 PM] 
Проверка есть, просто некоторые штуки, которые мне уже сейчас кажутся спорными ... хочется с ними сразу разобраться)


grigory.kislin [10:07 PM] 
@dart_rabbit
> Как сделать так, чтобы в этом списке были и рестораны с нулевым списком голосов
1. а почему не LEFT JOIN??
2. на всякий случай: еще раз прочтите про юзеров и их запросы к базе



----- Today January 8th, 2018 -----
Katherine Buzatu [12:03 PM] 
Товарищи, поделитесь, как проверяете работоспособность своей голосовалки по ходу разработки? Подробные тесты на все / TDD / свой клиент и вручную / никак :) ?

philip.goldm [10 hours ago] 
1. тесты на (services, REST) / TDD
2. Вручную через Postman. В Postman есть возможность сохранить результаты нужных запросов чтобы использовать в других запросах. Таким образом можно не тратить много времени на написание параметров.


Yuri [2 hours ago] 
подробные тесты на все + вручную через curl (точнее написал скрипт на bash)


dart_rabbit [12:05 PM] 
тесты, REST через rested или postman или soapui...


alphadoub [3:02 PM] 
Вот вы работаете с голосами. Вы голоса достаете как elementCollection или у вас отдельная сущность(Еnitty) для голоса есть? (edited)


Viktor [5:58 PM] 
у меня отдельная сущность + отдельная таблица + есть сущность под результаты голосования :smiley:


alphadoub [6:26 PM] 
@Viktor , ясненько. А я сделал функционал голосования, в теперь переделывать надо. Код простой, но при миллионе юзеров будет тяжко. Слишком много модифицирующих запросов. У меня вообще было 3 сущности. В ресторане был Атомик который при голосовании атомарно инкрементировался, а при изменении голоса в пользу другого ресторана декрементировался. Но голосование - судя по всему частая операция и рестораны не закэшировать так. И я отказался от этого. Если б это была внутрикорпоративная голосовалка «для маленькой такой компании», то ладно, а если 100500 юзеров - то плохо. Сейчас переделываю. Сам себя «нахитрил»:relaxed: (edited)


Valery [6:44 PM] 
>В ресторане был Атомик который при голосовании атомарно инкрементировался, а при изменении голоса в пользу другого ресторана декрементировался
тоже такая мысль была. проблемой оказалось вычитать голоса. для этого надо знать за кого голосовал пользователь ранее и голосовал ли вообще. а это лишние запросы в базу.


alphadoub [6:47 PM] 
@Valery , ага. У меня была ссылка на Ресторан в Юзере. Я проверял при голосовании её. Если null - то это голосование, если нет - «переголосование». Вобщем дорого это, согласен. А так красиво было. Три сущности. Но увы.


dart_rabbit [6:54 PM] 
Одна сущность с композитным первичным ключом - user-date, при переголосовании меняется реквизит - ресторан :slightly_smiling_face:


Yuri [7:50 PM] 
Отдельная сущность для голоса+отдельная таблица с голосами. Отдельно голоса как таковые вообще не достаю, достаю результаты голосования...


[7:52] 
Вообще интересно даже прогнать приложение скажем на 10млн данных)
Надо будет попробовать))


alphadoub [9:11 PM] 
Столько вопросов по логике, если начать задумываться, голова пухнет. Когда админ может добавлять еду ресторану? Ну условно в 10:59 на этот же день может? С учетом того, что с 11:00 голосование этого дня прекращается? Вроде не нужно углубляться, но блин, вопросы такие очевидные. У меня таких мелких вопросов, написанных ручкой на бумаге уйма (типа решить). (edited)


Valery [9:25 PM] 
>Когда админ может добавлять еду ресторану?
ИМХО, когда угодно. Уйдет в запой, заболеет и пр. Ну не будет за что голосовать, но на работоспособности приложения это не должно сказаться. Просто в getAll() надо учесть пустой список.


anpotashev [9:30 PM] 
Я запретил только редактирование меню за прошлые дни + софт-удаление записей, чтобы статистику не испортить.


alphadoub [9:32 PM] 
Это да. У меня тоже проверка дат есть. Ладно. Подумаемс.


[9:34] 
Редактирование редактированию рознь тоже. Если в «прошлом» есть орфографическая ошибка в названии еды: условное «эКспрессо», почему бы её не исправить. :grinning:


anpotashev [9:36 PM] 
А для этого у меня отдельный справочник еды. Название исправить можно, а цену - нет.
Там, правда, тоже можно испортить, переименовав стейк в манную кашу.

alphadoub [9:36 PM] 
Во-во


[9:36] 
Понеслась


[9:36] 
:grinning:


[9:37] 
Ладно, пошёл кофе заварю. Всем добра!



Valery [10:00 PM] 
не понимаю, зачем запреты вводить. Админ - лицо ответственное. в том плане, что отвечает за приложение. И что плохого в правке прошлых записей? Гораздо хуже когда редактируется меню в день голосования. Проголосовал кто-то утром за манную кашу, а ближе к обеду она перловой оказалась - вот тут будут негодования.


anpotashev [10:06 PM] 
не только ответственность. Правило есть такое "не ошибается только тот, кто не работает".


[10:10] 
Как-то, на заре карьеры, ошибочно нулевую цену забил в программу. За пару недель хороший такой убыток нарисовался. Я был тогда в роли такого вот админа.


alphadoub [10:15 PM] 
@Valery , дак вот никто и не против редактирования прошлого, но избирательно. Представь, что я отредактировал даты прошлого меню. Голоса за ресторан есть, а блюд на этот день нет. Они уехали в 2118 год случайно.


[10:18] 
Вобщем ладно. Наверное надо постараться проще все сделать. Просто когда это «проще» кажется неправильным, тяжело от этого абстрагироваться.


anpotashev [10:25 PM] 
Друзья, а как кто поступает с исключениями в проекте? Создаете их при валидации результатов из репозитория?


alphadoub [10:27 PM] 
Будет в topjave, или уже было


anpotashev [10:27 PM] 
Ты про обработку исключений?


alphadoub [10:27 PM] 
Ага


[10:27] 
А ты?

anpotashev [10:28 PM] 
Так я ее сделал. Но насколько помню, исключения весьма ресурсоемкая процедура.


[10:29] 
И если регулярно отправлять один и тот же некорректный запрос, то можно сервер загрузить исключениями покруче чем кривым sql-ем.


Viktor [10:40 PM] 
@anpotashev как тут уже писал Григорий, варианты атак на сервер пока не рассматриваются. (edited)


anpotashev [10:53 PM] 
Но все же, может кто-то знает другой путь, чтобы отдать инфо об ошибке юзеру, кроме как генерировать исключение, и потом его обрабатывать.


grigory.kislin [11:38 PM] 
@anpotashev обработка исключений у нас будут на 10м уроке (edited)



----- Today January 9th, 2018 -----
MetalBro [4:31 AM] 
у исключения же можно аннотацию ResponseStatus и выбрасывать в контроллере по условию


[4:32] 
По поводу админов, вы тут походу искусственный интеллект хотите) На что тогда админ? Должен же за  что-то отвечать


anpotashev [12:30 PM] 
исключения у меня и так обрабатываются методом с аннотацией ExceptionHandler. Вопрос был можно ли валидацию сделать БЕЗ использования исключений. (edited)


dart_rabbit [6:58 PM] 
Прикручивать ли пагинацию? Всё-таки пользователей у нас много... ;))


vch [6:59 PM] 
@dart_rabbit а где её применить? web-интерфейса вроде не заказывали...


dart_rabbit [7:00 PM] 
в репозитории и запросах контроллеров.


[7:02] 
Просто, если пользователей у нас "оочень много", то дергать полный список может быть накладно)


vch [7:03 PM] 
@dart_rabbit я не вижу в ТЗ ни малейшего указания, что список пользователей надо отдавать наружу по REST



dart_rabbit [7:04 PM] 
Ммм. Т.е. админы пользователей не админят, а админят строго рестораны и блюда? Утопично немного)


MetalBro [8:38 PM] 
пагинацию если надо на фронтенде сделают



----- Today January 11th, 2018 -----
Антон Кляшторный [11:51 AM] 
If user votes again the same day:
If it is before 11:00 we asume that he changed his mind.
If it is after 11:00 then it is too late, vote can't be changed - эти условия для повторного голосования юзеров, для неголосовавших юзеров голосование идет нон-стоп 24/7? с учетом: Only one vote counted per user



grigory.kislin [12:11 PM] 
@dart_rabbit
> Прикручивать ли пагинацию?
ну, по REST тоже пагинацию делают.. но вТЗ нет ничего. те опционально, только если все остальное сделано - то можно (edited)


dart_rabbit [2:38 PM] 
Вопрос по кэшу:

есть метод контроллера - 
@GetMapping(value = "/with_votes", produces = MediaType.APPLICATION_JSON_VALUE)
   public List<RestaurantWithVotes> getAllWithVotes(@RequestParam(value = "date", required = false) @DateTimeFormat(iso = DateTimeFormat.ISO.DATE) LocalDate date)
Если параметр date есть - отдаем за дату, если даты нет - отдаем за сегодня. 
Сегодняшние данные лучше не кэшировать - они меняются, данные за дату кэшировать надо - они исторические и меняться не будут. 
Собственно вопрос: если сделать два метода - с датой (кэшируемый) и без (не кэшируемый), и в метод с датой подать сегодняшнюю дату, то она попадет в кэш. Как этого избежать? Форвардить маппинг другого метода?


anpotashev [2:54 PM] 
Может поможет: Если ты из метода A вызовешь метод B, который с кашей и в том же классе что и A, то кэш на методе B не сработает.

vch [2:55 PM] 
логично


dart_rabbit [2:56 PM] 
@vch форвардить или вызвать В из А?


anpotashev [2:57 PM] 
Вызвать. Именно вызвать. Я так делал. Но, в сервисе а не в контроллере (edited)


vch [2:58 PM] 
@dart_rabbit в качестве костыля я бы объявил через @Autowired локальную переменную этого же интерфейса и вызывал через неё. Наверно сработает. (edited)


anpotashev [2:59 PM] 
Как раз надо чтоб кеш не работал. Поэтому переменная не нужна


vch [3:00 PM] 
А зачем вам вообще кэшировать вчерашние данные? По-моему, как раз они вообще уже никому неинтересны. Все работают только с сегодняшними


dart_rabbit [3:01 PM] 
Чтоб за историей не лезть в базу?

[3:01] 
Я еще думаю в сторону условий т.е. вот так: @Cacheable(value = "restaurants", condition = "#date!=today")

anpotashev [3:01 PM] 
У меня так как-то было:
```@Cache
public .... method1(Date) {....}
public ... method1() {
this.method1(now()); // тут кэша не будет.
}```


vch [3:02 PM] 
@dart_rabbit в ТЗ не вижу ничего о том, что их надо отдавать наружу. И даже если какой-то любопытный админ захочет узнать, где народ обедал год назад, то такие запросы будут редкими и для кэширования, мне кажется, не подходящими


dart_rabbit [3:03 PM] 
Про историю голосований Григорий толсто намекнул в рекомендациях же)

anpotashev [3:04 PM] 
Полагаю история голосований - это данные в бд


vch [3:04 PM] 
он намекнул про хранение истории. Но не то, что надо делать OLAP для быстрого доступа к старым данным.



anpotashev [3:05 PM] 
Хотя, у меня так же есть возможность получить кол-во голосов за дату


[3:06] 
Нам по ТЗ, вроде, и за текущую дату не надо отдавать кол-во голосов



dart_rabbit [3:07 PM] 
Что значит хранение? Есть вариант, при котором в полночь база превращается ~в тыкву~ пустеет? (edited)



anpotashev [3:07 PM] 
Есть и такие варианты


dart_rabbit [3:07 PM] 
Такой, как раз, был бы описан в ТЗ, имхо


MetalBro [5:18 PM] 
по-моему кроме юзеров остальное мало нуждается в кешировании. Может если только данные по голосам на ресторан (фронтенд реализует рейтинг за все время). Тут и не суть важно сегодня/не сегодня. Один день существенной разницы играть не будет


dart_rabbit [5:20 PM] 
Ну почему же? Например список ресторанов с блюдами на сегодня - много юзеров будет его запрашивать прежде, чем проголосовать, а меняться он не будет, заданный админами в начале дня.

anpotashev [1 day ago] 
Только почему в начале дня? Нельзя что-ли на неделю вперёд внести? Или хотя бы на завтра. (edited)


dart_rabbit [1 day ago] 
@anpotashev Можно конечно, таких ограничений у меня, например, нет.


anpotashev [1 day ago] 
Только почему в начале дня? Нельзя что-ли на неделю вперёд внести? Или хотя бы на завтра. (edited)


dart_rabbit [1 day ago] 
@anpotashev Можно конечно, таких ограничений у меня, например, нет.

dart_rabbit [15 hours ago] 
Как так, два? У меня с композитным ключом один запрос на запись/обновление голоса...


anpotashev [10 hours ago] 
+ один запрос на проверку есть ли уже голос - создавать или обновлять.


alphadoub [1:04 AM] 
По 2 полям? (edited)


anpotashev [1:04 AM] 
Да


alphadoub [1:05 AM] 
Я склоняюсь к этому, но многие пишут, отказывайтесь от составных ключей. Может и не актуально. Сижу-гуглю


Dmitry Makarov [1:06 AM] 
накидай ссылок что пишут


anpotashev [1:06 AM] 
Date и User в entity; date и id - соответственно в таблице


[1:06] 
У меня сперва в price был составной, но от него отказался.


alphadoub [1:07 AM] 
Price - жопа(пардон). Точно не вариант для ключа


anpotashev [1:08 AM] 
Ну почему, с ним тоже работало. Но без него проще стало.


alphadoub [1:10 AM] 
Вобщем, резюмирую, у тебя vote функционал - это 2 запроса. Не 1


anpotashev [1:11 AM] 
Да, для времени до 11. После 11 - один.


alphadoub [1:13 AM] 
:hugging_face:


MetalBro [6:36 AM] 
entityManager.getReference и SpringDataJPA.getOne не делают запрос в базу. Учитываете?

anpotashev [9 hours ago] 
На этом проекте решил попробовать soft-delete - поэтому тоже с запросом идет


grigory.kislin [9:05 PM] 
по поводу простых-составных ключей где-то на so читал. холивар:) те и так и так можно
но хибернате с составными плохо работает
однако если хочется и работает, то можно


Gle [3:32 PM] 
Привет, подскажите, в контроллере можно несколько сервисов дергать?


vch [4:11 PM] 
@Gle Хмм... А кто посмеет запретить?


alphadoub [4:33 PM] 
Как правильно сравнивать коллекции элементов, которые имеют только lazy загружаемые поля? Ну то есть видел, что да, есть assertJ,с помощью него можно подобрать логику сравнения, например игнорировать поля с ленивой загрузкой. Но если все поля ленивые (не исключишь же все), как сравнивать. Не игнорировать, а просто сравнивать элементы коллекций fieldByField - приведёт к LazyInitializationException. Ну оно и понятно. Hib сессия закрыта и мы не можем получить доступ к ленивым полям


grigory.kislin [4:36 PM] 
@Gle да, делаею. особенно если логика сложная в контроллере. хотя по рекомендации логику выносят в слой сервиса, зависит от проекта


[4:37] 
@alphadoub если ты хочешь менять логику работы программы ради тестов- то никак не надо (edited)


alphadoub [4:41 PM] 
@grigory.kislin, понял. Да проблема только в тестировании. Программа работает, консоль показывает запрос, который правильный, все необходимое для логики загружено. Только сравнить не могу. Ну понял вобщем, спасибо


alphadoub [4:54 PM] 
@grigory.kislin , хотя, блин, мне ж для текущего тз достаточно сравнить размеры коллекцией. Всё я все решил для себя. Проще надо быть)))
